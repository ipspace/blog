---
url: /2013/12/control-plane-in-openflow-networks.html
title: "Control Plane in OpenFlow Networks"
date: "2013-12-11T07:54:00.000+01:00"
tags: [ SDN,OpenFlow ]
more_blurb: True
---

<p>It’s <a href="https://www.opennetworking.org/sdn-resources/sdn-definition">easy to say</a> “<em>SDN is the physical separation of the network </em><a href="/2013/08/management-control-and-data-planes-in.html"><em>control plane</em></a><em> from the forwarding plane, and where a control plane controls several devices</em>,” handwave over the details, and let someone else figure them out. Implementing that concept in a reliable manner is a totally different undertaking.<!--more--></p>
<p class="update">2013-12-12: Inserted description of in-band control plane in OVS.</p>
<h4>OpenFlow Control Plane 101</h4><p>In an OpenFlow-based network architecture, the controller (or a cluster of redundant controllers) implements control-plane functionality: discovering the network topology and external endpoints (or adjacent network devices), computing the forwarding entries that have to be installed into individual network devices, and <a href="/2011/04/what-is-openflow.html">downloading them into controlled network devices using OpenFlow protocol</a>.</p>
<div class="separator"><a href="/2013/12/s1600-OF_ControlPlane.png" imageanchor="1"><img border="0" src="/2013/12/s520-OF_ControlPlane.png"/></a></div>
<p>OpenFlow is an application-level protocol running on top of TCP (and optionally TLS) – the controller and controlled device are IP hosts using IP connectivity services of some unspecified <em>control plane network</em>. Does that bring back fond memories of SDH/SONET days? It should.</p>
<h4>Who Will Build the Control Plane Network?</h4><p>The answer you’ll get from academic-minded OpenFlow zealots is likely “that’s out of scope, let’s focus on the magic new stuff the separation of control- and data plane brings you.” Pretty useless, right? We need a more detailed answer before we start building OpenFlow-based solutions.</p>
<p>As always, history is our best teacher: similar architectures commonly used out-of-band control-plane networks.</p>
<h4>Out-of-Band OpenFlow Control Plane</h4><p>The easiest (but not necessarily the most cost effective) approach to OpenFlow control plane network is to build a separate network connecting management ports of OpenFlow switches with OpenFlow controller. NEC is using this approach in their <a href="http://demo.ipspace.net/get/2.1%20-%20ProgrammableFlow%20Basics.mp4">ProgrammableFlow solution</a>, as is Juniper in its <a href="/2011/09/qfabric-part-1-hardware-architecture.html">QFabric architecture</a>. There’s something slightly ironic in this approach: you have to build a traditional L2 or L3 network to control the new gear.</p>
<div class="separator"><a href="/2013/12/s1600-PF_ControlPlane.png" imageanchor="1"><img border="0" src="/2013/12/s520-PF_ControlPlane.png"/></a></div>
<p class="note">You could (in theory) build another OpenFlow-controlled network to implement control-plane network you need, but you’d quickly end with <a href="http://en.wikipedia.org/wiki/Turtles_all_the_way_down">turtles all the way down</a>.</p>
<p>On the other hand, out-of-band control plane network is safe: we know how to build a robust L3 network with traditional gear, and a controller bug cannot disrupt the control-plane communication. I would definitely use this approach in data center environment, where the costs of implementing a dedicated 1GE control-plane network wouldn’t be prohibitively high.</p>
<p>Would the same approach work in WAN/Service Provider environments? Of course it would – after all, we’ve been using it forever to manage traditional optical gear.  Does it make sense? It definitely does if you already have an out-of-band network, less so if someone asks you to build a new one to support their bleeding-edge SDN solution.</p>
<h4>In-Band Control Plane</h4><p>It’s possible (in theory) to get OpenFlow switches working with in-band control plane, but it’s a complex and potentially risky undertaking. To get an understanding of the complexities involved, read the <a href="http://git.openvswitch.org/cgi-bin/gitweb.cgi?p=openvswitch;a=blob;f=DESIGN;h=4d654d01d7b140a32e5974f7d0c7a08f6b5aa800;hb=HEAD#l599">relevant Open vSwitch documentation</a>, which succinctly explains the challenges and the OVS solution.</p>
<p>That solution would work under optimal circumstances on properly configured switches, but would still use an out-of-band control plane in networks with transit OpenFlow-controlled switches (a transit switch being a switch passing control-plane traffic between controller and another switch).</p>
<h4>But Google Got It to Work</h4><p>No, they didn’t. They <a href="/2012/05/openflow-google-brilliant-but-not.html">use OpenFlow within the data center edge to control low-cost fixed-configuration switches</a> they used to implement a large-scale routing device. They still run IS-IS and BGP between data centers, and use something functionally equivalent to PCEP to download centrally computed traffic-engineering tunnels into the data center edge routers.</p>
