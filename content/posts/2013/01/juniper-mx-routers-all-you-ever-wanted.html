---
url: /2013/01/juniper-mx-routers-all-you-ever-wanted.html
title: "Juniper MX Routers – all you ever wanted to know"
date: "2013-01-23T06:54:00.000+01:00"
tags: [ Service Providers,QoS ]
---

<p>During a recent <a href="http://www.ipspace.net/ExpertExpress">ExpertExpress</a> engagement I got an interesting question: “<em>could we do per-customer policing and shaping on an MX-80 if we want to offer VPLS services and have Q-in-Q encapsulation on customer-facing links?</em>” As I have preciously little Junos/MX knowledge, it was time for the classic “<em>I’ll get back to you”</em> reply and some heavy research.</p>
<p>You probably know how hard it is to find in-depth information on an unknown platform running unfamiliar software. Fortunately, <a href="http://www.linkedin.com/in/dhanks">Doug Hanks</a> (<a href="https://twitter.com/douglashanksjr">@douglashanksjr</a>) sent me a review copy of his new <a href="http://www.amazon.com/gp/product/1449319718/ref=as_li_tf_tl?ie=UTF8&amp;tag=cisioshinandt-20&amp;linkCode=as2&amp;camp=1789&amp;creative=9325&amp;creativeASIN=1449319718">Juniper MX Series</a> book a while ago. It was time for some serious reading.<!--more--></p>
<iframe frameborder="0" marginheight="0" marginwidth="0" scrolling="no" src="http://rcm-na.amazon-adsystem.com/e/cm?lt1=_top&amp;bc1=000000&amp;IS2=1&amp;npa=1&amp;bg1=FFFFFF&amp;fc1=000000&amp;lc1=0000FF&amp;t=cisioshinandt-20&amp;o=1&amp;p=8&amp;l=as1&amp;m=amazon&amp;f=ifr&amp;ref=tf_til&amp;asins=1449319718" style="width:120px;height:240px;float: right;"></iframe><p><strong>Chapter 1 – Juniper MX Architecture</strong>. A deep-dive introduction into various MX models, the Trio chipset architecture and functionality and various linecards and their advantages and limitations. Got me to the point where I understood what the customer planned to order. Nice start.</p>
<p><strong>Chapter 2 – Bridging, VLAN mapping, IRB</strong>. Exactly what I needed. Although VPLS is <em>out of scope of the book</em>, I got enough information to understand that you need to configure per-customer logical interfaces, that you could sort packets into interfaces by matching outer or inner VLAN tags, and that you could do all sorts of weird VLAN tag manipulation in transit. </p>
<p>Key takeaway: you can define per-customer logical interfaces, configure bridging or routing on them, and use full Q-in-Q tagging to select logical interfaces.</p>
<p><strong>Chapter 3 – Stateless Filters, Hierarchical Policing and Tri-Color Marking</strong>. I started skimming the content at this point as I was really not interested in firewall filters, but got just enough information to understand you could do per-logical-interface policing and marking. Enough information to answer the customer query.</p>
<p><strong>Chapter 5 – Trio Class of Service</strong>. Another beautiful in-depth description of Trio functionality that I mostly skipped because I really didn’t need all the details. However, I quickly got the answer I was looking for: you can do per-IFL (logical interface) shaping, but you need hierarchical QoS for that, and it’s available only on certain linecards, not on the built-in 10GE ports on MX-80.</p>
<p>Conclusion: If my customer wants per-VLAN egress shaping (not only ingress/egress policing), they have to install a MIC (or two) in their MX-80 (because MX-80 supports H-CoS only on MIC ports) and connect customer-facing links to the MIC ports.</p>
<p>Three hours later, I had all the answers I needed, courtesy of Doug Hanks, Harry Reynolds and O’Reilly. Thank you, you all did a great job! Now, if there would be a similar book on ASR-1K ...</p>
<h4>But wait, there’s more</h4><p>Obviously this excellent book covers more topics than the ones I was looking for. There’s a chapter on control plane protection and DDOS prevention, another one on virtual chassis, multi-chassis link aggregation (no surprise, Doug as a Data Center Architect), and high availability. Finally, the <em>Trio Inline Services </em>chapter describes NAT and tunnel services.</p>
<p>All these goodies will probably have to wait till my next consulting engagement; at the moment I’m too busy preparing for another trip to the <a href="https://blog.ipspace.net/2012/02/going-back-to-ivory-tower.html">Ivory Tower</a>.</p>
<h4>Full disclosure</h4><p>Doug Hanks sent me a free review copy of the book, but that did not influence my opinion in any way – I would gladly <a href="http://www.amazon.com/gp/product/1449319718/ref=as_li_tf_tl?ie=UTF8&amp;tag=cisioshinandt-20&amp;linkCode=as2&amp;camp=1789&amp;creative=9325&amp;creativeASIN=1449319718">pay the $69.99 price</a> to have this tome of condensed in-depth information readily available.</p>

