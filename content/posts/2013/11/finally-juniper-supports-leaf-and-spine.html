---
date: 2013-11-05T07:31:00.000+01:00
tags:
- data center
- workshop
- fabric
title: 'Finally: Juniper Supports a Leaf-and-Spine Virtual Chassis'
url: /2013/11/finally-juniper-supports-leaf-and-spine.html
---

<p>The recent Juniper product launch included numerous components, among them: a <a href="http://www.juniper.net/us/en/products-services/switching/qfx-series/qfx5100/">new series of data center switches</a> (including a badly-needed spine switch), <a href="http://www.juniper.net/us/en/local/pdf/whitepapers/2000539-en.pdf">MetaFabric reference architecture</a> (too meta for me at the moment – waiting to see the technical documentation beyond the whitepaper level), and (finally) a leaf-and-spine virtual chassis – Virtual Chassis Fabric.<!--more--></p>
<h4>Why is Virtual Chassis Fabric important?</h4><p>The existing Junos Virtual Chassis architecture evolved from stackable switches connected with Virtual Chassis Ports (VCPs). Later software releases allowed you to use 10GE ports as VCP ports, and the <a href="http://www.juniper.net/techpubs/en_US/junos13.2/information-products/pathway-pages/qfx-series/virtual-chassis.pdf">QFX-series Virtual Chassis has no dedicated VCP ports</a>, but it seems the inter-switch connectivity requirements never made it past the stacking mentality.</p>
<p>More than 18 months ago I published a leaf-and-spine architecture that could use virtual chassis to manage the whole fabric as a single device, first in <a href="http://www.juniper.net/us/en/forms/network-fabrics-webinar/">Server Guys Guide to Data Center Fabrics</a> webinar, and later in the design section of the <a href="http://www.ipspace.net/Clos_fabrics_explained">Clos Fabric Explained</a> webinar. The size of the fabric was limited by the Virtual Chassis limitations (10 devices in a virtual fabric), but you still got several hundred server ports, which is more than enough for most environments.</p>
<div class="separator"><a href="/2013/11/s1600-Virtual+Chassis+Fabric.png" imageanchor="1"><img border="0" src="/2013/11/s400-Virtual+Chassis+Fabric.png"/></a></div>
<p>Unfortunately, I never got a definitive “yes, this architecture is supported” answer from Juniper. Merging the spine switches in a virtual chassis and keeping the leaf switches independent is obviously a supported configuration, but then we don’t get the benefits of a single configuration/management entity that I wanted to have. It seems the switches in a virtual chassis are still supposed to be connected in a linear or ring topology (even the <a href="http://www.juniper.net/techpubs/en_US/junos13.2/information-products/topic-collections/qfx-series/release-notes/ex-qfx-series-junos-release-notes-13.2X50.pdf">latest Junos 13.2 release notes</a> hint at that), which <a href="http://blog.ipspace.net/2012/11/stackable-data-center-switches-do-math.html">definitely sucks in a data center environment</a>.</p>
<p>The Virtual Chassis Fabric technology removes all the inter-switch connectivity limitations – you can connect the switches in any way you wish (according to a recent <a href="http://forums.juniper.net/t5/Data-Center-Technologists/Tiers-in-Virtual-Chassis-Fabric/ba-p/214765">Juniper blog post</a>) and even though <a href="http://blog.ipspace.net/2012/04/monkey-design-still-doesnt-work-well.html">monkey designs might look enticing</a>, I would stick with the more traditional <a href="http://blog.ipspace.net/2012/11/building-leaf-and-spine-fabrics-with.html">leaf-and-spine architecture</a>.</p>
<h4>How relevant is Virtual Chassis Fabric?</h4><p>The same blog post claims (and I’ve seen similar claims in other Juniper documents) you’ll be able to connect all QFX-series switches in a Virtual Chassis Fabric (the prerequisite software is not yet available), removing the major objection Juniper was facing with <a href="http://blog.ipspace.net/2011/09/qfabric-part-1-hardware-architecture.html">QFabric</a> (including the <a href="http://blog.ipspace.net/2012/06/qfabric-lite.html">scale-down version</a>). </p>
<p>You can buy individual switches as you need them, merge them in a fabric whenever you feel the need to reduce the management burden, and there’s no need to buy dedicated fabric components when you start the journey.</p>
<h4>More information</h4><p>You might find these webinars valuable if you’re building a new data center fabric:</p>
<ul class="ListParagraph"><li><a href="http://www.ipspace.net/Data_Center_Fabrics">Data Center Fabrics</a> webinar describes hardware and software features of data center switching products from all major vendors; </li>
<li><a href="http://www.ipspace.net/Clos_fabrics_explained">Clos Fabrics Explained</a> webinar has in-depth design and deployment guidelines that will come handy once you start building a leaf-and-spine fabric;</li>
<li><a href="http://www.ipspace.net/Data_Center_3.0_for_Networking_Engineers">Data Center 3.0 for Networking Engineers</a> webinar introduces you to a wide variety of data center-related topics, going all the way from application architectures to fabrics, storage and lossless transport.</li>
</ul>
<p>Finally, if you need design help or a quick review of your design, check out my <a href="http://www.ipspace.net/ExpertExpress">ExpertExpress consulting service</a>.</p>

