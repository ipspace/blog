---
title: "Simplify Your Disaster Recovery with Virtual Appliances"
date: "2013-05-31T07:26:00.000+02:00"
tags: [ Data Center,Workshop,Overlay networks,virtualization ]
---

<p>Regardless of what the vendors are telling you, it’s hard to get data center disaster recovery right (unless you’re <a href="http://queue.acm.org/detail.cfm?id=2371297">running regular fire drills</a>), and your job usually gets harder due to the intricate (sometimes undocumented) intertwining of physical and virtual worlds. For example, do you know how to get the firewall and load balancer configurations from the failed site implemented in the equipment currently used at disaster recovery site?</p>
<p>Imagine a simple application stack with a few web servers, app servers and two database servers. There’s a firewall in front of the web servers and a load balancer tying all the segments together.<!--more--></p>
<div class='separator'><a href="http://1.bp.blogspot.com/-_kdBcdF0Ghk/UaW7M0_2lYI/AAAAAAAAFz4/mqNzG-ymmHI/s1600/VA_SampleArchitecture.png" imageanchor="1" ><img border="0" src="http://1.bp.blogspot.com/-_kdBcdF0Ghk/UaW7M0_2lYI/AAAAAAAAFz4/mqNzG-ymmHI/s540/VA_SampleArchitecture.png" /></a><br />Wondering where the icons came from? This is a slide from the free <br /><a href="http://www.ipspace.net/Enterasys_Robust_Data_Center_Interconnect_Solutions">Enterasys Robust Data Center Interconnect Solutions</a> webinar (<a href="http://enterasys-blog.eventbrite.com/">register here</a>).</div>
<p>To implement this extremely simple application stack you need four or five (internal) VLANs, two load balancing contexts, and a firewall context. How many points do you have to touch when migrating the whole stack to a disaster recovery site? How many things can go wrong?</p>
<p>Now let’s try to virtualize the whole stack.</p>
<p><strong>Step#1</strong>: Replace the physical appliances with virtual firewall and load balancer. Your life quickly becomes easier – the virtual appliances are usually small and tied to individual applications, and they usually store their configuration in a central repository (I do hope you have an up-to-date copy of that repository at the DR location) or on local disk, which is just a file on some shared file system (yet again, hopefully replicated to the DR site). </p>
<p>Moving a virtual appliance to a disaster recovery location is literally as easy as point-and-click, and getting it up and running after a data center failure is a total no-brainer … but there are still VLANs to configure.</p>
<p><strong>Step#2</strong>: Throw overlay virtual networks into the mix. They don’t rely on physical infrastructure (as long as that infrastructure provides IP transport and in some cases IP multicast), so you can build a complex application stack with virtual machines and virtual appliances without ever touching the physical gear. Can you move that whole stack to a different location and recreate the environment there? Of course you can, the only thing you might have to do is to create the port groups referenced in VMDK files.</p>
<p class="note">I’m almost positive vCloud Director would handle even that, but am currently too lazy to check the manuals. Feedback most welcome.</p>
<p>The only points of interaction between the whole application stack and the external world are the outside dependencies: client access (after all, clients still live in the physical world), and connectivity to central services (be they a central database, LDAP/AD or anything else).</p>
<div class='separator'><a href="http://3.bp.blogspot.com/-VIaOYZk-dcU/UaW7VZTG8KI/AAAAAAAAF0A/PIBg33sc3OE/s1600/VA_SampleVirtual.png" imageanchor="1" ><img border="0" src="http://3.bp.blogspot.com/-VIaOYZk-dcU/UaW7VZTG8KI/AAAAAAAAF0A/PIBg33sc3OE/s540/VA_SampleVirtual.png" /></a></div>
<p>Client connectivity can be handled with dynamic addressing of the outside interface of the first load balancer/firewall in the application stack coupled with corresponding DNS changes; connectivity to common services is likewise easy to implement with a NAT box using DHCP on the outside (external-services-facing) interface.</p>
<p>Alternatively, you can use some interesting routing tricks that I’m describing in the <a href="http://www.ipspace.net/Enterasys_Robust_Data_Center_Interconnect_Solutions">Enterasys Robust Data Center Interconnect Solutions</a>. Unfortunately not too many vendors found it expedient to offer something similar; it’s sexier to throw a bunch of new technologies (and bugs and interdependencies) into the mix.</p>
<p>Finally, remember that the overlay networks used to implement intra-stack connectivity stay totally isolated from the outside world. You can use whatever address range you wish within the application stack; as long as the outside-facing addresses remain reachable from the physical world your application works.</p>
<p class="note">You really wouldn’t want to use overlapping address ranges, but that’s a whole different story.</p>
<p><strong>End result:</strong> a packaged application stack that can be moved to another location with minimal (or no) interaction with the physical gear. I somehow suspect some hardware vendors don't like the idea ;)</p>
<h4>More information</h4><p>I described the virtual appliance ideas in more detail in the <a href="http://blog.ioshints.info/2013/04/virtual-firewall-presentation-from.html">Virtual Firewalls</a> presentation @ <a href="http://blog.ioshints.info/2013/05/troopers-13-must-visit-security.html">Troopers 13</a> and in the <a href="http://www.ipspace.net/Virtual_Firewalls">Virtual Firewalls webinar</a>. They’ll also play an important role in the <a href="http://overlaynetworks-blog.eventbrite.com/">Overlay Networking Explained</a> webinar scheduled for fall 2013.</p>
<p>If you're interested in the bigger picture, check out the <a href="http://www.ipspace.net/Data_Center_Interconnects">Data Center Interconnects</a> webinar and <a href="http://enterasys-blog.eventbrite.com/">register</a> for the <a href="http://www.ipspace.net/Enterasys_Robust_Data_Center_Interconnect_Solutions">Enterasys Robust Data Center Interconnect Solutions</a> one (I did mention it’s free, didn’t I?).</p>

