---
url: /2013/10/forwarding-models-in-openflow-networks.html
title: "Forwarding Models in OpenFlow Networks"
date: "2013-10-15T07:31:00.000+02:00"
tags: [ SDN,Workshop,Fabric,OpenFlow ]
---

<p>A few days ago Tom (<a href="https://twitter.com/networkingnerd">@NetworkingNerd</a>) Hollingsworth <a href="https://twitter.com/networkingnerd/status/387572289308356608">asked a seemingly simple question</a>: “<em>OpenFlow programs hop-by-hop packet forwarding, right?  No tunnels?</em>” and <a href="https://twitter.com/networkingnerd/status/387621520635207681">wasn’t satisfied with my standard answer</a>, so here’s a longer explanation.<!--more--></p>
<p class="info">Before we get started, keep in mind OpenFlow is just a tool that one can use (or not) in numerous environments. Tom’s question is (almost) equivalent to “<em>C programs use string functions, right?</em>” Some do, some don’t, depends on what you’re trying to do.</p>
<h4>Point OpenFlow Deployments</h4><p>Sometimes you can <a href="http://blog.ipspace.net/2011/11/openflow-enterprise-use-cases.html">solve your problem</a> by using OpenFlow on individual (uncoupled) devices. Typical use cases:</p>
<ul class="ListParagraph"><li><strong>Edge security policy</strong> – authenticate users (or VMs) and deploy per-user ACLs before connecting a user to the network (example: <a href="http://blog.ipspace.net/2012/10/ipv6-first-hop-security-ideal-openflow.html">IPv6 first-hop security</a>);</li>
<li><strong>Programmable SPAN ports</strong> – use OpenFlow entries on a single switch to mirror selected traffic to SPAN port;</li>
<li><strong>DoS traffic blackholing </strong>– use OpenFlow to block DoS traffic as close to the source as possible, using N-tuples for more selective traffic targeting than the more traditional RTBH approach.</li>
<li><strong>Traffic redirection </strong>– use OpenFlow to redirect interesting subset of traffic to network services appliance (example: IDS).</li>
</ul>
<p>Using OpenFlow on one or more isolated devices is simple (no interaction with adjacent devices) and linearly scalable – you can add more devices and controllers as needed because there’s no <a href="http://blog.ipspace.net/2013/09/openflow-fabric-controllers-are-light.html">tight coupling anywhere in the system</a>.</p>
<h4>Fabric OpenFlow Deployments</h4><p>Most OpenFlow products being developed these days try to solve the OpenFlow fabric use case (because existing data center fabrics and Internet clearly don’t work, right?). In these scenarios the OpenFlow controller manages all the switches in the forwarding path and has to install forwarding entries on every one of them.</p>
<p>Not surprisingly, developers of these products took different approaches based on their understanding of networking challenges and limitations of OpenFlow devices.</p>
<p><strong>Bypass the fabric.</strong> Some solutions (example: <a href="http://demo.ipspace.net/get/3.2%20-%20NSX%20Control%20Plane.mp4">VMware NSX</a>) <a href="http://blog.ipspace.net/2013/08/nicira-nvp-control-plane.html">bypass the complexities of fabric forwarding by establishing end-to-end something-over-IP tunnels</a>, effectively reducing the fabric to a single hop.</p>
<p><strong>Path-based forwarding</strong>. Install end-to-end <a href="http://demo.ipspace.net/get/2.1%20-%20ProgrammableFlow%20Basics.mp4">path forwarding entries</a> into the fabric and assign user traffic to paths at the edge nodes (aka <a href="http://blog.ipspace.net/2013/01/edge-and-core-openflow-and-why-mpls-is.html">Edge and Core OpenFlow</a>). Bonus points if you’re smart enough to pre-compute and install backup paths.</p>
<p class="info">If this looks like a description of MPLS LSPs, FECs and FRR, you’re spot on. There are only so many ways you can solve a problem in a scalable way.</p>
<p>The dirty details of path-based forwarding vary based on the hardware capabilities of the switches you use and your programming preferences. Using MPLS or PBB would be the cleanest option – those packet formats are well understood by network troubleshooting tools, so an unlucky engineer trying to fix a problem in an OpenFlow-based fabric would have a fighting chance. </p>
<p>Unfortunately you won’t see much PBB or MPLS in OpenFlow products any time soon – they require OpenFlow 1.3 (or vendor extensions) and hardware support that’s often lacking in switches used for OpenFlow forwarding these days. OpenFlow controller developers are trying to bypass those problems with creative uses of packet headers (<a href="http://blog.ipspace.net/2012/02/virtual-circuits-in-openflow-10-world.html">VLAN or MAC rewrite</a> comes to mind), making a troubleshooters job much more interesting.</p>
<p><strong>Hop-by-hop forwarding</strong>. Install flow-matching N-tuples in every switch along the path. Results in an architecture that works great in PowerPoint and lab tests, but breaks down in anything remotely similar to a production network due to <a href="http://highscalability.com/blog/2012/6/4/openflowsdn-is-not-a-silver-bullet-for-network-scalability.html">scalability problems</a>, primarily <a href="http://blog.ipspace.net/2012/01/fib-update-challenges-in-openflow.html">FIB update challenges</a>.</p>
<p>If an OpenFlow controller using hop-by-hop forwarding paradigm implements proactive flow installation (install N-tuples based on configuration and topology), it just might work in small deployments. If it uses <a href="http://networkstatic.net/openflow-proactive-vs-reactive-flows/">reactive flow installation</a> (<a href="http://blog.ipspace.net/2013/03/controller-based-packet-forwarding-in.html">punt new flows to the controller</a>, install <a href="http://blog.ipspace.net/2012/08/openstackquantum-sdn-based-virtual.html">microflow entries on every hop for each new flow</a>), it deserves a nomination for Darwin Award.</p>
<h4>Why does it matter?</h4><p>Would you buy a core router that only supports RIPv1? Would you use a solution that uses PBR instead of routing protocols? Would you use NetFlow-based forwarding with flows being instantiated by a central router (remember Multi-Layer Switching on Cat5000)? Probably not – we’ve learned the hard way which protocols and architectures work and which ones don’t.</p>
<p>OpenFlow is an emerging technology, and you’ll stumble upon numerous vendors (from startups to major brand names) selling you OpenFlow-based solutions (and pixie dust). It’s important to understand how these solutions work behind the scenes when evaluating them. Everything will work great in your 2-node proof-of-concept lab, but you might encounter severe scalability limitations in real-life deployment. </p>
<h4>More information</h4><p>It just so happens that I’m running an <a href="http://www.ipspace.net/Real_Life_OpenFlow-based_SDN_Use_Cases">OpenFlow/SDN Use Cases</a> webinar in a few weeks. It’s free, but make sure you <a href="https://openflowsdnusecases.eventbrite.com/?ref=ebapi">register</a> before we run out of space in the virtual classroom.</p>

