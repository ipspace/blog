---
url: /2019/10/the-cost-of-disruptiveness-and/
title: "The Cost of Disruptiveness and Guerrilla Marketing"
date: "2019-10-08T08:32:00.000+02:00"
tags: [ Docker, virtualization ]
---

<p><a href="https://twitter.com/icemarkom/status/1162944127354359808">A Docker networking rant</a> coming from my good friend <a href="https://twitter.com/icemarkom">Marko Milivojević</a> triggered a severe case of <a href="https://i.pinimg.com/originals/df/ee/9f/dfee9f8e823e04ddbc511d457d235fe0.jpg">Deja-Moo</a>, resulting in a flood of unpleasant memories caused by too-successful “disruptive” IT vendors.</p>
<div class="note" data-markdown="1">Before moving on, please note that the following observations were made from my outsider perspective. If I got something badly wrong, please correct me in a comment. </div>
<p>Imagine you’re working for a startup creating a cool new product in the IT infrastructure space (if you have an oversized ego you would call yourself “<em>disruptive thought leader</em>” on your <a href="https://twitter.com/ioshints/status/1162050949801762816">LinkedIn profile</a>) but nobody is taking you seriously. How about some guerrilla warfare: advertising your product to people who hate the IT operations (today we’d call that <em>Shadow IT</em>).<!--more--></p>
<p>Every now and then that trick results in an unexpected wild success, and a horrendous nightmare for everyone in IT Operations who has to support the former-guerilla environment that was dumped on them. Most probably that environment (or product) was never designed for large-scale use, and was never fixed or redesigned to adjust to the new use cases… but of course the now-successful vendors rarely care about those unintended consequences.</p>
<h3 id="novell-netware">Novell Netware</h3><p>The first vendor using this trick that I had to deal with was Novell with its Netware product. Instead of trying to connect to all sorts of Enterprise Systems (like IBM, CDC, DEC, Univac, Burroughs, Honeywell…), they created this standalone thingy that could run on anything slightly better than barbed wire (remember <a href="https://en.wikipedia.org/wiki/ARCNET">ARCnet?</a>) and started selling it to department that needed simple file sharing capabilities.</p>
<p>All of a sudden they became hugely successful (until Microsoft started offering the same functionality bundled with Windows servers), and we were asked to extend a protocol that was designed to be a just-good-enough kludge running over a single coax cable over WAN networks, and to build huge networks running Novell IPX. The whole thing was so bad that Cisco made good money with software features like service advertisement (SAP) filters (SAP filters became mandatory items in networking RFPs in those days).</p>
<p>Novell tried to fix things years later with NLSP (a link-state protocol for IPX/SAP), but it was too little too late. Most everyone moved to TCP/IP at that point. Even though we built numerous Novell IPX networks in those days, I’ve never seen NLSP deployed.</p>
<h3 id="vmware-networking">VMware Networking</h3><p>Imagine you have this cool virtualization idea, but the big guys don’t take you seriously… so you decide to fly under the radar and make your product as invisible as possible, trying to persuade developers that it’s the next best thing since sliced bread.</p>
<p>Unfortunately your product has to work with existing networking infrastructure, and while you can use multiple MAC and IP addresses on the same interface card (nobody was serious about IP or MAC security in those days), anything else would complicate your life because it would require your customers to talk with their internal IT infrastructure teams.</p>
<p>End result: bridging without STP, port channels without LACP, no LLDP…</p>
<p>Even worse: because VMware tried to support every possible lunacy (like <a href="/2012/02/microsoft-network-load-balancing-behind/">Microsoft NLB</a>), there was no way they could reliably figure out the virtual machine IP address, so when ESXi virtual switch has to send a MAC frame on behalf of the virtual machine, it sends something that has no IP address in the payload. Welcome to the famous <a href="https://www.fragmentationneeded.net/2015/10/musings-on-datanauts-9.html">RARP kludge</a>.</p>
<p><strong>Notes</strong>:</p>
<ul><li>There are two ways to deal with enterprise lunacies. You either try to accommodate every stupidity anyone ever made (the usual Enterprise IT Vendor way), or tell the customers they can take their business somewhere else (AWS/Azure/GCP way). Guess which one doesn’t work in guerrilla marketing approach ;)</li>
<li>For whatever reason (unless I’m totally mistaken in which case please fix my ignorance) most other hypervisors, including Hyper-V, can spell <strong>IP</strong> and send gratuitous ARP instead of RARP packets after a MAC move event.</li>
</ul>
<p>But wait, there’s more: a few years later VMware created this awesome technology that allows the administrators to move a running virtual machine between servers, but it only works if there’s a <a href="/2011/02/layer-3-gurus-asleep-at-wheel/">layer-2 network between the source and destination hypervisor</a>. <a href="/2015/02/before-talking-about-vmotion-across/">Ignoring the laws of physics</a>, VMware’s marketing department started selling that technology as <a href="/2013/01/long-distance-vmotion-stretched-ha/">multi-site disaster avoidance panacea</a>, probably indirectly triggering more <a href="/2019/05/real-life-data-center-meltdown/">data center meltdowns</a> than any other crazy idea out there.</p>
<p>Years later, VMware tried to fix the mess they created with VXLAN and later with NSX. Ask me how that turned out in about a decade ;)</p>
<h3 id="docker-networking">Docker Networking</h3><p>Fast-forward a decade. At least some public cloud providers have figured out that the flat earth theory doesn’t work well, and started enforcing rigorous one-IP-per-VM and no-nasty-tricks rules… and there’s a startup that’s trying to build another disruptive technology on top of Linux containers and the “unicast IP forwarding only” limitations imposed by those public cloud providers.</p>
<p>Welcome to <a href="https://www.ipspace.net/Docker_Networking_Fundamentals">Docker Networking</a>, a morass full of NAT rules, complex iptables, overlay virtual networking, internal and external IP addressing… At least in this particular case, I don’t think they could have done anything more sensible given the constraints and the desire to have an independent TCP/IP stack within each container.</p>
<p>The really sad part: it would be really easy to implement Docker Networking with IPv6, a <a href="/2017/09/coming-full-circle-on-ipv6-address/">/64 prefix per host</a>, and ACLs to enforce limited inter-container communication.</p>
<p>Alas, we’re way past that point. For example, one of the overlay virtual networking implementations runs in a user-mode program connected to individual containers through <em>tap</em> interfaces. What could possibly go wrong with that? ;)</p>

