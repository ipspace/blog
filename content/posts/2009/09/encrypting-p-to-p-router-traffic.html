---
title: "Encrypting P-to-P-router traffic"
date: "2009-09-23T07:17:00.002+02:00"
tags: [ You've asked for it,ipsec,MPLS VPN ]
---

<div class="bloggerBody"><p>Rob sent me a really good question:</p>
<blockquote class="cite">I have an enterprise MPLS network. Two P routers are connected via carrier point-to-point Gigabit Ethernet and I would like to encrypt the MPLS traffic traversing the GE link. The PE-routers don't have hardware crypto accelerators, so I would like to keep the MPLS within the buildings running in cleartext and only encrypt the inter-site (P-to-P) MPLS traffic.</blockquote>
<p>The only solution I could imagine would nicely fit the motto of one of our engineers: »Any time you have a problem, use more GRE tunnels« (if you have a better solution, please post it in the comments).</p>
<!--more--><p>As far as I understand Cisco's IPSEC implementation, IOS can encrypt only IP traffic. If you want to encrypt MPLS frames forwarded by a P-router, you have to convert them back to IP ... and the only way to convert MPLS frames back into IP without losing the whole label stack which is vital to proper operation of MPLS VPN is to encapsulate them in a GRE tunnel and encrypting the MPLS-over-GRE traffic.</p>
<p>The "obvious" problem of this setup (apart from performance hit) is the MTU issue: the MTU on the GE link has to be high enough to support all the extra overhead on top of the 1500-byte payload. If that's not the case, you have to lower the MTU on the tunnel interface to ensure the GRE packets are not fragmented - that would kill the receiving router.</p>
<p>There are also "a few" intricacies of using MPLS-over-GRE/IPSec when the P-router is a 6500 or 7600. Don't ask me what they are, I'm a conceptual person and try to stay away from the specific hardware implementations, but <a href="http://www.nil.com/go/ccie_experts">our engineers</a> built several large networks using this architecture and got a lot of hands-on experience. If you feel you could benefit from their expertise, <a href="http://www.nil.com/go/contacts">get in touch with our Professional Services team</a>.</p>
</div>

