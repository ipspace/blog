---
date: 2009-11-18T07:01:00.001+01:00
tags:
- workshop
- EEM
title: Detect short bursts with EEM
url: /2009/11/detect-short-bursts-with-eem.html
---

<p>Last week I’ve described <a href="https://blog.ipspace.net/2009/11/detect-dos-attacks-with-eem.html">how you can use EEM to detect long-term interface congestion</a> which could indicate denial-of-service attack. The mechanism I’ve used (the averaged interface load) is pretty slow; using the lowest possible value for the <strong>load-interval </strong>(30 seconds) it takes almost a minute to detect a DOS attack (see below).</p>
<p>If you want to detect outbound bursts, you can do better: you can monitor the increase in the number of output drops over a short period of time. </p>
<div class="separator" style="clear: both; text-align: center;"><a href="/2009/11/Faster+Congestion+Detection.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="/2009/11/s400-Faster+Congestion+Detection.png"/></a><br/></div>
<p class="warn">Obviously you cannot use this mechanism to detect inbound (potentially DOS-related) floods as the drops occur on the Service Provider’s edge router.</p>
<p class="more">Various polling and averaging options, including in-depth discussion of hysteresis, are covered in the <a href="https://www.ipspace.net/Embedded_Event_Manager_(EEM)_Workshop">Embedded Event Manager (EEM) workshop</a>. You can attend an online version of the workshop or we can organize a dedicated event for your networking team.</p>
<!--more--><h4>More details: Interface load increases slowly after a flood starts</h4><p>The interface input/output rates in bps or pps are computed as weighted averages using a sampling interval configured with <strong>load-interval </strong>command. To measure the delay between the start of a UDP burst and the <a href="https://blog.ipspace.net/2009/11/detect-dos-attacks-with-eem.html">denial-of-service alert generated by EEM</a> (which is triggered by output bps rate exceeding ~80% of configured interface bandwidth), I’ve configured an access-list that reported the start of the burst and attached it to the outgoing interface:</p>
<pre class="code">ip access-list extended UDP<br/> permit udp any any gt 0 log<br/> permit ip any any<br/>!<br/>interface Serial0/1/0<br/> bandwidth 1000<br/> ip address 10.0.1.1 255.255.255.252<br/> ip access-group UDP out<br/> encapsulation ppp<br/> load-interval 30</pre><p>It took the router almost a minute to report the interface saturation <a href="/2009/11/Detect+interface+overload.png">when the EEM applet was triggered by the TXload interface variable</a>:</p>
<pre class="code">rtr#<br/>00:27:38: %SEC-6-IPACCESSLOGP: list UDP permitted udp <br/>  10.0.0.10(1070) -&gt; 10.0.20.3(5002), 1 packet<br/>00:28:25: %HA_EM-6-LOG: IntOverload: Interface Serial0/1/0 <br/>  overloaded: txload = 209</pre><p>The <em>OutputDrops </em>EEM applet which relies on the <strong>output_packets_dropped </strong>variable detected the flood within 10 seconds.</p>

