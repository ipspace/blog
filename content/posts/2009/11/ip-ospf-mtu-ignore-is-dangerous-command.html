---
title: "“ip ospf mtu-ignore” is a dangerous command"
date: "2009-11-23T06:38:00.004+01:00"
tags: [ OSPF ]
---

<p>Two years ago I wrote about the <a href="http://blog.ioshints.info/2007/10/ospf-neighbors-stuck-in-exstart.html">problems caused by MTU mismatch between OSPF neighbors</a>, and warned that the <strong>ip ospf mtu-ignore </strong>interface configuration command that supposedly solves the problem could cause significant headaches. Last week’s challenge was a simple illustration of what could happen if you <a href="http://blog.ioshints.info/2009/11/challenge-ospf-neighbor-changing-state.html">force OSPF neighbors to establish a session even though their interface MTUs don’t match</a> (the very first comment correctly identified the issue).</p>
<!--more--><p>This is the router configuration I’ve used to generate the problem:</p>
<table class="codeTable"><tr class="TRFirst TRLast"><td valign="top" class="TDHead TDLast"><pre class="code">hostname A1<br />!<br />interface Serial1/0<br /> description Link to C1<br /> ip address 10.0.7.5 255.255.255.252<br /> encapsulation ppp<br /> ip ospf cost 100<br /> ip ospf mtu-ignore<br />!<br />router ospf 1<br /> log-adjacency-changes<br /> redistribute static subnets<br /> network 0.0.0.0 255.255.255.255 area 1</pre></td><td valign="top" class="TDHead TDLast"><pre class="code">hostname C1<br />!<br />interface Serial1/0<br /> description Link to A1<br /> mtu 512<br /> ip address 10.0.7.6 255.255.255.252<br /> encapsulation ppp<br /> ip ospf cost 100<br /> ip ospf mtu-ignore<br /> ip ospf 1 area 1<br />!<br />router ospf 1<br /> log-adjacency-changes</pre></td></tr></table><p>The problem occurs when C1 drops the <em>database description packet </em>or a flooding packet sent by A1 exceeds because it exceeds the MTU size. The dropped packets appear as <em>giants </em>or <em>overruns </em>in the <strong>show interface </strong>printout.</p>
<div class='warn'><p>And now for the really fun part:</p>
<ul class="Bullet1"><li>The problem is not completely reproducible. Sometimes the routers are willing to accept oversized packets, sometimes they drop them. This behavior is probably related to the IOS release and hardware platform used in the tests; it might also be triggered by a particular sequence of configuration commands.</li>
<li>The problem appears (if at all) only when the OSPF database grows. Tests in a small lab might work fine, but the production network might crash.</li>
<li>When the MTUs differ by only a few bytes, the setup might work for a long time until you happen to stumble across the correct combination of LSAs which generate the DBD or update packet of just the right size.</li>
</ul>
</div>

