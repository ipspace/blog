---
title: "IOS fossils: OSPF-to-BGP redistribution"
date: "2009-05-13T06:27:00.004+02:00"
tags: [ OSPF,IOS Fossils,BGP ]
---

<div class="bloggerBody"><p>Here’s a weird requirement that you could get on a really hard CCIE preparation lab (and hopefully never in a live network): redistribute external OSPF routes from selected ASBRs into BGP without using a route-map on the redistribution router.</p>
<p>For example, assuming R1 and R2 insert external routes into OSPF, you want only routes from R1 to be redistributed into BGP on R3, but you cannot use route-maps on R3.</p>
&lt;!--more--&gt;<p><strong>Answer:</strong> OSPF external routes with tags greater than 3758096384 are not redistributed into BGP.</p>
<p><strong>Solution:</strong> You can set the OSPF route tags on the originating ASBRs with the <strong>redistribute … tag </strong><strong><em>value </em></strong>router configuration command and the router performing OSPF-to-BGP redistribution configured with <strong>redistribute ospf </strong><strong><em>pid </em></strong>performs automatic filtering.</p>
<p><strong>Sample configurations</strong>: The following printouts contain OSPF router configuration on R1 and R2:</p>
<pre class="code">R1#<strong>show run | section router ospf</strong><br/>router ospf 1<br/> log-adjacency-changes<br/> redistribute static subnets<br/> network 10.0.0.0 0.255.255.255 area 0<br/><br/>R2#<strong>show run | section router ospf</strong><br/>router ospf 1<br/> log-adjacency-changes<br/> redistribute static subnets tag 3758096385<br/> network 0.0.0.0 255.255.255.255 area 0</pre><p>You can inspect the OSPF external routes on R3 and verify that only one of them gets inserted into BGP even though all OSPF external routes should be redistributed.</p>
<pre class="code">R3#<strong>show run | section router bgp</strong><br/>router bgp 65000<br/> no synchronization<br/> bgp log-neighbor-changes<br/> redistribute ospf 1 match external 1 external 2<br/> neighbor 10.0.1.1 remote-as 65000<br/><br/>R3#<strong>show ip ospf data external | inc Link State|Tag</strong><br/>                Type-5 AS External Link States<br/>  Link State ID: 10.2.1.0 (External Network Number )<br/>        External Route Tag: 3758098606<br/>  Link State ID: 10.2.2.0 (External Network Number )<br/>        External Route Tag: 0<br/><br/>R3#<strong>show ip bgp | begin Network</strong><br/>   Network          Next Hop            Metric LocPrf Weight Path<br/>*&gt; 10.2.2.0/24      10.0.7.10               20         32768 ?</pre><p>By now you’re probably wondering what’s going on? The behavior is the result of section 4.4.6 of <a href="http://www.ietf.org/rfc/rfc1403.txt">RFC 1403</a> (3758096384 = 14 * 2^28), which is over 16 years old (and that’s the reason this post belongs to “IOS Fossils”)</p>
</div>

