---
url: /2011/11/junos-day-one-is-is-for-dummies.html
title: "Junos Day One: IS-IS for dummies"
date: "2011-11-30T06:22:00.000+01:00"
tags: [ IS-IS,Junos ]
---

<p>For whatever reason I decided to start my Junos experience with a very simple IS-IS network – four core routers from my <a href="http://www.ipspace.net/Building_IPv6_Service_Provider_Core">Building IPv6 Service Provider Core</a> webinar. As Junosphere doesn’t support serial or POS interfaces, I migrated all links to Gigabit Ethernet and added a point-to-point GE link between PE-A and PE-B.<!--more--></p>
<p>I started with a very simple configuration: dual-stack (IPv4+IPv6) network with IS-IS running on core interfaces (and the loopback).</p>
<p class="info">Junos can run a single instance of each routing protocol <em>per routing instance</em>. You can run multiple copies of IS-IS, but you have to use multiple routing instances. The routing instances are not exactly VRFs; you can merge routes from multiple routing instances with proper <strong>import </strong>and <strong>export </strong>policies.</p>
<p>The configuration guide told me to configure NET on the loopback interface:</p>
<pre class="code">root@PE-A&gt; <strong>show configuration interfaces lo0.0</strong><br/>family inet {<br/>    address 10.0.1.1/32;<br/>}<br/>family iso {<br/>    address 49.0000.0000.cccc.0001.00;<br/>}<br/>family inet6 {<br/>    address fec0::cccc:1/128;<br/>    address ::ffff:10.0.1.1/128;<br/>}</pre><p>All other IS-IS-related configuration is done within the <strong>protocols isis </strong>configuration block – a major difference from Cisco IOS, where you configure interface-specific parameters within the <strong>interface </strong>configuration mode (<a href="/2011/11/junos-interfaces-and-protocols-now-i.html">here’s why the Junos approach makes sense</a>).</p>
<p class="info"><strong>Discovery #1</strong>: Junos expects you to configure all routing protocol-related parameters in the <strong>protocols </strong>part of the configuration.</p>
<p>Anyway, continuing to read the Routing Protocols Configuration Guide, I listed all core interfaces within the <strong>protocol isis </strong>block:</p>
<pre class="code">root@PE-A&gt; <strong>show configuration protocols isis</strong><br/>topologies ipv6-unicast;<br/>interface ge-0/0/1.0 {<br/>interface ge-0/0/4.0;<br/>interface lo0.0;</pre><p>No good, there were no adjacencies, and IS-IS was supposedly running only on the loopback interface. Excuse me? I did configure it on three interfaces.</p>
<pre class="code">root@PE-A&gt; <strong>show isis adjacency</strong><br/><br/>root@PE-A&gt; show isis interface<br/>IS-IS interface database:<br/>Interface             L CirID Level 1 DR        Level 2 DR        L1/L2 Metric<br/>lo0.0                 0   0x1 Passive           Passive                 0/0</pre><p>After spending some more time going through the Routing Protocols configuration guide I figured out the problem: you have to enable <strong>family iso </strong>on the interfaces on which you want IS-IS to run. Remember: without <a href="/2011/11/junos-interfaces-and-protocols-now-i.html">data-plane configuration (interfaces) control plane won’t work</a>. </p>
<p class="info"><strong>Discovery #2</strong>: List IS-IS interfaces in the <strong>protocol isis </strong>configuration block and enable <strong>family iso </strong>on each interface.</p>
<pre class="code">root@PE-A&gt; <strong>show configuration interfaces ge-0/0/4.0</strong><br/>description "Link to P router";<br/>family inet {<br/>    address 10.0.7.9/30;<br/>}<br/>family iso;<br/>family inet6;<br/><br/>root@PE-A&gt; <strong>show configuration interfaces ge-0/0/1.0</strong><br/>family iso;<br/>family inet6 {<br/>    unnumbered-address lo0.0;<br/>}</pre><p>After adding the <strong>family iso </strong>into each interface configuration, IS-IS started to work and established both L1 and L2 adjacencies between all routers.</p>
<pre class="code">root@PE-A# <strong>run show isis adjacency</strong><br/>Interface             System         L State        Hold (secs) SNPA<br/>ge-0/0/1.0            PE-B           1  Up                    8  56:68:28:2b:86:eb<br/>ge-0/0/1.0            PE-B           2  Up                    6  56:68:28:2b:86:eb<br/>ge-0/0/4.0            P              1  Up                    8  56:68:28:2b:87:5<br/>ge-0/0/4.0            P              2  Up                    8  56:68:28:2b:87:5</pre><p>However, a quick look into the IS-IS database revealed a <a href="/2011/11/multi-level-is-is-in-single-area-think.html">well-known problem: L2 LSP contained all prefixes known to IS-IS</a>:</p>
<pre class="code">root@PE-A&gt; <strong>show isis database detail PE-A</strong><br/>IS-IS level 1 link-state database:<br/><br/>PE-A.00-00 Sequence: 0xb, Checksum: 0x6323, Lifetime: 1068 secs<br/>   IPV4 Unicast IS neighbor: PE-B.00          Metric:       10<br/>   IPV4 Unicast IS neighbor: P.03             Metric:       10<br/>   IPV6 Unicast IS neighbor: PE-B.00          Metric:       10<br/>   IPV6 Unicast IS neighbor: P.03             Metric:       10<br/>   IP IPV4 Unicast prefix: 10.0.1.1/32        Metric:        0 Internal Up<br/>   IP IPV4 Unicast prefix: 10.0.7.8/30        Metric:       10 Internal Up<br/>   V6 IPV6 Unicast prefix: ::ffff:10.0.1.1/128 Metric:        0 Internal Up<br/>   V6 IPV6 Unicast prefix: fec0::cccc:1/128   Metric:        0 Internal Up<br/><br/>IS-IS level 2 link-state database:<br/><br/>PE-A.00-00 Sequence: 0xd, Checksum: 0x7eb0, Lifetime: 1068 secs<br/>   IPV4 Unicast IS neighbor: PE-B.00          Metric:       10<br/>   IPV4 Unicast IS neighbor: P.03             Metric:       10<br/>   IPV6 Unicast IS neighbor: PE-B.00          Metric:       10<br/>   IPV6 Unicast IS neighbor: P.03             Metric:       10<br/>   IP IPV4 Unicast prefix: 10.0.1.1/32        Metric:        0 Internal Up<br/>   IP IPV4 Unicast prefix: 10.0.1.2/32        Metric:       20 Internal Up<br/>   IP IPV4 Unicast prefix: 10.0.1.5/32        Metric:       20 Internal Up<br/>   IP IPV4 Unicast prefix: 10.0.1.6/32        Metric:       10 Internal Up<br/>   IP IPV4 Unicast prefix: 10.0.2.0/24        Metric:       20 Internal Up<br/>   IP IPV4 Unicast prefix: 10.0.7.8/30        Metric:       10 Internal Up<br/>   IP IPV4 Unicast prefix: 10.0.7.16/30       Metric:       20 Internal Up<br/>   V6 IPV6 Unicast prefix: ::ffff:10.0.1.1/128 Metric:        0 Internal Up<br/>   V6 IPV6 Unicast prefix: ::ffff:10.0.1.2/128 Metric:       20 Internal Up<br/>   V6 IPV6 Unicast prefix: ::ffff:10.0.1.5/128 Metric:       20 Internal Up<br/>   V6 IPV6 Unicast prefix: ::ffff:10.0.1.6/128 Metric:       10 Internal Up<br/>   V6 IPV6 Unicast prefix: fec0::cccc:1/128   Metric:        0 Internal Up<br/>   V6 IPV6 Unicast prefix: fec0::cccc:2/128   Metric:       20 Internal Up<br/>   V6 IPV6 Unicast prefix: fec0::cccc:3/128   Metric:       10 Internal Up<br/>   V6 IPV6 Unicast prefix: fec0::cccc:4/128   Metric:       20 Internal Up<br/>   V6 IPV6 Unicast prefix: fec0:1:1:13::/64   Metric:       20 Internal Up</pre><p>The fix for that behavior is very simple: disable L1 routing. Here’s where the Junos documentation gets confusion – it tells you to disable L1 hellos on each individual interface, whereas in reality you can disable L1 globally with <strong>set protocols isis level 1 disable</strong>. I checked every possible angle, including “Configuring IS-IS” section (which lists all IS-IS configuration parameters) and “Summary of IS-IS Configuration Statements” – the <strong>level 1 disable </strong>command should not work at the <strong>protocol isis </strong>level ... but it does (which is a good thing).</p>
<p class="codecaption">Disable L1 processing</p>
<pre class="code">root@PE-A# <strong>show protocols isis</strong><br/>topologies ipv6-unicast;<br/>level 1 disable;<br/>interface ge-0/0/1.0<br/>interface ge-0/0/4.0;<br/>interface lo0.0; </pre><p class="info"><strong>Discovery #3</strong>: Disable L1 processing on individual IS-IS interfaces with <strong>set interface </strong><strong><em>name </em></strong><strong>level 1 disable </strong>configuration command. To disable it globally, use <strong>set level 1 disable </strong>command within [edit protocols isis].</p>
<p>Only L2 adjacencies were established after the configuration change ...</p>
<pre class="code">root@PE-A# <strong>run show isis adjacency</strong><br/>Interface             System         L State        Hold (secs) SNPA<br/>ge-0/0/1.0            PE-B           2  Up                    6  56:68:28:2b:86:eb<br/>ge-0/0/4.0            P              2  Up                    8  56:68:28:2b:87:5</pre><p>... and L2 LSP contained only the local prefixes:</p>
<pre class="code">root@PE-A&gt; show isis database PE-A detail<br/>IS-IS level 1 link-state database:<br/><br/>PE-A.00-00 Sequence: 0xd, Checksum: 0x94ef, Lifetime: 632 secs<br/>   IPV4 Unicast IS neighbor: PE-B.00          Metric:       10<br/>   IPV4 Unicast IS neighbor: P.03             Metric:       10<br/>   IPV6 Unicast IS neighbor: PE-B.00          Metric:       10<br/>   IPV6 Unicast IS neighbor: P.03             Metric:       10<br/>   IP IPV4 Unicast prefix: 10.0.1.1/32        Metric:        0 Internal Up<br/>   IP IPV4 Unicast prefix: 10.0.7.8/30        Metric:       10 Internal Up<br/>   V6 IPV6 Unicast prefix: ::ffff:10.0.1.1/128 Metric:        0 Internal Up<br/>   V6 IPV6 Unicast prefix: fec0::cccc:1/128   Metric:        0 Internal Up<br/><br/>IS-IS level 2 link-state database:<br/><br/>PE-A.00-00 Sequence: 0x14, Checksum: 0x512c, Lifetime: 998 secs<br/>   IPV4 Unicast IS neighbor: PE-B.00          Metric:       10<br/>   IPV4 Unicast IS neighbor: P.03             Metric:       10<br/>   IPV6 Unicast IS neighbor: PE-B.00          Metric:       10<br/>   IPV6 Unicast IS neighbor: P.03             Metric:       10<br/>   IP IPV4 Unicast prefix: 10.0.1.1/32        Metric:        0 Internal Up<br/>   IP IPV4 Unicast prefix: 10.0.7.8/30        Metric:       10 Internal Up<br/>   V6 IPV6 Unicast prefix: ::ffff:10.0.1.1/128 Metric:        0 Internal Up<br/>   V6 IPV6 Unicast prefix: fec0::cccc:1/128   Metric:        0 Internal Up</pre><h4>Summary of major differences between Cisco IOS and Junos</h4><ul class="ListParagraph"><li>You have to configure CLNS NET on the loopback interface, not within the IS-IS process;</li>
<li>You can configure a single IS-IS routing process per <em>routing instance</em>, but can run multiple IS-IS processes per box (using multiple routing instances);</li>
<li>You have to enable <strong>family iso </strong>on every interface on which you want to run IS-IS;</li>
<li>You have to enable IS-IS on individual interfaces within the <strong>protocol isis </strong>section, not within the interface configuration;</li>
<li>You can use <strong>set protocol isis interface all</strong>, which would enable IS-IS on all interfaces that have <strong>family iso </strong>enabled. After that, you can disable individual interfaces with <strong>set protocol isis interface </strong><strong><em>name </em></strong><strong>disable</strong>.</li>
</ul>
<h4>Disclosure</h4><p>The only reason I learned the marginal bits &amp; pieces I know about Junos is because Juniper kindly provided me with free access to Junosphere environment</a> (thanks to @abnerg) ... but I was not compensated for my blog posts, or asked to write about Junos or Junosphere. </p>

