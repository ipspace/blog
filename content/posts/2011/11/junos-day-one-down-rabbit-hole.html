---
url: /2011/11/junos-day-one-down-rabbit-hole/
title: "Junos Day One: Translating Configurations The Geeky Way"
date: "2011-11-08T06:50:00.001+01:00"
tags: [ Junos ]
---

<p>Abner (@abnerg) Germanov surprised us all at the end of <a href="http://techfieldday.com/2011/juniper-presents-networking-field-day-2/">Juniper’s presentation</a> at <a href="http://techfieldday.com/2011/nfd2/">Networking Tech Field Day</a> when he announced <a href="http://www.juniper.net/as/en/products-services/software/junos-platform/junosphere/">Junosphere</a> access for all the delegates – after a year of nagging, I would finally be able to touch Junos. However, instead of taking it easy and studying the excellent <a href="http://www.juniper.net/dayone">Junos Day One</a> books (which I also did – if you’re new to Junos you should definitely start there; they are well worth reading), I decided to take a more geeky approach.<!--more--></p>
<p class="note">Obviously it would be easier and faster for me to buy an SRX or two on the eBay to get exposure to Junos, but I wanted to test a few somewhat larger scenarios with recent Junos releases and the second-hand equipment rarely comes with brand new software (don’t even mention that you can get Junos in the wild and run it on Olive). </p>
<p>If you’ve watched the video of the <a href="http://forums.juniper.net/t5/Junos-Automation-Scripting/bd-p/junos-automation">Junos Automation</a> presentation Dan Backman did during the Networking Tech Field Day, you might have noticed how excited I was about the fact that Junos uses XML internally – I developed several XML-based web sites and know all about the flexibility (and a lot about the pain) of using XML and XSLT behind the scenes. </p>
<div style="text-align: center"><iframe allowfullscreen="" frameborder="0" height="293" src="http://player.vimeo.com/video/31477811?byline=0" webkitallowfullscreen="" width="521"></iframe></div>
<p>As Cisco IOS supposedly also supports XML output, I had this very simple idea: generate XML from Cisco IOS, use an XSLT transformation to copy relevant parameters into XML-formatted Junos configuration, and another XSLT transformation to change it into <strong>set </strong>commands or curly-braces syntax.</p>
<p class="note">I know Juniper offers an <a href="http://kb.juniper.net/InfoCenter/index?page=content&amp;id=KB15482">IOS-to-Junos configuration translation tool</a> ... but using it wouldn't be nearly as much fun (not to mention the educational value) as this project was.</p>
<p><strong>Step#1 – get sample Junos </strong><strong>configurations in XML format</strong>. A few twitter friends replied to my plea for help (I wanted to get ready before getting Junosphere access) and sent me scrubbed configs in XML and test format. Thank you, you’ve been a great help!</p>
<p><strong>Step#2 – generate text configuration from XML</strong>. Ouch. As every other large system, Junos seems to have evolved “organically” and there’s no simple way of transforming XML configuration into a format that’s identical to a text configuration a Junos router generates; there are just too many exceptions (more about that some other time).</p>
<p>Anyhow, I got 95% there after extensive tweaking and it turns out Junos doesn’t care too much about the exact syntax – as long as the object structure is correct, it usually parses and accepts the configuration. </p>
<p>If you’re interested in this project, <a href="https://github.com/ioshints/Ios2Junos/blob/master/xmlToCurly.xsl">download the XSLT</a> and play with it. To use it, you need a XSLT 2.0 processor; I highly recommend <a href="http://saxon.sourceforge.net/">Saxon (home edition)</a>.</p>
<p><strong>Step#</strong><strong>3</strong><strong> – generate XML configs from Cisco IOS</strong>. Fail. Cisco IOS does not use XML internally; its configurations are generated in text format (don’t blame anyone – the development of Cisco IOS had started long before someone even dreamed about XML).</p>
<p>However, in theory you should be able to get an IOS configuration in XML format with the <strong>show configuration | format</strong><strong> </strong>command. Unfortunately, that command has to rely on a technique somewhat similar to <a href="http://en.wikipedia.org/wiki/Data_scraping#Screen_scraping"><em>screen scraping</em></a><em> </em>– it re-parses the configuration generated by Cisco IOS and tries to munge it into XML format. </p>
<p>The process worked reasonably well when I first tried it years ago; this time I got parsing errors and totally unusable XML. Time for Plan B.</p>
<div class="separator" style="clear: both; text-align: center;"><a href="http://en.wikipedia.org/wiki/Antoni_Gaud%C3%AD" imageanchor="1" style="margin-left:1em; margin-right:1em"><img border="0" height="320" src="/2011/11/s320-gaudi" width="246"/></a><br/><span style="font-size: 90%">Yeah, this looks about right</span></div>
<h4>A geek makes the wrong choice</h4><p>At this point, I had a few options:</p>
<ul class="ListParagraph"><li>Generate Junos configuration by hand. This would be the easiest and least painful one; after all, I wanted to get basic configuration, IP addressing and IGP routing from my existing IOS configurations.</li>
<li>Write a Perl script that would use regular expressions to collect those parameters from IOS configurations and output them in curly-braces format.</li>
<li>Develop a generic solution. </li>
</ul>
<p>By now, you probably know what option a stupid geek with a strong affinity for getting-it-right solutions would choose ... because a bunch of regular expressions in a Perl script just isn’t good enough when all you need is interface IP/IPv6 addressing and OSPF/IS-IS routing.</p>
<p>Two days later, I had a <a href="https://github.com/ioshints/Ios2Junos">set of Perl scripts</a> that:</p>
<ul class="ListParagraph"><li>Parse a simple language that you can use to specify which Cisco IOS configuration parameters you want to match and how they translate into XML nodes in Junos configuration (yeah, I revisited the wonderland of LR-parsers and rediscovered Parse::RecDescent).</li>
<li>Interpret that language to collect Cisco IOS configuration information and create XML DOM tree (fortunately, the XML::LibXML Perl module supports XPath syntax);</li>
<li>Output the generated XML document or push it through the XSLT processor to generate the Junos configuration.</li>
</ul>
<p>At the moment, all those scripts can do is to copy the IP/IPv6 interface addresses and very basic IS-IS routing configuration from Cisco IOS format to Junos format ... but the solution is clearly extensible ;) and it actually generates working Junos configurations that I was able to use in Junosphere.</p>
<p style="text-align: right;">To be continued ...</p>
<p><strong>Disclosure</strong>: Juniper indirectly covered some of my travel expenses during the Networking Tech Field Day by participating in the event, but nobody has ever asked me to write about their products or solutions.</p>

