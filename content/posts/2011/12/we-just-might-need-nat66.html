---
url: /2011/12/we-just-might-need-nat66.html
title: "We just might need NAT66"
date: "2011-12-06T07:12:00.000+01:00"
tags: [ IPv6,NAT ]
---

<p>My friend Tom Hollingsworth has written another <a href="http://networkingnerd.net/2011/12/01/whats-the-point-of-nat66/">NAT66-is-evil</a> blog post. While I agree with him in principle, and most everyone agrees NAT as we know it from IPv4 world is plain stupid in IPv6 world (NAPT more so than NAT), we just might need NPT66 (<a href="http://www.rfc-editor.org/rfc/rfc6296.txt">Network Prefix Translation; RFC 6296</a>) to support <a href="http://wiki.nil.com/Small_site_multihoming">small-site multihoming</a> ... and yet again, it seems that many leading IPv6 experts grudgingly agree with me.<!--more--></p>
<h4>What’s the problem</h4><p>There’s plenty of multihoming going on in the current Internet without anyone being aware of it. Anyone using Internet for mission-critical applications (or business-grade cloud access) can get two Internet connections from two upstream providers and <a href="http://wiki.nil.com/Small_site_multihoming">use pretty simple NAT tricks to use those connections</a> in either active-standby or active-active mode. I’m personally aware of a few large multinational organizations using similar designs for remote office or retail access.</p>
<div class="separator"><a href="http://wiki.nil.com/Small_site_multihoming"><img src="http://wiki.nil.com/wk/images/d/db/SOHO_Multihoming_Addressing.jpg" style="width: 320px;"/></a></div>
<p>Using currently available low-end routers and existing IPv6 host stacks (with <a href="https://blog.ipspace.net/2009/08/what-went-wrong-tcpip-lacks-session.html">TCP stack without a session layer</a> and <a href="https://blog.ipspace.net/2009/08/what-went-wrong-socket-api.html">broken socket API</a>) you can solve the same problem in one of two ways in the IPv6 world:</p>
<p><strong>BGP-based multihoming</strong>. Get a large chunk of provider-independent (PI) address space and an AS number, assign a /48 to every location, and run BGP with two upstream ISPs from every location. </p>
<p class="note">With a few routing tricks you don’t need more than one AS number; you can use default routing or <strong>allowas-in </strong>to get connectivity between your sites.</p>
<p>With this approach anyone in Elbonia who’s willing to pay ASN and PI prefix tax (a few tens or hundreds € or $ per year) and a business-grade ISP connection to two Service Providers gets the chance to pollute routing and forwarding tables in every router in the default-free zone ... worldwide. Not something I’m looking forward to.</p>
<p><strong>VPN-based multihoming</strong><strong>. </strong>You use your own address space within the remote office site; the public address space assigned by the ISPs is used only to address tunnel endpoints. This design does not allow <em>local Internet exit</em> (all Internet traffic has to be shuffled over a VPN tunnel to a central hub site) – often a showstopper for companies that have widespread remote offices.</p>
<p><strong>NPT66-based multihoming</strong><strong>. </strong>Works in exactly the same way as NAT-based multihoming in IPv4, but translates only on the upper 64 bits of the IPv6 prefix. It’s NAT (so it’s evil), but at least it’s stateless.</p>
<div class="separator"><a href="http://en.wikipedia.org/wiki/File:Modelshipmadewithpaper.jpg"><img src="http://upload.wikimedia.org/wikipedia/en/a/af/Modelshipmadewithpaper.jpg"/></a><span>It's amazing how far the duct tape can bring you</span></div>
<h4>Unicorn tears and other solutions</h4><p>There are a number of other solutions we could use, but they all require changes to the host IPv6 stack, so it’s not likely we’ll see them implemented any time soon.</p>
<p><a href="http://en.wikipedia.org/wiki/Stream_Control_Transmission_Protocol">SCTP</a> and <a href="http://en.wikipedia.org/wiki/Shim6">Shim6</a> are pretty old and well-known. SCTP requires application-level changes (due to broken socket API), Shim6 requires changes in the IPv6 stack.</p>
<p><a href="http://ietfreport.isoc.org/idref/draft-ietf-v6ops-ipv6-multihoming-without-ipv6nat/">IPv6 multihoming without IPv6 NAT</a> is one of the emerging IETF drafts that try to address the problem (you should read at least the first few sections, where they admit you need NPT66) ... but yet again requires changes to the host IPv6 stack to work properly (but only in the source IP address selection policy code).</p>
<p><a href="http://en.wikipedia.org/wiki/Locator/Identifier_Separation_Protocol">LISP</a> would replace BGP-based multihoming with LISP-based multihoming (moving the customer prefixes into the LISP+ALT topology, which yet again uses BGP). This approach will probably work well once everyone deploys LISP. In the meantime, you’ll need proxy-ITR/ETR routers (6to4 relays anyone?), resulting in suboptimal traffic flows and central choke points.</p>
<h4>Summary</h4><p>As much as I hate to admit it, NPT66 seems to be the most flexible solution for the small-site IPv6 multihoming problem we have today. I would love to see the host IPv6 stacks fixed, but I’ve learned a sad lesson from the history of NAT: once the networking McGyvers fix other people’s problems with layers of duct tape, everyone starts pretending the problem is gone and goes off chasing another squirrel.</p>
<h4>More information</h4><ul class="ListParagraph"><li><a href="http://www.ipspace.net/Enterprise_IPv6_-_the_First_Steps"><em>Enterprise IPv6 – the first steps</em></a> webinar gives you an overview of IPv6 technologies, 4-to-6 migration alternatives and design recommendations.</li>
<li><a href="http://www.ipspace.net/Service_Provider_IPv6_Introduction"><em>Service Provider IPv6 Introduction</em></a> is an introductory-level webinar targeting ISP environments.</li>
<li><a href="http://www.ipspace.net/Building_IPv6_Service_Provider_Core"><em>Building Ipv6 Service Provider Core</em></a> webinar describes access- and core-layer technologies and designs.</li>
</ul>
<p>All three webinars (and numerous others) are part of the <a href="http://www.ipspace.net/Subscription">yearly subscription</a>.</p>

