---
url: /2011/10/l2-or-l3-switching-in-campus-networks/
title: "L2 or L3 switching in campus networks?"
date: "2011-10-31T15:04:00.000+01:00"
tags: [ switching,LAN ]
---

<p>Michael sent me an interesting question:</p>
<blockquote class="cite">I work in a rather large enterprise facing a campus network redesign. I am in favor of using a routed access for floor LANs, and make Ethernet segments rather small (L3 switching on access devices). My colleagues seem to like L2 switching to VSS (distribution layer for the floor LANs). OSPF is in use currently in the backbone as the sole routing protocol. So basically I need some additional pros and cons for VSS vs Routed Access. :-)</blockquote>
<p>The follow-up questions confirmed he has L3-capable switches in the access layer connected with redundant links to a pair of Cat6500s:<!--more--></p>
<div class="separator" style="clear: both; text-align: center;"><a href="/2011/10/s1600-L2L3Campus_HW.png" imageanchor="1" style="margin-left:1em; margin-right:1em"><img border="0" height="209" src="/2011/10/s320-L2L3Campus_HW.png" width="320"/></a></div>
<h4>What are the options?</h4><p>There are two fundamental designs Michael could use:</p>
<p><strong>Layer-3 switching (also known as routing) in the access layer</strong>. VLANs would be terminated at the access-layer switch (no user-to-switch redundancy, thus no HSRP), the links between access and distribution layer would be P2P L3 links (routed interfaces) and every single switch would participate in the OSPF routing.</p>
<div class="separator" style="clear: both; text-align: center;"><a href="/2011/10/s1600-L2L3Campus_L2Design.png" imageanchor="1" style="margin-left:1em; margin-right:1em"><img border="0" height="214" src="/2011/10/s320-L2L3Campus_L2Design.png" width="320"/></a></div>
<p><strong>Layer-2 switching (also known as bridging) in the access layer</strong>. VLANs would be terminated at the distribution layer; the access layer switches would run as pure bridges. Half of the uplinks would be blocked due to the spanning tree limitations, unless you aggregate them with multi-chassis link aggregation (MLAG), which requires VSS on the Cat6500. You would still run STP with MLAG to prevent forwarding loops due to configuration or wiring errors.</p>
<div class="separator" style="clear: both; text-align: center;"><a href="/2011/10/s1600-L2L3Campus_L3Design.png" imageanchor="1" style="margin-left:1em; margin-right:1em"><img border="0" height="241" src="/2011/10/s320-L2L3Campus_L3Design.png" width="320"/></a></div>
<p>When you configure VSS on Cat6500s, they appear as a single IP device, so yet again you don’t need HSRP.</p>
<h4>Which one is better?</h4><p>Both designs have minor benefits and drawbacks. For example, L3 design is more complex and has larger OSPF areas, L2 design requires VSS on Cat6500. The major showstopper is usually the requirement for multiple security zones (for example, users in different departments or guest VLANs).</p>
<p>You might be lucky enough and satisfy the security requirements by installing packet filters in every access VLANs, but more often than not you have to implement <em>path separation </em>throughout the network – for example, the guest VLAN traffic should stay separated from internal traffic. </p>
<p>The proper L3 solution to path separation is full-blown MPLS/VPN with label-based forwarding in the L3 part of the network ... but HP seems to be the only vendor with MPLS/VPN support on low-end A-series switches. </p>
<p>Without MPLS/VPN you’re left with the Multi-VRF kludge (assuming your access layer switch support VRFs – not all do), where you have to create numerous P2P L3 interfaces (using VLANs) between access and core switches. Do I have to mention you have to run a separate copy of OSPF in each VRF instance?</p>
<div class="separator" style="clear: both; text-align: center;"><a href="/2011/10/s1600-L2L3Campus_L3Separation.png" imageanchor="1" style="margin-left:1em; margin-right:1em"><img border="0" height="255" src="/2011/10/s320-L2L3Campus_L3Separation.png" width="320"/></a></div>
<p>Obviously the MultiVRF-based path separation doesn’t scale, so it might be easier to go with the L2 design: terminate VLANs on the Cat6500, where you can use centralized packet filters, VRFs and even MPLS/VPN if you need to retain the path separation across the network core.</p>
<div class="separator" style="clear: both; text-align: center;"><a href="/2011/10/s1600-L2L3Campus_L2Separation.png" imageanchor="1" style="margin-left:1em; margin-right:1em"><img border="0" height="260" src="/2011/10/s320-L2L3Campus_L2Separation.png" width="320"/></a></div>
<h4>Have I missed something?</h4><p>What are your thoughts? Would you prefer L2 or L3 switching in access network? Do you believe in “route where you must, bridge where you can” or in “route as much as possible”? Write a comment!</p>
<h4>Any relevant webinars?</h4><p>Sure. <a href="https://www.ipspace.net/Enterprise_MPLS_VPN_Deployment">Enterprise MPLS/VPN Deployment</a> webinar (<a href="https://www.ipspace.net/Recordings?code=EntMPLS">recording</a>) describes the path separation challenges and the potential solutions – MultiVRF and MPLS/VPN with label-based forwarding. You’ll also learn about VRF-aware NAT and DHCP (just in case you need them in your network). And if you’re interested in a <a href="https://www.ipspace.net/Webinar_roadmaps">wider range of topics</a>, you might find the <a href="https://www.ipspace.net/Subscription">yearly subscription</a> cost effective.</p>
<h4>And what are those crazy diagrams?</h4><p><a href="http://etherealmind.com/">Greg Ferro</a> has persuaded me that iPad-based drawing has a future. I bought a proper pen (doing it with your fingers will get you a kindergarten-grade results), <a href="http://itunes.apple.com/us/app/penultimate/id354098826?mt=8">Penultimate</a> software (nothing to do with <a href="/2011/07/penultimate-hop-popping-php-demystified/">Penultimate Hop Popping</a>) and started experimenting. Who know, I just might <a href="http://www.amazon.com/gp/product/1591843065/ref=as_li_tf_tl?ie=UTF8&amp;tag=cisioshinandt-20&amp;linkCode=as2&amp;camp=217145&amp;creative=399369&amp;creativeASIN=1591843065">learn how to do good napkin drawings</a>.</p>

