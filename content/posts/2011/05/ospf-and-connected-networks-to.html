---
url: /2011/05/ospf-and-connected-networks-to.html
title: "OSPF and connected networks: to redistribute or not?"
date: "2011-05-03T06:59:00.000+02:00"
tags: [ OSPF ]
---

<p>A few days ago I was discussing a data center design with a seasoned network architect and during the MPLS discussions he made an offhand remark “there are still some switches running OSPF and using <strong>network 0.0.0.0 </strong>and <strong>redistribute connected.</strong>” My first thought was “this can’t be good” but I had no idea how bad it is until I ran a lab test.</p>
<p>The generic dilemma along the lines of “should I make connected interfaces part of my OSPF process (and make them passive) or should I redistribute them into OSPF” has no clear-cut answer (apart from the obvious “it depends”) ... and Google will quickly find you tons of lengthy discussions.<!--more--></p>
<p>However, doing both is clearly harmful, as the router includes connected subnets as stub links in its Type-1 LSA (causing full SPF run every time an interface flaps) <em>and </em>generates Type-5 LSA for every connected subnet (and you know the pesky Type-5 LSAs will just whizz by any summarization boundary and plague the whole OSPF domain). To make matters even more complex, specifying OSPF area on an interface (with the <strong>ip ospf area </strong>interface configuration command) <em>disables the generation of Type-5 LSA </em>whereas using the <strong>network </strong>statement does not (tested with IOS release 15.0(1)M).</p>
<p>The next printout shows the summary of the IP addressing/OSPF configuration I was using (I started a single router in one of the OSPF labs that you get as part of the <a href="https://www.ipspace.net/DMVPN:_From_Basics_to_Scalable_Networks">DMVPN – From Basics to Scalable Networks</a> webinar).</p>
<pre class="code">interface Loopback0<br/> ip address 10.0.1.5 255.255.255.255<br/> ip ospf 1 area 11<br/>!<br/>interface Tunnel0<br/> ip address 192.168.0.5 255.255.255.0<br/> ip ospf network broadcast<br/> ip ospf priority 0<br/>!<br/>interface Tunnel1<br/> ip address 192.168.1.5 255.255.255.0<br/> ip ospf network broadcast<br/> ip ospf priority 0<br/>!<br/>interface FastEthernet0/0<br/> ip address 172.16.11.1 255.255.255.0<br/> ip ospf 1 area 11<br/>!<br/>interface Serial1/0<br/> ip address 10.0.7.9 255.255.255.252<br/> encapsulation ppp<br/>!<br/>router ospf 1<br/> log-adjacency-changes<br/> redistribute connected subnets<br/> network 0.0.0.0 255.255.255.255 area 11</pre><p>The router has five operational IP-enabled interface:</p>
<pre class="code">R2#<strong>show ip interface brief | include up</strong><br/>FastEthernet0/0       172.16.11.1     YES NVRAM  up          up<br/>Serial1/0             10.0.7.9        YES NVRAM  up          up<br/>Loopback0             10.0.1.5        YES NVRAM  up          up<br/>Tunnel0               192.168.0.5     YES NVRAM  up          up<br/>Tunnel1               192.168.1.5     YES NVRAM  up          up</pre><p>OSPF is running on five interfaces (as expected), all of them covered by the <strong>network </strong>statement. OSPF area is specified on two of them with interface configuration commands:</p>
<pre class="code">R2#<strong>show ip ospf interface | include protocol|Area|Enabled</strong><br/>Loopback0 is up, line protocol is up<br/>  Internet Address 10.0.1.5/32, Area 11<br/>  Enabled by interface config, including secondary ip addresses<br/>Tunnel1 is up, line protocol is up<br/>  Internet Address 192.168.1.5/24, Area 11<br/>Tunnel0 is up, line protocol is up<br/>  Internet Address 192.168.0.5/24, Area 11<br/>Serial1/0 is up, line protocol is up<br/>  Internet Address 10.0.7.9/30, Area 11<br/>FastEthernet0/0 is up, line protocol is up<br/>  Internet Address 172.16.11.1/24, Area 11<br/>  Enabled by interface config, including secondary ip addresses</pre><p>The OSPF database has one Type-1 LSA (with five links) and three Type-5 LSAs:</p>
<pre class="code">R2#<strong>show ip ospf database</strong><br/><br/>            OSPF Router with ID (10.0.1.5) (Process ID 1)<br/><br/>                Router Link States (Area 11)<br/><br/>Link ID         ADV Router      Age         Seq#       Checksum Link count<br/>10.0.1.5        10.0.1.5        806         0x80000006 0x00C926 5<br/><br/>                Type-5 AS External Link States<br/><br/>Link ID         ADV Router      Age         Seq#       Checksum Tag<br/>10.0.7.8        10.0.1.5        862         0x80000001 0x003644 0<br/>192.168.0.0     10.0.1.5        812         0x80000001 0x00B670 0<br/>192.168.1.0     10.0.1.5        808         0x80000001 0x00AB7A 0</pre><p>The stub network links of the Type-1 LSA include all five directly connected interfaces:</p>
<pre class="code">R2#<strong>show ip ospf database router 10.0.1.5 | include Network</strong><br/>    Link connected to: a Stub Network<br/>     (Link ID) Network/subnet number: 10.0.1.5<br/>     (Link Data) Network Mask: 255.255.255.255<br/>    Link connected to: a Stub Network<br/>     (Link ID) Network/subnet number: 192.168.1.0<br/>     (Link Data) Network Mask: 255.255.255.0<br/>    Link connected to: a Stub Network<br/>     (Link ID) Network/subnet number: 192.168.0.0<br/>     (Link Data) Network Mask: 255.255.255.0<br/>    Link connected to: a Stub Network<br/>     (Link ID) Network/subnet number: 10.0.7.8<br/>     (Link Data) Network Mask: 255.255.255.252<br/>    Link connected to: a Stub Network<br/>     (Link ID) Network/subnet number: 172.16.11.0<br/>     (Link Data) Network Mask: 255.255.255.0</pre><p>To summarize:</p>
<ul class="ListParagraph"><li>The router has five directly connected IP subnets; all of them are part of the OSPF routing protocol <em>and </em>redistributed into OSPF;</li>
<li>The Type-1 LSA has five stub networks (as expected)</li>
<li>Connected subnets are also inserted into the OSPF database as Type-5 LSAs (as expected)</li>
<li>However, only three connected subnets (those without <strong>ip ospf area </strong>interface configuration command) are redistributed into OSPF.</li>
</ul>
<p>Weird? Absolutely. Confusing? You bet. </p>
<h4>@ioshints Recommendation</h4><p>Use one or the other mechanism, not both. If you decide to redistribute connected subnets into OSPF with the <strong>redistribute connected subnets </strong>command, don’t use the <strong>network</strong>-based routing protocol configuration; use <strong>ip ospf area </strong>interface configuration commands on transit interfaces to minimize the number of Type-5 LSAs inserted into the OSPF database.</p>

