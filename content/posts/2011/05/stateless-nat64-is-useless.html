---
url: /2011/05/stateless-nat64-is-useless.html
title: "Stateless NAT64 is useless"
date: "2011-05-23T06:40:00.000+02:00"
tags: [ IPv6,Workshop ]
---

<p>When I was <a href="http://www.slideshare.net/IOSHints/nat64-and-dns64-in-30-minutes">explaining stateless and stateful NAT64</a> a while ago, I compared them to what we used to know as NAT (L3-only translation) and PAT (per-L4-session translation). Wrong. Even L3-only NAT44 needs some state (inside-to-outside IPv4 address mapping). </p>
<p>Stateless NAT64 is truly stateless: it uses a deterministic algorithm to convert IPv4 addresses into specially crafted IPv6 addresses (<a href="http://www.cisco.com/en/US/docs/ios/ios_xe/ipaddr/configuration/guide/iad_stateless_nat64_xe.html#wp1070936">a good diagram is included in IOS XE documentation</a>). It’s also mostly useless.<!--more--></p>
<p>NAT64 has two common use cases: </p>
<ul class="ListParagraph"><li><a href="https://blog.ipspace.net/2011/05/nat64-its-all-about-legacy-content.html">Allowing IPv6-only clients to reach legacy IPv4 content</a> while minimizing IPv4 address usage (similar to PAT)</li>
<li>Allowing content providers to offer their IPv4-only content over IPv6. This use case is described in my <a href="http://www.ioshints.info/IPv6E101">Enterprise IPv6 – the first steps</a> webinar (<a href="http://entipv6.eventbrite.com/">register for an online session</a> or <a href="http://www.ioshints.info/Recordings?code=IPv6E101">buy a recording</a>).</li>
</ul>
<p class="info">You don’t need a full-blown stateful NAT64 to make your content available over IPv6. 6-to-4 load balancer like F5’s BIG-IP, Brocade’s ADX or Zeus Traffic Manager is a good enough solution.</p>
<p>Stateless NAT64 cannot be used in either one of these use cases.</p>
<p><strong>IPv6 address format</strong>. Stateless NAT64 address translation algorithm works only with very particular IPv6 addresses. If you want to use stateless NAT64 to give your IPv6 clients IPv4 connectivity, you have to ensure the clients’ IPv6 addresses conform to that format. Forget SLAAC, you must use DHCPv6 (or static IPv6 addresses).</p>
<p><strong>IPv4 address preservation</strong>. Stateless NAT64 needs a separate IPv4 address for each IPv6 address it’s translating. This might have been fine 15 years ago; today we don’t have that luxury in public IPv4 networks any more. </p>
<p>You can “solve” the address preservation problem by placing a NAT44 device in front of NAT64 device. Great design ... and while doing that, why don’t you insert an <a href="http://tools.ietf.org/html/rfc4338">RFC 4338</a> link running over FCoE between the two boxes to ensure continuous headache.</p>
<p><strong>Is stateless NAT64 useful at all? </strong>Well, there is a single use case where it might come handy: if you have an IPv6-only server and you have to make it reachable to IPv4-only clients (fat chance today), stateless NAT64 is the right tool for the job.</p>
<p><strong>Why bother?</strong> Cisco promised <a href="http://blogs.cisco.com/sp/now_is_the_time_to_plan_for_your_ipv6_transition/">NAT64 a year and a half ago</a>, and then launched stateless NAT64 last November. I’m positive they’re as aware of its general uselessness as I am and I can’t figure out why they would bother launching a half-baked solution. After all, once you get the hard part done (IP header translation and ICMP translation), adding state table is a minor annoyance (more so since they already have stateful NAT44 code). Any ideas?</p>
<h4>More information</h4><p>If you need a <strong>high-level </strong><strong>IPv6 </strong><strong>overview and a</strong><strong> deployment </strong><strong>action plan</strong>, my Enterprise IPv6 – the first steps webinar is the right choice (<a href="http://entipv6.eventbrite.com/">register for an online session</a> or <a href="http://www.ioshints.info/Recordings?code=IPv6E101">buy a recording</a>).</p>
<p>If you’re interested in <strong>baseline technical details</strong> like IPv6 addressing, packet structure and basic router/host configuration, Brandon’s <a href="http://myipv6tutor.com/join?ap_id=ioshints">MyIPv6Tutor</a> is the best choice (<a href="http://myipv6tutor.com/join?ap_id=ioshints">register</a>).</p>
<p>Working for a Service Provider? You’ll find all the <strong>intricate details of deploying your IPv6 core</strong> and <strong>providing IPv6 to your enterprise and residential customers</strong> in my <a href="http://www.ioshints.info/Building_IPv6_Service_Provider_Core">Building Service Provider IPv6 Core</a> webinar (<a href="http://www.ioshints.info/Recordings?code=IPv6SPCore">buy a recording</a> or <a href="http://www.ioshints.info/Subscription">yearly subscription</a>).</p>
<p>Last but definitely not least, if you need in-depth knowledge of major Cisco IOS IPv6 features, take the weeklong <a href="http://www.nil.com/ls/IP6FD30">IPv6 Fundamentals, Design, and Deployment v3.0</a> course.</p>

