---
title: "Configuring OSPF in Phase 2 DMVPN network"
date: "2011-01-19T06:43:00.000+01:00"
tags: [ DMVPN,OSPF,Workshop ]
---

<p>Phase 2 DMVPN network should behave like a LAN (if you’re not familiar with DMVPN watch the <a href="http://blog.ioshints.info/2011/01/dmvpn-phase-1-fundamentals.html">Phase 2 DMVPN fundamentals</a> first). OSPF configuration is thus quite simple ... unless you forget to set the DR priority on the hub router(s) and one of the spokes becomes the DR. Watch the <a href="http://demo.ipspace.net/bin/watch?id=fa60e4e0-3b98-11e1-96be-005056880254">step-by-step OSPF-over-DMVPN configuration guidelines</a>.</p>
<div class="separator" style="clear: both; text-align: center;"><a href="http://demo.ipspace.net/bin/watch?id=fa60e4e0-3b98-11e1-96be-005056880254" imageanchor="1" style="margin-left:1em; margin-right:1em"><img border="0" height="277" width="400" src="http://4.bp.blogspot.com/-zAoFxLyUByo/TxMiAgB0iWI/AAAAAAAAEpg/Fg2DNZmJAWQ/s400/DMVPN_OSPF_Phase2_Play.png" /></a></div>
<p>Points to remember:<!--more--></p>
<ul class="ListParagraph"><li>Configure <strong>ip nhrp multicast-map </strong>for the hub on the spoke routers, otherwise the spokes will not send OSPF hellos to the hub. </li>
<li>Use dynamic NHRP multicast maps on the hub router, otherwise the spokes will not receive its OSPF hellos.</li>
<li>Use <strong>broadcast </strong>network type on all routers.</li>
</ul>
<p class="note">You could use <strong>non-broadcast</strong> network type and configure the neighbors manually, but that would just destroy the scalability of the solution. If you use <strong>point-to-multipoint </strong>network type, all the traffic will flow through the hub router.</p>
<ul class="ListParagraph"><li>Only the NHRP next hop servers (usually the hub router(s)) can send OSPF hellos to everyone. If any other router becomes DR or BDR, you’ll get hard-to-explain partial connectivity.</li>
<li>Set OSPF DR priority to a high value on the hub router (so even if an under-configured spoke joins the network, it won’t preempt the hub).</li>
<li>Set OSPF DR priority to zero on the spoke routers (this ensures they can never become a DR or BDR).</li>
<li>The DMVPN part of your network should be a separate OSPF area; if at all possible, make it a stub or NSSA area (watch the <a href="http://blog.ioshints.info/2011/01/ospf-configuration-in-phase-1-dmvpn.html"><em>Configuring OSPF in Phase 1 DMVPN</em></a><em> </em>video for details).</li>
</ul>
<h4>More information</h4><p>The <em>Phase 2 DMVPN </em>section of the <a href="http://www.ioshints.info/DMVPN"><em>DMVPN: from Basics to Scalable Networks</em></a> webinar (<a href="http://dmvpn.eventbrite.com/">register here</a> or <a href="http://www.ioshints.info/Recordings">buy a recording</a>) includes detailed OSPF, EIGRP and BGP configuration guidelines as well as <a href="http://blog.ioshints.info/2011/01/dmvpn-phase-2-fundamentals.html">numerous others topics described in the previous post</a>.</p>

