---
url: /2016/03/dont-run-ospf-with-your-customers.html
title: "Don’t Run OSPF with Your Customers"
date: "2016-03-14T10:05:00.000+01:00"
tags: [ OSPF,Data Center,BGP,IP routing ]
---

<p>Salman left an interesting comment on my <a href="http://blog.ipspace.net/2016/02/running-bgp-on-servers.html"><em>Running BGP on Servers</em></a> blog post:</p>
<blockquote class="cite">My prior counterparts thought running OSPF on Mainframes was a good idea. Then we had a routing blackhole due to misconfiguration on the server. Twice! The main issue was the Mainframe admins lack of networking/OSPF knowledge.</blockquote>
<p>Well, there’s a reason OSPF is called <em>Interior Routing Protocol</em>.<!--more--></p>
<p class="note">Honestly, mainframe administrators have no other options: IBM in their infinite wisdom implemented only RIP and OSPF, and OSPF seems to be the lesser evil.</p>
<p>However, even some networking engineers didn’t get the memo. Long time ago I encountered a service provider who ran OSPF with their customers, and all customers happily shared area 0 with the provider… until a customer accidentally managed to create an intra-area default route (don’t ask me how), which was preferred over provider’s external default route. And so an early attempt at plug-and-pray networking (because it’s oh-so-much-easier to run OSPF with your customers than to configure static routes) failed miserably.</p>
<h4>30K Foot View</h4><p>Ignoring the technicalities, the main difference between OSPF (which I would never run on a host) and BGP (which I’d recommended in some cases) is the intended use:</p>
<ul class="ListParagraph"><li>OSPF is an <a href="https://en.wikipedia.org/wiki/Interior_gateway_protocol"><em>Interior Routing Protocol</em></a><em> </em>designed to exchange information <em>within </em>an autonomous system.</li>
<li>BGP is an <em>Exterior Routing Protocol </em>with enough safeguards to be used <em>between </em>autonomous systems.</li>
</ul>
<p>You might claim that the mainframe Salman mentioned belongs to the same autonomous system as the data center switches. However, even the early definitions of AS (going all the way back to <a href="https://tools.ietf.org/html/rfc1654">RFC 1654</a>) don’t talk about physical proximity:</p>
<blockquote class="cite">The classic definition of an Autonomous System is a set of routers under a single technical administration…</blockquote>
<p>Obviously the mainframe team and the networking team weren’t a <em>single technical administration</em>.</p>
<h4>Technical Differences</h4><p>The intended use cases heavily influenced the design and behavior of OSPF (or IS-IS) and BGP:</p>
<ul class="ListParagraph"><li>BGP uses a pretty conservative approach to information propagation: receive -&gt; filter -&gt; evaluate -&gt; filter -&gt; propagate best information.</li>
<li>OSPF is focused on speed-of-convergence and uses a radically different approach: receive -&gt; flood everything -&gt; evaluate.</li>
</ul>
<p>In other words, anyone who’s part of an OSPF domain can insert any stupidity they wish into the domain and <strong>there’s nothing anyone else can do to stop the propagation of that stupidity</strong> within an area, <strong>and it stays in the area for at least half an hour</strong>. There are (as expected) vendor-specific kludges one can use between areas, but within area flooding rules (and external routes get flooded across area boundaries unless you use NSSA areas).</p>
<h4>To summarize</h4><p>As I <a href="http://blog.ipspace.net/2013/08/virtual-appliance-routing-network.html">wrote 2.5 years ago</a>: Don’t ever run OSPF with a third party, even if that third party happens to be your friendly server administrator. It’s not that you wouldn’t trust him, it’s just that you don’t need so many additional sources of semi-reliable information plugged straight into the heart of your network.</p>
<p>Finally, to learn more about running BGP between servers and ToR switches, register for the upcoming <a href="http://www.ipspace.net/Leaf-and-Spine_Fabric_Designs">Leaf-and-Spine Fabric Designs live webinar</a> in which I’ll cover the various design scenarios and Dinesh Dutt will talk about implementation details and real-life deployments.</p>

