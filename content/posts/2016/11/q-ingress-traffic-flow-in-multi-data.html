---
date: 2016-11-28T09:46:00.000+01:00
tags:
- design
- data center
- WAN
- high availability
title: 'Q&A: Ingress Traffic Flow in Multi-Data Center Deployments'
url: /2016/11/q-ingress-traffic-flow-in-multi-data.html
---

<p><a name="_GoBack"></a>One of my readers was watching the <a href="http://www.ipspace.net/Designing_Active-Active_and_Disaster_Recovery_Data_Centers">Building Active-Active Data Centers webinar</a> and sent me this question:</p>
<blockquote class="cite">I'm wondering if you have additional info on how to address the ingress traffic flow issue? The egress is well explained but the ingress issue wasn't as well explained.</blockquote>
<p>There’s a reason for that: there’s no good answer.<!--more--></p>
<h4>The Problem</h4><p>Let’s briefly describe the problem before going into the details. Assume someone forced you to deploy stretched VLANs (so you have the same subnet in multiple locations) or you only got a single /24 from your ISP or RIR (because that’s all that’s left and since <a href="https://www.google.com/intl/en/ipv6/statistics.html">nobody uses IPv6 yet</a> going there is not an option – hope you noticed the sarcasm).</p>
<p>In both cases you have to advertise the same /24 from multiple data centers and the clients are confused: which way should they go? Here's the diagram I used in the webinar:</p>
<div class="separator"><a href="/2016/11/s1600-Ingress+Traffic+Flow.jpg" imageanchor="1"><img border="0" src="/2016/11/s520-Ingress+Traffic+Flow.jpg"/></a></div>
<h4>Potential Solutions</h4><p>If your problem is lack of address space, you could use anycast: advertise the same prefix from multiple data centers, but terminate the TCP sessions on a different set of load balancers, all using the same outside IP address. Works surprisingly well across the global Internet (just ask <a href="https://blog.cloudflare.com/a-brief-anycast-primer/">CloudFlare</a> or <a href="https://engineering.linkedin.com/network-performance/tcp-over-ip-anycast-pipe-dream-or-reality">LinkedIn</a>).</p>
<p>If however someone forced you to implement a stretched subnet design, or you did it on your own because you <a href="http://blog.ipspace.net/2016/01/the-sad-state-of-enterprise-networking.html">trust your $vendor</a> and <a href="http://blog.ipspace.net/2013/08/temper-your-macgyver-streak.html">you know you can make it work</a>, you’re in deep **** anyway. <a href="http://blog.ipspace.net/2015/10/sometimes-you-have-to-decide-how-badly.html">There’s no good solution</a>, particularly if the traffic has to traverse any stateful service (please don’t get me started on <a href="http://blog.ipspace.net/2011/06/stretched-clusters-almost-as-good-as.html">stretched</a> <a href="http://blog.ipspace.net/2011/04/distributed-firewalls-how-badly-do-you.html">firewall clusters</a>). </p>
<p>I spent a lot of time a while ago describing the <a href="http://content.ipspace.net/get/X1%20Redundant%20Data%20Center%20Internet%20Connectivity.mp4">intricacies of redundant Internet connectivity</a> (free video) and <a href="http://www.ipspace.net/External_Routing_with_Layer-2_Data_Center_Interconnect_(DCI)">wrote a case study documenting how you might solve the external routing with L2 DCI</a>, so if you need more details you’ll find them there.</p>
<h4>Even More Details</h4><p>On a more real-life front, <a href="http://nextgendc.ipspace.net/Public:5-High-Availability_Concerns#Guest_speaker">Ethan Banks did a great presentation describing real-life lessons learned while operating active/active data centers</a> during the autumn 2016 session of <a href="http://www.ipspace.net/Building_Next-Generation_Data_Center">Building Next-Generation Data Center course</a> (you get access to the recording as soon as you <a href="http://www.ipspace.net/Building_Next-Generation_Data_Center#register">register for the course</a>).</p>
<p>And finally, if you believe that LISP is the answer regardless what the question is, I can only say <a href="https://www.youtube.com/watch?v=w5Fgp-KihIA">this</a>.</p>

