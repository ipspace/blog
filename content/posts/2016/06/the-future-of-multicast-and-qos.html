---
url: /2016/06/the-future-of-multicast-and-qos.html
title: "The Future of Multicast and QoS"
date: "2016-06-02T10:06:00.000+02:00"
tags: [ QoS,multicast ]
---

<p>A. Friend sent me a long list of questions after listening to excellent <a href="http://packetpushers.net/podcast/podcasts/show-265-future-networking-martin-casado/">Future of Networking podcast with Martin Casado</a> because (as he said) he prefers “<em>having a technical discussion with arguments and not just throwing statements out there</em><em>.</em>”</p>
<p>He started with “<em>Martin's view seems to be that network is all plumbing and all the intelligence should be in the applications.</em>”<!--more--></p>
<p>Which I totally agree with. <a href="https://blog.ipspace.net/2011/05/complexity-belongs-to-network-edge.html">Complexity belongs to the network edge</a> (ideally into the end-hosts) and every time we <a href="http://blog.ipspace.net/2013/06/network-virtualization-at-tor-switches.html">managed to move it from the network to the end-hosts</a>, we got cheaper and faster networks (example: moving from X.28 to Telnet, and from FC to NFS/iSCSI).</p>
<blockquote class="cite">They make statements that multicast and QoS are going away.</blockquote>
<p>Also somewhat agree with. Not unconditionally, but yes (and their discussion was more nuanced than that anyway, so go and listen to it). Let’s go into details.</p>
<blockquote class="cite">While I can agree with some statements, multicast is there for a reason.</blockquote>
<p>There are a few well-known use cases for multicast (live 1-to-N video streaming, stock exchange feeds), and a few others where the developers wanted to push the problem of service discovery to someone else (yet again proving RFC 1925 section 2.6). Apart from that, multicast has been a zombie for decades.</p>
<blockquote class="cite">They mention the application keeping track of who requested the stream instead. OK, so we moved the state to the application. That's fine and dandy when app is hosted on one device. Now our service is popular and needs to be hosted on multiple devices, who keeps state? How do we sync the state? Hasn't the amount of state increased compared to having it in the network? Not even taking concern of the bandwidth are wasting.</blockquote>
<p>First, state is cheap when it’s implemented in low-speed software. Low-speed RAM is cheap, high-speed packet forwarding engines using TCAM (because a walk down a data structure would be too slow) is expensive. Moving state to low-speed components makes perfect sense.</p>
<p>Also, how many times have you seen endpoints requiring the exact same content, which could then be effectively replicated on-the-fly within the network (apart from the two use cases I mentioned above)?</p>
<p>On a somewhat tangential topic, creating unnecessary state and/or syncing state across multiple devices is best avoided if you want to scale your solution. You can start with something as simple as not keeping session state in local files on your web server (so you don’t have to use session stickiness on your load balancer), or go <a href="http://conferences.oreilly.com/velocity/velocity2013/public/schedule/detail/28410">as far as Facebook did</a>.</p>
<blockquote class="cite">Regarding QoS, it's just a tool to differentiate traffic based on business needs. I can agree that throwing more bandwidth at things is often the best solution. However, that is not always an option and as long as we consider a certain type of traffic to be more important than other traffic we must have some form of QoS or queuing.</blockquote>
<p>Generic widespread end-to-end QoS has been dead even before it was born ;) One would hope that we’ve learned that lesson from ATM. Read what <a href="http://www.internetsociety.org/sites/default/files/QoS%20Huston%20June%202012.pdf">Geoff Huston wrote on the topic of Internet-wide QoS</a>, and listen to the <a href="https://blog.ipspace.net/2015/10/douglas-comer-on-future-of-networking.html">Packet Pushers podcast with Douglas Comer</a>.</p>
<p>In the data centers, it’s easier to throw more bandwidth at the problem, and solve the potential remaining 5% in the application stack. MP-TCP is one of the <a href="https://blog.ipspace.net/2015/01/load-balancing-elephant-storage-flows.html">solutions addressing the hashing problems of elephant flows</a>, as is MPIO. Other tricks like <a href="http://conferences2.sigcomm.org/co-next/2014/CoNEXT_papers/p149.pdf">FlowBender</a> modify hashing fields (IPv6 flow label or TTL) until the TCP session hits a non-congested link (they already have a patch for Linux kernel).</p>
<p class="more">We’ll talk about these issues in the next <a href="http://www.ipspace.net/Leaf-and-Spine_Fabric_Designs">Leaf-and-Spine Fabric Designs</a> webinar sometimes in autumn.</p>
<p>As for QoS on WAN, the real question is “<em>can you control the congestion point?</em>”, and in most cases, the answer is NO (because the congestion happens in DSLAM or within the SP access/core network), which leaves the end-to-end congestion tracking offered by some SD-WAN vendors as the only alternative. Yes, it’s QoS (shaping + subsequent queuing) but it’s done at the very edge of the congestion domain, not everywhere in the network.</p>

