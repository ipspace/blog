---
url: /2016/06/directed-arp-saga-continues.html
title: "Directed ARP Saga Continues"
date: "2016-06-22T08:28:00.000+02:00"
tags: [ ARP ]
---

<p>Reading my <a href="/2016/06/directed-arp-and-icmp-redirects.html">Directed ARP and ICMP Redirects</a> blog post you might have wondered “<em>how did Directed ARP ever get into ***redacted***</em>?”</p>
<p>I searched for “directed ARP cisco” and found <a href="https://supportforums.cisco.com/discussion/9703841/directed-arp-cisco-router">this gem</a>, which really talks about <em>unicast ARP </em>behavior, an ancient mechanism <a href="#page-22">documented in RFC 1122</a> (it’s not my Google-Fu, I got the reference to RFC 1122 in <a href="http://www.embeddedsystemtesting.com/2012/08/can-arp-request-be-unicast.html">this blog post</a>).<!--more--></p>
<p>Unicast ARP is used in <a href="https://support.microsoft.com/en-us/kb/949589">Windows</a> and <a href="http://stackoverflow.com/questions/23321355/unicast-arp-requests">Linux</a> to verify remote system reachability (see also <a href="/2015/05/arp-processing-in-layer-3-only-networks.html">this blog post</a>), but I never heard of Cisco IOS using it to refresh its ARP cache. Time for another test.</p>
<h4>Getting my Hands Dirty</h4><p>I used the same VIRL setup as in the <a href="/2016/06/directed-arp-and-icmp-redirects.html">previous blog post</a>. After the initial communication was established, the IOS router had ARP entries for its interfaces and the two Linux servers:</p>
<pre class="code">GW#<strong>show arp</strong><br/>Protocol  Address          Age (min)  Hardware Addr   Type   Interface<br/>Internet  10.0.0.1                -   fa16.3e63.f348  ARPA   GigabitEthernet0/1<br/>Internet  10.0.0.5               27   fa16.3e99.a0ac  ARPA   GigabitEthernet0/1<br/>Internet  10.0.1.1                -   fa16.3e63.f348  ARPA   GigabitEthernet0/1<br/>Internet  10.0.1.5                0   fa16.3e9f.d087  ARPA   GigabitEthernet0/1</pre><p>I turned on ARP debugging and cleared the ARP cache:</p>
<pre class="code">GW#<strong>debug arp</strong><br/>ARP packet debugging is on<br/>GW#<strong>clear arp</strong><br/>GW#<br/>ARP: flushing ARP entries for all interfaces<br/>IP ARP: sent rep src 10.255.0.62 fa16.3e0d.892c,<br/>                 dst 10.255.0.62 ffff.ffff.ffff GigabitEthernet0/0<br/>IP ARP: sent rep src 10.0.0.1 fa16.3e63.f348,<br/>                 dst 10.0.0.1 ffff.ffff.ffff GigabitEthernet0/1<br/>IP ARP: sent rep src 10.0.1.1 fa16.3e63.f348,<br/>                 dst 10.0.1.1 ffff.ffff.ffff GigabitEthernet0/1<br/>IP ARP: sent req src 10.0.0.1 fa16.3e63.f348,<br/>                 dst 10.0.0.5 fa16.3e99.a0ac GigabitEthernet0/1<br/>IP ARP: sent req src 10.0.0.1 fa16.3e63.f348,<br/>                 dst 10.0.1.5 fa16.3e9f.d087 GigabitEthernet0/1<br/>IP ARP: rcvd rep src 10.0.0.5 fa16.3e99.a0ac, dst 10.0.0.1 GigabitEthernet0/1<br/>IP ARP: rcvd rep src 10.0.1.5 fa16.3e9f.d087, dst 10.0.0.1 GigabitEthernet0/1</pre><p>The first three packets were gratuitous ARPs for router’s own IP addresses. The next two packets were ARP requests for entries already in the ARP cache (although I told the router to clear it) and they were <em>sent as unicasts to known MAC addresses</em>.</p>
<h4>Periodic ARP refreshes</h4><p>I also knew that <a href="/2007/06/ar.html">Cisco IOS refreshes ARP entries</a> instead of deleting them (<a href="/2007/05/what-is-cached-cef-adjacency.html">here’s why</a>), so I modified the ARP timeout on the Ethernet interface and waited…</p>
<pre class="code">interface GigabitEthernet0/1<br/> description to L2<br/> ip address 10.0.1.1 255.255.0.0 secondary<br/> ip address 10.0.0.1 255.255.0.0<br/> arp timeout 20</pre><p>Not surprisingly, this is what I got:</p>
<pre class="code">IP ARP: sent req src 10.0.0.1 fa16.3e63.f348,<br/>                 dst 10.0.1.5 fa16.3e9f.d087 GigabitEthernet0/1<br/>IP ARP: rcvd rep src 10.0.1.5 fa16.3e9f.d087, dst 10.0.0.1 GigabitEthernet0/1<br/>IP ARP: creating entry for IP address: 10.0.1.5, hw: fa16.3e9f.d087<br/>IP ARP: sent req src 10.0.0.1 fa16.3e63.f348,<br/>                 dst 10.0.0.5 fa16.3e99.a0ac GigabitEthernet0/1<br/>IP ARP: rcvd rep src 10.0.0.5 fa16.3e99.a0ac, dst 10.0.0.1 GigabitEthernet0/1<br/>IP ARP: creating entry for IP address: 10.0.0.5, hw: fa16.3e99.a0ac</pre><p><strong>Lesson learned:</strong> Cisco IOS uses unicast ARP to refresh expired ARP entries. </p>
<p>Interestingly, I <a href="/2007/06/ar.html">got the same result in 2007</a> but never realized what’s really going on. Sometimes it does pay to <a href="http://www.brainyquote.com/quotes/quotes/y/yogiberra125285.html">watch carefully</a> while getting your hands dirty ;)</p>

