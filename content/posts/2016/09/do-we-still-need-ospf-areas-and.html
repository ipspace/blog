---
title: "Do We Still Need OSPF Areas and Summarization?"
date: "2016-09-05T12:48:00.000+02:00"
tags: [ Design,OSPF,WAN ]
---

<p><a name="_GoBack"></a>One of my <a href="http://www.ipspace.net/ExpertExpress">ExpertExpress design discussions</a> focused on WAN network design and the need for OSPF areas and summarization (the customer had random addressing and the engineers wondered whether it makes sense to renumber the network to get better summarization).</p>
<p>I was struggling with the question of whether we still need OSPF areas and summarization in 2016 for a long time. Here are my thoughts on the topic; please share yours in the comments.<!--more--></p>
<h4>Do we need OSPF areas?</h4><p>When OSPF was created it used areas to minimize the size of the topology graph (and the time it took to run Dijkstra algorithm). In the meantime, the CPU speeds increased by orders of magnitude, and graph computation algorithms got a few optimization boosts (<em>incremental SPF </em>for example).</p>
<p class="note">IIRC we were told decades ago the computational complexity of Dijkstra algorithm is O(V^3) where V is number of vertices (routers). However, its <a href="http://stackoverflow.com/questions/26547816/understanding-time-complexity-calculation-for-dijkstra-algorithm">real computational complexity</a> (when implemented correctly) is O(E log V) where E is the total number of edges (links), or way less than what we were told.</p>
<p>There are obviously still limits to what CPUs can handle, but anecdata suggests having a few hundred routers in an OSPF area is no big deal (unless, of course, that includes nodes with $0.02 CPUs).</p>
<p>Based on this reasoning, one would say that:</p>
<ul class="ListParagraph"><li>It doesn&rsquo;t make sense to worry about OSPF areas if you have tens of routers;</li>
<li>You definitely have a problem if you have thousands of routers, and BGP is probably your friend;</li>
<li>In between there&rsquo;s an <em>It Depends </em>area.</li>
</ul>
<p>However, even if you feel you have to split your network into multiple areas to cut down the size of the topology graph, you might not need route summarization.</p>
<h4>Do we need inter-area route summarization?</h4><p>Let&rsquo;s be frank: route summarization is a royal pain. You need hierarchical addressing plan (which means you need an addressing plan in the first place), and even when you do it right things start moving around (or get connected to the wrong place) ruining your wonderful design.</p>
<p>Even worse than that are area splits. Announcing the same summarized prefix from two points that are not in a contiguous area is a perfect blackhole recipe (just ask anyone who advertised the same prefix from two data centers and lost the DCI link).</p>
<p class="note">To be more precise: the routers advertising a summarized prefix should be connected by a path going exclusively through the part of the network with more specific prefixes. GRE tunnel also satisfies that criteria; the proof is left as an exercise for the reader.</p>
<p>With the route summarization being such a pain one has to wonder why they introduced it in the first place. There were at least three good reasons for that decision:</p>
<ul class="ListParagraph"><li>Reducing the size of the routing tables;</li>
<li>Reducing the CPU load across areas;</li>
<li>Preventing a change within an area from impacting other areas.</li>
</ul>
<p>The first reason is mostly bogus in 2016 unless you have a huge network.</p>
<p>If you feel you might have a problem with the CPU load, you SHOULD change the vendor. Changes in inter-area LSAs should trigger partial SPF (the <a href="http://blog.ipspace.net/2008/02/when-ospf-becomes-distance-vector.html">distance vector part of OSPF</a>) which is relatively cheap compared to full SPF.</p>
<p>However, there&rsquo;s the <em>failure domain separation </em>aspect of route summarization.</p>
<h4>Areas and Route Summarization split network in isolated failure domains</h4><p>If you implement OSPF areas and route summarization correctly, you get excellent separation of failure domains:</p>
<ul class="ListParagraph"><li>Failures in the core network don&rsquo;t impact nodes in access network (particularly if you use totally stubby areas);</li>
<li>Failures in the access network don&rsquo;t impact core network (particularly if you include border router loopback IP address in the summarized prefix);</li>
</ul>
<p>Are the pains of using OSPF areas and getting the route summarization just right worth it? As always, it depends, and maybe we&rsquo;re yet again using the wrong tool to solve the problem. Here are a few alternatives:</p>
<ul class="ListParagraph"><li>Using BGP for customer routes and OSPF for core routes. I know this sounds like &ldquo;<em>BGP is the answer, what was the question?&rdquo;</em>, but this is the design used successfully in hundreds of large-scale networks, so maybe it isn&rsquo;t that bad.</li>
<li>Reducing the number of changes in the access network (where most of the flaky links are) using functionality like <a href="http://www.cisco.com/c/en/us/td/docs/ios/12_0s/feature/guide/s_ipevdp.html">IP event dampening</a> or network automation scripts (EEM is good enough) to kick flapping interfaces offline. </li>
</ul>
<p>However, using one of these alternatives requires:</p>
<ul class="ListParagraph"><li>An approximate understanding of the network behavior (= how often do you get link flaps and how bad could they be);</li>
<li>An estimate of the actual business requirements (= can I keep a remote site down for five minutes because the link is flapping) as opposed to &ldquo;<em>everything has to converge in 50 msec because voice</em>&rdquo;</li>
</ul>
<p>Meh, maybe it&rsquo;s easier to rely on magic properties of OSPF route summarization and blame protocol designs or vendor implementations when things go wrong than dealing with other people within your organization.</p>
<h4>More information</h4><p>Russ White wrote two articles on the same topic:</p>
<ul class="ListParagraph"><li><a href="http://ntwrk.guru/flooding-domains-1/">Routing protocol technical reasons</a> for implementing multiple flooding domains;</li>
<li><a href="http://ntwrk.guru/flooding-domains-2/">Other reasons</a> for splitting up your flooding domain.</li>
</ul>
<p>Also, listen to the <a href="http://packetpushers.net/podcast/podcasts/show-134-ospf-design-part-1-debunking-the-multiple-area-myth/">Packet Pushers Episode 134</a> with Ethan Banks, Derick Winkworth, Paul Gear and Darren O&rsquo;Connor.</p>

