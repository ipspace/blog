---
url: /2006/12/which-switching-path-does-ios-feature.html
title: "Which switching path does an IOS feature use"
date: "2006-12-15T19:05:00.000+01:00"
tags: [ CEF ]
---

<p>I've got an excellent question recently: <a href="https://blog.ipspace.net/2006/11/deploying-zone-based-firewalls.html">Which switching path is used in Zone-based firewalls when a packet is dropped</a>? As usual, IOS documentation was not very helpful (which is understandable as the answer might depend on hardware platform, interface encapsulation, other features configured on the router etc.). However, there is a great tool to use - the <strong>show interface stats</strong> command.<!--more--></p>
<p>The <strong>show interface stats</strong> command displays the number of packets switched per switching mechanism (unfortunately, <abbr title="Cisco Express Forwarding">CEF</abbr> is lumped together with <em>fast switching</em>). This command thus helps us to figure out if the packets are process switched. The <strong>show cef not-cef-switched</strong> command displays all packets punted from CEF to other switching mechanisms, so together they give us a pretty strong indication of what's going on.</p>
<p>To answer the question, I've configured a test lab router as follows:</p>
<pre class="code">class-map type inspect match-all ICMP<br/> match protocol icmp<br/>!<br/>!<br/>policy-map type inspect InToOut<br/> class type inspect ICMP<br/>  drop log<br/> class class-default<br/>  inspect<br/>!<br/>zone security inside<br/>zone security outside<br/>zone-pair security InToOut source inside destination outside<br/> service-policy type inspect InToOut<br/>!<br/>interface FastEthernet0/0<br/> ip address 10.0.0.1 255.255.255.0<br/> zone-member security inside<br/>!<br/>interface Serial0/0/0.100 point-to-point<br/> description Link to the Internet<br/> ip address 192.168.201.6 255.255.255.252<br/> zone-member security outside</pre><p class="note"><strong>Note:</strong> it's best to perform these tests in very "quiet" and controlled environment to ensure the statistics are not skewed by other traffic.</p>
<p>I've started a continuous ping on a LAN-attached workstation (as expected, all pings failed), cleared the interface counters on the router and took a snapshot of them a while later. The counter values clearly indicate that the dropped packets are not process-switched.</p>
<pre class="code">fw#<strong>clear counters</strong><br/>...<br/>*Dec 15 18:14:28: %FW-6-DROP_PKT: Dropping icmp pkt 10.0.0.2:8 =&gt; <br/>172.16.0.1:0 with ip ident 17758 due to DROP action found in policy-map<br/>...<br/>fw#<strong>show interface FastEthernet0/0 stats</strong><br/>FastEthernet0/0<br/>Switching path Pkts In Chars In Pkts Out Chars Out<br/>Processor 4 553 10 919<br/>Route cache 32 2368 0 0<br/>Total 36 2921 10 919<br/><br/>fw#<strong>show cef not-cef-switched</strong><br/>CEF Packets passed on to next switching layer<br/>Slot No_adj No_encap Unsupp'ted Redirect Receive Options Access Frag<br/>RP   0      0        0          0        0       0       0      0<br/></pre>

