---
url: /2006/12/per-port-cef-load-sharing.html
title: "Per-port CEF load sharing"
date: "2007-01-14T15:38:00.000+01:00"
tags: [ CEF,load balancing ]
---

In designs with very low number of IP hosts, no per-destination load-sharing algorithm will work adequately. Consider, for example, an extranet design where a large number of IP hosts are NAT-ed to a single IP address which then accesses a single remote server.<br/><p style="MARGIN: 0px; TEXT-ALIGN: center"><a href="http://photos1.blogger.com/x/blogger/7266/2287/1600/185033/LoadSharing_2.jpg" onblur="try {parent.deselectBloggerImageGracefully();} catch(e) {}"><img alt="" border="0" src="http://photos1.blogger.com/x/blogger/7266/2287/400/187598/LoadSharing_2.jpg" style="CURSOR: pointer"/></a></p>
<br/>In this design, all the traffic flows between a single pair of IP addresses, making per-destination load-sharing unusable.<br/><br/>Cisco has addressed this problem in IOS release 12.4(11)T with <em>per-port CEF load sharing</em>, which extends the <a href="https://blog.ipspace.net/2006/10/cef-load-sharing-details.html">CEF hashing function</a> to include source and/or destination TCP or UDP port.<!--more--><br/><br/>The global configuration command that enables per-port CEF load-sharing is <strong>ip cef load-sharing algorithm [ include-ports [source] [dest] ] <em>seed</em></strong>. To test it, use the <strong>show ip cef exact-route</strong> command, which now supports source and destination port numbers. For example:<pre class="code">a1(config)#<strong>ip cef load-sharing algorithm include-ports source dest 22</strong><br/><br/>a1#<strong>show ip cef exact-route 10.0.0.10 src-port 35 192.168.0.2 dest-port 80</strong><br/>10.0.0.10       -&gt; 192.168.0.2    : Serial0/0/0.100 (next hop 172.16.1.2)<br/>a1#<strong>show ip cef exact-route 10.0.0.10 src-port 36 192.168.0.2 dest-port 80</strong><br/>10.0.0.10       -&gt; 192.168.0.2    : Serial0/0/0.200 (next hop 172.16.1.6)<br/>a1#<strong>show ip cef exact-route 10.0.0.10 src-port 37 192.168.0.2 dest-port 80</strong><br/>10.0.0.10       -&gt; 192.168.0.2    : Serial0/0/0.100 (next hop 172.16.1.2)<br/></pre>

