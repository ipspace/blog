---
url: /2006/12/fine-tuning-cef-load-sharing.html
title: "Fine-tuning CEF load-sharing"
date: "2006-12-12T12:30:00.000+01:00"
tags: [ CEF,load balancing ]
---

In environments with a low number of IP hosts you have to fine-tune the CEF load-sharing algorithm to ensure that the traffic is spread between all parallel paths. A typical scenario is a primary-backup data center setup with pairs of replicating servers, as shown in the figure below.<br/><p style="margin: 0pt; text-align: center;"><a href="http://photos1.blogger.com/x/blogger/7266/2287/1600/938342/LoadSharing_1.jpg" onblur="try {parent.deselectBloggerImageGracefully();} catch(e) {}"><img alt="" border="0" src="http://photos1.blogger.com/x/blogger/7266/2287/400/159899/LoadSharing_1.jpg" style="cursor: pointer;"/></a></p>
<br/>In these cases, you have to try different values of <em>seed</em> parameter of the <a href="https://blog.ipspace.net/2006/10/cef-per-destination-load-sharing.html">CEF universal algorithm.</a><!--more--><br/>For example, if you have two equal-cost paths between networks 10.0.0.0/24 and 192.168.0.0/24 ...<pre class="code">a1#<strong>show ip cef 192.168.0.0 detail</strong><br/>192.168.0.0/24, version 33, epoch 0, per-destination sharing<br/>0 packets, 0 bytes<br/> via 172.16.1.6, Serial0/0/0.200, 0 dependencies<br/>   traffic share 1<br/>   next hop 172.16.1.6, Serial0/0/0.200<br/>   valid adjacency<br/> via 172.16.1.2, Serial0/0/0.100, 0 dependencies<br/>   traffic share 1<br/>   next hop 172.16.1.2, Serial0/0/0.100<br/>   valid adjacency<br/></pre>... you might want the traffic between 10.0.0.1 and 192.168.0.1 to flow over a different link than the traffic between 10.0.0.2 and 192.168.0.2. The command that will help you is the <strong>show ip cef exact-route <em>source destination</em></strong>. In our example, both traffic flows would go over the same serial link:<blockquote class="code">a1#show ip cef exact-route 10.0.0.1 192.168.0.1<br/>10.0.0.1        -&gt; 192.168.0.1    : Serial0/0/0.100 (next hop 172.16.1.2)<br/>a1#show ip cef exact-route 10.0.0.2 192.168.0.2<br/>10.0.0.2        -&gt; 192.168.0.2    : Serial0/0/0.100 (next hop 172.16.1.2)</blockquote>
However, by changing the <em>seed</em> parameter of the <strong>ip cef load-sharing algorithm universal</strong> command, you can influence the <a href="https://blog.ipspace.net/2006/10/cef-load-sharing-details.html">CEF hashing function</a>, eventually reaching a state where the traffic flows are spread between both WAN links:<blockquote class="code">a1(config)#<strong>ip cef load-sharing algorithm universal 1</strong><br/>a1(config)#<strong>^Z</strong><br/>a1#<strong>show ip cef exact-route 10.0.0.1 192.168.0.1</strong><br/>10.0.0.1        -&gt; 192.168.0.1    : Serial0/0/0.100 (next hop 172.16.1.2)<br/>a1#<strong>show ip cef exact-route 10.0.0.2 192.168.0.2</strong><br/>10.0.0.1        -&gt; 192.168.0.2    : Serial0/0/0.200 (next hop 172.16.1.6)<br/></blockquote>

