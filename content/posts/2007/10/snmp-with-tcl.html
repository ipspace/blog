---
url: /2007/10/snmp-with-tcl/
title: "SNMP with Tcl"
date: "2007-10-15T07:11:00.000+02:00"
tags: [ network management,Tcl ]
---

Looking from the outside, it looks like Tcl SNMP routines in Cisco IOS were <a href="http://en.wikipedia.org/wiki/Design_by_committee">designed by a commitee</a> or came <a href="http://www.dilbert.com/">straight from Dilbert</a>. The <a href="http://www.cisco.com/en/US/products/sw/iosswrel/ps5207/products_feature_guide09186a00801a75a7.html#wp1053659"><strong>snmp_getone</strong></a> function that reads a single SNMP value does not return an array or a list (as one would expect), but a string representation of something that looks like an XML object (but is not, since its attributes are not properly quoted). As Tcl on Cisco IOS has no built-in XML support, parsing the return values is a pure joy (and a nice exercise in writing regular expressions).<br/><br/>The following excerpt of a telnet session shows how to extract a single SNMP value in Tcl (I've used extra steps and an interactive tclsh session for illustration purposes). The SNMP community has to be configured in advance with the <strong>snmp-server community test ro</strong> configuration command.<pre class="code">rtr#<strong>tclsh</strong><br/>rtr(tcl)#<strong>set value [snmp_getone test system.3.0]</strong><br/>{&lt;obj oid='sysUpTime.0' val='14886'/&gt;}<br/>rtr(tcl)#<strong>regexp -inline {oid='(.*)'.*val='(.*)'} $value</strong><br/>{oid='sysUpTime.0' val='14886'} sysUpTime.0 14886<br/>rtr(tcl)#<strong>regexp {oid='(.*)'.*val='(.*)'} $value ignore oid result</strong><br/>1<br/>rtr(tcl)#<strong>puts $result</strong><br/>14886</pre>And now for a complete example: the following script prints the router uptime.<pre class="code">#<br/># Simple Tcl script to print system uptime<br/>#<br/>set value [snmp_getone test system.3.0]<br/>regexp {oid='(.*)'.*val='(.*)'} $value ignore oid result<br/>set result [expr $result / 100]<br/>puts "Router uptime is $result seconds"</pre>

