---
url: /2007/10/tale-of-three-mtus/
title: "The tale of the three MTUs"
date: "2007-10-17T18:14:00.002+02:00"
tags: [ MPLS,IP routing,MPLS VPN ]
---

<iframe border="0" frameborder="0" height="240" marginheight="0" marginwidth="0" scrolling="no" src="http://rcm-na.amazon-adsystem.com/e/cm?t=cisioshinandt-20&amp;o=1&amp;p=8&amp;l=st1&amp;mode=books&amp;search=Cisco%20MPLS&amp;fc1=000000&lt;1=&amp;lc1=3366FF&amp;bg1=FFFFFF&amp;f=ifr" style="border:none; float:right;" width="120"></iframe><p>An IOS device configured for IP+MPLS routing uses three different Maximum Transmission Unit (MTU) values:<ul><li>The hardware MTU configured with the <strong>mtu</strong> interface configuration command</li>
<li>The IP MTU configured with the <strong>ip mtu</strong> interface configuration command</li>
<li>The MPLS MTU configured with the <strong>mpls mtu</strong> interface configuration command</li>
</ul>
<p>The hardware MTU specifies the maximum packet length the interface can support â€¦ or at least that's the theory behind it. In reality, longer packets can be sent (assuming the hardware interface chipset doesn't complain); therefore you can configure MPLS MTU to be larger than the interface MTU and still have a working network. Oversized packets might not be received correctly if the interface uses fixed-length buffers; platforms with <a href="http://en.wikipedia.org/wiki/Vectored_I/O">scatter/gather architecture</a> (also called particle buffers) usually survive incoming oversized packets.</p>
<p>IP MTU is used to determine whether a non-labeled IP packet forwarded through an interface has to be fragmented (the IP MTU has no impact on labeled IP packets). It has to be lower or equal to hardware MTU (and this limitation is enforced). If it equals the HW MTU, its value does not appear in the running configuration and it tracks the changes in HW MTU. For example, if you configure <strong>ip mtu 1300</strong> on a Serial interface, it will appear in the running configuration as long as the hardware MTU is not equal to 1300 (and will not change as the HW MTU changes). However, as soon as the <strong>mtu 1300</strong> is configured, the <strong>ip mtu 1300</strong> command disappears from the configuration and the IP MTU yet again tracks the HW MTU.</p>
<p>The MPLS MTU determines the maximum size of a labeled IP packet (MPLS shim header + IP payload size). If the overall length of the labeled packet (including the shim header) is greater than the MPLS MTU, the packet is fragmented. The MPLS MTU can be greater than the HW MTU assuming the hardware architecture and interface chipset support that (and the router will warn you that you might be getting into trouble). Similar to the <strong>ip mtu</strong> command, the <strong>mpls mtu</strong> command will only appear in the running configuration if the MPLS MTU is different from the HW MTU. However, contrary to the behavior of the IP MTU, any change in HW MTU with the <strong>mtu</strong> configuration command also resets the MPLS MTU to HW MTU.</p>
<p class="note">The behavior as described above was tested on a 3725 router running IOS release 12.4(15)T1. Although the <a href="http://www.cisco.com/en/US/products/ps6566/products_feature_guide09186a0080629db0.html">MPLS MTU Command Changes</a> document claims that you cannot set MPLS MTU larger than then interface MTU from IOS release 12.4(11)T, I was still able to do it in 12.4(15)T1.</p>
</p>

