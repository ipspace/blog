---
url: /2007/12/execute-cli-commands-with-prompts-in.html
title: "Execute CLI commands with prompts in EEM"
date: "2007-12-04T06:59:00.001+01:00"
tags: [ EEM ]
---

In response to my <a href="/2007/11/can-i-combine-eem-applets-with-tcl.html">post about combining Tcl shell with EEM</a> to get around the “<em>no prompts</em>” limitation of EEM action cli command, Xavier proposed using the undocumented <strong>pattern</strong> option of the <strong>action cli</strong> command, which changes the string the EEM script is expecting to indicate that the current command has been executed.<br/><br/>By default, the EEM <strong>action cli</strong> command waits until it receives exec-level prompt from the VTY (Router&gt; or Router#), resulting in an endless wait and aborted EEM applet in IOS release 12.4(15)T (earlier releases would hang a VTY line forever) if a CLI command returns an additional prompt. With the <strong>pattern</strong> option, you can change the expected reply to whatever prompt the CLI command is outputting.<!--more-->For example, to clear interface counters, you could use the following EEM applet:<pre class="code">event manager applet test<br/> event none<br/> action 0.9 cli command "enable"<br/> action 1.0 cli command "clear counter loopback 0" pattern "confirm"<br/> action 1.1 cli command "y"<br/></pre>When it's executed with the <strong>event manager run test</strong> command and the event manager CLI debugging is enabled, you'll see the following printout:<pre class="code">%HA_EM-6-LOG: test : DEBUG(cli_lib) : : CTL : cli_open called.<br/>%HA_EM-6-LOG: test : DEBUG(cli_lib) : : OUT :<br/>%HA_EM-6-LOG: test : DEBUG(cli_lib) : : OUT : R1&gt;<br/>%HA_EM-6-LOG: test : DEBUG(cli_lib) : : IN  : R1&gt;enable<br/>%HA_EM-6-LOG: test : DEBUG(cli_lib) : : OUT :<br/>%HA_EM-6-LOG: test : DEBUG(cli_lib) : : OUT : R1#<br/>%HA_EM-6-LOG: test : DEBUG(cli_lib) : : IN  : R1#clear counter loopback 0<br/>%HA_EM-6-LOG: test : DEBUG(cli_lib) : : IN  : y<br/>%CLEAR-5-COUNTERS: Clear counter on interface Loopback0 by  on vty0 (EEM:test)<br/>%HA_EM-6-LOG: test : DEBUG(cli_lib) : : OUT : y<br/>%HA_EM-6-LOG: test : DEBUG(cli_lib) : : OUT : R1#<br/>%HA_EM-6-LOG: test : DEBUG(cli_lib) : : CTL : cli_close called.<br/></pre>

