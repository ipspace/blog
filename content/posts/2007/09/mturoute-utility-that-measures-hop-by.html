---
url: /2007/09/mturoute-utility-that-measures-hop-by/
title: "mturoute: A utility that measures hop-by-hop path MTU"
date: "2007-09-29T16:31:00.000+02:00"
tags: [ MPLS,IP routing,MPLS VPN,GRE ]
---

I wanted to get in-depth details on how various MTU parameters interact in GRE/IPSec/MPLS environment. Before going into router configuration details, I wanted to have a tool that would reliably measure actual path MTU between the endpoints. After a while, Google gave me a usable link: supposedly the <em>tracepath</em> program on Linux does what I needed. As I'm a purely Windows user (for me, PCs are just a tool), I needed a Windows equivalent … and found <a href="http://www.elifulkerson.com/projects/mturoute.php">mturoute</a>, the utility that does exactly what I was looking for.<!--more-->Unfortunately, the original <em>mturoute</em> had an interesting bug: ICMP unreachable generated due to DF bit on oversized packet was accepted as a successful ping. The second run of the program always reported the correct MTU size (as Windows caches the maximum MTU per destination host), but I wanted to be more precise. Half a day later, after installing Windows SDK and Visual Studio Express on my PC, rediscovering my C programming skills and reading a lot of Winsock documentation, I've managed to fix the bugs and even add a “retry on ping timeout” feature. You can <a href="http://www.zaplana.net/Articles/index.asp?binary=RouterConfigs/mturoute.zip">download the fixed version</a> (source + exe) from the <a href="http://www.zaplana.net/Articles/">Articles</a> area of my web site. It was compiled and tested on Windows XP, if you can test it on other platforms (2000, Vista), please let me know the results.<br/><br/>Here is a sample run of the program (the reduced path MTU is due to an MPLS-enabled GRE tunnel in the path):<pre class="code">$ mturoute -t 10.0.3.3<br/>mturoute to 10.0.3.3, 30 hops max, variable sized packets<br/>* ICMP Fragmentation is not permitted. *<br/>* Maximum payload is 10000 bytes. *<br/> 1  --+---+++-+++-++  host: 10.0.0.1  max: 1500 bytes<br/> 2  --+---++---+++  host: 10.2.0.2  max: 1476 bytes<br/> 3  --+---+-+++++++  host: 10.0.3.3  max: 1472 bytes</pre>

