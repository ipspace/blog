---
url: /2007/11/bgp-default-route.html
title: "BGP default route"
date: "2007-11-15T06:23:00.004+01:00"
tags: [ BGP ]
---

<p class="update">Update 2011-12-07: You might also want to read the <em><a href="https://blog.ipspace.net/2011/09/responsible-generation-of-bgp-default.html">Responsible generation of BGP default route</a></em> article describing the ISP side of the solution.<br/>Update 2008-08-10: IOS behavior has changed; fixed the article.</p>
<p>Martin Kluge sent me an interesting BGP question: he has two upstream links and runs BGP on both. Since his router is low on RAM, he cannot accept full routing, so he's just announcing his IP prefix and using static default routing toward upstream ISPs.</p>
<div style="separator"><a href="http://bp3.blogger.com/_K_pkZO5-tTg/Rzc7WxqDyfI/AAAAAAAAAtk/jBK4WqUvfE4/s1600-h/bgp_1.jpg"><img alt="" border="0" id="BLOGGER_PHOTO_ID_5131635562884876786" src="http://bp3.blogger.com/_K_pkZO5-tTg/Rzc7WxqDyfI/AAAAAAAAAtk/jBK4WqUvfE4/s400/bgp_1.jpg"/></a></div>
<p>The relevant configuration on the GW router is somewhat similar to the configuration I've used as a staring point in my lab:<!--more--></p>
<pre class="code">interface Serial1/0<br/> ip address 10.0.1.1 255.255.255.252<br/>!<br/>interface Serial1/1<br/> ip address 10.0.1.5 255.255.255.252<br/>!<br/>router bgp 65100<br/> neighbor 10.0.1.2 remote-as 65001<br/> neighbor 10.0.1.6 remote-as 65002<br/>!<br/>ip route 0.0.0.0 0.0.0.0 10.0.1.2<br/>ip route 0.0.0.0 0.0.0.0 10.0.1.6 250</pre><iframe border="0" frameborder="0" height="240" marginheight="0" marginwidth="0" scrolling="no" src="http://rcm-na.amazon-adsystem.com/e/cm?t=cisioshinandt-20&amp;o=1&amp;p=8&amp;l=st1&amp;mode=books&amp;search=Cisco%20Routing&amp;fc1=000000&lt;1=_blank&amp;lc1=3366FF&amp;bg1=FFFFFF&amp;f=ifr" style="border:none; float:right;" width="120"></iframe><p>I'm sure the long-time readers of my blog immediately figured out where the catch is: if the upstream router dies, but the interface stays up, the outbound traffic is blackholed. <a href="https://blog.ipspace.net/2007/02/reliable-static-routing.html">Reliable static routing</a> might be a solution, but his router is running an old IOS version. Obviously it's time for yet another rarely known BGP feature: the BGP default route.</p>
<p class="more">More information about the <a href="http://wiki.nil.com/BGP_default_route">BGP default route information</a> is available in the <a href="http://wiki.nil.com/">CT<sup>3</sup> wiki</a>.</p>
<p>If you've <a href="https://blog.ipspace.net/2007/06/inserting-default-route-into-ospf.html">mastered default routes in other routing protocols</a>, forget about what you know … BGP is different:</p>
<ul><li><del class="wrong">The default route is not announced to BGP neighbors, even if it's in the IP routing table <em>and</em> BGP table.</del> <ins class="corr">This was true in old IOS releases, 12.4 and 12.2SRC announce BGP default route like any other network.</ins></li>
<li>To announce a default route to a BGP neighbor, you can configure <strong>neighbor default-originate</strong>.</li>
<li>Once you've configured default route advertising <ins class="corr">with the <strong>neighbor default-originate</strong></ins>, it's announced to the neighbor even if the router doesn't have the default route itself.</li>
<li>The default route advertised to a BGP neighbor <ins class="corr">with the <strong>neighbor default-originate</strong></ins> does not pass through BGP output filters, so you cannot filter it.</li>
</ul>
<p>To solve Martin's problem, you'd have to reconfigure BGP on E1 and E2 as follows (the <strong>ip as-path</strong> access list just ensures nothing else is sent to the customer router; obviously you could use a <strong>route-map</strong> instead):</p>
<pre class="code">router bgp 65002<br/> neighbor 10.0.1.5 remote-as 65100<br/> neighbor 10.0.1.5 default-originate<br/> neighbor 10.0.1.5 filter-list 1 out<br/>!<br/>ip as-path access-list 1 deny .*</pre><p>Now that the default route is advertised via BGP, there is no need for a static default, and the default route will be removed (and replaced with the backup one) if the BGP neighbor disappears.</p>

