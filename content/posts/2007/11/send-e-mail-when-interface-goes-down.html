---
url: /2007/11/send-e-mail-when-interface-goes-down.html
title: "Send an e-mail when an interface goes down"
date: "2007-10-29T07:49:00.000+01:00"
tags: [ network management,EEM ]
---

<p>John S. Pumphrey recently asked an interesting question: “Can the router send an e-mail when an interface goes down?” The <a href="http://en.wikipedia.org/wiki/Enterprise_software#Criticisms">enterprisey</a> solution is obvious: deploy a high-end <acronym title="Element Management System">EMS</acronym> to collect <acronym title="Simple Network Management Protocol">SNMP</acronym> traps and use its <acronym title="Application Program Interface">API</acronym> to write a custom module that would use a <acronym title="Message Queue">MQ</acronym> interface to alert the operator. Fortunately, Event Manager applets in Cisco IOS provide <a href="http://www.cisco.com/univercd/cc/td/doc/product/software/ios124/124tcr/tnm_r/nmg_01ht.htm#wp1253694">action mail</a> command (available in 12.3(14)T and 12.4) that can send an e-mail to a <acronym title="Simple Mail Transfer Protocol">SMTP</acronym> server straight from the router.</p>
<p>There are two ways you can detect that an interface went down with EEM: either you track the interface status with a <strong>track</strong> object and start an EEM applet when the track object changes state or you catch the <em>syslog</em> messages reporting that the interface line protocol changed state to down. The second approach is obviously more generic, as a single applet can act on multiple interfaces.</p>
<pre class="code">event manager applet MailOnIfDown<br/> event syslog occurs 1 →<br/>    pattern "LINEPROTO-5-UPDOWN.*to down" →<br/>    period 1<br/></pre><div class="note" style="margin-bottom: 1em;"><p style="margin-top:0; margin-bottom:0"><span>Notes:</span></p>
<ul style="margin-top:0; margin-bottom:0;"><li>If you want to limit the applet to serial interfaces only, you could change the pattern to <strong>LINEPROTO-5-UPDOWN.*Serial.*to down</strong>.</li>
<li>The → continuation character is used to indicate that a single configuration line has been split to increase readability.</li>
</ul>
</div>
<p>The <strong>action mail</strong> command specifies the mail <strong>server</strong>'s address (use a hostname and DNS lookup or <strong>ip host</strong> configuration command to make the EEM applet more generic), <strong>from</strong> and <strong>to</strong> address, message <strong>subject</strong> and <strong>body</strong>. In each of these fields, you can use EEM environment variables that you can define with the <strong>event manager environment</strong> configuration command. Each EEM event also defines a few environment variables that you can use (see the <a href="http://www.cisco.com/univercd/cc/td/doc/product/software/ios124/124cg/hnm_c/ch05/heem21.htm#wp1047028">table of EEM system-defined variables on CCO</a>). For example, you can define the e-mail recipient in the router's configuration and use the <strong>_syslog_msg</strong> variable to include the <em>syslog</em> message in the e-mail body:</p>
<pre class="code">event manager environment _ifDown_rcpt admin@lab.com<br/>!<br/>event manager applet MailOnIfDown<br/> event syslog occurs 1 →<br/>    pattern "LINEPROTO-5-UPDOWN.*to down" →<br/>    period 1<br/> action 1.0 mail server "mail-gw" →<br/>    to "<span class="high">$_ifDown_rcpt</span>" from "R1@lab.com" →<br/>    subject "Interface down on R1" →<br/>    body "$_syslog_msg"</pre><p>You can make the applet even more generic with the help of <strong>action info type routername</strong> command, which stores the current router's name into the $_info_routername environment variable:<pre class="code">event manager environment _ifDown_rcpt admin@lab.com<br/>!<br/>event manager applet MailOnIfDown<br/> event syslog occurs 1 →<br/>    pattern "LINEPROTO-5-UPDOWN.*to down" →<br/>    period 1<br/> action 1.0 info type routername<br/> action 2.0 mail server "mail-gw" →<br/>    to "$_ifDown_rcpt</pre></p>
" from "<span class="high">$_info_routername</span>@lab.com" →<br/>    subject "Interface down on $_info_routername" →<br/>    body "$_syslog_msg"<p class="note"><span>Note: </span>This article is part of <a href="https://blog.ipspace.net/2007/01/youve-asked-for-it-series.html">You've asked for it</a> <a href="https://blog.ipspace.net/tag/youve-asked-for-it.html">series</a>.</p>

