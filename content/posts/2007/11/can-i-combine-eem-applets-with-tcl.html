---
url: /2007/11/can-i-combine-eem-applets-with-tcl.html
title: "Can I combine EEM applets with Tcl shell?"
date: "2007-11-26T07:27:00.002+01:00"
tags: [ Tcl,EEM ]
---

<p>When I've been <a href="https://blog.ipspace.net/2007/11/kron-poor-man-cron.html">describing the limitations of kron</a>, ??? quickly asked an interesting question: “as I cannot insert extra input keystrokes with <acronym title="Embedded Event Manager">EEM</acronym> applet, can I run a Tcl script from it with the <strong>action <em>sequence</em> cli command "tclsh <em>script</em>"</strong> command and use the <strong>typeahead</strong> function call to get around the limitation?” The only answer I could give at that time was “maybe” … and obviously it was time for a more thorough test. The short result is: YES, you can do it (at least in IOS release 12.4(15)T1).</p>
<!--more--><p>… and here is the long description of the test. I've started by creating a small Tcl script (see below) that clears the counters on <em>Loopback 0</em>. As the <strong>clear counters</strong> command requires keyboard input and generates a syslog message, it was a perfect test case.</p>
<pre class="code">typeahead "y"<br/>exec "clear counter loop 0"</pre><p>I've copied this script into the <em>flash:tcl/clearL0.tcl</em> and tested it:</p>
<pre class="code">R1#<strong>tclsh flash:tcl/clearL0.tcl</strong><br/>%CLEAR-5-COUNTERS: Clear counter on interface Loopback0 by console</pre><p>So far, so good. Next, I've created an EEM applet with no trigger …</p>
<pre class="code">event manager applet Clear<br/> event none<br/> action 1.0 cli command "enable"<br/> action 1.1 cli command "tclsh flash:tcl/clearL0.tcl"</pre><p>… enabled the EEM CLI debugging and started it:</p>
<pre class="code">R1#<strong>debug event man action cli</strong><br/>Debug EEM action cli debugging is on<br/>R1#<strong>event man run Clear</strong><br/>R1#<br/>%HA_EM-6-LOG: Clear : DEBUG(cli_lib) : : CTL : cli_open called.<br/>%HA_EM-6-LOG: Clear : DEBUG(cli_lib) : : OUT :<br/>%HA_EM-6-LOG: Clear : DEBUG(cli_lib) : : OUT : R1&gt;<br/>%HA_EM-6-LOG: Clear : DEBUG(cli_lib) : : IN  : R1&gt;enable<br/>%HA_EM-6-LOG: Clear : DEBUG(cli_lib) : : OUT :<br/>%HA_EM-6-LOG: Clear : DEBUG(cli_lib) : : OUT : R1#<br/>%HA_EM-6-LOG: Clear : DEBUG(cli_lib) : : IN  : R1#tclsh flash:tcl/clearL0.tcl<br/>%CLEAR-5-COUNTERS: Clear counter on interface Loopback0 by  on vty0 (EEM:Clear)<br/>%HA_EM-6-LOG: Clear : DEBUG(cli_lib) : : OUT :<br/>%HA_EM-6-LOG: Clear : DEBUG(cli_lib) : : OUT : R1#<br/>%HA_EM-6-LOG: Clear : DEBUG(cli_lib) : : CTL : cli_close called.</pre><p>Great. It works. Let's move on: I've inserted a trigger into the EEM applet that ran the applet when an OSPF neighbor reached <em>FULL</em> adjacency:</p>
<pre class="code">event manager applet Clear<br/> event syslog pattern "OSPF-5-ADJCHG.*to FULL"<br/> action 1.0 cli command "enable"<br/> action 1.1 cli command "tclsh flash:tcl/clearL0.tcl"</pre><p>And now for the final test: after I've enabled the serial interface, OSPF neighbors established adjacency …</p>
<pre class="code">R1(config-if)#<strong>interface ser 1/0</strong><br/>R1(config-if)#<strong>no shutdown</strong><br/>R1(config-if)#<br/>%LINK-3-UPDOWN: Interface Serial1/0, changed state to up<br/>%LINEPROTO-5-UPDOWN: Line protocol on Interface Serial1/0, changed state to up<br/>%OSPF-5-ADJCHG: Process 1, Nbr 10.0.1.2 on Serial1/0 from LOADING to FULL, Loading Done<br/>%CLEAR-5-COUNTERS: Clear counter on interface Loopback0 by  on vty0 (EEM:Clear)</pre><p>… and the counters on Loopback0 were cleared. Test completed :)</p>
<div class="more"><p>You can find more Tclsh-related information in the <a href="http://wiki.nil.com/Tclsh_on_Cisco_IOS_tutorial">Tclsh on Cisco IOS tutorial</a>. Sample Tclsh scripts are available in the <a href="http://wiki.nil.com/Tclsh_script_library">Tclsh script library</a>. If you need expert help in planning, developing or deploying Tclsh scripts in your network, <a href="https://www.ipspace.net/Contact">contact the author</a>.</p>
<p>This article is part of <a href="https://blog.ipspace.net/2007/01/youve-asked-for-it-series.html">You've asked for it</a> <a href="https://blog.ipspace.net/search/label/You%27ve%20asked%20for%20it">series</a>.</p>
</div>

