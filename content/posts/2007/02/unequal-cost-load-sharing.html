---
url: /2007/02/unequal-cost-load-sharing.html
title: "Unequal cost load-sharing"
date: "2007-02-08T13:47:00.000+01:00"
tags: [ CEF,You've asked for it,load balancing ]
---

One of the most commonly asked load-sharing-related questions is "can I load-share traffic across unequal-cost links". In general, the answer is no. In order to load-share the traffic, you need more than one path to the destination and the only way to get multiple routes toward a destination in the IP routing table is to make them equal-cost (the only notable exception being <a href="http://www.cisco.com/en/US/tech/tk365/technologies_tech_note09186a008009437d.shtml">EIGRP that supports unequal-cost load-sharing</a> with the <strong><a href="http://www.cisco.com/univercd/cc/td/doc/product/software/ios120/12cgcr/np1_r/1rprt1/1reigrp.htm#wp1018926">variance</a></strong> parameter).<br/><br/>There are, however, two cases where you can force unequal traffic split across equal-cost paths toward a destination: when using <a href="http://www.cisco.com/univercd/cc/td/doc/product/software/ios122/122newft/122t/122t2/ftbgplb.htm">inter-AS BGP with the link bandwidth parameter </a>and when using unequal-bandwidth traffic-engineering tunnels.<br/><br/><strong>Note:</strong> You can read more about load sharing with MPLS TE in my <a href="http://www.nil.com/ipcorner/">IP Corner</a> article <a href="http://www.nil.com/ipcorner/LoadSharingTE/">Perfect Load-Balancing: How Close Can You Get?</a><!--more-->Due to the way MPLS TE autoroute is implemented in Cisco IOS, all tunnels toward the same destination appear as equal-cost paths, even when their TE bandwidths are not the same. For example, using a simple TE configuration ...<pre class="code">interface Tunnel0<br/> ip unnumbered Loopback0<br/> tunnel destination 172.16.0.21<br/> tunnel mode mpls traffic-eng<br/> tunnel mpls traffic-eng autoroute announce<br/> tunnel mpls traffic-eng priority 7 7<br/> tunnel mpls traffic-eng bandwidth  300<br/> tunnel mpls traffic-eng path-option 1 explicit identifier 1<br/> no routing dynamic<br/>!<br/>interface Tunnel1<br/> ip unnumbered Loopback0<br/> tunnel destination 172.16.0.21<br/> tunnel mode mpls traffic-eng<br/> tunnel mpls traffic-eng autoroute announce<br/> tunnel mpls traffic-eng priority 7 7<br/> tunnel mpls traffic-eng bandwidth  500<br/> tunnel mpls traffic-eng path-option 1 explicit identifier 2<br/> no routing dynamic</pre>... you get two equal-cost paths in your IP routing table even though the <strong>tunnel mpls traffic-eng bandwidths</strong> are different:<pre class="code">a1#<strong>show ip route ospf</strong><br/>  172.16.0.0 255.255.0.0 is variably subnetted, 6 subnets, 2 masks<br/>O  172.16.0.21 255.255.255.255 [110/51] via 0.0.0.0, 00:11:06, Tunnel0<br/>                               [110/51] via 0.0.0.0, 00:11:06, Tunnel1<br/>O  172.16.0.22 255.255.255.255 [110/52] via 0.0.0.0, 00:11:06, Tunnel0<br/>                               [110/52] via 0.0.0.0, 00:11:06, Tunnel1</pre>When transferring the IP routing table into the CEF table, the router takes MPLS TE bandwidth in consideration, <a href="https://blog.ipspace.net/2006/10/cef-load-sharing-details.html">resulting in unequal traffic split</a> proportional to the MPLS TE bandwidth:<pre class="code">a1#<strong>show ip cef 172.16.0.21 internal</strong><br/>172.16.0.21/32, version 55, epoch 1, per-destination sharing<br/>0 packets, 0 bytes<br/>  tag information set<br/>    local tag: tunnel-head<br/>  via 0.0.0.0, Tunnel0, 0 dependencies<br/>    traffic share 3<br/>    next hop 0.0.0.0, Tunnel0<br/>    valid adjacency<br/>    tag rewrite with Tu0, point2point, tags imposed: {}<br/>  via 0.0.0.0, Tunnel1, 0 dependencies<br/>    traffic share 5<br/>    next hop 0.0.0.0, Tunnel1<br/>    valid adjacency<br/>    tag rewrite with Tu1, point2point, tags imposed: {}<br/><br/>  0 packets, 0 bytes switched through the prefix<br/>  tmstats: external 0 packets, 0 bytes<br/>           internal 0 packets, 0 bytes<br/><span class="high">  Load distribution: 0 1 0 1 0 1 0 1 0 1 0 1 1 1 1 1 (refcount 1)</span><br/><br/>  Hash  OK  Interface                 Address         Packets  Tags imposed<br/>  1     Y   Tunnel0                   point2point           0    {}<br/>  2     Y   Tunnel1                   point2point           0    {}<br/>  3     Y   Tunnel0                   point2point           0    {}<br/>  4     Y   Tunnel1                   point2point           0    {}<br/>  5     Y   Tunnel0                   point2point           0    {}<br/>  6     Y   Tunnel1                   point2point           0    {}<br/>  7     Y   Tunnel0                   point2point           0    {}<br/>  8     Y   Tunnel1                   point2point           0    {}<br/>  9     Y   Tunnel0                   point2point           0    {}<br/>  10    Y   Tunnel1                   point2point           0    {}<br/>  11    Y   Tunnel0                   point2point           0    {}<br/>  12    Y   Tunnel1                   point2point           0    {}<br/>  13    Y   Tunnel1                   point2point           0    {}<br/>  14    Y   Tunnel1                   point2point           0    {}<br/>  15    Y   Tunnel1                   point2point           0    {}<br/>  16    Y   Tunnel1                   point2point           0    {}</pre><strong>Note:</strong> this article is part of <a href="https://blog.ipspace.net/2007/01/youve-asked-for-it-series.html">You've asked for it</a> <a href="https://blog.ipspace.net/search/label/You%27ve%20asked%20for%20it">series</a>.

