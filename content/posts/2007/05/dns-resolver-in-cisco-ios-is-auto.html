---
url: /2007/05/dns-resolver-in-cisco-ios-is-auto/
title: "DNS resolver in Cisco IOS is auto-configured with parameters from a DHCP reply"
date: "2007-05-22T10:07:00.000+02:00"
tags: [ DHCP,DNS ]
---

If you're using DHCP to get IP interface addresses on your router (using the <strong>ip address dhcp</strong> interface configuration command), the router will also inherit the DNS resolver settings included in the DHCP reply. Makes sense, but the implementation is "a bit" unexpected: if you configure the DNS name servers manually with the <strong>ip name-server <em>address-list</em></strong> command, the ones matching the values in the DHCP reply packet are not included in the running configuration and thus not saved to NVRAM. Even worse, the statically-configured name-servers overwritten by a DHCP reply are lost if the DHCP-configured interface goes down.<br/><br/>To avoid total confusion, you thus have these options:<ul><li>Do not use DHCP to acquire IP interface addresses</li>
<li>Make sure the DHCP server does not send DNS-related parameters (a bit hard if you're using DHCP with your ISP)</li>
<li>Rely exclusively on DHCP to provide your router with the DNS name server addresses</li>
</ul>
<!--more-->Here is also an example of what can happen if you mix static configuration with DHCP. We'll start by configuring the name servers and verifying they are configured:<pre class="code">ro#<strong>conf t</strong><br/>Enter configuration commands, one per line.  End with CNTL/Z.<br/>ro(config)#<strong>ip name-server 192.168.2.1 192.168.2.2</strong><br/>ro(config)#<strong>^Z</strong><br/>ro#<strong>show run | include name-server</strong><br/>ip name-server 192.168.2.1 192.168.2.2</pre>Next, we'll configure DHCP client on an interface and watch the DHCP debugging to see what's actually going on (only parts of debugging printout are included):<pre class="code">ro(config)#<strong>interface FastEthernet 0/0</strong><br/>ro(config-if)#<strong>ip address dhcp</strong><br/>...<br/>DHCP: Received a BOOTREP pkt<br/>DHCP: Scan: Message type: DHCP Ack<br/>DHCP: Scan: Server ID Option: 192.168.2.1 = C0A80201<br/>DHCP: Scan: Lease Time: 86400<br/>DHCP: Scan: Renewal time: 43200<br/>DHCP: Scan: Rebind time: 75600<br/>DHCP: Scan: Host Name: ro.address.net<br/>DHCP: Scan: Subnet Address Option: 255.255.255.240<br/>DHCP: Scan: Router Option: 192.168.2.1<br/>DHCP: Scan: Domain Name: address.net<br/>DHCP: Scan: DNS Name Server Option: 192.168.2.2<br/>...<br/>DHCP: Applying DHCP options:<br/>  Setting default_gateway to 192.168.2.1<br/>  Adding default route 192.168.2.1<br/><span class="high">  Adding DNS server address 192.168.2.2<br/>  Setting default domain to address.net</span><br/>%DHCP-6-ADDRESS_ASSIGN: Interface FastEthernet0/0 assigned DHCP address 192.168.2.5, mask 255.255.255.240, hostname ro</pre>The name server received in the DHCP reply (192.168.2.2) is now missing from the running configuration:<pre class="code">ro#show run | include name-server<br/>ip name-server 192.168.2.1</pre>

