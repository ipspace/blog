---
title: "OSPF Challenge #2: Final results"
date: "2008-11-04T11:43:00.000+01:00"
tags: [ OSPF ]
---

<div class="bloggerBody"><p>I’ve received almost a dozen responses to the <a href="http://blog.ioshints.info/2008/10/ospf-challenge-2-mixing-numbered-and.html">second OSPF challenge</a>, most of them correct. The key to the solution is the way OSPF checks neighbor’s IP address on point-to-point links (<a href="http://blog.ioshints.info/2008/10/ospf-challenge-1-final-results.html">we already know that the subnet mask is ignored</a>):</p>
<ul class="Bullet1"><li>If the interface is unnumbered, the router ignores the source IP address in the OSPF hello packets.</li>
<li>If there’s an IP address configured on the interface, the router checks that the neighbor’s IP address (the source IP address in the OSPF hello packets) belongs to the same subnet. If the source IP address is not in the same subnet, the OSPF hello packet is ignored.</li>
</ul>
<p></p>
&lt;!--more--&gt;<p>R1 and R2 (<a href="http://blog.ioshints.info/2008/10/ospf-challenge-2-mixing-numbered-and.html">the router configuration can be found in the challenge</a>) would establish adjacency only if the source IP address of the packets sent by R1 would be in the same subnet as the IP address on R2. Since the serial interface on R1 is unnumbered, R1 would use the IP address of the loopback interface in the OSPF hello packets. IP address of the loopback interface on R1 thus has to be in the 10.1.2.0/29 subnet, giving you five choices (you cannot use the 10.1.2.0, 10.1.2.7 and 10.1.2.3).</p>
<p>However, as Yuri pointed out in his response, the routers do establish adjacency (so the challenge is solved) but do not build valid routing tables. The reason is the weird IP address used in the <em>Link Data </em>field of each unnumbered point-to-point link. According to RFC 2328, the router should <a href="http://tools.ietf.org/html/rfc2328">use the MIB-II ifIndex as the IP address of an unnumbered interface</a>. IOS performs subnet checks on SPF tree as well as on the OSPF hello packets and therefore R2 declares that R1 is not reachable. The following printout shows the R1’s router LSA as seen on R2:</p>
<pre class="code">R2#<strong>show ip ospf data router 10.1.2.4</strong><br/><br/>            OSPF Router with ID (10.1.2.3) (Process ID 1)<br/><br/>                Router Link States (Area 1)<br/><br/>  <span class="high">Adv Router is not-reachable</span><br/>  LS age: 758<br/>  Options: (No TOS-capability, DC)<br/>  LS Type: Router Links<br/>  Link State ID: 10.1.2.4<br/>  Advertising Router: 10.1.2.4<br/>  LS Seq Number: 80000016<br/>  Checksum: 0x296B<br/>  Length: 48<br/>  Number of Links: 2<br/><br/>    Link connected to: a Stub Network<br/>     (Link ID) Network/subnet number: 10.1.2.4<br/>     (Link Data) Network Mask: 255.255.255.255<br/>      Number of TOS metrics: 0<br/>       TOS 0 Metrics: 1<br/><br/>    Link connected to: another Router (point-to-point)<br/>     <span class="high">(Link ID) Neighboring Router ID: 10.1.2.3</span><br/>     <span class="high">(Link Data) Router Interface address: 0.0.0.6</span><br/>      Number of TOS metrics: 0<br/>       TOS 0 Metrics: 64</pre><p></p>
<p class="info">All readers that sent me a correct response received a small award from our Remote Labs team: free access to the <a href="http://www.nil.com/C1256F620032CACB/NILLookup/BS_IP_OSPFDefault_BS">OSPF default mysteries e-lesson</a> which includes a recorded presentation and three remote lab exercises.</p>
</div>

