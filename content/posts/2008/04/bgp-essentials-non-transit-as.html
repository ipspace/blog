---
url: /2008/04/bgp-essentials-non-transit-as.html
title: "BGP essentials: Non-transit AS"
date: "2008-04-08T07:34:00.001+02:00"
tags: [ BGP ]
---

<p>Sometimes I find the information on the Internet that is so far from the facts that it might actually hurt someone. For example, the <a href="http://ciscotips.wordpress.com/2007/10/24/preventing-as-from-becoming-transit-as/">configuration in this post supposedly prevents you from becoming a transit AS</a> (which is a really bad idea if you're a multi-homed end-user). Actually, it achieves the goal as it drops all incoming routes due to a malformed AS-path access-list that denies everything :) … but then, why do you need BGP in the first place?<!--more--></p>
<p>Fortunately, someone provided correct configuration in the comments to the post, just made in unnecessarily complex with the introduction of a <strong>route-map</strong>.</p>
<p>It really pays off to study all the available BGP filtering mechanisms: AS-path access-list can be applied to updates directly with the <strong>neighbor filter-list</strong> command. The minimum configuration that guarantees you won't become a transit AS is thus as follows:</p>
<pre class="code">router bgp 65000<br/> neighbor 10.1.1.1 filter-list 1 out<br/>!<br/>ip as-path access-list 1 permit ^$</pre><p>Of course you can make things really interesting by <a href="https://blog.ipspace.net/2008/02/bgp-essentials-bgp-communities.html">introducing BGP communities</a>: if you mark all routes received from the EBGP peers with the <a href="https://blog.ipspace.net/2008/01/redistributing-customer-routes-into-bgp.html">NO_EXPORT community</a>, they will be filtered out on other EBGP sessions automatically :) Here's a sample configuration:</p>
<pre class="code">router bgp 65001<br/> neighbor 10.0.1.2 route-map setNoExport in<br/> neighbor 10.0.1.3 route-map setNoExport in<br/><br/>!<br/>route-map setNoExport permit 10<br/> set community no-export additive</pre><p class="info">If you're looking for more in-depth BGP knowledge, try our <a href="http://www.nil.si/ls/BS_BGP32?showlp">Configuring BGP on Cisco Routers</a> <a href="http://www.nil.si/C1256F0A00429755/html/bs_portfolio">e-learning solution</a>. If you just need to enhance your hands-on skill, the <a href="http://www.nil.si/ls/LB_RL_BGP32?showlp">BGP Remote Lab Bundle</a> is the perfect choice.</p>

