---
url: /2008/12/most-convoluted-mib-ive-seen.html
title: "The most convoluted MIB Iâ€™ve seen"
date: "2008-12-10T10:12:00.002+01:00"
tags: [ network management,Tcl,QoS ]
---

<div class="bloggerBody"><p><a href="http://wiki.nil.com/"><img src="http://www.ioshints.info/images/Wiki.png" style="border: medium none; float: right; padding-bottom: 10px; padding-left: 10px;"/></a>Jared Valentine sent me a really interesting problem: he would like to <a href="http://www.xmission.com/~hidden/aatqos/">detect voice traffic and start shaping TCP traffic for the duration of the voice call</a>. The ideal solution would be an EEM applet reacting to the changes in the CISCO-CLASS-BASED-QOS-MIB; one of its tables contains the amount of traffic for each class configured in a service policy. </p>
<!--more--><p>The MIB navigation looks simple: you just read the values from the <tt>cbQosClassMapStats</tt> table, indexed by policy ID and class ID. The real problem is finding the correct index values. I could walk the MIB manually with a MIB browser or <strong>snmp_getnext </strong>TCL calls, but this approach is obviously not scalable, so I wrote a <a href="http://wiki.nil.com/Class-based_QoS_MIB_indexes">script that walks through the <tt>cbQosServicePolicy</tt>, <tt>cbQosObjects</tt>, <tt>cbQosPolicyMapCfg</tt> and <tt>cbQosClassMapCfg</tt> tables and prints the index values you need</a>.</p>
<div class="more">You can find more Tcl-related information in the <a href="http://wiki.nil.com/Tclsh_on_Cisco_IOS_tutorial">Tclsh on Cisco IOS tutorial</a>. Sample Tclsh scripts are available in the <a href="http://wiki.nil.com/Tclsh_script_library">Tclsh script library</a>. If you need expert help in planning, developing or deploying Tclsh scripts in your network, <a href="https://www.ipspace.net/Contact">contact the author</a>.</div>
</div>

