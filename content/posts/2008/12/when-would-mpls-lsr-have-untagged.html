---
date: 2008-12-01T06:40:00.002+01:00
tags:
- MPLS
- you've asked for it
title: When would an MPLS LSR have Untagged output label?
url: /2008/12/when-would-mpls-lsr-have-untagged.html
---

<div class="bloggerBody"><div style="float: right;"><script charset="utf-8" src="http://ws-na.amazon-adsystem.com/widgets/q?ServiceVersion=20070822&amp;MarketPlace=US&amp;ID=V20070822/US/cisioshinandt-20/8001/f945a008-15a5-42fc-b01d-88555c61afff" type="text/javascript"> </script> <noscript><a href="http://ws.amazon.com/widgets/q?ServiceVersion=20070822&amp;MarketPlace=US&amp;ID=V20070822%2FUS%2Fcisioshinandt-20%2F8001%2Ff945a008-15a5-42fc-b01d-88555c61afff&amp;Operation=NoScript">CCIP Reading list</a></noscript></div>
<p>This is a nice MPLS question I’ve received from one of the readers:</p>
<blockquote class="cite">I have understood the Penultimate Hop Popping (PHP) process, but I don’t understand when a router would use UNTAGGED instead of POP TAG?</blockquote>
<p>Instead of answering the question directly, let's walk through a series of simple Q&amp;A pairs that will help you understand the whole process (remember: <a href="http://blog.ipspace.net/2008/09/knowledge-or-recipes.html">knowledge, not recipes</a>!).</p>
<p class="info">It's highly recommended you read the first few chapters of the <em><a href="http://www.amazon.com/gp/product/1587050021?ie=UTF8&amp;tag=cisioshinandt-20&amp;linkCode=as2&amp;camp=1789&amp;creative=9325&amp;creativeASIN=1587050021">MPLS and VPN Architectures</a> </em>book before the rest of this post.</p>
<!--more--><p><strong>Where does the </strong><strong><em>Untagged </em></strong><strong>keyword appear?</strong> It only appears as the <em>output </em>label in the LFIB (Label Forwarding Information Base) that you can inspect with the <strong>show mpls forwarding-table</strong>.</p>
<p><strong>What does the </strong><strong><em>Untagged </em></strong><strong>keyword mean?</strong> This keyword means that the router has no output label associated with the <em>forwarding equivalence class </em>(FEC ... usually an IP prefix). Since there is no output label, the router cannot perform a label swap (or pop) but has to remove the whole MPLS shim header.</p>
<p><strong>Where would a router get the output label?</strong> It's received from the next-hop router.</p>
<p><strong>When would a router have no output label?</strong> When there is no next-hop router or when the next-hop router did not advertise a label for the IP prefix.</p>
<p><strong>When would there be no next-hop router?</strong> If the IP prefix is a directly connected subnet (including a loopback interface) or a summary route advertised by the router itself.</p>
<p><strong>When would the next-hop router not advertise a label?</strong> The reasons a next-hop router would not advertise a label for an IP prefix include:</p>
<ul class="Bullet1"><li>It's not running MPLS.</li>
<li>It's running MPLS but not CEF (MPLS labels are assigned to IP prefixes in CEF table).</li>
<li>It's not reachable across an MPLS-enabled interface (both routers could be running MPLS, but the transit interface does not have the <strong>mpls ip </strong>configuration).</li>
<li>The LDP session has not been established yet.</li>
<li>There is a mismatch in LDP protocol (one router is running Cisco's proprietary TDP, the other one standard LDP).</li>
<li>The next-hop router uses an access-list to filter the IP prefixes for which the MPLS labels are advertised.</li>
</ul>
<p><strong>Summary:</strong> you would see the <em>Untagged </em>label in the LFIB when the IP prefix is a directly connected interface, a summary route or the next-hop router has not advertised the label.</p>
</div>

