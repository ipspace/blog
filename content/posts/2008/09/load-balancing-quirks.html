---
url: /2008/09/load-balancing-quirks.html
title: "Load balancing quirks"
date: "2008-09-23T13:04:00.001+02:00"
tags: [ CEF,You've asked for it,load balancing ]
---

One of my readers has noted an interesting load-balancing behavior: when he was running <b>traceroute</b> tests from various routers in a topology similar to the one displayed below, the <b>traceroute</b> outputs indicated per-packet load balancing (both paths were used) when they were initiated from R2 or R3, but used a single path when initiated from R1 or R4.<br/><div class="separator" style="clear: both; text-align: center;"><a href="/2008/09/SimpleLoadSharing.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="/2008/09/SimpleLoadSharing.png"/></a>Â </div>
<div class="separator" style="clear: both; text-align: left;">The reason for this behavior is very simple: if you do <b>traceroute</b> from R1 to R4, R2 and R3 perform CEF switching, which usually does <a href="https://blog.ipspace.net/2006/10/cef-load-sharing-details.html">load balancing based on source-destination IP address pairs</a>, so all probe packets from R1 to R4 travel along the same path. If you start <b>traceroute </b>from R2 or R3, the packets are process-switched on the first hop (from R2 to R3, for example) and thus alternate between the parallel links.</div>
<p class="more">This article is part of <a href="https://blog.ipspace.net/2007/01/youve-asked-for-it-series.html">You've asked for it</a> <a href="https://blog.ipspace.net/tag/youve-asked-for-it.html">series</a>.</p>

