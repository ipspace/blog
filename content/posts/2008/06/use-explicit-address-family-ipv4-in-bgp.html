---
url: /2008/06/use-explicit-address-family-ipv4-in-bgp/
title: "Use the explicit \"address-family ipv4\" in BGP configurations"
date: "2008-06-05T07:10:00.000+02:00"
tags: [ BGP,MPLS VPN ]
---

If you use multiprotocol BGP (MP-BGP) in your network to support MPLS VPN, IPv6 or IP Multicast over BGP, it's best if you go all the way and configure an explicit ipv4 address family; the resulting BGP configuration is significantly easier to read and understand as the session-specific parameters are clearly separated from the routing-specific parameters and the IPv4 settings are nicely grouped in an explicit section.<br/><br/>To change the format of the BGP configuration, configure the IPv4 address family with the address-family ipv4 unicast router configuration command (the neighbor statements and other configuration settings pertinent to IPv4 configuration are automatically moved into the new address family) or manually activate a BGP neighbor for IPv4 route exchange with the neighbor activate router configuration command.<!--more-->To illustrate the differences between the traditional BGP configuration and the per-address-family configuration, consider a simple MPLS VPN+Internet setup. First the traditional approach:<pre class="code">router bgp 65000<br/> template peer-policy Internal<br/>  send-community both<br/> exit-peer-policy<br/> !<br/> template peer-session Internal<br/>  remote-as 65000<br/>  update-source Loopback0<br/> exit-peer-session<br/> !<br/> no synchronization<br/> bgp log-neighbor-changes<br/> network 10.0.1.1 mask 255.255.255.255<br/> neighbor 10.0.1.5 inherit peer-session Internal<br/> neighbor 10.0.1.5 description PE-C(RR)<br/> neighbor 10.0.1.5 inherit peer-policy Internal<br/> no auto-summary<br/> !<br/> address-family vpnv4<br/>  neighbor 10.0.1.5 activate<br/>  neighbor 10.0.1.5 send-community extended<br/> exit-address-family</pre>... and the changed configuration after the address-family ipv4 command has been entered:<pre class="code">router bgp 65000<br/> template peer-policy Internal<br/>  send-community both<br/> exit-peer-policy<br/> !<br/> template peer-policy InternalV6<br/>  send-label<br/>  inherit peer-policy Internal 1<br/> exit-peer-policy<br/> !<br/> template peer-session Internal<br/>  remote-as 65000<br/>  update-source Loopback0<br/> exit-peer-session<br/> !<br/> bgp log-neighbor-changes<br/> neighbor 10.0.1.5 inherit peer-session Internal<br/> neighbor 10.0.1.5 description PE-C(RR)<br/> !<br/> address-family ipv4<br/>  no synchronization<br/>  network 10.0.1.1 mask 255.255.255.255<br/>  neighbor 10.0.1.5 activate<br/>  neighbor 10.0.1.5 inherit peer-policy Internal<br/>  no auto-summary<br/> exit-address-family<br/> !<br/> address-family vpnv4<br/>  neighbor 10.0.1.5 activate<br/>  neighbor 10.0.1.5 send-community extended<br/> exit-address-family</pre>

