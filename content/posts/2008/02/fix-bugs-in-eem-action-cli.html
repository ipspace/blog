---
url: /2008/02/fix-bugs-in-eem-action-cli.html
title: "Fix bugs in EEM action cli implementation"
date: "2008-02-11T07:19:00.000+01:00"
tags: [ configuration,EEM ]
---

Every now and then, EEM applets fail to recognize a new configuration prompt generated by the router and abort due to timeout (or hang-up forever if you're using IOS release prior to 12.4(15)T). You can use the new <a href="https://blog.ipspace.net/2007/12/execute-cli-commands-with-prompts-in.html">pattern keyword</a> of the action cli configuration command to fix the bug.<!--more--><p>For example, the DNS view configuration is not recognized by the EEM code, so the following applet fails to complete:</p>
<pre class="code">event manager applet Test<br/> event none<br/> action 1.0 cli command "enable"<br/> action 1.1 cli command "configure terminal"<br/> action 1.2 cli command "ip dns view default"<br/> action 1.3 cli command "dns forwarder 10.0.0.2"<br/></pre><p>… as you can test quite easiliy with the EEM CLI debugging (note the highlighted times that indicate the EEM applet timeout) …</p>
<pre class="code">Rtr#<strong>event man run Test</strong><br/>:13.343: %HA_EM-6-LOG: Test : DEBUG(cli_lib) : : CTL : cli_open called.<br/>:13.451: %HA_EM-6-LOG: Test : DEBUG(cli_lib) : : OUT :<br/>:13.455: %HA_EM-6-LOG: Test : DEBUG(cli_lib) : : OUT : GW-B&gt;<br/>:13.459: %HA_EM-6-LOG: Test : DEBUG(cli_lib) : : IN  : GW-B&gt;enable<br/>:13.499: %HA_EM-6-LOG: Test : DEBUG(cli_lib) : : OUT :<br/>:13.499: %HA_EM-6-LOG: Test : DEBUG(cli_lib) : : OUT : GW-B#<br/>:13.499: %HA_EM-6-LOG: Test : DEBUG(cli_lib) : : IN  : GW-B#configure terminal<br/>:13.519: %HA_EM-6-LOG: Test : DEBUG(cli_lib) : : OUT :<br/>:13.519: %HA_EM-6-LOG: Test : DEBUG(cli_lib) : : OUT : Enter configuration commands, one per line.  End with CNTL/Z.<br/>:13.523: %HA_EM-6-LOG: Test : DEBUG(cli_lib) : : OUT : GW-B(config)#<br/><span class="high">:13.523:</span> %HA_EM-6-LOG: Test : DEBUG(cli_lib) : : IN  : GW-B(config)#ip dns view default<br/><span class="high">:33.395:</span> %HA_EM-6-LOG: Test : DEBUG(cli_lib) : : OUT :<br/>:33.399: %HA_EM-6-LOG: Test : DEBUG(cli_lib) : : OUT : GW-B(cfg-dns-view)#<br/>:33.403: %HA_EM-6-LOG: Test : DEBUG(cli_lib) : : CTL : cli_close called.<br/></pre><p>To fix this bug, use the <strong>pattern "#"</strong> option of the <strong>action cli</strong> command to tell the EEM applet what prompt to expect:<pre class="code">event manager applet Test<br/> event none<br/> action 1.0 cli command "enable"<br/> action 1.1 cli command "configure terminal"<br/> action 1.2 cli command "ip dns view default" pattern "#"<br/> action 1.3 cli command "dns forwarder 10.0.0.2" pattern "#"</pre></p>

