---
url: /2008/03/sntp-will-not-work-if-you-configured/
title: "SNTP will not work if you've configured NTP"
date: "2008-03-18T07:07:00.002+01:00"
tags: [ NTP ]
---

If you're running NTP and SNTP on the same router, SNTP will never synchronize with a configured SNTP server, as the NTP process captures the reply packet before SNTP has the chance to react.<p class="note">SNTP multicast/broadcast client mode works in combination with NTP</p>
<p>NTP process could be running even if your running configuration has no NTP-related commands. It starts automatically whenever you enter NTP-related configuration (<strong>ntp logging</strong> configuration command is enough) and is not stopped when the last NTP-related configuration command is removed. You have to reload the router to kill it.</p>
<!--more-->On my test router, I've switched from NTP to SNTP by removing all NTP configuration and configuring SNTP server:<pre class="code">b2#<strong>show run | inc ntp</strong><br/>sntp logging<br/>sntp server 192.168.0.5</pre>However, SNTP would not synchronize as the NTP process was still running (check with the <strong>show processes | inc NTP</strong> command):<pre class="code">b2#<strong>show process | inc NTP</strong><br/> 259 Mwe 41E568BC   8  3233    2 3624/6000   0 NTP<br/> 260 Mwe 4228BA9C   8    86   93 3660/6000   0 SNTP</pre>NTP process was obviously receiving the NTP reply packets, as the <strong>debug sntp packet</strong> command did not display the return packets, even though the <strong>debug ntp packet <em>peer</em></strong> command on the NTP server (192.168.0.5) displayed received and transmitted packets:<pre class="code">Sending SNTP packet to 192.168.0.5<br/> xmt CB66B3C0.8EC48A8E (14:12:16.557 UTC Wed Feb 20 2008)</pre>After the reload, SNTP started working immediately and generated a syslog message indicating the time has been adjusted:<blockquote class="code">00:00:45: %SYS-6-CLOCKUPDATE: System clock has been updated from 15:00:59 UTC Wed Feb 20 2008 to 14:15:10 UTC Wed Feb 20 2008, configured from SNTP by 192.168.0.5.</blockquote>
The debugging printout also confirmed that the NTP reply packets were received by SNTP.<pre class="code">Sending SNTP packet to 192.168.0.5<br/> xmt CB66B4B8.D94D8B90 (14:16:24.848 UTC Wed Feb 20 2008)<br/>Received SNTP packet from 192.168.0.5, length 48<br/> leap 0, mode 4, version 1, stratum 8, ppoll 16<br/><br/> rtdel 00000C87, rtdsp 0000E5F1, refid 0A000005 (10.0.0.5)<br/> ref CB66B33F.2E02462D (14:10:07.179 UTC Wed Feb 20 2008)<br/> org CB66B4B8.D94D8B90 (14:16:24.848 UTC Wed Feb 20 2008)<br/> rec CB66B4B9.4C2B68CA (14:16:25.297 UTC Wed Feb 20 2008)<br/> xmt CB66B4B9.4C6FF670 (14:16:25.298 UTC Wed Feb 20 2008)<br/> inp CB66B4B8.DA2137A9 (14:16:24.852 UTC Wed Feb 20 2008)</pre>

