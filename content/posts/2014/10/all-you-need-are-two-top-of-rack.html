---
date: 2014-10-22T08:16:00.000+02:00
tags:
- design
- data center
- cloud
title: All You Need Are Two Top-of-Rack Switches
url: /2014/10/all-you-need-are-two-top-of-rack.html
---

<p>Every time I’m running a classroom version of my <a href="http://www.ipspace.net/Designing_Private_Cloud_Infrastructure"><em>Designing the Cloud Infrastructure</em></a> workshop, I start with a simple question: “<em>Who has more than 2000 VMs or bare-metal servers in the data center?</em>”</p>
<p>I might see three hands on a good day; 90-95% of the audience have smaller data centers… and some of them get disappointed when I tell them they don’t need more than two ToR switches in their data center.<!--more--></p>
<p class="info">I wrote an <a href="https://blog.ipspace.net/2013/09/how-much-data-center-bandwidth-do-you.html">almost identical blog post a year ago</a>, and I’m still getting the same questions, so here it is again.</p>
<p>Let’s do some math. It’s easy to pack 50-100 VMs in a single 1RU server these days (more details in the <a href="http://www.ipspace.net/Designing_a_Private_Cloud_Network_Infrastructure">Designing a Private Cloud Infrastructure case study</a> and <a href="http://www.ipspace.net/Data_Center_Design_Case_Studies">Data Center Design book</a>) – 2000 VMs can easily fit onto 40 servers, for a total of 80 x 10GE ports (two 10GE ports per hypervisor host are still enough for most workloads).</p>
<p>Most 1RU ToR switches have 64 10GE ports (sometimes available in 40GE format; see my <a href="http://www.ipspace.net/Data_Center_Fabrics">Data Center Fabrics webinar</a> for details), and two of them provide all the ports you need to connect 40 servers, associated storage (or none if you’re already in the <a href="https://blog.ipspace.net/2014/08/vmware-evorail-one-stop-shopping-for.html">distributed local storage world</a>), network appliances or <a href="http://blog.ipspace.net/2013/07/cloud-as-appliance-design.html">network services cluster</a>, and <a href="http://blog.ipspace.net/2014/09/connecting-virtual-routers-to-outside.html">WAN edge routers</a> or your layer-3 backbone.</p>
<p>For a totally different perspective let’s focus on bandwidth requirements. In the good old days most traffic left data center; these days in some rare cases up to 90% of the traffic stays within the data center. </p>
<p>Let’s assume our data center has two 10GE uplinks, and 90% of the traffic stays within the data center. The total amount of traffic generated in the data center is thus 200 Gbps. Let’s add another 200 Gbps for storage traffic, and multiple the sum by two to cater to the whims of marketing math – 800 Gbps is more than enough bandwidth. </p>
<p>Most 1RU switches provide 1.28 Tbps of non-blocking marketing bandwidth these days, and we need at least two of them for redundancy. Yet again, we don’t need more than two switches.</p>
<p>Your requirements might be totally different. You may run a Hadoop cluster, in which case this calculation makes no sense, or you might be a large service provider planning to deploy a million VMs, in which case you shouldn’t base your designs on napkin calculations and blog posts, but build in-house knowledge or get a network architect to help you (you do know <a href="http://www.ipspace.net/Consulting">I’m available for short engagements</a>, don’t you?).</p>
<p>Finally, you might be in that awkward spot where you need 70 or 80 10GE ports per switch. Buying two 2RU switches (with 96 to 128 10GE ports each) is probably easier than building a leaf-and-spine fabric.</p>

