---
date: 2014-12-17T08:35:00.000+01:00
tags:
- switching
- data center
- IP routing
title: VRF Lite on Nexus 5600
url: /2014/12/vrf-lite-on-nexus-5600.html
---

<p>One of the networking engineers using my <a href="http://www.ipspace.net/ExpertExpress">ExpertExpress</a> to validate their network design had an interesting problem: he was building a multi-tenant VLAN-based private cloud architecture with each tenant having multiple subnets, and wanted to route within the tenant network as close to the VMs as possible (in the ToR switch).</p>
<p>He was using Nexus 5600 as the ToR switch, and although there’s conflicting information on the number of VRFs supported by that switch (<a href="http://www.cisco.com/c/en/us/td/docs/switches/datacenter/nexus5600/sw/verified_scalability/701N11/b_N5600_Verified_Scalability_701N11/b_N6000_Verified_Scalability_700N11_chapter_01.html">verified topology</a>:  25 VRFs, <a href="http://www.cisco.com/c/en/us/td/docs/switches/datacenter/nexus5600/sw/verified_scalability/701N11/b_N5600_Verified_Scalability_701N11/b_N6000_Verified_Scalability_700N11_chapter_01.html#reference_0D30847FCBBC4541A8B099D752F47FCE">verified maximum</a>: 1000 VRFs, <a href="http://www.cisco.com/c/en/us/td/docs/switches/datacenter/nexus5600/sw/unicast/7x/unicast_n5600_config/l3_virtual.html#pgfId-1070879">configuration guide</a>: 64 VRFs), he thought 25 VRFs (tenant routing domains) might be enough.<!--more--></p>
<p class="warn">Another limiting factor is the number of prefixes that you can install in the TCAM, which is shared by all VRFs. The total number of all routes in all VRFs cannot exceed the TCAM size (24000 IPv4 routes or 6000 IPv6 routes on Nexus 5600).  </p>
<p class="update">2014-12-19: Rewrote the following paragraph - it seems Nexus OS supports multiple VRFs in the same OSPF instance.</p>
<p>The real roadblock turned out to be the routing protocol support. Nexus 5600 supports up to four OSPF or OSPFv3 instances, which is obviously useless if you want to run an instance per VRF. You can use the same OSPF instance for multiple VRFs, but are still limited by the number of neighbors. With fast OSPF hello timers Nexus 5600 supports up to 16 neighbors (no other information is available in the Verified Scalability guide), which is quite small as you have to run whichever routing protocol you choose in VRF-Lite mode on every virtual uplink (VLAN subinterface) of every VRF. EIGRP is no better: it supports multiple address families (VRFs) per routing process, but cannot have more than <a href="http://www.cisco.com/c/en/us/td/docs/switches/datacenter/nexus5600/sw/verified_scalability/701N11/b_N5600_Verified_Scalability_701N11/b_N6000_Verified_Scalability_700N11_chapter_01.html#reference_A0E1B7CA184E478188BF5939574418F7">50 active EIGRP interfaces</a>.</p>
<p>It seems BGP is yet again the right answer. You can route multiple address families (VRFs) in a single BGP process, and configure per-VRF neighbors to peer with spine switches. The <a href="http://www.cisco.com/c/en/us/td/docs/switches/datacenter/nexus5600/sw/verified_scalability/701N11/b_N5600_Verified_Scalability_701N11/b_N6000_Verified_Scalability_700N11_chapter_01.html#reference_A0E1B7CA184E478188BF5939574418F7">maximum number of active BGP peers supported on a Nexus 5600 with Nexus OS 7.0 is 256</a>, which gives you four peers per VRF (for four spine switches) with 64 VRFs. </p>
<p class="info">Not surprisingly, BGP is the routing protocol used to propagate customer reachability information in Cisco’s DFA.</p>
<h4>More information</h4><p>Need to know the limitations of individual data center switches? Check out the <a href="http://www.ipspace.net/Data_Center_Fabrics">Data Center Fabrics</a> webinar. Building a leaf-and-spine fabric? You’ll find the design guidelines in the <a href="http://www.ipspace.net/Leaf-and-Spine_Fabric_Architectures">Leaf-and-Spine Fabric Architectures</a> webinar. Looking for a design review? Go for <a href="http://www.ipspace.net/ExpertExpress">ExpertExpress</a>.</p>

