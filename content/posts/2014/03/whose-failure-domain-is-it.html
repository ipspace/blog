---
url: /2014/03/whose-failure-domain-is-it.html
title: "Whose Failure Domain Is It?"
date: "2014-03-05T07:13:00.000+01:00"
tags: [ bridging, Internet, high availability ]
---

<p><em>Draco</em> made a <a href="http://blog.ipspace.net/2014/02/keep-your-failure-domains-small.html?showComment=1392697415285#c8785876830767953728">valid comment</a> to my <a href="http://blog.ipspace.net/2014/02/keep-your-failure-domains-small.html?showComment=1392697415285"><em>Keep Your Failure Domain Small</em></a> post:</p>
<blockquote class="cite">What could a small ISP do to limit failure domains? Metro Ethernet and MPLS Virtual Private LAN service are all the rage, and offers customers the promise of being able to connect all their branch offices together, and use the same set of VLANs with free Layer 2 connectivity between their sites. It's either: extend the failure domains, or lose out in selling the service, b/c the customer will buy from another ISP.</blockquote>
<p>Well, <a href="http://blog.ipspace.net/2012/07/the-difference-between-metro-ethernet.html">your customer’s failure domain doesn’t have to be yours</a>.<!--more--></p>
<h4>Protect yourself</h4><p>The first thing you should do as an ISP is to limit the amount of damage a customer could do to your edge (PE) routers: </p>
<ul class="ListParagraph"><li>Rate-limit the BUM frames entering your network (Cisco’s <em>storm control </em>is such a mechanism, although a pretty rudimentary one);</li>
<li>Configure BPDU guard (if appropriate), or root guard on customer-facing links;</li>
<li>Protect the PE router control plane.</li>
</ul>
<p class="more">Years ago, I met an ISP running RIPv1 with their customers (no, they were not offering MPLS/VPN services). Go figure ;)</p>
<h4>Decouple customer networks from your core</h4><p>If you implement a Metro Ethernet service with an end-to-end bridged network using 802.1Q or 802.1ad (QinQ) encapsulation, don’t act surprised when it collapses due to a <a href="http://blog.ipspace.net/2009/02/connecting-switch-to-itself-does-it.html">L2 forwarding loop</a>, or when you get uncontrollable amount of unicast flooding due to TCAM overflows – you’ve tightly coupled the fate of your core network to the (mis)behavior of your customers.</p>
<p>802.1ah (PBB) is slightly better – at the very least the core switches don’t see the customer MAC addresses any longer.</p>
<p>Pseudowires (EoMPLS or L2TPv3), VPLS or PBB-EVPN are the best solution – they totally decouple the <a href="http://blog.ipspace.net/2010/07/bridging-and-routing-is-there.html">layer-2 forwarding behavior</a> of your services from stable layer-3 forwarding behavior of your IP+MPLS core. A problem within a customer’s network can no longer trash the ISP core (assuming the customer cannot generate enough traffic to overload the core links).</p>
<h4>And now for a truly crazy idea</h4><p>Hate MPLS and VPLS? Use VXLAN. Arista’s switches aren’t the best (or cheapest) ISP edge devices out there, but they do have wirespeed VXLAN VTEP, allowing you to build high-speed L2-over-L3 overlay networks.</p>

