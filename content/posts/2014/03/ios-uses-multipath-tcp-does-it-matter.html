---
date: 2014-03-03T07:06:00.000+01:00
tags:
- what went wrong
- Internet
- load balancing
title: iOS uses Multipath TCP – Does It Matter?
url: /2014/03/ios-uses-multipath-tcp-does-it-matter.html
---

<p>When Apple launched the new release of iOS last autumn, networking gurus realized <a href="http://appleinsider.com/articles/13/09/20/apple-found-to-be-using-advanced-multipath-tcp-networking-in-ios-7">the new iOS uses MP-TCP</a>, a recent development that allows a single TCP socket (as presented to the higher layers of the application stack) to use multiple parallel TCP sessions. Does that mean we’re <a href="http://blog.ipspace.net/2010/07/tcpip-is-like-mainframe-you-cant-change.html">getting closer to fixing the TCP/IP stack</a>?</p>
<p>TL&amp;DR summary: Unfortunately not.<!--more--></p>
<h4>Why Is MP-TCP Interesting?</h4><p><strong>Use case #1 – mobile networks</strong>: Mobile devices are often connected to WiFi and mobile (3G/4G) networks concurrently, but cannot use both connections simultaneously for the same data transfer – a TCP session is limited to a single set of IP endpoints, and since you cannot share an IP address between 3G and WiFi interface, a single TCP session cannot use both links (at least not in the inbound direction).</p>
<p><strong>Use case #2 – data centers</strong>: Modern data center fabrics are commonly using highly parallel Clos fabric architecture. There might be tens of alternate paths between any two servers … and yet the servers cannot use more than one of them for a single TCP session due to 5-tuple load balancing restrictions (<a href="http://blog.ipspace.net/2011/04/brocade-vcs-fabric-has-almost-perfect.html">Brocade fares a bit better</a>).</p>
<h4>How Does MP-TCP Solve These Problems?</h4><p><a href="http://tools.ietf.org/html/rfc6824">MP-TCP</a> introduces a shim layer between the TCP’s application-facing API (<a href="http://blog.ipspace.net/2009/08/what-went-wrong-socket-api.html">socket API in most cases</a>) and the traditional TCP stack. The shim layer establishes multiple traditional TCP sessions between the client’s and server’s IP endpoints, and multiplexes data of a single application session across them. </p>
<p>Multiple TCP sessions below the MP-TCP shim layer allow a mobile device to use all its interfaces to transfer data of a single application session (this is why Apple implemented it). <a href="http://multipath-tcp.org/pmwiki.php?n=Main.50Gbps">Servers can use multiple TCP sessions to get more bandwidth</a> or access to less loaded alternate paths – new TCP sessions using different source and destination TCP port numbers might be placed on a different set of ECMP paths.</p>
<h4>Will MP-TCP Fix the TCP Stack?</h4><p>No. A typical application still has to use <a href="http://linux.die.net/man/3/getaddrinfo"><em>getaddrinfo</em></a><em> </em>calls to get a list of IP addresses for a given host name, and try to connect to one of them (sequentially or <a href="http://blog.ipspace.net/2013/03/happy-eyeballs-happiness-defined-by.html">somewhat more intelligently</a>). A server (or service) must thus still be <a href="http://blog.ipspace.net/2009/08/what-went-wrong-tcpip-lacks-session.html">exposed as a single IP address</a>; MP-TCP will not remove the need for Application Delivery Controllers (known as load balancers outside of marketing departments) or traditional multi-homing.</p>

