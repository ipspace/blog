---
url: /2014/03/stp-in-brocade-vcs-fabric-interesting.html
title: "STP in Brocade VCS Fabric – an Interesting Solution after a Long Wait"
date: "2014-03-31T14:56:00.000+02:00"
tags: [ bridging,Data Center,Fabric ]
---

<p>A few years ago I <a href="http://blog.ipspace.net/2011/05/ignoring-stp-be-careful-be-very-careful.html">lambasted the lack of STP support in Brocade’s VCS fabric</a>. It took Brocade <a href="http://blog.ipspace.net/2011/05/ignoring-stp-be-careful-be-very-careful.html?showComment=1375253965978#c3573674327448809382">over two years</a> to solve the problem, but they finally came up with an interesting end-to-end solution.</p>
<p>Here are a few highlights; for more details read the <a href="http://www.brocade.com/downloads/documents/html_product_manuals/NOS_410_AG/GUID-BC4C6C94-3227-4CE1-A421-D2F44485F752.html"><em>Configuring STP-type Protocols</em></a> section in <a href="http://www.brocade.com/downloads/documents/html_product_manuals/NOS_410_AG/index.html">Network OS Administrator Guide</a>.<!--more--></p>
<p><strong>Supported protocols</strong>. Network OS 4.0 and above supports standard STP, RSTP and MSTP, as well as Cisco’s PVST and PVRST in <em>both standalone and fabric mode</em>. </p>
<p><strong>Single STP instance</strong>. A fabric of VDX switches behaves as a single STP instance, representing the fabric as a single humongous switch to its STP peers. As far as I know, this is the only fabric solution where numerous switches with independent control and management planes act as a single STP instance (Cisco’s vPC is also a single STP instance, but limited to two switches).</p>
<p><strong>No root bridge enforcement</strong>. I’ve seen solutions that require the fabric (or MLAG pair) becoming a root bridge. Other solutions <a href="http://blog.ipspace.net/2011/03/trillfabric-path-stp-integration.html">split a bridging domain into small STP domains around a fabric core</a>. VCS fabric has no such limitation – the fabric participates in the regular operation of xSTP and blocks its edge ports as needed.</p>
<p><strong>Internal state synchronization</strong>. RBridges (VDX switches) exchange STP information, probably using proprietary extensions to FSPF protocol that VCS fabric uses instead of IS-IS.</p>
<p><strong>Distributed STP calculation</strong>. Each RBridge uses information supplied by its FSPF peers (think OSPF or IS-IS topology database), and information received through the fabric edge ports in xSTP BPDUs, to calculate the xSTP state and change the port state of its edge ports. Fabric ports are not affected by xSTP; they use TRILL-based forwarding controlled by FSPF routing protocol.</p>
<p><strong>Summary</strong>. Brocade definitely took an interesting approach to STP integration and (within the scope of that approach) executed flawlessly. The solution is obviously totally proprietary, but then we probably gave up the idea of having multi-vendor fabrics years ago.</p>
<p>However, looking at the bigger picture, one has to wonder whether a tight integration with STP is better than fabric-at-core-STP-at-edges approach. If the VCS fabric is not the root bridge, then it propagates topology change events across all STP islands connected to its edge ports. That might be what the customers want, but it might not be the most stable solution. </p>
<h4>More information?</h4><p>I’m running a <a href="https://www.eventbrite.com/e/data-center-fabrics-update-tickets-8753807875?ref=blog">Data Center Fabrics update session in May 2014</a> – it will cover new features of Brocade’s Network OS as well as new switches from Cisco, Juniper, Arista and a few other vendors, and the software improvements these vendors made in the last year.</p>
<p>If you’re reading this blog post after May 2014, don’t despair – you can always <a href="http://cms.ipspace.net/bin/buy?id=DCFabric">buy a recording of the webinar</a>, a <a href="http://cms.ipspace.net/bin/buy?id=DC_Track">bundle of all data center webinars</a>, or <a href="http://cms.ipspace.net/bin/buy?id=Subscription">a subscription</a> that <a href="http://www.ipspace.net/Subscription">gives you access to all webinars I ever did</a>.</p>

