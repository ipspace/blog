---
url: /2018/02/evpn-with-mpls-data-plane-in-data.html
title: "EVPN with MPLS Data Plane in Data Centers"
date: "2018-02-23T10:00:00.000+01:00"
tags: [ MPLS,Data Center,EVPN ]
---

<p>Mr. Anonymous (my most loyal reader and commentator) sent me this question as a comment to one of my blog posts:</p>
<blockquote class="cite">Is there any use case of running EVPN (or PBB EVPN) in DC with MPLS Data Plane, most vendors seems to be only implementing NVO to my understanding.</blockquote>
<p>Sure there is: you already have MPLS control plane and want to leverage the investment.<!--more--></p>
<p>You might also want to persuade your customers that this is a must-have feature because your competitors don’t have it in their products.</p>
<p><a name="_GoBack"></a>Sarcasm aside:</p>
<ul class="ListParagraph"><li>EVPN uses BGP Tunnel Encapsulation Attribute (<a href="https://tools.ietf.org/html/rfc5512">RFC 5512</a>, new version in <a href="https://tools.ietf.org/html/draft-ietf-idr-tunnel-encaps">draft-ietf-idr-tunnel-encaps</a>) to indicate the encapsulation to use to reach the egress PE device (we shouldn’t call them routers anymore, right)? </li>
<li>The values of this attribute can be found in <a href="https://www.iana.org/assignments/bgp-parameters/bgp-parameters.xhtml#tunnel-types">IANA registry</a>. </li>
<li>Almost all of them rely on something-over-IP tunneling.</li>
</ul>
<p>Maybe the real question should be “<em>why is that the case?</em>” In a word: decoupling.</p>
<p class="info">Unrelated question: why do we need so many encapsulations? Because <a href="https://xkcd.com/927/">standards</a>.</p>
<h4>The Benefits of Decoupling</h4><p>When using whatever-over-IP encapsulation technology with EVPN, the transport fabric remains simple and clean. It’s a pure IP fabric using a single encapsulation (IP) and running a single routing protocol.</p>
<p>MPLS encapsulation used with EVPN control plane requires end-to-end LSPs between PE devices. You’ll have to deal with two encapsulations (IP and MPLS), two sets of forwarding tables (FIB and LFIB), and additional control-plane protocols – LDP, MPLS-TE, BGP IPv4+labels or segment routing.</p>
<p>Each LSP has to exist in the forwarding table of every node it traverses. That introduces extra state in the transport fabric - not relevant if you have 10 switches, highly relevant if you have thousands of switches (example: WAN deployment) and the core switches use <a href="https://www.juniper.net/documentation/en_US/junos/topics/reference/general/mpls-scaling-values-qfx-series.html">high-speed merchant silicon</a>. </p>
<p>Admittedly, the MPLS encapsulation introduces lower overhead than whatever-over-IP encapsulation. That overhead becomes relevant when the bandwidth becomes expensive: in WAN networks, not in data centers.</p>
<p>To summarize: there’s no free lunch. You have to accept higher encapsulation overhead or more complex transport fabric. I know what I would do when designing data center infrastructure.</p>
<h4>More information</h4><ul class="ListParagraph"><li>We’ll do a <a href="http://www.ipspace.net/EVPN_Technical_Deep_Dive">deep dive into EVPN complexities</a> with Dinesh Dutt on March 6<sup>th</sup>;</li>
<li>We’ll discuss the implications of using EVPN in multi-site deployments in a live session with Lukas Krattiger (part of <a href="http://www.ipspace.net/Leaf-and-Spine_Fabric_Architectures">Leaf-and-Spine Fabric Architecture webinar</a>) on March 29<sup>th</sup>;</li>
</ul>
<p>Both live sessions are open to <a href="http://www.ipspace.net/Subscription">ipSpace.net subscribers</a>.</p>
<ul class="ListParagraph"><li>I expect EVPN discussions to take a large part of whiteboarding sessions in the <a href="http://www.ipspace.net/Building_Next-Generation_Data_Center">Building Next-Generation Data Centers</a> online course (starting on April 25<sup>th</sup>);</li>
<li>Did you notice the data centers online course starts with <a href="http://nextgendc.ipspace.net/Public:Speakers">Managing Complexity presentation by Russ White</a>?</li>
</ul>

