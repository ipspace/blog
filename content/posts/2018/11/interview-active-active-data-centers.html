---
date: 2018-11-29T12:50:00.000+01:00
tags:
- VXLAN
- data center
- EVPN
title: 'Interview: Active-Active Data Centers with VXLAN and EVPN'
url: /2018/11/interview-active-active-data-centers.html
---

<p>Christoph Jaggi asked me a few questions about using VXLAN with EVPN to build data center fabrics and data center interconnects (including active/active data centers). The German version <a href="https://www.inside-it.ch/articles/53019">was published on Inside-IT</a>, here’s the English version.</p>
<p>He started with an obvious one:</p>
<blockquote class="cite">What is an active-active data center and why would I want to use an active-active data center?</blockquote>
<p>Numerous organizations have multiple data centers for load sharing or disaster recovery purposes. They could use one of their data centers and have the other(s) as warm or cold standby (active/backup setup) or use all data centers at the same time (active/active).<!--more--></p>
<p class="info">Wondering whether you could use VXLAN with EVPN to solve your data center design challenge? Attend my <a href="https://www.sig-switzerland.ch/using-vxlan-and-evpn-to-build-active-active-data-centers/">workshop in Zurich (Switzerland)</a> on December 5<sup>th</sup>.</p>
<p>It’s also possible to have a hybrid architecture where a subset of workloads is running in each data center, but none of the workloads runs in multiple data centers at the same time. Data centers are active/standby from the workload perspective (simplifying the application architecture or infrastructure requirements) but still fully utilized.</p>
<p>We covered these concepts in more details in the <a href="https://www.ipspace.net/Designing_Active-Active_and_Disaster_Recovery_Data_Centers">Designing Active-Active and Disaster Recovery Data Centers</a> webinar.</p>
<blockquote class="cite">What is VXLAN and what is EVPN? Are they independent of each other or do they always come as combination?</blockquote>
<p>VXLAN is a simple data plane Ethernet-over-IP encapsulation scheme that enables us to tunnel Ethernet traffic across IP networks. It’s commonly used to implement overlay virtual networking in large-scale data center environments and private- and public clouds.</p>
<p>EVPN is the control plane for layer-2 and layer-3 VPNs. It’s similar to well-known MPLS/VPN control plane with added support for layer-2 (MAC) addresses, layer-3 (IPv4 and IPv6) addresses and IPv4/IPv6 prefixes.</p>
<p>VXLAN can be used without a control plane, and EVPN works with numerous data plane encapsulations including VXLAN and MPLS. Running VXLAN with EVPN is just the most popular combination.</p>
<p>For more details watch <a href="https://www.ipspace.net/VXLAN_Technical_Deep_Dive">VXLAN</a> and <a href="https://www.ipspace.net/EVPN_Technical_Deep_Dive">EVPN</a> technical deep dive webinars.</p>
<blockquote class="cite">What benefits does EVPN offer that might not be achieved when using a straight Ethernet underlay without additional VXLAN overlay?</blockquote>
<p>Traditional Ethernet solutions have two challenges: stability (due to spanning tree protocol challenges) and scalability (every switch has to see know about every MAC address in the network).</p>
<p>VXLAN (but also VPLS, PBB, TRILL, SPB…) improves scalability - customer MAC addresses are not visible in the transport core.</p>
<p>Compared to most other solutions VXLAN also improves network stability, as the core network uses well-tested IP transport and IP routing protocols.</p>
<p>EVPN is the icing on the cake - it makes VXLAN or MPLS deployments better by replacing dynamic MAC address learning used in traditional Ethernet networks with a deterministic control-plane protocol tested across the global Internet (BGP).</p>
<p>For more details watch the <a href="https://my.ipspace.net/bin/list?id=Clos#L2_FABRIC">layer-2 fabrics</a> part of <a href="https://www.ipspace.net/Leaf-and-Spine_Fabric_Architectures">leaf-and-spine fabric architectures webinar</a>.</p>
<blockquote class="cite">What are the limitations and disadvantages of using VXLAN and EVPN?</blockquote>
<p>Implementing VXLAN on hardware devices is still way more expensive than implementing simple Ethernet switching or 802.1ad (Q-in-Q). Hardware supporting VXLAN is therefore more expensive than simpler switching hardware.</p>
<p>EVPN is a complex control-plane protocol based on BGP. It also requires a well-functioning underlay (IP transport). It’s therefore harder to understand and implement than simpler VLAN-based solutions.</p>
<p>Wonder how complex EVPN is? Dinesh Dutt spent over four hours <a href="https://my.ipspace.net/bin/list?id=EVPN">describing its data center intricacies</a> without even mentioning EVPN-with-MPLS or typical service provider use cases.</p>
<blockquote class="cite">Which vendors do offer VXLAN and EVPN support? Are the implementations fully interoperable?</blockquote>
<p>Every single data center switching vendor (including Arista, Cisco, Cumulus, Extreme, and Juniper) has dropped whatever proprietary solution they were praising in the past (including FabricPath, DFA, VCS Fabric, IRF…) and implemented VXLAN encapsulation and EVPN control plane.</p>
<p>Unfortunately EVPN has many options, and vendors implemented different subsets of those options, resulting in what I call SIP of virtual networking (have you ever tried to get SIP working between VoIP products of different vendors?). While vendors claim their products interoperate (and participate in testing events to prove it), there are still a lot ways things can go wrong.</p>
<p>For example, the vendors can’t agree on simple things like <a href="https://www.ipspace.net/Data_Center_BGP/BGP_Fabric_Routing_Protocol">what the best routing protocol is for the underlay</a>, and <a href="https://www.ipspace.net/Data_Center_BGP/BGP_in_EVPN-Based_Data_Center_Fabrics">how you should run BGP in the overlay</a>. Each vendor is promoting a slightly different approach, making a designers' job a true nightmare.</p>
<blockquote class="cite">Is the implementation straightforward or are there things that can go wrong?</blockquote>
<p>We’re combining a hard problem (large-scale bridging) with a complex protocol (BGP) often implemented on a code base that was built to support totally different solutions (Internet routing with BGP or MPLS/VPN). There are tons of things that can go wrong, including subtle hardware problems and software bugs, more so if you’re trying to build an architecture that goes against what your vendor believes to be the right way of doing things.</p>
<blockquote class="cite">What are the key things to look at when designing a data center solution using VXLAN and EVPN?</blockquote>
<p>As always, start with simple questions:</p>
<ul class="ListParagraph"><li>What problem am I trying to solve?</li>
<li>Do I really have to solve it, or would redesigning some other part of the system (for example, application architecture) give us better overall results?</li>
<li>What options do I have to solve the problem?</li>
<li>Assuming you have to build large-scale virtual Ethernet networks spanning one or few data centers, VXLAN might be better than the alternatives.</li>
</ul>
<p class="info">You’ll find more information in the <a href="https://my.ipspace.net/bin/list?id=NextGenDC&amp;module=1">Define the Services and Requirements</a> module of <a href="https://www.ipspace.net/Building_Next-Generation_Data_Center">Building Next-Generation Data Center</a> online course.</p>
<p>Next, you have to figure out whether to implement VXLAN in hardware (on top-of-rack switches, the approach taken by data center switching vendors) or in software (in hypervisors, the approach used by VMware, Microsoft, Juniper Contrail, many OpenStack implementations and most large-scale public cloud providers). We covered this dilemma in the <a href="https://www.ipspace.net/VMware_NSX,_Cisco_ACI_or_Standard-Based_EVPN">VMware NSX, Cisco ACI or EVPN</a> webinar.</p>
<p>If it turns out that it’s best to implement VXLAN in hardware (for example, due to significant amount of non-virtualized servers), you have to decide whether to use static configurations potentially augmented with simple automation, or deploy EVPN.</p>
<p>Keep in mind what I told you about EVPN interoperability challenges. Don’t mix-and-match different vendors in the same fabric. Build smaller pods (self-contained units of compute, storage and virtualization) and connect them with traditional technologies like IP routing or VLANs.</p>
<p>Last but definitely not least, while EVPN control plane used with VXLAN is become more stable, it’s not yet a rock-solid technology. Do thorough testing.</p>
<p>Interested? We’ll discuss all these questions in way more details during the day-long <a href="https://www.sig-switzerland.ch/using-vxlan-and-evpn-to-build-active-active-data-centers/">workshop in Zurich (Switzerland)</a> on December 5<sup>th</sup>.</p>

