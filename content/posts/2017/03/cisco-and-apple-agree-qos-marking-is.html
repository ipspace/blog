---
date: 2017-03-27T08:26:00.000+02:00
tags:
- wireless
- QoS
title: 'Cisco and Apple Agree: QoS Marking Is an Application Problem'
url: /2017/03/cisco-and-apple-agree-qos-marking-is.html
---

<p>The last presentation during the <a href="http://techfieldday.com/event/cleur17/">Tech Field Day Extra @ Cisco Live Europe</a> event was a <em>Cisco-Apple Partnership </em>presentation, and we expected an hour of corporate marketese. </p>
<p>Can’t tell you how pleasantly surprised we were when Jerome Henry started his very technical presentation <a href="http://techfieldday.com/appearance/cisco-apple-partnership-presentation-at-tech-field-day-extra-at-cisco-live-europe-2017/">explaining the wireless goodies you get when using iOS with IOS</a>.<!--more--></p>
<p>Ethan Banks <a href="http://packetpushers.net/cisco-apple-wireless-partnership/">published a great summary of the presentation</a>, what I found most interesting was how they decided to handle QoS:</p>
<ul class="ListParagraph"><li>Applications must decide what QoS they need;</li>
<li>They use iOS API to request the QoS class;</li>
<li>iOS marks the traffic generated by the application with proper DSCP values;</li>
<li>Network devices act on the DSCP values to provide the desired QoS.</li>
</ul>
<p>I was so delighted to hear someone finally realized how to handle QoS properly: the responsibility lies with the applications on the host; the network should just provide what it was asked to do, not try to reverse-engineer application intent based on TCP/UDP port numbers or haruspicy.</p>
<blockquote class="twitter-tweet" data-lang="en"><p dir="ltr" lang="en">If an app wants to get QoS on iOS 10, the developer must use the right calls. Finally someone got it ;)) <a href="https://twitter.com/hashtag/win?src=hash">#win</a> <a href="https://twitter.com/hashtag/TFDX?src=hash">#TFDX</a></p>
— Ivan Pepelnjak (@ioshints) <a href="https://twitter.com/ioshints/status/834396905543196673">February 22, 2017</a></blockquote>
<script async="" charset="utf-8" src="//platform.twitter.com/widgets.js"></script><h4>But It Doesn’t Work in Real Life…</h4><p>The obvious counter-argument to this idea is “<em>but then every application will request the best QoS class</em>”. No problem. Have you ever heard the mantra of treating the <a href="/2013/04/they-want-networking-to-be-utility-lets.html">network as a utility</a>? Let’s do it:</p>
<ul class="ListParagraph"><li>Every endpoint has a traffic contract with the network specifying how much traffic the endpoint can send or receive (per traffic class).</li>
<li>It’s the endpoint responsibility not to get over the traffic contract. </li>
<li>The ingress or egress edge device measures and polices the traffic. Excess traffic is dropped or remarked.</li>
<li>Network core does simple per-class queuing and dropping.</li>
</ul>
<p>Won’t work in real life? Tell that to the hundreds of SPs around the world that use this simple approach to run their networks. </p>
<p>Admittedly, the “only” difference between SP and enterprise world is that there’s a customer-provider contract in the SP world, and all the screaming won’t help you if you want to exceed your contractual traffic rates and your traffic gets dropped.</p>
<p>The only trick to use the same approach in enterprise networks (where there’s no customer-provider relationship) is to get someone very high up the food chain motivated to support the contract enforcements (= no exceptions). CFO comes to mind – explain to her how using a simple approach like the one above will reduce the network complexity and consequently CapEx and OpEx.</p>
<h4>Back to Wireless</h4><p>Based on the above reasoning I wondered why Cisco and Apple think they need to tightly control this functionality (called Fastlane QoS). Andrew von Nagy <a href="http://packetpushers.net/cisco-apple-wireless-partnership/#comment-7968">provided the answer in a response to Ethan’s blog post</a>: wireless is shared media, and on a shared media you have to enforce QoS on ingress point, otherwise a noisy neighbor can easily devour all the resources.</p>
<p>The only way to get QoS on wireless working flawlessly is thus to control the endpoints – and that’s what Apple iOS is pretty good at.</p>
<h4>More information</h4><p>Want to know more about QoS? Ethan Banks agreed to do a 2-3 hour <a href="http://www.ipspace.net/QoS">QoS Fundamentals webinar</a> in autumn 2017. Stay tuned…</p>

