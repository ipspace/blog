---
url: /2020/02/pragmatic-evpn-designs.html
title: "Pragmatic EVPN Designs"
date: "2020-02-25T08:48:00.000+01:00"
tags: [ Design,EVPN ]
---

<p>While running the <em><a href="https://www.ipspace.net/Using_VXLAN_And_EVPN_To_Build_Active-Active_Data_Centers">Using VXLAN And EVPN To Build Active-Active Data Centers</a></em> workshop in early December 2019 I got the usual set of questions about using BGP as the underlay routing protocol in EVPN fabrics, and the <a href="https://www.ipspace.net/Data_Center_BGP/BGP_in_EVPN-Based_Data_Center_Fabrics">various convoluted designs</a> like IBGP-over-EBGP or EBGP-between-loopbacks over directly-connected-EBGP that some vendors love so much.</p>
<p>I got a question along the same lines from one of the readers of my <a href="https://blog.ipspace.net/2020/02/the-evpnbgp-saga-continues.html">latest EPVN rant</a> who described how convoluted it is to implement the design he’d like to use with the gear he has (I won’t name any vendor because hazardous chemical substances get mentioned when I do).<!--more--></p>
<p>Here’s what you have to keep in mind when considering what design to use in your network (and it applies to everything, not just EVPN): while I <a href="https://blog.ipspace.net/2019/04/dont-sugarcoat-challenges-you-have.html">love to fight the windmills</a> of overly-complex designs, and <a href="https://blog.ipspace.net/2020/02/the-evpnbgp-saga-continues.html">annoy the vendors by pointing out weaknesses in their arguments</a>, you have a network to run, so be pragmatic.</p>
<p><strong>Do whatever your vendor describes as the reference design… and if you have multiple reference designs to choose from, choose the simplest one that meets your scalability requirements.</strong></p>
<p>You might not like the design your vendor loves, and you might find it too complex. Guess what, there are multiple vendors out there, and they are all keen to take your money. Vote with your wallet - that’s the only way to bring some common sense to this industry.</p>
<h3 id="in-case-youre-not-persuaded-yet">In Case You’re Not Persuaded (Yet)</h3><p>While every vendor (marketing department) claims they support whatever you’d like to do, or as Aldrin said in <a href="https://blog.ipspace.net/2019/11/the-evpn-dilemma.html?showComment=1575211955484#c831176054126186737">his comment</a> to my <a href="https://blog.ipspace.net/2019/11/the-evpn-dilemma.html">EVPN Dilemma</a> blog post…</p>
<blockquote><p>Pretty much all EVPN implementations support multiple routing protocols. Including IS-IS, OSPF and EBGP as IGP. There’s a difference between a reference design and feature support.</p>
</blockquote>
<p>.. there truly is a difference between the two: reference design is tested much better than all other combinations of supposedly-supported features. If you don’t fancy providing free QA/troubleshooting resources to your $vendor (and arguing with their level-1 TAC that reloading the box really doesn’t help while doing that), stick with whatever the vendor is recommending.</p>
<p>As always, there will be consequences. In this particular case:</p>
<ul><li>As no two vendors use the same preferred reference design, forget about multi-vendor EVPN fabrics (which is probably a good idea anyway);</li>
<li>Some reference designs tend to be overly complex. Someone will have to troubleshoot them at 2AM on a Sunday morning (hint: that might be you, or they might call you after the get hopelessly lost). All other things being comparable, choose the vendor with the simplest reference design.</li>
<li>Some reference design configurations read like a Tolstoy novel. Prefer vendors that can implement your needs with minimum configuration hassle (<a href="https://blog.ipspace.net/2019/10/auto-mlag-and-auto-bgp-in-cumulus-linux.html">example</a>)</li>
</ul>
<p>You can always generate device configurations with templates, and the vendors with overly-verbose configurations will be quick to point out the powers of automation. However, someone has to design those templates, and someone might have to troubleshoot them (or the actual device configurations)… yet again most probably at 2AM on a Sunday morning <a href="https://blog.ipspace.net/2018/02/big-red-button-for-network-automation.html">when the automation system breaks down</a>. Regardless of what the thought leaders love to tell you, if you want to have a stable solution, <a href="https://blog.ipspace.net/2015/11/can-you-afford-to-reformat-your-data.html">hidden complexity</a> tends to be <a href="https://blog.ipspace.net/2018/02/how-self-sufficient-do-you-want-to-be.html">worse than explicit complexity</a>.</p>
<p>Notes:</p>
<ul><li>You’ll find everything you want to know about EVPN in <a href="https://www.ipspace.net/EVPN_Technical_Deep_Dive">EVPN Technical Deep Dive</a> webinar;</li>
<li>You might want to build a stable leaf-and-spine fabric, in which case parts of <a href="https://www.ipspace.net/Leaf-and-Spine_Fabric_Architectures">Leaf-and-Spine Fabric Architectures</a> webinar is what you’re looking for;</li>
<li>Once you’re ready to automate your fabric, check out our <a href="https://www.ipspace.net/Roadmap/Network_Automation_webinars">automation webinars</a> and <a href="https://www.ipspace.net/Building_Network_Automation_Solutions">online course</a>.</li>
</ul>

