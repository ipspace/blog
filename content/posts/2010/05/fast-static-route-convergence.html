---
url: /2010/05/fast-static-route-convergence/
title: "Fast static route convergence"
date: "2010-05-07T07:00:00.002+02:00"
tags: [ IP routing ]
---

<p>A few days ago I’ve received a cryptic e-mail with exactly this content: “<em>I am having a issue "static routes not flushed when next hop is unreachable" please advice.</em>” I suspected that the sender actually wanted to ask me what to do if a static route pointing to an IP next-hop does not disappear when the next hop becomes unreachable and told him to adjust the <strong>ip route static adjust-time </strong>parameter while monitoring the CPU usage.</p>
<!--more--><p>The reason for this suggestion is simple: while various events (including changes in interface state and tracked objects) cause immediate change in the state of the static routes, the changes to next-hop reachability are not evaluated immediately; the next-hop check is done periodically and the <a href="http://www.cisco.com/en/US/docs/ios/iproute_pi/command/reference/iri_pi1.html">default interval is 60 seconds</a>.</p>
<p class="warn">A very low value of the scanning interval increases CPU utilization on a device with many static routes.</p>
<p>To illustrate this behavior, I’ve configured a simple static route using a loopback IP address of a remote OSPF router as its next hop:</p>
<pre class="code">S1#<strong>show ip route 10.7.8.0</strong> <br/>Routing entry for 10.7.8.0/24<br/>  Known via "static", distance 1, metric 0<br/>  Routing Descriptor Blocks:<br/>  * 10.0.0.22<br/>      Route metric is 0, traffic share count is 1<br/><br/>S1#<strong>show ip route 10.0.0.22</strong><br/>Routing entry for 10.0.0.22/32<br/>  Known via "ospf 1", distance 110, metric 65, type intra area<br/>  Last update from 10.0.0.11 on Serial1/0.100, 00:00:26 ago<br/>  Routing Descriptor Blocks:<br/>  * 10.0.0.11, from 10.0.0.11, 00:00:26 ago, via Serial1/0.100<br/>      Route metric is 65, traffic share count is 1</pre><p>When the remote loopback interface was shut down, the OSPF route disappeared within a few seconds (as dictated by the SPF delay timer), but it took almost a minute for the static route to be removed from the IP routing table (the printout was generated by the <strong>debug ip routing </strong>command).</p>
<pre class="code">00:04:23.953: RT: del 10.0.0.22/32 via 10.0.0.11, ospf metric [110/65]<br/>00:04:23.953: RT: delete subnet route to 10.0.0.22/32<br/>00:05:10.766: RT: del 10.7.8.0/24 via 10.0.0.22, static metric [1/0]<br/>00:05:10.766: RT: delete subnet route to 10.7.8.0/24</pre><p>After changing the scanning interval to one second, the static route disappeared almost immediately after the OSPF route:</p>
<pre class="code">S1(config)#<strong>ip route static adjust-time 1</strong> <br/>S1(config)#<br/>00:07:08.994: RT: del 10.0.0.22/32 via 10.0.0.11, ospf metric [110/65]<br/>00:07:08.994: RT: delete subnet route to 10.0.0.22/32<br/>00:07:09.882: RT: del 10.7.8.0/24 via 10.0.0.22, static metric [1/0]<br/>00:07:09.886: RT: delete subnet route to 10.7.8.0/24</pre>

