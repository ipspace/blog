---
date: 2010-08-02T06:41:00.002+02:00
tags:
- bridging
- data center
- TRILL
title: TRILL and 802.1aq are like apples and oranges
url: /2010/08/trill-and-8021aq-are-like-apples-and/
---

<p>A <a href="#comments">comment by Brad Hedlund</a> has sent me studying the differences between TRILL and 802.1aq and one of the first articles I’ve stumbled upon was a nice overview which claimed <a href="http://blog.sflow.com/2009/10/8021aq-and-trill.html">that the protocols are very similar</a> (as they both use IS-IS to select shortest path across the network). After studying whatever <a href="http://www.ieee802.org/1/pages/802.1aq.html">sparse</a> <a href="http://en.wikipedia.org/wiki/802.1aq">information</a> there is on 802.1aq and the <a href="http://twitter.com/ioshints/status/19677423236">obligatory headache</a>, I’ve figured out that the two proposals have completely different forwarding paradigms. To claim they’re similar is the same as saying DECnet phase V and MPLS Traffic Engineering are similar because they both use IS-IS.</p>
<!--more--><h4>TRILL forwarding</h4><p>Within the backbone, TRILL is a true layer-3 protocol: TRILL header has a hop count, RBridges have layer-3 addresses and the layer-2 header changes as the packet is propagated across the backbone. Even though TRILL still retains the bridging paradigm at the edges, its core properties ensure it behaves like any other (well designed) L3 protocol.</p>
<p>As you can see in the diagram, once the ingress RBridge receives the end-user’s MAC frame, the frame is encapsulated in a layer-3 TRILL header with layer-3 addresses of ingress and egress RBridge. The TRILL datagram gets a new MAC header, which is changed every time the packet is forwarded by an RBridge; the layer-3 addresses in the TRILL header obviously stay unchanged, just the hop count is decreased.</p>
<p style="text-align: center;"><a href="/2010/08/s1600-TrillFwd.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="276" src="/2010/08/s400-TrillFwd.png" width="400"/></a></p>
<p><strong>Benefits:</strong> a layer-3 protocol has numerous advantages over a layer-2 protocol; read my “<a href="/2010/07/bridging-and-routing-is-there/"><em>Bridging and Routing: is there a difference?</em></a>” and “<a href="/2010/07/bridging-and-routing-part-ii/"><em>Bridging and Routing, Part II</em></a>” posts.</p>
<p><strong>Drawbacks:</strong> TRILL cannot be implemented with those existing (low-cost) ASICs that are hard-coded to support only 802.1ad and 802.1ah. It can be implemented, however, with any forwarding architecture that is generic enough to be able to insert and remove L2/L3 headers on ingress/egress points and swap L2 headers and modify L3 headers while forwarding the datagrams.</p>
<h4>802.1aq forwarding</h4><p>802.1aq is actually a modified way of populating the bridging FIB (Forwarding Information Base), while the forwarding paradigm stays unchanged. 802.1aq can use 802.1ad (Q-in-Q) forwarding or 802.1ah (Provider Backbone Bridging or MAC-in-MAC) forwarding. I sincerely hope nobody will implement Q-in-Q forwarding (SPBV), as it’s a total confusion (on the other hand, troubleshooting that would be excellent job security), so let’s focus on MAC-in-MAC forwarding (SPBM).</p>
<p>The ingress PBB (Provider Backbone Bridge) takes the user’s MAC frame and encapsulates it in 802.1ah MAC frame. The destination MAC address in the 802.1ah MAC frame is the egress PBB and there’s no hop count that can be used to detect loops (or allow the network operator to <em>traceroute</em> across the network). The new frame is bridged across the 802.1aq backbone; because the FIB building mechanisms are modified, the backbone is no longer limited to a single spanning tree (which makes 802.1aq different from 802.1ah). Throughout the backbone forwarding process, the frame is unchanged (and the destination MAC address remains the address of the egress PBB).</p>
<p style="text-align: center;"><a href="/2010/08/s1600-802.1aqFwd.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="277" src="/2010/08/s400-802.1aqFwd.png" width="400"/></a></p>
<p><strong>Benefits:</strong> 802.1aq can use existing ASICs</p>
<p><strong>Drawbacks:</strong> 802.1aq has no relation to routing and none of the routing functionality. A loop generated by the control-plane protocol (for example, due to buggy implementation or distributed nature of IS-IS computations) can cause a network meltdown.</p>
<h4>Cisco FabricPath</h4><p>According to the comment Brad made, the current FabricPath implementation does not change MAC header on every hop, so it seems to be aligned with the 802.1aq framework. Please allow me to refrain from commenting what this really means for the marketing claims about FabricPath.</p>
<p>And, last but not least, if you’d like to know more about L2/L3 switching in Data Center and emerging DC technologies, watch my <a href="https://www.ipspace.net/DC30">Data Center 3.0 for Networking Engineers</a> webinar (<a href="https://www.ipspace.net/SingleRecording?code=DC30">buy a recording</a> or <a href="https://www.ipspace.net/Subscription">yearly subscription</a>).</p>

