---
url: /2010/11/dhcp-microsoft-way-almost-standard/
title: "DHCP the Microsoft way: almost standard"
date: "2010-11-12T06:55:00.008+01:00"
tags: [ DHCP ]
---

<p>Srinivas sent me the following printout a few days ago and asked me whether I could explain the weird DHCP bindings (I removed the lease expiration column from the printout):</p>
<pre class="code">Switch#<strong>sh ip dhcp binding</strong><br/>Bindings from all pools not associated with VRF:<br/>IP address          Client-ID/              Type<br/>                    Hardware address/<br/>                    User name<br/>192.168.101.140     <span class="high">0152.4153.2000.188b.</span>    Automatic<br/>                    <span class="high">cfb7.f800.0000.0000.</span><br/>                    <span class="high">00</span><br/>192.168.101.141     0152.4153.2000.188b.    Automatic<br/>                    cfb7.f800.0001.0000.<br/>                    00</pre><!--more--><p>Sometimes it’s good if your programming history goes back to the days when we had to read hex dumps: the first few bytes of the Client ID immediately looked like uppercase letters follow by a space. Lookup into the ASCII tables (I still can’t read hex without external help) produced the string 'RAS ' and Google quickly <a href="http://www.net.princeton.edu/announcements/dhcp-cliid-must-match-chaddr.html">provided the culprit</a>: Microsoft RAS.</p>
<p>A Remote Access Server (RAS) obviously needs IP addresses for its dial-in clients. They could be in a separate pool, in which case RAS has to do routing (potentially including a routing protocol) and its administrator has to be able to configure that. Obviously that was too tough a choice for some people, so Microsoft decided to offer another approach: grab a few IP addresses from the DHCP server and pass them to the dial-in clients. Nothing wrong with that until you start using a “somewhat unusual” DHCP Client ID format.</p>
<p>Are they violating the standards? Strictly speaking, they’re not. <a href="#section-9.14">RFC 2132 says</a>:</p>
<blockquote class="cite">[client identifier] MAY consist of a hardware type and hardware address. In this case the type field SHOULD be one of the ARP hardware types defined in STD2 [22].  A hardware type of 0 (zero) should be used when the value field contains an identifier other than a hardware address.</blockquote>
<p>However, most other DHCP client implementations use hardware type zero when the subsequent bytes are not a MAC address. By needlessly violating the common behavior, you’re bound to trigger problems with some overly-zealous servers, which are working close to the sidelines of RFC 2132. Here’s what it has to say about the servers:</p>
<blockquote class="cite">[client identifier] is expected to be unique for all clients in an administrative domain. Identifiers SHOULD be treated as opaque objects by DHCP servers.</blockquote>
<p>Great wording, isn’t it? Clients don’t have to respect the common rules and servers are not required not to rely on the common behavior. As far as I remember, you can’t have your cake and eat it too ... unless we’re talking about digital goods, so maybe things are different in the RFC land.</p>
<p>Last but not least, what do you think: is there a specific reason Microsoft’s programmers chose to structure the RAS client identifiers the way they did or were they simply too sloppy to read the standards?</p>

