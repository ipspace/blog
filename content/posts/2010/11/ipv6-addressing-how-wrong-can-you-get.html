---
date: 2010-11-08T06:56:00.016+01:00
tags:
- IPv6
- workshop
title: 'IPv6 addressing: how wrong can you get it?'
url: /2010/11/ipv6-addressing-how-wrong-can-you-get.html
---

<p>Mike was wondering whether his ISP is giving him what he needs to start an IPv6 pilot within his enterprise network. He wrote:</p>
<blockquote class="cite">So I got an IPv6 assignment with a /120 mask (basically our IPv4/24 network mapped to IPv6) and two smaller networks to use for links between our external router and the ISP.</blockquote>
<p class="warn">Believe it or not, I’m not making this up. I was as amazed as you probably are.</p>
<p>Dear Mike’s ISP: where were you when the rest of the world was preparing to deploy IPv6? Did you read <a href="http://tools.ietf.org/html/rfc5375"><em>IPv6 Unicast Address Assignment Considerations</em></a> (RFC 5375) or <a href="http://www.ripe.net/docs/ipv6policy.html"><em>IPv6 Address Allocation and Assignment Policy</em></a> from RIPE or your regional registry?</p>
<!--more--><p>Let’s start with prefix lengths. RFC 5375 is very explicit (section 3):</p>
<blockquote class="cite">Using a subnet prefix length other than a /64 will break many features of IPv6, including Neighbor Discovery (ND), Secure Neighbor Discovery (SEND) [RFC3971], privacy extensions [RFC4941], parts of Mobile IPv6 [RFC4866], Protocol Independent Multicast - Sparse Mode (PIM-SM) with Embedded-RP [RFC3956], and Site Multihoming by IPv6 Intermediation (SHIM6) [SHIM6], among others.</blockquote>
<p>It’s therefore highly recommended to use a /64 prefix on every subnet. The use of longer prefixes on point-to-point inter-router links is debatable (some people recommend /126 or /127, others /112). Properly-implemented network devices have no problem with shorter subnets; after all, IPv6 is classless. However, to ensure you won’t get a hiccup from a just-good-enough-too-cheap-to-pass box someone will eventually connect to your network, be conservative and use /64 everywhere.</p>
<p><strong>Summary:</strong> assigning someone a public /120 prefix is ... let’s be diplomatic ... out of touch with reality.</p>
<p>So, Mike got a /120 and tried to make sense out of it. He needs to allocate IPv6 addresses to the whole network and somehow can’t do that with a /120. Here is the next bit of wisdom passed to him by a helpful colleague (I’m not making this up either):</p>
<blockquote class="cite">I asked someone more familiar (but no hands-on-experience) about this, and got the answer that I should use a link-local or unique-local addresses beginning with fe08 or fd for all computers within the company, the same way we use RFC1918 addresses today, and then just NAT them to the /120 network I got assigned from the ISP.</blockquote>
<p>We were all confused by the plethora of different types of IPv6 addresses (<a href="http://packetpushers.net/show-21-ipv6-for-the-win-part-1/">Packet Pushers IPv6 podcast</a> has a lively debate on that topic), but they are really not that hard to grasp. Let’s over-simplify them a bit:</p>
<ul class="ListParagraph"><li>Link-local addresses are a better solution for unnumbered interfaces and other communication needs before you get a real IPv6 address (for example, DHCPv6 request packets are sent from a link-local address);</li>
<li>Unique local addresses (ULA) can be used for intra-network connectivity (for example, for those hosts and servers that never communicate with the Internet). Your host could have an ULA and a global IPv6 address (or even more than one global address) and use one or the other as needed.</li>
<li>In most cases, your hosts should have a globally unique IPv6 address.</li>
</ul>
<p>Regardless of whether you decide to use ULA or not, remember that there is no NAT in IPv6 (although some people are <a href="http://tools.ietf.org/html/rfc5902">seriously longing for NAT66</a>). Let me repeat that: <strong>there is no NAT in IPv6</strong>. </p>
<p>Mike is thus stuck: he needs a /64 on every subnet in his network and got a meager /120 from the ISP. What’s wrong? The ISP’s IPv6 address allocation policy. </p>
<p>A minimum allocation an ISP has to give to a residential end-user is a /64. If a residential end-user needs multiple subnets, he should get a /56. Minimum end-site allocation is /48 (Mike should thus get a /48, not a /120). Minimum provider-independent allocation assigned by RIPE or ARIN is /48.</p>
<p>Mike could get 65000 /64 prefixes from the /48 prefix he should have got from the ISP, probably more than enough to number his entire network. If you have a larger network, it’s not hard to get a larger allocation; you just have to provide the paperwork documenting your needs.</p>
<p><strong>Summary:</strong> If you are an enterprise customer and your ISP is giving you anything less than a /48, it’s time to consider changing the ISP.</p>
<h4>Additional information</h4><p>My <a href="http://www.ioshints.info/Building_IPv6_Service_Provider_Core"><em>Building the IPv6 Service Provider Core</em></a><em> </em>webinar (<a href="http://spipv6.eventbrite.com/">register here</a>) covers not only the core design principles, but also IPv6 addressing and access network issues.</p>
<p>If you’re planning IPv6 deployment in your enterprise network, let’s consider the <a href="http://www.ioshints.info/Enterprise_IPv6_Deployment_Workshop">Enterprise IPv6 Deployment Workshop</a>. </p>
<p>I did a number of CIO/CTO-level technical presentations recently, giving them a fair assessment of why they might want to consider IPv6 and what the hurdles are. If you need something along these lines, <a href="http://www.ioshints.info/Contact">just let me know</a> (and if you have a Telepresence system, we might be able to hook them together and have an interesting “virtual live meeting” experience).</p>
<p>If you need IPv6 readiness audit or network design/implementation help, there’s always our <a href="http://wiki.nil.si/ps">Professional Services team</a>. We’ve been running IPv6 internally for quite a while and we were one of the first IPv6-multihomed enterprises in Europe using PI address space, so we’ve gathered a bit of experience on the way.</p>

