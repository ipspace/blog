---
date: 2010-11-17T08:54:00.004+01:00
tags:
- DCB
- data center
- workshop
- FCoE
title: Does FCoE need QCN (802.1Qau)?
url: /2010/11/does-fcoe-need-qcn-8021qau.html
---

<p>One of the recurring religious FCoE-related debates of the last months is undoubtedly “do you need <a href="https://blog.ipspace.net/2010/11/data-center-bridging-dcb-congestion.html">QCN</a> to run FCoE” with Cisco adamantly claiming you don’t (hint: Nexus doesn’t support it) and <a href="http://h30507.www3.hp.com/t5/Eye-on-Blades-Blog-Trends-in/This-is-not-the-10Gb-network-you-re-looking-for/ba-p/79733">HP claiming you do</a> (hint: their switch software lacks FC stack) ... and then <a href="http://www.networkcomputing.com/data-networking-management/brocade-first-to-market-with-native-end-to-end-fcoe.php">there’s this recent announcement from Brocade</a> (more about it in a future post). As is usually the case, Cisco and HP are both right ... depending on <a href="https://blog.ipspace.net/2010/08/multihop-fcoe-101.html">how you design your multi-hop FCoE network</a>.</p>
<!--more--><p>According to Cisco, every major switch in your network should also be an FCoE Forwarder (FCF; FC functionality somewhat equivalent to a router) running full FC stack, having its own FC domain ID and participating in the FSPF. There’s no bridging in this scenario. FC frames are routed hop-by-hop and QCN is simply not applicable (it works only across a single bridged domain). The fact that NX-OS has FC stack and that Nexus hardware does not support QCN might have biased the design a bit.</p>
<p style="clear: both; text-align: center;"><a href="/2010/11/s1600-FCoE+101+fullFC.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="136" src="/2010/11/s400-FCoE+101+fullFC.png" width="400"/></a></p>
<p>Another design favored by Cisco uses a single DCB-enabled access switch (<a href="https://blog.ipspace.net/2010/09/what-exactly-is-nexus-4000.html">Nexus 4000</a>, for example) between the hosts and FCFs. QCN might be marginally beneficial in this scenario, but as traditional FC networks have worked quite well with BB_credits, <a href="https://blog.ipspace.net/2010/09/introduction-to-8021qbb-priority-flow.html">PFC</a> will probably do a decent job here as well.</p>
<p>In this design, the access switch has to support PFC (<a href="https://blog.ipspace.net/2010/09/introduction-to-8021qaz-enhanced.html">ETS</a> is recommended) but not QCN. Cisco is also telling you the access switch simply has to have <a href="https://blog.ipspace.net/2010/09/multihop-fcoe-102-vnport-proxy-and-fip.html">FIP snooping</a>. Nothing to do with the fact that Cisco has generic snooping hardware and some other vendors don’t.</p>
<p style="clear: both; text-align: center;"><a href="/2010/11/s1600-FCoE+101+FIP+snooping.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="142" src="/2010/11/s400-FCoE+101+FIP+snooping.png" width="400"/></a></p>
<p>The vendors that don’t have FC stack in their core and aggregation switches usually keep mum about FCoE. When prodded, they might tell you it’s a legacy migration technology and you should really be using iSCSI or NFS, or they claim they’ll support it once QCN chips are available, because you really need QCN for multihop FCoE ... and they’re also right. If you have FCoE Enodes and FCFs at the edges of a large LAN (with a lot of DCB-enabled aggregation/core switches in the middle), it’s quite possible to get congestion somewhere in the core and QCN is the only thing that can help you.</p>
<p style="clear: both; text-align: center;"><a href="/2010/11/s1600-FCoE+101+MH+DCB.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="136" src="/2010/11/s400-FCoE+101+MH+DCB.png" width="400"/></a></p>
<p>Continuing the same debate, Cisco will be quick to point out that the FCoE-on-the-edges design loses all traffic engineering capabilities, most of security and multipath separation of traditional FC networks ... and so we’re going around in circles. Maybe it’s not a bad idea to be cautious for the next few years, use FCoE only as a feeder technology into legacy FC network and prepare to migrate to iSCSI or NFS.</p>
<h4>More information</h4><ul class="ListParagraph"><li>Joe Onisick wrote a great article “<a href="http://www.definethecloud.net/whats-the-deal-with-quantized-congestion-notification-qcn">What’s the deal with Quantized Congestion Notification (QCN)</a>”.</li>
<li>You can enjoy vendor bantering in comments to the “<a href="http://blogs.cisco.com/datacenter/when_are_fcoe_standards_done/">When are FCoE standards done</a>” post on Cisco Blog (or you could follow <a href="http://twitter.com/bradhedlund">@bradhedlund</a> on Twitter, he’s quick to jump into QCN/FCoE debates).</li>
<li>The <a href="http://www.ioshints.info/DC30">Data Center 3.0 for Networking Engineers</a> webinar (<a href="http://www.ioshints.info/SingleRecording?code=DC30">buy a recording</a> or <a href="http://www.ioshints.info/Subscription">yearly subscription</a>) will give you a comprehensive overview of numerous Data Center technologies, including FCoE, multihop FCoE and DBC (PFC, ETS and QCN).</li>
</ul>

