---
date: 2010-11-01T07:02:00.005+01:00
tags:
- link aggregation
- switching
- data center
- workshop
- LAN
title: 'Multi-chassis Link Aggregation (MLAG): external brains'
url: /2010/11/multi-chassis-link-aggregation-mlag.html
more_blurb: True
---

<p class="more">This is my third MLAG post. You might want to read the <a href="https://blog.ipspace.net/2010/10/multi-chassis-link-aggregation-basics.html">Multi-chassis Link Aggregation Basics</a> and <a href="https://blog.ipspace.net/2010/10/multi-chassis-link-aggregation-stacking.html">Multi-chassis Link Aggregation: Stacking on Steroids</a> posts before continuing.</p>
<p>Juniper has <a href="http://www.juniper.net/us/en/local/pdf/whitepapers/2000348-en.pdf">introduced an interesting twist</a> to the <em>Stacking on Steroids </em>architecture: the brains of the box (control plane) are outsourced. When you want to build a <em>virtual chassis </em>(Juniper’s marketing term for stack of core switches) out of EX8200 switches, you offload all the control-plane functionality (Spanning Tree Protocol, Link Aggregation Control Protocol, first-hop redundancy protocol, routing protocols) to an external box (XRE200).</p>
<!--more--><p>The resulting architecture is very similar to <a href="https://blog.ipspace.net/2010/10/multi-chassis-link-aggregation-stacking.html">Cisco’s VSS</a>, the major difference being that the internal routing engine in an EX8200 participating in a virtual chassis performs only the most rudimentary functions (chassis/linecard monitoring and maintenance). </p>
<p style="clear: both; text-align: center;"><a href="/2010/11/s1600-MLAG_EX8200.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="271" src="/2010/11/s400-MLAG_EX8200.png" width="400"/></a></p>
<p>Theoretically you could scale the <em>virtual chassis </em>architecture to numerous EX8200 switches behaving like a single data center fabric. From that perspective, the <em>virtual chassis </em>approach is way better than Cisco’s VSS (which still looks like a hack to me). In reality, only two EX8200-series switches can be joined initially, making the <em>virtual chassis </em>a more expensive hack than the VSS (not only are you lobotomizing one supervisor module, you have to buy two more and lobotomize three out of four).</p>
<h4>The nasty details</h4><p>Not surprisingly, <a href="http://www.juniper.net/us/en/local/pdf/whitepapers/2000348-en.pdf">Juniper’s white paper</a> is full of not-so-subtle hints comparing <em>virtual chassis </em>with VSS. For example: if the inter-switch link (Juniper’s term: <em>intra-chassis link</em>) goes down, you don’t lose half of your switching capacity (like you do with VSS). What they forget to mention is that the most common reason you’d lose a well-designed inter-switch link implemented as a port channel of multiple 10Gb connections terminated on different linecards is the failure of the supervisor module (in which case half of your switching capacity is dead anyway). </p>
<p>Furthermore, losing the inter-switch link between two Catalysts in a VSS system is equivalent to losing all the connections between the left- and right-hand sides in the above diagram, in which case the <em>virtual chassis </em>is at least as brain-dead as VSS (the whitepaper is curiously mum about that scenario). Another omission: when you lose the <em>intra-chassis link</em> between two EX8200 switches, hosts connected only to the left-hand switch (most probably) can no longer talk to hosts connected only to the right-hand switch.</p>
<p>Last but not least, when trying to compare apples to apples (which you can never expect a marketing whitepaper to do), we should also consider the extra power supplies, fans and other infrastructure needed in the XRE200 boxes.</p>
<p>Speaking of marketing misdirections, the <a href="http://www.juniper.net/us/en/local/pdf/fact-sheets-backgrounder/3000068-en.pdf">EX8200 Virtual Chassis Technology</a> “fact sheet” has some “excellent” FUD:</p>
<blockquote class="cite">[virtual chassis behavior at inter-switch link loss] is a significant advancement over other vendors’ solutions, where the loss of the intra-chassis link leads to complete loss in connectivity between any nodes (access switches or core routers) interconnected via the aggregation layer.</blockquote>
<p>If you’re unsure why that’s a bogus claim, maybe it’s time to  watch the <a href="http://www.ioshints.info/DataCenterIntro"><em>Data Center 3.0 for the Networking Engineers</em></a> webinar ;)</p>
<h4>Summary</h4><p>Due to the current limitations, the <em>virtual chassis </em>offers no clear advantages over Cisco’s VSS or vPC solutions. However, the architecture (clean separation between control and data planes with numerous redundant paths between them) looks promising and once they manage to implement a reliable system beyond the two chassis, it will be a truly interesting solution.</p>
<p class="warn">It looks like the EX8200+XRE200 <em>virtual chassis </em>is still a <em>future</em>, not a <em>feature</em>. I could find no EX8200-related information in the <a href="http://www.juniper.net/techpubs/en_US/junos10.3/information-products/pathway-pages/ex-series/virtual-systems.html"><em>Virtual Chassis for the EX Series Switches</em></a><em> </em>JunOS documentation.</p>
