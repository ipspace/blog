---
title: "Can you run OSPF over DMVPN?"
date: "2010-12-22T07:21:00.000+01:00"
tags: [ DMVPN,OSPF,Workshop ]
---

<p>Ian sent me a really good OSPF-over-DMVPN question after watching the <a href="http://www.ioshints.info/Recordings">recording</a> of my <a href="http://www.ioshints.info/DMVPN">DMVPN webinar</a> (<a href="http://dmvpn.eventbrite.com/">register here for a live session</a>):</p>
<blockquote class="cite">In the DMVPN webinar you discuss OSPF design and configuration. However, Cisco design guide says you should use a different routing protocol from what you use on your LAN but you seem to suggest it is okay to extend your OSPF network out to the DMVPN edge by continuing to use OSPF albeit in a different area.</blockquote>
<p>The main issue you face when running OSPF over DMVPN is scalability: OSPF does not scale as well as other routing protocols when used over DMVPN.</p>
<!--more--><p>Because OSPF is a link-state protocol, the topology database of every spoke router has to contain full topology of the DMVPN area (and LSAs for all IP prefixes inserted into the area by ABRs) and if you believe a low-end router cannot handle more than 50 routers in an OSPF area (that’s the “classic” OSPF design recipe), you see how limited we are. Furthermore, DMVPN cloud has to be a single subnet, so all the spoke routers attached to the same DMVPN cloud have to be in the same OSPF area.</p>
<p class="info">You can implement <a href="http://blog.ioshints.info/2010/01/ospf-flooding-filters-in-hub-and-spoke.html">OSPF flood reduction</a> on the hub router in combination with reliable static default routing on the spokes to increase OSPF scalability.</p>
<p>You can make things a bit better by making the DMVPN area totally stubby (in which case you need Internet VRF for Phase 2 DMVPN), so at least the changes in the non-DMVPN part of the network are not causing SPFs (or partial SPFs).</p>
<p>According to <a href="http://www.cisco.com/web/strategy/docs/gov/IntegNet_Feb17_915_Lynn.pdf">Cisco’s presentations</a>, the number of spoke sites in an OSPF-based DMVPN can be pushed to low hundreds (I would seriously doubt that the low-end spokes would survive that, but maybe they would), while you can go above 500 with EIGRP and above 1000 with passive RIP.</p>
<h4>Summary</h4><p>OSPF over DMVPN works just fine as long as the number of spoke sites is low (I would keep it below 100, but it obviously depends on the CPU capabilities of the platform you’re using for the spoke sites), you keep the DMVPN subnet in a separate area and make that area a stub or totally stubby area. If you have a larger number of spoke sites, it makes more sense to go with a distance vector protocol and redistribution.</p>
<h4>More information</h4><p>You’ll find numerous <a href="http://blog.ioshints.info/2010/10/dmvpn-scalability.html">scalability recommendations</a> and various scalable DMVPN designs in my <a href="http://www.ioshints.info/DMVPN">DMVPN: From Basics to Scalability </a>webinar (<a href="http://dmvpn.eventbrite.com/">register here</a> or buy a <a href="http://www.ioshints.info/Recordings">recording</a>).</p>
<p>The question discussed in this blog post is also part of the <em>DMVPN Frequently Asked Questions </em>document that you get with the DMVPN webinar (see also the <a href="http://www.ioshints.info/Subscription/Materials?w=DMVPN">list of all materials associated with the DMVPN webinar</a>).</p>

