---
date: 2010-12-13T06:45:00.001+01:00
tags:
- DHCP
- IPv6
- workshop
title: DHCPv6 IA_PD relaying works with 12.2SRE2
url: /2010/12/dhcpv6-iapd-relaying-works-with-122sre2.html
---

<p>Last week I ran numerous lab tests while preparing router configurations for the <a href="http://www.ioshints.info/Building_IPv6_Service_Provider_Core"><em>Building IPv6 Service Provider Core</em></a><em> </em>webinar. One of the fantastic test results: DHCPv6 relaying works correctly on a 7200 running 12.2(33)SRE2, even when the client requests IA_PD option. </p>
<!--more--><p>Some of the limitations I’ve described in the “<a href="https://blog.ipspace.net/2010/10/dhcpv6-relaying-another-trouble-spot.html"><em>DHCPv6 relaying: another trouble spot?</em></a>” remain (PE router reload is still an issue and you cannot retain DHCPv6 relay bindings when a PPPoE session is disconnected because the associated virtual interface is deleted), but I would say Cisco got as far as they can within the current technological (DHCPv6) and architectural (virtual access interfaces) constraints.</p>
<p>After enabling DHCPv6 relay debugging on the PE-router, you can see relayed requests and static routes installed after the response from the DHCP server carrying IA_PD option is relayed back to the client:</p>
<pre class="code">PE-A#<strong>debug ipv6 dhcp relay </strong><br/>   IPv6 DHCP relay debugging is on<br/>PE-A#<br/>IPv6 DHCP_RELAY: Relaying SOLICIT from FE80::C802:8FF:FEA7:6 on<br/>  FastEthernet0/0.200<br/>IPv6 DHCP_RELAY: Packet forwarded to FEC0::CCCC:4<br/>IPv6 DHCP_RELAY: Relaying RELAY-REPLY from FEC0:1:1:13::2 on <br/>  Serial1/0<br/>IPv6 DHCP_RELAY: Packet forwarded to FE80::C802:8FF:FEA7:6 via <br/>  FastEthernet0/0.200<br/>PE-A#<br/>IPv6 DHCP_RELAY: Relaying REQUEST from FE80::C802:8FF:FEA7:6 on <br/>  FastEthernet0/0.200<br/>IPv6 DHCP_RELAY: Packet forwarded to FEC0::CCCC:4<br/>IPv6 DHCP_RELAY: Relaying RELAY-REPLY from FEC0:1:1:13::2 on <br/>  Serial1/0<br/>IPv6 DHCP_RELAY: Route added: FEC0:1:2310::/56 via <br/>  FE80::C802:8FF:FEA7:6 dist 1 iaid 00080001 lifetime 2592000<br/>IPv6 DHCP_RELAY: Packet forwarded to FE80::C802:8FF:FEA7:6 via <br/>  FastEthernet0/0.200</pre><p>You can inspect the relayed bindings stored by the PE-router with the <strong>show ipv6 dhcp relay binding </strong>command and the associated static routes with the <strong>show ipv6 route interface </strong><strong><em>name </em></strong>command:</p>
<pre class="code">PE-A#<strong>show ipv6 dhcp relay bind</strong><br/>Prefix: FEC0:1:2310::/56 (FastEthernet0/0.200)<br/>  DUID: 00030001CA0208A70008<br/>  IAID: 524289<br/>  lifetime: 2592000<br/>  expiration: 12:27:39 UTC Jan 10 2011<br/>PE-A#<strong>show ipv6 route int fa0/0.200</strong><br/>[ ... standard header ... ]<br/>C   FEC0:1:2301::/64 [0/0]<br/>     via FastEthernet0/0.200, directly connected<br/>L   FEC0:1:2301::1/128 [0/0]<br/>     via FastEthernet0/0.200, receive<br/>S   FEC0:1:2310::/56 [1/0]<br/>     via FE80::C802:8FF:FEA7:6, FastEthernet0/0.200</pre><p>But wait, it gets better: even if the interface goes down, the relay bindings are retained until they expire ... and the static routes to the delegated prefixes get reinstated once the interface state changes to <em>up</em>. It can’t get any better than that, can it?</p>
<pre class="code">%LINEPROTO-5-UPDOWN: Line protocol on Interface FastEthernet0/0, <br/>  changed state to down<br/>IPv6 DHCP_RELAY: Static route removed: FEC0:1:2310::/56 <br/>  via FE80::C802:8FF:FEA7:6<br/>PE-A#<br/>%LINEPROTO-5-UPDOWN: Line protocol on Interface FastEthernet0/0, <br/>  changed state to up<br/>IPv6 DHCP_RELAY: Static route added: FEC0:1:2310::/56 via <br/>  FE80::C802:8FF:FEA7:6</pre>

