---
url: /2012/02/6wind-solving-virtual-appliance.html
title: "6WIND: Solving the Virtual Appliance Performance Issues"
date: "2012-02-20T06:39:00.000+01:00"
tags: [ cloud,virtualization ]
---

<p>We all know that the performance of <a href="https://blog.ipspace.net/2011/04/virtual-network-appliances-benefits-and.html">virtual networking appliances</a> (firewalls, load balancers, routers ... running inside virtual machines) really sucks, right? Some vendors managed to <a href="https://blog.ipspace.net/2011/11/junipers-virtual-gateway-virtual.html">offload the packet-intensive processing into the hypervisor kernel</a>, getting way more bang for the buck, but that’s a pretty R&amp;D-intensive undertaking. </p>
<p>We also know that The Real Men use The Real Hardware (ASICs and FPGAs) to get The Real Performance, right? Wrong!<!--more--></p>
<p class="separator"><img src="http://upload.wikimedia.org/wikipedia/en/2/27/Harry_Callahan.JPG"/><br/>Real Men use Real Hardware</p>
<p>It turns out the generic Intel chipset is extremely powerful ... assuming you know how to use it, and that’s what <a href="http://www.6wind.com/">6WIND</a> has been <a href="http://www.6wind.com/about-us/our-customers">doing for the last decade</a> – among other things, they have acquired extensive experience with the Intel <a href="http://www.intel.com/p/en_US/embedded/hwsw/technology/packet-processing">Data Plane Development Kit</a> and wrote a full-blown TCP/IP stack on top of it.</p>
<p>So, what’s the big deal? It turns out nobody (<a href="https://blog.ipspace.net/2011/12/vmware-vswitch-baseline-of-simplicity.html">including VMware</a>) ever wanted to spend too much time getting the networking part of servers and operating systems right, so we’re burdened with a lasagna-like hodgepodge of just-good-enough-to-work layers, from device drivers through the whole Linux TCP/IP stack. </p>
<p>The <a href="http://www.6wind.com/products-services/6windgate-software">6WINDGate software</a> complements the whole Linux networking stack with a high-performance multi-core implementation that supports all <a href="http://www.6wind.com/products-services/6windgate-software/6windgate-software-modules#fp">data-plane</a> and <a href="http://www.6wind.com/products-services/6windgate-software/6windgate-software-modules#cp">control-plane protocols</a> you’ll ever need (unless you’re still stuck with AppleTalk). Interestingly enough, they can coexist with the TCP/IP stack in the Linux kernel – you don’t have to patch or rebuild the kernel to improve the performance, the <a href="http://www.6wind.com/products-services/6windgate-software/">6WINDGate software</a> installs its own parallel stack and intercepts API calls (for example, <a href="http://en.wikipedia.org/wiki/Netlink">Netlink</a> calls).</p>
<div class="separator" style="clear: both; text-align: center;"><a href="/2012/02/s1600-FP.jpg" imageanchor="1" style="margin-left:1em; margin-right:1em"><img border="0" height="232" src="/2012/02/s400-FP.jpg" width="400"/></a></div>
<p>Not surprisingly, you get amazing performance once you manage to squeeze the most out of the available hardware. They claim they can increase the performance of a Linux-based networking appliance by a factor of 10, and the performance scales linearly with the number of CPU cores allocated to run 6WINDGate fast path (which does make sense – packet/flow processing is a highly parallelized activity). They say they can share some performance results without an NDA – just contact them.</p>
<div class="separator" style="clear: both; text-align: center;"><a href="/2012/02/s1600-CP+and+DP.jpg" imageanchor="1" style="margin-left:1em; margin-right:1em"><img border="0" height="131" src="/2012/02/s400-CP+and+DP.jpg" width="400"/></a></div>
<p><strong>Summary:</strong> 6WIND claims you can get up to 10x more performance out of the existing commodity hardware by adding 6WINDGate stack to an existing bare-metal Linux-based appliance. But can they repeat that feat in the virtual space?</p>
<h4>Entering the Virtual World</h4><p><a href="http://www.linkedin.com/pub/david-le-goff/15/765/352">David Le Goff</a>, 6WIND’s product manager, was kind enough to walk me through 6WIND’s recent <a href="http://www.6wind.com/solutions/cloud-infrastructure">Cloud Infrastructure announcement</a>. Once you manage to get past the numerous layers of marketing messages, the solution is blindingly simple: if you want to have the performance you need, you have to bypass the hypervisor:</p>
<p>Step#1 – Install 6WINDGate software in the virtual appliance VM, and use your solution directly or integrate your own protocols with their fast path API;</p>
<p>Step#2 – Bypass the virtual switch and connect the data-path NICs of the virtual machine directly to the physical NICs using <a href="http://kb.vmware.com/selfservice/microsites/search.do?language=en_US&amp;cmd=displayKC&amp;externalId=1010789">VMDirectPath</a> or a Xen/Hyper-V equivalent.</p>
<div class="separator" style="clear: both; text-align: center;"><a href="/2012/02/s1600-6WIND_DirectIO.png" imageanchor="1" style="margin-left:1em; margin-right:1em"><img border="0" height="310" src="/2012/02/s400-6WIND_DirectIO.png" width="400"/></a></div>
<p>Obviously you need plenty of physical NICs in the server running the virtual appliances (or you use UCS blades with Palo chipset and Adapter FEX), and you can’t vMotion the appliance, but the performance differences should more than offset any inconveniences.</p>
<div class="separator" style="clear: both; text-align: center;"><a href="/2012/02/s1600-6WIND_AdapterFEX.png" imageanchor="1" style="margin-left:1em; margin-right:1em"><img border="0" height="310" src="/2012/02/s400-6WIND_AdapterFEX.png" width="400"/></a><br>You could use Adapter FEX (Cisco) or<br/>an equivalent solution from other vendors (EVB/VEPA?)</br></div>
<p>Tying physical NICs to guest VMs and bypassing the hypervisor vSwitch usually results in a loss of functionality – for example, you have to do your own VLAN tagging, using either the capabilities of the VM’s software, or by configuring a VLAN access port on the first-hop switch (external switch tagging – EST – in VMware lingo), but 6WINDGate does include VLAN- and MPLS tagging and GRE tunneling, and I wouldn’t mind a few extra configuration steps for a 10-time increase in performance.</p>
<div class="separator" style="clear: both; text-align: center;"><a href="/2012/02/s1600-6WIND_EST.png" imageanchor="1" style="margin-left:1em; margin-right:1em"><img border="0" height="400" src="/2012/02/s400-6WIND_EST.png" width="383"/></a></div>
<p>Finally, 6WIND can go one step further: if you have multiple VMs with 6WINDGate stack in the same hypervisor, they could bypass the hypervisor vSwitch. A VM using 6WINDGate can still communicate through vSwitch with other VMs or with the orchestration/management software while having high-speed communication with other VMs using 6WINDGate.</p>
<p>Intrigued? Interested? See a perfect fit between your cloudy needs and 6WIND’s software? Go talk to David.</p>
<h4>Need more information?</h4><ul class="ListParagraph"><li>The diagrams in this blog post were taken from the <a href="http://www.ipspace.net/VMware_Networking_Deep_Dive">VMware Networking Deep Dive</a> webinar, which explains all the details of VMware networking and related virtual appliances.</li>
<li>If you need a gentler introduction to virtualized networking world, watch the <a href="http://www.ipspace.net/Introduction_to_Virtualized_Networking">Introduction to Virtualized Networking</a> or <a href="http://www.ipspace.net/Cloud_Computing_Networking:_Under_the_Hood">Cloud Computing Networking – Under the Hood</a> webinars.</li>
<li>Don’t forget: you get access to all these webinars (and numerous others) if you buy the <a href="http://www.ipspace.net/Subscription">yearly subscription</a>.</li>
<li>Finally: if you ever need a second opinion, in-depth technology review or design help, there’s the <a href="http://www.ipspace.net/ExpertExpress">ExpertExpress service</a>.</li>
</ul>

