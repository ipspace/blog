---
date: 2012-05-09T08:06:00.000+02:00
tags:
- DMVPN
- workshop
title: NHRP Rate Limiting can hurt your DMVPN network
url: /2012/05/nhrp-rate-limiting-can-hurt-your-dmvpn.html
---

<p><a href="http://www.cisco.com/en/US/docs/ios-xml/ios/sec_conn_dmvpn/configuration/15-2mt/sec-conn-dmvpn-tun-mon.html#GUID-E968E183-0022-4E8C-89A6-69AE3AE2AFF9">NHRP-based interface state control</a> is a fantastic feature that you can use for faster convergence of very large DMVPN networks (as explained in the <a href="http://www.ipspace.net/DMVPN_Designs">DMVPN Designs</a> webinar, you can also use it to solve some interesting backup scenarios). We tested it in a network with over 1000 spokes (using ASR1K as the hub router) using very short registration timeouts, and the CPU utilization of the NHRP process rarely exceeded a few percents.<!--more--></p>
<p>However, the engineer doing the tests forgot to tell me a crucial bit of the puzzle – he had to tweak the NHRP rate limiting (configured with <strong>ip nhrp max-send</strong> command). This omission was gracefully pointed out by George Mihalachioaie who stumbled across the same problem during his DMVPN deployment.</p>
<p><strong>Summary:</strong> Having short registration timeouts in large NHRP networks is not a problem per-se (and NHRP-based interface state control may significantly simplify your design), but you have to know what you’re doing, and change the defaults. The <a href="http://www.cisco.com/en/US/docs/ios/ipaddr/command/reference/iad_nhrp.html#wp1011514">usage guidelines provided with the <strong>ip nhrp max-send </strong>command</a> should give you more than enough information ... and don’t forget that NHRP replies (not just requests) also count as NHRP packets.</p>

