---
title: "IPv6 ND Managed-Config-Flag is just a hint"
date: "2012-01-19T10:44:00.000+01:00"
tags: [ IPv6,Workshop ]
---

<p class="update">2012-01-19: The initial version of this post contained a serious error: Cisco IOS DHCPv6 server does not create host routes; without on-link prefix, the router cannot forward the packets to the attached end-hosts.</p>
<p>IPv6 hosts can use <em>stateless </em>or <em>stateful </em>autoconfiguration. <a href="http://blog.ioshints.info/2011/10/ipv6-stateless-autoconfiguration-101.html">Stateless address autoconfiguration (SLAAC) uses IPv6 prefixes from Router Advertisement (RA) messages</a>; stateful autoconfiguration uses DHCPv6. The routers can use two flags in RA messages to tell the attached end hosts which method to use:<!--more--></p>
<ul class="ListParagraph"><li>Managed-Config-Flag tells the end-host to use DHCPv6 exclusively;</li>
<li>Other-Config-Flag tells the end-host to use <a href="http://blog.ioshints.info/2011/02/dhcpv6slaacra-dhcpv4.html">SLAAC to get IPv6 address and DHCPv6 to get other parameters</a> (DNS server address, for example).</li>
<li>Absence of both flags tells the end-host to use only SLAAC.</li>
</ul>
<p>One might assume that setting <em>managed-config-flag </em>in RA messages forces IPv6 hosts to use DHCPv6. Wrong, the two flags are just a polite suggestion.<!--more--></p>
<p>Let’s start with the <a href="http://tools.ietf.org/html/rfc4294">IPv6 Node Requirements</a> (RFC 4294). <a href="http://tools.ietf.org/html/rfc4294#section-4.5">Section 4.5</a> is very explicit: SLAAC <em>must </em>be supported, DHCPv6 <em>may </em>be supported.</p>
<p><a href="http://tools.ietf.org/html/rfc4861">RFC 4861</a> (IPv6 Neighbor Discovery) uses similarly non-committal language in <a href="http://tools.ietf.org/html/rfc4861#section-4.2">Section 4.2</a>: M flag indicates <em>addresses are available DHCPv6</em>, nothing more.</p>
<p>Can you enforce the use of DHCPv6 in case you want to track end-user IPv6 addresses for security/accountability reasons? Sure you can (there’s a workaround for every problem) – if you don’t advertise on-link prefixes in router advertisement messages, the hosts cannot auto-generate IPv6 addresses and are forced to use DHCPv6, or stay forever isolated from the beauties of IPv6-only Internet.</p>
<p class="note">You have to configure IPv6 prefix on the LAN interface and disable its propagation with the <strong>ipv6 nd prefix no-advertise</strong> interface configuration command – DHCPv6 server does not create host routes toward its clients.</p>
<p>To enforce DHCPv6-only address configuration in Cisco IOS, use the following interface configuration:</p>
<pre class="code">interface FastEthernet0/0.100<br/> description Host Access LAN (VLAN 100)<br/> encapsulation dot1Q 100<br/> ipv6 address FEC0:1:2300:1::1/64<br/> ipv6 nd prefix FEC0:1:2300:1::/64 no-advertise<br/> ipv6 nd managed-config-flag<br/> ipv6 nd router-preference High<br/> ipv6 dhcp server VLAN_100</pre><h4>More information</h4><p>Many more IPv6 access network hints are described in my new <a href="http://spipv6-blog.eventbrite.com/"><em>Building </em><em>L</em><em>arge IPv6 Access Networks</em></a> webinar (and you get access to the recording of the <a href="http://www.ipspace.net/Building_IPv6_Service_Provider_Core"><em>Building IPv6 Service Provider Core</em></a><em> </em>webinar when you register).</p>
<p>I can <a href="http://www.ipspace.net/ExpertExpress">help you with the design or implementation details</a>,  or you could <a href="http://www.nil.com/solutions/ipv6-deployment-services/">engage our professional services team in a full-blown network design/implementation project</a>.</p>

