---
url: /2012/01/dhcpv6-prefix-delegation-with-radius.html
title: "DHCPv6 Prefix Delegation with Radius works in IOS release 15.1"
date: "2012-01-19T13:52:00.001+01:00"
tags: [ DHCP,IPv6,PPP,Workshop ]
---

<p>A while ago I described the <a href="https://blog.ipspace.net/2011/03/dhcpv6-radius-integration-cisco-way.html">pre-standard way Cisco IOS used to get delegated IPv6 prefixes from a RADIUS server</a>. Cisco’s documentation <a href="http://www.cisco.com/en/US/prod/collateral/iosswrel/ps8802/ps6968/ps6350/prod_bulletin0900aecd802eaa4f.html">always claimed</a> that Cisco IOS implements <a href="http://tools.ietf.org/html/rfc4818">RFC 4818</a>, but you simply couldn’t get it to work in IOS releases 12.4T or 15.0M. In December I wrote about the <a href="https://blog.ipspace.net/2011/12/dhcpv6-server-on-cisco-ios-making.html">progress Cisco is making on the DHCPv6 front</a> and <em>iord@intracom.com</em><em> </em>commented that IOS 15.1S does support RFC 4818. You know I absolutely had to test that claim ... and it’s true!<!--more--></p>
<p>This is the configuration you can use on the PE-router:</p>
<pre class="code">aaa authorization configuration IA_PD group radius<br/>!<br/>ipv6 dhcp pool PPP-Radius<br/> prefix-delegation aaa method-list IA_PD lifetime 7200 300<br/> dns-server FEC0::CCCC:4<br/> domain-name example.com<br/>!<br/>interface Virtual-Template10<br/> mtu 1480<br/> no ip address<br/> ipv6 enable<br/> ipv6 nd other-config-flag<br/> no ipv6 nd ra suppress<br/> ipv6 dhcp server PPP-Radius</pre><p>And this is the FreeRADIUS user definition:</p>
<pre class="code">Site-A  Cleartext-Password := "Site-A"<br/>        Service-Type = Framed-User,<br/>        Framed-Protocol = PPP,<br/>        Framed-IPv6-Prefix = "fec0:1:2400:1::/64",<br/>        Delegated-IPv6-Prefix = "fec0:1:2400:1100::/56"</pre><p>Cisco IOS release 15.1(3)S that I used in the tests also supports a fallback mechanism:</p>
<ul class="ListParagraph"><li>The value of the <em>Delegated-IPv6-Prefix</em> from the RADIUS reply is saved in a per-interface DHCPv6 block;</li>
<li>When the PPPoE client uses DHCPv6 to get a delegated prefix, PE-router checks the pre-populated DHCPv6 reply associated with the incoming interface. If the delegated prefix is already in there, it returns the reply without querying the RADIUS server;</li>
<li>If the delegated IPv6 prefix is not yet available, the PE-router uses the pre-standard method and sends <a href="https://blog.ipspace.net/2011/03/dhcpv6-radius-integration-cisco-way.html">another RADIUS request for the <em>user-</em>dhcpv6<em> </em>username</a>.</li>
</ul>
<p class="note">According to Cisco’s documentation, you get the same functionality (RFC 4818 support) in IOS XE release 3S.</p>
<h4>More information</h4><p>You’ll get more IPv6 access network design and configuration guidelines in my new <a href="http://spipv6-blog.eventbrite.com/"><em>Building Large IPv6 Access Networks</em></a> webinar (you also get immediate access to the recording of the <a href="http://www.ipspace.net/Building_IPv6_Service_Provider_Core"><em>Building IPv6 Service Provider Core</em></a><em> </em>webinar when you register).</p>

