---
url: /2012/01/bgp-free-service-provider-core-in.html
title: "BGP-Free Service Provider Core in Pictures"
date: "2012-01-11T07:04:00.000+01:00"
tags: [ MPLS,IPv6,BGP ]
---

<p>I got a follow-up question to the <a href="http://blog.ioshints.info/2012/01/should-i-use-6pe-or-native-ipv6.html"><em>Should I use 6PE or native IPv6</em></a> post: “<em>Am I remembering correctly that if you run IPv6 native throughout the network you need to enable BGP on all routers, even P routers? Why is that?</em>” I <a href="http://blog.ioshints.info/2008/03/use-mpls-to-scale-your-internet.html">wrote about BGP-free core before</a>, but evidently wasn’t clear enough, so I’ll try to fix that error.<!--more--></p>
<p>Imagine a small ISP with a customer-facing PE-router (A), two PE-routers providing upstream connectivity (B and D), a core router (C), and a route reflector (R). The ISP is running IPv4 and IPv6 natively (no MPLS).</p>
<div class="separator" style="clear: both; text-align: center;"><img border="0" src="/2012/01/s400-BGP_FC_1.png"/></div>
<p>When an end-customer sends a packet toward an Internet destination (a Facebook server, for example), each router in the ISP network has to examine the packet, perform destination address lookup in its <a href="http://blog.ioshints.info/2010/09/ribs-and-fibs.html">forwarding table</a> (FIB), and forward the packet toward the next hop.</p>
<p>Assuming the ISP is not running BGP on the core router, the core router is not aware of any destination outside of its own AS, and thus drops the packet sent toward Facebook.</p>
<div class="separator" style="clear: both; text-align: center;"><img border="0" src="/2012/01/s400-BGP_FC_2.png"/></div>
<p>You can use default routing as a problem-solving kludge (B and D advertise default routes into the ISP’s network), or deploy BGP on the core router (C).</p>
<p>After a BGP session between C and R is configured, C receives all global BGP routes, and is able to forward packets toward external destinations:</p>
<div class="separator" style="clear: both; text-align: center;"><img border="0" height="192" src="/2012/01/s400-BGP_FC_3.png" width="400"/></div>
<p>There is another solution: if you deploy MPLS in the network, LDP automatically builds virtual circuits (Label Switched Paths – LSP) between any two routers.</p>
<p class="note">Cisco IOS builds LSPs for all IGP destinations, Junos only for the loopback interfaces. More details in <a href="http://blog.ioshints.info/2011/11/junos-versus-cisco-ios-mpls-and-ldp.html"><em>Junos and Cisco IOS: MPLS and LDP</em></a>, and <a href="http://blog.ioshints.info/2011/12/junos-day-one-mpls-behind-scenes.html"><em>Junos Day One: MPLS behind the scenes</em></a>.</p>
<p>Ingress PE-routers use LSPs toward BGP next hops to send packets toward external destinations learned through BGP. The core router (C) thus receives labeled packet that it can switch toward the next hop without inspecting the destination IPv4 or IPv6 address, and thus there is no need to run BGP on C.</p>
<div class="separator" style="clear: both; text-align: center;"><img border="0" height="216" src="/2012/01/s400-BGP_FC_4.png" width="400"/></div>
<p class="note">The last core router might send labeled or unlabeled IP packet (due to <a href="http://blog.ioshints.info/2011/07/penultimate-hop-popping-php-demystified.html">penultimate hop popping</a>) to the egress PE-router. You can <a href="http://wiki.nil.com/Implicit_and_explicit_NULL_in_MPLS_networks">influence this behavior with <strong>mpls ldp explicit- null</strong></a><strong> </strong>configuration command.</p>
<h4>Need help?</h4><p>If you need a second opinion or a review of your MPLS or BGP design, check out the <a href="http://www.ipspace.net/ExpertExpress">ExpertExpress service</a>. You could also <a href="http://www.nil.com/solutions/">engage our professional services team in a full-blown network design/implementation project</a> or <a href="http://www.nil.com/solutions/content-customization-and-development/">customized</a> on-site training/design workshop.</p>

