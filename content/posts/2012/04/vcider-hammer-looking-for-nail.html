---
url: /2012/04/vcider-hammer-looking-for-nail.html
title: "vCider: A Hammer Looking For a Nail?"
date: "2012-04-12T07:39:00.000+02:00"
tags: [ Design,cloud,load balancing,virtualization ]
---

<p>Last week <a href="http://blog.vcider.com/author/juergen/">Juergen Brendel</a> published an interesting blog post describing how you can <a href="http://blog.vcider.com/2012/04/multi-cloud-ip-address-failover-with-heartbeat-and-vcider/">use vCider to implement high-availability clusters with multi cloud strategy</a>, triggering the following response from one of my readers: “<em>I hadn't heard of vCider before but seeing stuff like this always makes me doubt my sanity – is there really a situation where the only solution is multi-site L2?</em>”<!--more--></p>
<h4>A short diversion</h4><p>Before someone starts accusing me of being a grumpy L3 grunt, let me point out that I was probably the first one blogging about the <a href="https://blog.ipspace.net/2011/06/vcider-climbing-virtual-networking.html">technical details of vCider</a> (triggering an <a href="https://blog.ipspace.net/2012/03/stretched-layer-2-subnets-server.html">interesting response from a very experienced server admin</a>). The vCider solution is also described in more details in my <a href="http://www.ipspace.net/CloudNet">Cloud Computing Networking</a> webinar.</p>
<div class="separator" style="clear: both; text-align: center;"><a href="/2012/04/s1600-vCider.jpg" imageanchor="1" style="margin-left:1em; margin-right:1em"><img border="0" height="300" src="/2012/04/s400-vCider.jpg" width="400"/></a><br/>vCider architecture slide from the <a href="http://www.ipspace.net/CloudNet">Cloud Computing Networking webinar</a></div>
<p class="info">The vCider solution is definitely worth considering if you need private connectivity between VMs running in different clouds – it’s much easier to use something like vCider than to build a full mesh of VPN tunnels. However, just because you have a hammer doesn’t mean that every problem is a nail.</p>
<h4>Back to Multi-cloud high-availability scenario</h4><p>Juergen described the following scenario (please do <a href="http://blog.vcider.com/2012/04/multi-cloud-ip-address-failover-with-heartbeat-and-vcider/">read his blog post for details</a>):</p>
<ul class="ListParagraph"><li>You’re running a high-availability enterprise service in the IaaS cloud;</li>
<li>Service VMs are deployed in two different cloud environments to provide resiliency against cloud provider failure;</li>
<li>The service is accessed from your enterprise network through a gateway server that has a physical (or virtual) NIC in your network and a vCider virtual interface;</li>
<li>Linux heartbeat (IP address sharing based on L2 tricks like Gratuitous ARP) is used to implement the HA cluster.</li>
</ul>
<h4>What’s wrong with the HA idea?</h4><p><strong>Cloud provider failure is the least probable failure</strong>. Amazon failures always provide sensationalist headlines to IT yellow press, but it’s more likely something else will fail first ... like the network connectivity, which will immediately lead to split-brain cluster. <a href="https://blog.ipspace.net/2011/06/stretched-clusters-almost-as-good-as.html">Stretched cluster were never a good idea</a> and wrapping them in a <a href="http://etherealmind.com/cloud-security-blanket/">cozy cloud blanket</a> doesn’t make them any better.</p>
<div class="separator"><img src="http://networkingnerd.files.wordpress.com/2011/03/blanket1.jpg?w=400"/><br/><a href="http://networkingnerd.net/2011/03/06/my-buzzword-security-blanket/">Cloud Security Blanket</a> graciously provided by <a href="http://networkingnerd.net/">The Networking Nerd</a>.</div>
<p><strong>What </strong><strong>about storage?</strong> The networking nerds tend to <a href="http://blog.fosketts.net/2012/01/16/virtual-machine-mobility-state/">ignore the storage issues</a> (because <a href="https://twitter.com/tbourke/status/186894524503699456">storage is not funny</a>), but high availability clusters work well only if the servers have access to the same data. How will you implement data replication between two cloud providers? You could use an application-layer solution that makes sense (like database replication, mirroring or <a href="http://msdn.microsoft.com/en-us/library/ms187016.aspx">log shipping</a>), but then you probably don’t need HA cluster functionality (because the application can take care of itself).</p>
<p><strong>Ever heard of load balancers?</strong> Layer-2 HA clusters are needed in environments where the clients have to access the servers directly (thus requiring IP address migration between servers). In most cases, load balancers are a better choice, and they allow you to implement active/active designs (should your application happen to support them). </p>
<p>In the particular scenario described by Juergen it would be much simpler to achieve the goals he stated with a load balancer (because his scenario already has a gateway server between clients and vCider subnet), and there are plenty of open-source solutions available if you can’t afford to buy a commercial product to support your high-availability application ... but then you wouldn't need vCider.</p>
<h4>Not everyone is a layer-2 fan</h4><p>Fortunately, not everyone is a layer-2 fan. Quick Google search returned wealth of Linux high availability solutions, none of the requiring L2 connectivity between servers. Here are just a few of them:</p>
<ul class="ListParagraph"><li><a href="http://www.linuxvirtualserver.org/whatis.html">Linux Virtual Server</a> uses a front-end load balancer. Back-end can be implemented with any clustering technology (including Linux-HA).</li>
<li><a href="http://www.linux-ha.org/doc/users-guide/users-guide.html">Linux-HA</a> uses <a href="http://linux.die.net/man/8/heartbeat">heartbeat</a> to implement the cluster messaging layer and heartbeat runs on <a href="http://www.linux-ha.org/doc/users-guide/_components.html#_communication_module">UDP/IPv4</a> (you might need layer-2 if you want to use broadcast UDP, but there are always other options).</li>
</ul>
<h4>Summary</h4><p>I still haven’t seen a viable (let alone robust) scenario that would require stretched layer-2 subnets. Linux clusters definitely don’t need them (neither does the <a href="https://blog.ipspace.net/2011/06/multisite-clusters-done-right-by-none.html">Microsoft’s Windows Server Failover Cluster</a>). Long-distance layer-2 subnets make sense as a transport solution (VPLS and DMVPN come to mind), but not as an infrastructure for a HA cluster.</p>

