---
date: 2012-03-28T15:19:00.000+02:00
tags:
- design
- DMVPN
- workshop
title: Migrating from Phase 1 DMVPN to Phase 2/3 network
url: /2012/03/migrating-from-phase-1-dmvpn-to-phase.html
---

<p>Chris sent me an interesting question that I haven’t covered in any of my DMVPN webinars: “How would you migrate a part of a Phase-1 DMVPN network to a Phase-2 or Phase-3 network if you can only migrate one spoke site at a time? Can I just upgrade the spokes that need spoke-to-spoke connectivity?”</p>
<p>While it might be theoretically possible to have a mixed Phase-1/Phase-2 DMVPN tunnel (and I just might be able to get it to work in a lab), such a solution definitely violates the <a href="http://en.wikipedia.org/wiki/KISS_principle">KISS principle</a>.<!--more--></p>
<p>I would prefer to create a second Phase-2/3 DMVPN tunnel on the hub router(s) and migrate spoke sites that need any-to-any connectivity to this new Phase-2/3 DMVPN tunnel. The new tunnel would be used in parallel with the old one, and you could keep both of them running in parallel, or shut and remove the old one after all the spokes have been migrated to Phase 2/3 DMVPN.</p>
<div class="separator"><img src="http://upload.wikimedia.org/wikipedia/commons/thumb/2/2b/Waders_in_flight_Roebuck_Bay.jpg/800px-Waders_in_flight_Roebuck_Bay.jpg" width="400"/><br/>Unfortunately you can't migrate DMVPN spokes in flocks</div>
<p>Interestingly, the second tunnel does not diminish the network performance. In a Phase-1 DMVPN network all the traffic goes through the hub anyway, so it doesn't matter if you have one or more tunnels on the hub router – changing the tunnel interface while forwarding an IP packet does not impact the forwarding performance. Creating a new DMVPN tunnel on the hub router thus doesn't cause any change in performance or traffic flow.</p>
<p class="info">Be careful if you're using Cat 6500 as the hub, in which case you have to use a trick or two to ensure tunnels have different transport IP addresses so you're not forced to use GRE keys. </p>
<p class="warn">You might need two tunnel transport IP addresses anyway if you don't use GRE keys in your existing setup.</p>
<h4>More information</h4><p>You’ll find (almost) all you need to know about DMVPN in the <a href="http://www.ipspace.net/DMVPN_trilogy"><em>DMVPN Trilogy</em></a>, which is (like all other webinars) also part of the <a href="http://www.ipspace.net/Subscription">yearly subscription</a>.</p>

