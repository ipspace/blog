---
title: "Do We Need QoS in the Data Center?"
date: "2015-02-27T08:57:00.000+01:00"
tags: [ Data Center,load balancing,QoS ]
---

<p>Whenever I get asked about QoS in the data center, my stock reply is &ldquo;<em>bandwidth is cheaper than QoS-induced complexity</em>.&rdquo; This is definitely true in most cases, and ideally the <a href="http://blog.ipspace.net/2014/06/mice-elephants-and-virtual-switches.html">elephant problems</a> should be <a href="http://blog.ipspace.net/2015/01/load-balancing-elephant-storage-flows.html">solved higher up in the application stack</a>, not with network-layer kludges, but are there situations where you actually need data center QoS?<!--more--></p>
<p><a href="http://en.wikipedia.org/wiki/Explicit_Congestion_Notification">Congestion detection and TCP ECN marking</a> might be a good use case and can be done with minimal interface configuration &ndash; all it takes is a few configuration lines on Arista EOS and Cisco Nexus OS. <a href="https://tools.ietf.org/html/draft-bensley-tcpm-dctcp-01">Data Center TCP</a> uses ECN markings to detect congestion and reduce transmission rate before packets get dropped (packets drops could result in <a href="http://blog.ipspace.net/2014/03/per-packet-load-balancing-interferes.html">not-so-insignificant performance degradation because they kick the NICs out of TCP offload mode</a>).</p>
<p>There might be cases where you need QoS to reduce latency, but I don&#x2019;t think VoIP qualifies. At 10Gbps speeds, you need 1 MB of packets sitting in the output queue to generate an additional millisecond of latency.</p>
<p>Finally, if you&#x2019;re forced to implement queuing to reduce the impact of elephant flows (for example), insist on behaving like a service provider and keeping the network configuration as clean as possible &ndash; police ingress traffic (if needed) and queue packets based on <a href="http://blog.ipspace.net/2013/09/overlay-networks-and-qos-fud.html">DSCP or 802.1p markings</a>. Application-aware processing (hopefully resulting in DSCP marking) <a href="http://blog.ipspace.net/2014/07/vmware-vswitch-and-8021p-cos-value.html">belongs to hypervisors</a> or the end-hosts, not to the ToR switch.</p>
<p>Anything else? Share your thoughts in the comments.</p>

