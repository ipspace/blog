---
url: /2015/06/another-spectacular-layer-2-failure.html
title: "Another Spectacular Layer-2 Failure"
date: "2015-06-18T09:00:00.000+02:00"
tags: [ bridging, high availability ]
---

<p><a href="https://www.linkedin.com/in/matjaz6">Matjaž Straus</a> started the <a href="http://www.sinog.si">SINOG 2 meeting</a> I attended last week with a great story: during the RIPE70 meeting (just as I was flying home), <a href="https://ams-ix.net">Amsterdam Internet Exchange</a> (AMS-IX) crashed.</p>
<p>Here’s how the AMS-IX failure impacted ATLAS probes (world-wide monitoring system run by RIPE) – no wonder, as RIPE uses AMS-IX for their connectivity.<!--more--></p>
<div class="separator"><a href="/2015/06/s1600-619DA045-CC2B-4ED4-926A-3CDBC6EC00FA.png" imageanchor="1"><img border="0" src="/2015/06/s400-619DA045-CC2B-4ED4-926A-3CDBC6EC00FA.png"/></a></div>
<p>My friend Jeremy Stretch saved the daily traffic graph for posterity in one of his tweets:</p>
<div class="separator"><a href="/2015/06/s1600-5C1D9D2B-88B9-4AF1-9876-E906431FBBB6.png" imageanchor="1"><img border="0" src="/2015/06/s400-5C1D9D2B-88B9-4AF1-9876-E906431FBBB6.png"/></a></div>
<p>As you can see from the graph, Internet lost 2 Tbps of transit capacity, and many networks using AMS-IX (including some cloud services providers) were severely impacted.</p>
<p>You might wonder what the root cause for the outage was. Here’s the relevant tweet:</p>
<div class="separator"><a href="/2015/06/s1600-285C27B7-B885-4FA3-BD46-A2DA4092C2E6.png" imageanchor="1"><img border="0" src="/2015/06/s400-285C27B7-B885-4FA3-BD46-A2DA4092C2E6.png"/></a></div>
<p>As I said many times before, it’s not a question of <em>whether </em>a <a href="http://blog.ipspace.net/2012/05/layer-2-network-is-single-failure.html">large layer-2 fabric</a> will crash, it’s only the <a href="http://blog.ipspace.net/2012/10/if-something-can-fail-it-will.html">question of <em>when </em>and <em>how badly</em></a>. </p>
<p>Also, keep in mind that there are a few significant differences between AMS-IX and clueless geniuses that tell you to build large layer-2 fabric (hopefully stretched across two data centers):</p>
<ul class="ListParagraph"><li>AMS-IX is one of the large Internet exchanges and they usually know what they’re doing… and still bad things happen;</li>
<li>AMS-IX has been in business for almost 20 years and thus has significant operational experience. They’ve learned loads of lessons during past outages and have built their own tools (like ARP sponge) to make their infrastructure more reliable;</li>
<li>Internet exchanges that don’t want to dictate routing policies of their members have to be layer-2 fabrics (the proof is left as an exercise for the reader), while your data center doesn’t have to be.</li>
</ul>
<h4>Want even more horror stories?</h4><p><a href="https://twitter.com/sanjuanswan/status/609341083403706369">Jay Swan pointed me to a recent Cisco Live presentation</a> (BRKDCT-3102), which documented several interesting layer-2 failures, including a split-brain cluster – I was <a href="http://blog.ipspace.net/2011/04/distributed-firewalls-how-badly-do-you.html">telling people</a> about <a href="http://blog.ipspace.net/2011/06/stretched-clusters-almost-as-good-as.html">these scenarios</a> for years, and it’s so nice to have corroboration from a major vendor (not sure what the evangelists of layer-2 fabrics and DCI solutions working for that same vendor think about that presentation ;).</p>

