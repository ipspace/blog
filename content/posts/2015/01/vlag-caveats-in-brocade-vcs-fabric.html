---
date: 2015-01-20T08:22:00.000+01:00
tags:
- link aggregation
- data center
- fabric
title: vLAG Caveats in Brocade VCS Fabric
url: /2015/01/vlag-caveats-in-brocade-vcs-fabric.html
---

<p>Brocade VCS fabric has one of the most flexible multichassis link aggregation group (LAG) implementation – you can terminate member links of an individual LAG on any four switches in the VCS fabric. Using that flexibility is not always a good idea.</p>
<p class="update">2015-01-23: Added a few caveats on load distribution<!--more--></p>
<p>I <a href="/2012/04/monkey-design-still-doesnt-work-well.html">documented some pitfalls</a> of too much flexibility in a blog post almost three years ago, and spent significant time describing the caveats of using haphazard vLAG during the <a href="http://www.ipspace.net/Data_Center_Fabrics_Update">Data Center Fabrics update session</a> last May. </p>
<p class="note">The challenges described in the blog post and the video are not Brocade’s fault – they just give you plenty of rope to hang yourself if you believe it’s a good idea to implement a network without spending time on a proper design.</p>
<p>The <a href="http://content.ipspace.net/get/X2%20-%20vLAG%20Caveats%20Brocade%20VCS%20Fabric.mp4">video describing the impact of slapdash vLAG</a> is now publicly available on <a href="http://content.ipspace.net/bin/start">ipSpace.net content site</a>.</p>
<h4>Getting more precise</h4><p>One of my readers sent me a very valid observation:</p>
<blockquote class="cite">Now my question is why you assume 50% of traffic from Server A goes to one link to 1 and 50% of traffic goes to the other link to 2? With vLAG there is still LAG algorithm deciding which frame will go where on the NIC card of the server itself. </blockquote>
<p>He's absolutely correct, so let's be more precise. The load on each link is not exactly 50% (or 25% or 75%) but half of the ECMP/LAG buckets are pointing to one outbound link and half of the buckets are pointing to the other link. Until VCS Fabric has LAG/ECMP traffic distribution based on end-to-end link utilization, the expected results aren’t too far off from what I explained in the video assuming a large number of <a href="/2014/06/mice-elephants-and-virtual-switches.html">mice flows</a>. All bets are off if you're sending only a few elephant flows over the fabric.</p>
<h4>Want to know more?</h4><style>table.fmtTable * p { margin: 0.1em 0; }</style><table class="fmtTable"><tr class="TRFirst"><th class="TDHead" valign="top"><p>If you need…</p>
</th><th class="TDHead" valign="top"><p>…then</p>
</th></tr></table><tr><td valign="top"><p>Introduction to data center networking technologies</p>
</td><td valign="top"><p>Watch <a href="http://www.ipspace.net/DC30">Data Center 3.0</a> webinar</p>
</td></tr><tr><td valign="top"><p>Overview of data center fabric solutions from leading networking vendors</p>
</td><td valign="top"><p>Watch <a href="http://www.ipspace.net/Data_Center_Fabrics">Data Center Fabrics</a> webinar</p>
</td></tr><tr><td valign="top"><p>Design guidelines when building leaf-and-spine fabric</p>
</td><td valign="top"><p>Watch <a href="http://www.ipspace.net/Leaf-and-Spine_Fabric_Architectures">Leaf-and-Spine Fabric Architectures</a></p>
</td></tr><tr><td valign="top"><p>Even more design guidelines</p>
</td><td valign="top"><p>Read the <a href="http://www.ipspace.net/Data_Center_Design_Case_Studies">Data Center Design Case Studies </a>book</p>
</td></tr><tr><td>... all of the above?</td><td>Buy the <a href="http://www.ipspace.net/Subscription">ipSpace.net subscription</a>.</td></tr><tr class="TRLast"><td class="TDLast" valign="top"><p>Architectural or design advices, design validation of second opinion</p>
</td><td class="TDLast" valign="top"><p>Use my <a href="http://www.ipspace.net/ExpertExpress">ExpertExpress service</a></p>
</td></tr><div class="jump-link"><a href="http://content.ipspace.net/get/X2%20-%20vLAG%20Caveats%20Brocade%20VCS%20Fabric.mp4">Watch the video</a></div>

