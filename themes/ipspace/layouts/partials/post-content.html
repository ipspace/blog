{{ $full := .Scratch.Get "ArticleContext" }}
<div class='post__item'>
  <article class='post' itemscope='' itemtype='http://schema.org/BlogPosting'>
    <header class='post__header'>
      <p class='post__date'>
        <a class='timestamp-link' href="{{ .Permalink }}" title='permanent link'>
          <time datetime='{{ .Date.Format "Monday, January 2, 2006 15:04 MST" }}' itemprop='datePublished'>
            {{ .Date.Format "Monday, January 2, 2006 15:04 MST" }}</time>
        </a>{{ if ne .PublishDate .Lastmod }}&hellip;
          updated on {{ .Lastmod.Format "Monday, January 2, 2006 15:04 MST" }}
        {{ end }}
      </p>
      <h2 class='post__title' itemprop='name headline'>
        <a href="{{ .Permalink }}">{{ .Title }}</a>
      </h2>
    </header>
    <div class='post__content' itemprop='articleBody'>
      {{ $truncated := and .Truncated (not $full) }}
      {{ if $truncated }}
        {{ .Summary }}
      {{ else }}
        {{ if and $full .Truncated (and .File (eq .File.Extension "html")) }}
          {{ .Summary }}
        {{ end }}
        {{ .Content }}
      {{ end }}
    </div>
    {{ if $truncated }}
      <a class="post__read-more" href="{{ .RelPermalink }}">
        read more
        <svg class="post__arrow-icon">
          <use xlink:href="#arrow-right-orange" xmlns:xlink="http://www.w3.org/1999/xlink"></use>
        </svg>
      </a>
    {{ end }}
    {{ if not $full }}
      {{ $url := urls.Parse .Permalink }}
      {{ $plink := .Permalink }}
      {{ with index .Site.Data.comment_count $url.Path }}
        <a class="post__comment-link" href="{{ $plink }}#comments">
          <svg class="post__comments-icon">
            <use xlink:href="#icon-comments"></use>
          </svg>
            see {{ . }} comments
        </a>
      {{ else }}
        <a class="post__comment-link" href="{{ $plink }}#comments">
          <svg class="post__comments-icon">
            <use xlink:href="#icon-comments"></use>
          </svg>
            add comment
        </a>
      {{ end }}
    {{ else }}
      {{ partial "post-series.html" . }}
    {{ end }}
    <div style='clear: both;'></div>
    <!-- comments -->
    <div class='post__meta'>
      {{ partial "post-share.html" . }}
      {{ with .Params.media }}
        <audio src="{{ . }}" controls="controls" preload="none"></audio>
      {{ end }}
      {{ partial "post-tags.html" . }}
    </div>
  </article>
</div>