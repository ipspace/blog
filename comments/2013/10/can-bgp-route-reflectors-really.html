<div class="comments post" id="comments">
  <h4>9 comments:</h4>
  <div class="comments-content">
    <div class="comment-thread">
        <ol>
      <div>
        <li class="comment" id="5898219983034033720">
          <div class="comment-block">
            <div class="comment-header">
              <cite class="user"><a href="" rel="nofollow">Anonymous</a></cite>
              <span class="datetime secondary-text">
                <a rel="nofollow" id="c5898219983034033720" href="#5898219983034033720">08 October 2013 08:52</a>
              </span>
            </div>
            <div class="comment-content">Try to follow the physical topology, always peer clients with at least two RRs. If you can afford it (RIB wise) use unique cluster-ID. If using MPLS VPN use unique RD per VRF per PE.<br /><br />Would you agree with the above statements?</div>
              <div class="comment-replies">
                <div class="comment-thread inline-thread">
                  <span class="thread-count"><a>Replies</a></span>
                    <ol>
      <div>
        <li class="comment" id="8832386002536454288">
          <div class="comment-block">
            <div class="comment-header">
              <cite class="user"><a href="https://www.blogger.com/profile/13457151406311272386" rel="nofollow">Ivan Pepelnjak</a></cite>
              <span class="datetime secondary-text">
                <a rel="nofollow" id="c8832386002536454288" href="#8832386002536454288">08 October 2013 10:13</a>
              </span>
            </div>
            <div class="comment-content">Sounds like a good plan ;)</div>
          </div>
        </li>
      </div>
  </ol>

                </div>
              </div>
          </div>
        </li>
      </div>
      <div>
        <li class="comment" id="5369717873369666048">
          <div class="comment-block">
            <div class="comment-header">
              <cite class="user"><a href="" rel="nofollow">Anonymous</a></cite>
              <span class="datetime secondary-text">
                <a rel="nofollow" id="c5369717873369666048" href="#5369717873369666048">09 October 2013 00:41</a>
              </span>
            </div>
            <div class="comment-content">Just ensure routers peer with both RRs. They either have both or none. <br />It&#39;s difficult to emulate something similar in production...<br /><br />Nikolay</div>
          </div>
        </li>
      </div>
      <div>
        <li class="comment" id="6856023878872324607">
          <div class="comment-block">
            <div class="comment-header">
              <cite class="user"><a href="" rel="nofollow">Ianislav Trendafilov</a></cite>
              <span class="datetime secondary-text">
                <a rel="nofollow" id="c6856023878872324607" href="#6856023878872324607">09 October 2013 09:34</a>
              </span>
            </div>
            <div class="comment-content">I solve this by setting SOO community on the E1/E2 routers. SOO is copied to OSPF using a route tag (if OSPF is used as PE-CE protocol).<br /><br />http://www.cisco.com/en/US/docs/ios/12_4t/12_4t11/htbgpsoo.html<br /></div>
          </div>
        </li>
      </div>
      <div>
        <li class="comment" id="5247687925660057276">
          <div class="comment-block">
            <div class="comment-header">
              <cite class="user"><a href="https://www.blogger.com/profile/07881920807165431544" rel="nofollow">Unknown</a></cite>
              <span class="datetime secondary-text">
                <a rel="nofollow" id="c5247687925660057276" href="#5247687925660057276">12 October 2013 13:44</a>
              </span>
            </div>
            <div class="comment-content">I suppose AddPath (http://tools.ietf.org/html/draft-walton-bgp-add-paths-06) is elegant approach for resolving this issue.</div>
              <div class="comment-replies">
                <div class="comment-thread inline-thread">
                  <span class="thread-count"><a>Replies</a></span>
                    <ol>
      <div>
        <li class="comment" id="722864718033678053">
          <div class="comment-block">
            <div class="comment-header">
              <cite class="user"><a href="https://www.blogger.com/profile/13457151406311272386" rel="nofollow">Ivan Pepelnjak</a></cite>
              <span class="datetime secondary-text">
                <a rel="nofollow" id="c722864718033678053" href="#722864718033678053">12 October 2013 13:46</a>
              </span>
            </div>
            <div class="comment-content">It is ;)</div>
          </div>
        </li>
      </div>
  </ol>

                </div>
              </div>
          </div>
        </li>
      </div>
      <div>
        <li class="comment" id="688114574294305528">
          <div class="comment-block">
            <div class="comment-header">
              <cite class="user"><a href="" rel="nofollow">Anonymous</a></cite>
              <span class="datetime secondary-text">
                <a rel="nofollow" id="c688114574294305528" href="#688114574294305528">15 October 2013 23:27</a>
              </span>
            </div>
            <div class="comment-content">Couldn&#39;t E1/2 use next-hop-self in this scenario to avoid even introducing the external prefix into the mix?</div>
              <div class="comment-replies">
                <div class="comment-thread inline-thread">
                  <span class="thread-count"><a>Replies</a></span>
                    <ol>
      <div>
        <li class="comment" id="3394299978022562005">
          <div class="comment-block">
            <div class="comment-header">
              <cite class="user"><a href="https://www.blogger.com/profile/13457151406311272386" rel="nofollow">Ivan Pepelnjak</a></cite>
              <span class="datetime secondary-text">
                <a rel="nofollow" id="c3394299978022562005" href="#3394299978022562005">16 October 2013 07:58</a>
              </span>
            </div>
            <div class="comment-content">Doesn&#39;t solve the problem - root cause is route selection process in route reflectors, not BGP next hops.</div>
          </div>
        </li>
      </div>
  </ol>

                </div>
              </div>
          </div>
        </li>
      </div>
      <div>
        <li class="comment" id="482780599354263970">
          <div class="comment-block">
            <div class="comment-header">
              <cite class="user"><a href="http://packetpushers.net" rel="nofollow">Orhan ERGUN</a></cite>
              <span class="datetime secondary-text">
                <a rel="nofollow" id="c482780599354263970" href="#482780599354263970">31 October 2013 21:36</a>
              </span>
            </div>
            <div class="comment-content">Idea with best external , add-path with n or all , shadow RRs or session all adds extra state and require extra memory. If logical bgp topology cannot follow phsycail ( it should ) , then I believe best two approach is , first R1 could take the C1&#39;s IGP cost to external peering router into consideration and calculate best path from C1&#39;s point of view or there is one another draft which is angular distance aproach which puts the al the nodes basically in a circle and calculate the angular distance from RR to other nodes. First approach is like secondary SPF calculation of remofe LFA or  Not-Via tunnels so it adds maybe extra initial processing load but end result is less memory need, agree Ivan ? <br /><br />Thanks</div>
          </div>
        </li>
      </div>
      <div>
        <li class="comment" id="3759179689694555872">
          <div class="comment-block">
            <div class="comment-header">
              <cite class="user"><a href="" rel="nofollow">Anonymous</a></cite>
              <span class="datetime secondary-text">
                <a rel="nofollow" id="c3759179689694555872" href="#3759179689694555872">03 March 2014 17:30</a>
              </span>
            </div>
            <div class="comment-content">Did you actually test this? Based on BGP route selection criteria, the E routers should pick the eBGP route over the reflected iBGP route. So, from what I can see, there shouldn&#39;t be any loops in your set-up.</div>
              <div class="comment-replies">
                <div class="comment-thread inline-thread">
                  <span class="thread-count"><a>Replies</a></span>
                    <ol>
      <div>
        <li class="comment" id="8351480192393418812">
          <div class="comment-block">
            <div class="comment-header">
              <cite class="user"><a href="https://www.blogger.com/profile/13457151406311272386" rel="nofollow">Ivan Pepelnjak</a></cite>
              <span class="datetime secondary-text">
                <a rel="nofollow" id="c8351480192393418812" href="#8351480192393418812">03 March 2014 17:51</a>
              </span>
            </div>
            <div class="comment-content">Reread the blog post. The forwarding loop is between C1 and C2.</div>
          </div>
        </li>
      </div>
  </ol>

                </div>
              </div>
          </div>
        </li>
      </div>
      <div>
        <li class="comment" id="429690933299761594">
          <div class="comment-block">
            <div class="comment-header">
              <cite class="user"><a href="https://www.blogger.com/profile/05281240140117292641" rel="nofollow">Unknown</a></cite>
              <span class="datetime secondary-text">
                <a rel="nofollow" id="c429690933299761594" href="#429690933299761594">08 September 2017 12:02</a>
              </span>
            </div>
            <div class="comment-content">is there no BGP peering between C1 and E1 ? why won`t C1 forward the traffic to E1 directly ?</div>
          </div>
        </li>
      </div>
      <div>
        <li class="comment" id="1287">
          <div class="comment-block">
            <div class="comment-header">
              <cite class="user"><a href="" rel="nofollow">Mu</a></cite>
              <span class="datetime secondary-text">
                <a rel="nofollow" id="c1287" href="#1287">04 June 2022 02:25</a>
              </span>
            </div>
            <div class="comment-content"><p>Good post!</p>

<p>But I would be really surprised if I saw anything like this in real life.  RR is there to resolve the overhead caused by IBGP full-mesh.  And the reason for IBGP full-mesh is to ensure all IBGP speakers &ldquo;see&rdquo; the same. Back to this topology, E1,E2 are the common clients for R1 and R2, however, C1 and C2 belong to only one RR. If we remove the RR from the picture, we would see a topology that IBGP full mesh is not there. So to resolve this problem, just have C1 join the Cluster with R1 and C2 join the cluster with R2.</p>
</div>
              <div class="comment-replies">
                <div class="comment-thread inline-thread">
                  <span class="thread-count"><a>Replies</a></span>
                    <ol>
      <div>
        <li class="comment" id="1288">
          <div class="comment-block">
            <div class="comment-header">
              <cite class="user"><a href="" rel="nofollow">Ivan Pepelnjak</a></cite>
              <span class="datetime secondary-text">
                <a rel="nofollow" id="c1288" href="#1288">04 June 2022 09:06</a>
              </span>
            </div>
            <div class="comment-content"><p>I hope you wouldn&#39;t see anything like this in real life -- as I wrote, you have to be clumsy enough ;)</p>

<p>However, were you unlucky enough to have just the right combination of BGP sessions failing... Nah, that would never happen, we all monitor the state of our BGP sessions and react the moment they flap, don&#39;t we &#x1F61C;</p>
</div>
          </div>
        </li>
      </div>
  </ol>

                </div>
              </div>
          </div>
        </li>
      </div>
  </ol>

    </div>
  </div>
</div>
