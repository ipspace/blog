<div class="comments post" id="comments">
  <h4>10 comments:</h4>
  <div class="comments-content">
    <div class="comment-thread">
        <ol>
      <div>
        <li class="comment" id="5687459690857455466">
          <div class="comment-block">
            <div class="comment-header">
              <cite class="user"><a href="https://www.facebook.com/roman.sokolov.583" rel="nofollow">Roman Sokolov</a></cite>
              <span class="datetime secondary-text">
                <a rel="nofollow" id="c5687459690857455466" href="#5687459690857455466">13 February 2013 09:45</a>
              </span>
            </div>
            <div class="comment-content">Don&#39;t forget about VPN CAM when using per-vrf labels. Or you will hit recirculation for overflowing vrfs (more than 512).</div>
          </div>
        </li>
      </div>
      <div>
        <li class="comment" id="1404277300619895281">
          <div class="comment-block">
            <div class="comment-header">
              <cite class="user"><a href="http://blog.spearpoint.net" rel="nofollow">Fredrik Westermark</a></cite>
              <span class="datetime secondary-text">
                <a rel="nofollow" id="c1404277300619895281" href="#1404277300619895281">13 February 2013 10:28</a>
              </span>
            </div>
            <div class="comment-content">Love these types of solid and concrete posts!</div>
          </div>
        </li>
      </div>
      <div>
        <li class="comment" id="4141328485911924374">
          <div class="comment-block">
            <div class="comment-header">
              <cite class="user"><a href="" rel="nofollow">Anonymous</a></cite>
              <span class="datetime secondary-text">
                <a rel="nofollow" id="c4141328485911924374" href="#4141328485911924374">13 February 2013 19:53</a>
              </span>
            </div>
            <div class="comment-content">How does JUNOS handle this?</div>
              <div class="comment-replies">
                <div class="comment-thread inline-thread">
                  <span class="thread-count"><a>Replies</a></span>
                    <ol>
      <div>
        <li class="comment" id="4725233860546292665">
          <div class="comment-block">
            <div class="comment-header">
              <cite class="user"><a href="" rel="nofollow">Tiziano</a></cite>
              <span class="datetime secondary-text">
                <a rel="nofollow" id="c4725233860546292665" href="#4725233860546292665">14 February 2013 14:32</a>
              </span>
            </div>
            <div class="comment-content">vrf-table-label<br /><br /></div>
          </div>
        </li>
      </div>
  </ol>

                </div>
              </div>
          </div>
        </li>
      </div>
      <div>
        <li class="comment" id="7039089580543541729">
          <div class="comment-block">
            <div class="comment-header">
              <cite class="user"><a href="" rel="nofollow">Anonymous</a></cite>
              <span class="datetime secondary-text">
                <a rel="nofollow" id="c7039089580543541729" href="#7039089580543541729">15 February 2013 07:29</a>
              </span>
            </div>
            <div class="comment-content">Assigning an MPLS label per next-hop would be nice middle-of-the-road solution. No need to do double lookups and save lot of memory.</div>
          </div>
        </li>
      </div>
      <div>
        <li class="comment" id="241506802084061471">
          <div class="comment-block">
            <div class="comment-header">
              <cite class="user"><a href="" rel="nofollow">Anonymous</a></cite>
              <span class="datetime secondary-text">
                <a rel="nofollow" id="c241506802084061471" href="#241506802084061471">16 February 2013 14:19</a>
              </span>
            </div>
            <div class="comment-content">Already happened to face and solve the issue, but the post is great for sure.</div>
          </div>
        </li>
      </div>
      <div>
        <li class="comment" id="5393385821258349001">
          <div class="comment-block">
            <div class="comment-header">
              <cite class="user"><a href="" rel="nofollow">Mijo</a></cite>
              <span class="datetime secondary-text">
                <a rel="nofollow" id="c5393385821258349001" href="#5393385821258349001">18 February 2013 00:31</a>
              </span>
            </div>
            <div class="comment-content">On ASR9K/XR theres a third solution which avoids the extra lookup, you can do per next-hop label allocation<br /><br />qoute from: http://www.cisco.com/en/US/docs/ios_xr_sw/iosxr_r3.6/routing/configuration/guide/rc36bgp.html#wpmkr1456095 <br /><br />label-allocation-mode per-ce<br /><br />Configures the per-CE label allocation mode to avoid an extra lookup on the PE router and conserve label space (per-prefix is the default label allocation mode). In this mode, the PE router allocates one label for every immediate next-hop (in most cases, this would be a CE router). This label is directly mapped to the next hop, so there is no VRF route lookup performed during data forwarding. However, the number of labels allocated would be one for each CE rather than one for each VRF. Because BGP knows all the next hops, it assigns a label for each next hop (not for each PE-CE interface). When the outgoing interface is a multiaccess interface and the media access control (MAC) address of the neighbor is not known, Address Resolution Protocol (ARP) is triggered during packet forwarding. </div>
          </div>
        </li>
      </div>
      <div>
        <li class="comment" id="1835762316525614599">
          <div class="comment-block">
            <div class="comment-header">
              <cite class="user"><a href="" rel="nofollow">Andras Toth</a></cite>
              <span class="datetime secondary-text">
                <a rel="nofollow" id="c1835762316525614599" href="#1835762316525614599">12 March 2013 00:52</a>
              </span>
            </div>
            <div class="comment-content">This is available from 12.2(33)SXH and later on Cat 6500 and the command is the following:<br />mpls label mode all-vrfs protocol bgp-vpnv4 per-vrf<br /><br />On 12.2SR code the command is:<br />mpls label mode all-vrfs protocol all-afs per-vrf<br /></div>
          </div>
        </li>
      </div>
      <div>
        <li class="comment" id="587258251333597571">
          <div class="comment-block">
            <div class="comment-header">
              <cite class="user"><a href="" rel="nofollow">Anonymous</a></cite>
              <span class="datetime secondary-text">
                <a rel="nofollow" id="c587258251333597571" href="#587258251333597571">31 July 2013 16:00</a>
              </span>
            </div>
            <div class="comment-content">IOS XE3.10S (ASR1k) &quot;per-CE label allocation&quot;:<br /><br />http://www.cisco.com/en/US/docs/routers/asr1000/release/notes/asr1k_feats_important_notes_310s.html#wp3378629</div>
          </div>
        </li>
      </div>
      <div>
        <li class="comment" id="5703318926457859164">
          <div class="comment-block">
            <div class="comment-header">
              <cite class="user"><a href="" rel="nofollow">Anonymous</a></cite>
              <span class="datetime secondary-text">
                <a rel="nofollow" id="c5703318926457859164" href="#5703318926457859164">08 January 2014 08:56</a>
              </span>
            </div>
            <div class="comment-content">Juniper does per next-hop (like per-ce) as well.  Configure your export policy like this:<br />then {<br />label-allocation per-nexthop;<br />community add vpn1;<br />accept;<br />}<br /><br />I don&#39;t know why this wasn&#39;t the default/standard from all vendors right from the start..</div>
          </div>
        </li>
      </div>
  </ol>

    </div>
  </div>
</div>
