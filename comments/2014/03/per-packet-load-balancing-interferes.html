<div class="comments post" id="comments">
  <h4>12 comments:</h4>
  <div class="comments-content">
    <div class="comment-thread">
        <ol>
      <div>
        <li class="comment" id="7257247553615947533">
          <div class="comment-block">
            <div class="comment-header">
              <cite class="user"><a href="https://www.blogger.com/profile/16010323799492079420" rel="nofollow">Olivier Bonaventure</a></cite>
              <span class="datetime secondary-text">
                <a rel="nofollow" id="c7257247553615947533" href="#7257247553615947533">19 March 2014 09:29</a>
              </span>
            </div>
            <div class="comment-content">See http://tools.ietf.org/agenda/89/slides/slides-89-tcpm-7.pdf for a recent discussion on the impact of reordering on TCP performance on recent stacks. </div>
          </div>
        </li>
      </div>
      <div>
        <li class="comment" id="4802685953559007697">
          <div class="comment-block">
            <div class="comment-header">
              <cite class="user"><a href="https://www.blogger.com/profile/16010323799492079420" rel="nofollow">Olivier Bonaventure</a></cite>
              <span class="datetime secondary-text">
                <a rel="nofollow" id="c4802685953559007697" href="#4802685953559007697">19 March 2014 09:31</a>
              </span>
            </div>
            <div class="comment-content">Multipath TCP can deal efficiently with the reordering caused by different paths through the network. See http://multipath-tcp.org/pmwiki.php?n=Main.50Gbps on how to reach 50 Gbps with a single Multipath TCP connection on 6 10 Gbps interfaces</div>
              <div class="comment-replies">
                <div class="comment-thread inline-thread">
                  <span class="thread-count"><a>Replies</a></span>
                    <ol>
      <div>
        <li class="comment" id="2834143931053708209">
          <div class="comment-block">
            <div class="comment-header">
              <cite class="user"><a href="https://www.blogger.com/profile/13457151406311272386" rel="nofollow">Ivan Pepelnjak</a></cite>
              <span class="datetime secondary-text">
                <a rel="nofollow" id="c2834143931053708209" href="#2834143931053708209">19 March 2014 10:50</a>
              </span>
            </div>
            <div class="comment-content">That would be reordering across multiple paths (i.e. TCP sessions), not within a single TCP session, right?<br /><br />Thanks for the links, they&#39;re great!</div>
          </div>
        </li>
      </div>
      <div>
        <li class="comment" id="3860717170733321835">
          <div class="comment-block">
            <div class="comment-header">
              <cite class="user"><a href="https://www.blogger.com/profile/16010323799492079420" rel="nofollow">Olivier Bonaventure</a></cite>
              <span class="datetime secondary-text">
                <a rel="nofollow" id="c3860717170733321835" href="#3860717170733321835">19 March 2014 13:28</a>
              </span>
            </div>
            <div class="comment-content">Yes, MPTCP handles reordering accross different subflows/paths. The tcpm link above deals with reordering on a single tcp connection<br /></div>
          </div>
        </li>
      </div>
  </ol>

                </div>
              </div>
          </div>
        </li>
      </div>
      <div>
        <li class="comment" id="3328769487402545123">
          <div class="comment-block">
            <div class="comment-header">
              <cite class="user"><a href="https://www.blogger.com/profile/17119268104941260145" rel="nofollow">Unknown</a></cite>
              <span class="datetime secondary-text">
                <a rel="nofollow" id="c3328769487402545123" href="#3328769487402545123">19 March 2014 11:16</a>
              </span>
            </div>
            <div class="comment-content">Also when you have a problem (for example faultry transceiver/sfp/fiber) per packet load balancing may lead to situations that are very hard to troubleshoot. often enough I get inaccurate/wrong information on an issue by the customer/admin so adding another layer which probably complicates  the reproduction of the problem&#39;s effects is just bad</div>
          </div>
        </li>
      </div>
      <div>
        <li class="comment" id="3684949643264226194">
          <div class="comment-block">
            <div class="comment-header">
              <cite class="user"><a href="http://personales.unican.es/vallejoe/" rel="nofollow">Enrique Vallejo</a></cite>
              <span class="datetime secondary-text">
                <a rel="nofollow" id="c3684949643264226194" href="#3684949643264226194">19 March 2014 19:27</a>
              </span>
            </div>
            <div class="comment-content">Regarding TCP in the datacenter, though not specifically related to packet reordering, there is an specific variant denoted as DataCenter TCP (DCTCP) which leverages on ECN bits marked by switches when the queue occupancy is high. This DCTCP adjusts the congestion window of the transmitter based on the amount of packets received with the ECN bits marked per RTT, and obtains much better performance (in terms of latency, response to incast traffic and fairness between different flows sharing links) than traditional TCP implementations. DCTCP is active by default in Windows server 2012 (the server detects automatically which connections are from within the DC, to use DCTCP, and which ones are external to rely on traditional TCP), and there exist patches for linux. Additionally, some switches (see Nexus 3548, for example) are advertised as &quot;DCTCP compatible&quot;, or simply said, they mark the ECN bits. I am not involved with it, I found the info in their website: http://simula.stanford.edu/~alizade/Site/DCTCP.html<br /><br />Knowing that TCP or DCTCP only adjust the transmission window once per RTT, it would be interesting to know how this mechanism (or a similar one) reacts to packet reordering. </div>
          </div>
        </li>
      </div>
      <div>
        <li class="comment" id="3269946433203538010">
          <div class="comment-block">
            <div class="comment-header">
              <cite class="user"><a href="" rel="nofollow">Alvaro Pereira</a></cite>
              <span class="datetime secondary-text">
                <a rel="nofollow" id="c3269946433203538010" href="#3269946433203538010">19 March 2014 21:48</a>
              </span>
            </div>
            <div class="comment-content">I&#39;ve seen a couple of articles mentioning that the Cisco 9k will do something similar to Brocade regarding per-packet load-balancing:<br />http://keepingitclassless.net/2013/11/insieme-and-cisco-aci-part-2-aci-and-programmability/<br />http://lamejournal.com/2013/11/21/ciscos-aci-insieme-launch/<br /><br />A few searches later, it looks like Cisco will be using &quot;Flowlet Switching (Kandula et al â€™04)&quot;, as can be seen on page 20:<br />http://www.cisco.com/web/strategy/docs/gov/application_centric_infrastructure.pdf<br /><br />I had never heard of &quot;flowlet switching&quot; before, but it does sound interesting:<br />http://nms.lcs.mit.edu/~kandula/data/FLARE_HotNets04_web.ppt</div>
              <div class="comment-replies">
                <div class="comment-thread inline-thread">
                  <span class="thread-count"><a>Replies</a></span>
                    <ol>
      <div>
        <li class="comment" id="3175588625727589286">
          <div class="comment-block">
            <div class="comment-header">
              <cite class="user"><a href="https://www.blogger.com/profile/13457151406311272386" rel="nofollow">Ivan Pepelnjak</a></cite>
              <span class="datetime secondary-text">
                <a rel="nofollow" id="c3175588625727589286" href="#3175588625727589286">20 March 2014 08:37</a>
              </span>
            </div>
            <div class="comment-content">Thanks a million for figuring this out!!! Windows Server 2012 R2 is also using flowlets, but I never found time to chase that down.<br /><br />See &quot;Dynamic NIC teaming&quot; section in this document:<br /><br />http://blogs.technet.com/b/networking/archive/2013/07/31/transforming-your-datacenter-networking.aspx</div>
          </div>
        </li>
      </div>
  </ol>

                </div>
              </div>
          </div>
        </li>
      </div>
      <div>
        <li class="comment" id="7401247133978842229">
          <div class="comment-block">
            <div class="comment-header">
              <cite class="user"><a href="https://www.blogger.com/profile/13772533723547791668" rel="nofollow">Donal</a></cite>
              <span class="datetime secondary-text">
                <a rel="nofollow" id="c7401247133978842229" href="#7401247133978842229">03 April 2014 13:56</a>
              </span>
            </div>
            <div class="comment-content">Hi ivan, this raises an interesting point regarding the port channel load-balancing algorithm for PortChannels in vPCs on FlexPods. Essentially we have been advocating algorithms that use SRC port to spread the storage ethernet traffic across available paths to get the full use of 20, 30, 40Gbps channels (egress) from/to NetApp filers and Cisco UCS for NFS and iSCSI. So the jumbo storage frames would essentially not monopolise a single link when all NFS flows go from one SRC IP to one DST IP NFS mount. What we did see a lot in packet dumps for either VMware host storage or guest iSCSI traffic was out of order packets which I didn&#39;t think much of at the time... however in retrospect the default LRO/GRO, LSO/LRO behaviour on hosts and guests would be being slowed down and another reason to turn it off completely I guess? Thoughts?</div>
              <div class="comment-replies">
                <div class="comment-thread inline-thread">
                  <span class="thread-count"><a>Replies</a></span>
                    <ol>
      <div>
        <li class="comment" id="6286082881785395448">
          <div class="comment-block">
            <div class="comment-header">
              <cite class="user"><a href="https://www.blogger.com/profile/13457151406311272386" rel="nofollow">Ivan Pepelnjak</a></cite>
              <span class="datetime secondary-text">
                <a rel="nofollow" id="c6286082881785395448" href="#6286082881785395448">04 April 2014 21:38</a>
              </span>
            </div>
            <div class="comment-content">5-tuple load balancing should _not_ cause packet reordering. Per-packet load balancing will.<br /><br />Opinions on the usefulness of LRO/LSO are mixed, but if it works well, it can save significant amount of CPU cycles or improve throughput of high-bandwidth TCP sessions.</div>
          </div>
        </li>
      </div>
  </ol>

                </div>
              </div>
          </div>
        </li>
      </div>
      <div>
        <li class="comment" id="3731540712565330364">
          <div class="comment-block">
            <div class="comment-header">
              <cite class="user"><a href="https://www.blogger.com/profile/18417457563490718355" rel="nofollow">Adam</a></cite>
              <span class="datetime secondary-text">
                <a rel="nofollow" id="c3731540712565330364" href="#3731540712565330364">14 February 2015 03:36</a>
              </span>
            </div>
            <div class="comment-content">Last year Juniper introduced an interesting feature for their VC-Fabric called Adaptive Flowlet Splicing which inspects the metrics of flows and links to determine when packets within a flow may be &quot;safely sprayed&quot; without risk of reordering on the receiving end.<br /><br />I believe it measures link utilization, queue depth, latency, and several flow-specific metrics to determine a flow&#39;s &quot;burstiness&quot; in making this decision.<br /><br />This Juniper post explains it very well.<br />http://forums.juniper.net/t5/Data-Center-Technologists/Adaptive-Flowlet-Splicing-VCF-s-Fine-Grained-Adaptive-Load/ba-p/251674</div>
              <div class="comment-replies">
                <div class="comment-thread inline-thread">
                  <span class="thread-count"><a>Replies</a></span>
                    <ol>
      <div>
        <li class="comment" id="3639752724404015491">
          <div class="comment-block">
            <div class="comment-header">
              <cite class="user"><a href="https://www.blogger.com/profile/13457151406311272386" rel="nofollow">Ivan Pepelnjak</a></cite>
              <span class="datetime secondary-text">
                <a rel="nofollow" id="c3639752724404015491" href="#3639752724404015491">14 February 2015 03:47</a>
              </span>
            </div>
            <div class="comment-content">Please search my blog for recent posts on ECMP load balancing and flowlets - I covered both topics.<br /><br />Thank you!</div>
          </div>
        </li>
      </div>
  </ol>

                </div>
              </div>
          </div>
        </li>
      </div>
  </ol>

    </div>
  </div>
</div>
