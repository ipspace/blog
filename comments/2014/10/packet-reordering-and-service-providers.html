<div class="comments post" id="comments">
  <h4>9 comments:</h4>
  <div class="comments-content">
    <div class="comment-thread">
        <ol>
      <div>
        <li class="comment" id="2497535007271574910">
          <!--
          <div class="avatar-image-container">
            <img src="https://2.bp.blogspot.com/-W1SexVXRzEM/XJnELf51L5I/AAAAAAAA6G8/yk-GZnQwdxQ69UMRRc3xZ-zSlSLKUnGUACK4BGAYYCw/s32/rb.jpg">
          </div>
          -->
          <div class="comment-block">
            <div class="comment-header">
              <cite class="user"><a href="https://www.blogger.com/profile/00515499915979264058" rel="nofollow">Ronald Bartels</a></cite>
              <span class="datetime secondary-text">
                <a rel="nofollow" id="c2497535007271574910" href="#2497535007271574910">13 October 2014 11:14</a>
              </span>
            </div>
            <div class="comment-content">If you used Carrier Ethernet instead of IP links you wouldn&#39;t be writing this!</div>
              <div class="comment-replies">
                <div class="comment-thread inline-thread">
                  <span class="thread-count"><a>Replies</a></span>
                    <ol>
      <div>
        <li class="comment" id="5480830057862334643">
          <!--
          <div class="avatar-image-container">
            <img src="https://lh3.googleusercontent.com/zFdxGE77vvD2w5xHy6jkVuElKv-U9_9qLkRYK8OnbDeJPtjSZ82UPq5w6hJ-SA=s35">
          </div>
          -->
          <div class="comment-block">
            <div class="comment-header">
              <cite class="user"><a href="https://www.blogger.com/profile/13457151406311272386" rel="nofollow">Ivan Pepelnjak</a></cite>
              <span class="datetime secondary-text">
                <a rel="nofollow" id="c5480830057862334643" href="#5480830057862334643">13 October 2014 11:57</a>
              </span>
            </div>
            <div class="comment-content">The next time you find a working Carrier Ethernet solution between my web site and all its visitors let me know ;)<br /><br />On a more serious note, if you do packet marking on the edge of a Carrier Ethernet network (based on in-contract/out-of-contract decision) and combine that with any form of differentiated queuing within the network you might get the same results.</div>
          </div>
        </li>
      </div>
  </ol>

                </div>
              </div>
          </div>
        </li>
      </div>
      <div>
        <li class="comment" id="8163292159630560058">
          <!--
          <div class="avatar-image-container">
            <img src="https://lh3.googleusercontent.com/zFdxGE77vvD2w5xHy6jkVuElKv-U9_9qLkRYK8OnbDeJPtjSZ82UPq5w6hJ-SA=s35">
          </div>
          -->
          <div class="comment-block">
            <div class="comment-header">
              <cite class="user"><a href="https://www.blogger.com/profile/06517186494484977438" rel="nofollow">Roland Dobbins</a></cite>
              <span class="datetime secondary-text">
                <a rel="nofollow" id="c8163292159630560058" href="#8163292159630560058">13 October 2014 12:15</a>
              </span>
            </div>
            <div class="comment-content">I&#39;ve run into some ISPs in APAC doing per-packet load-balancing on their outbound traffic.  After I explained to them the various reasons this is a Bad Idea, they switched over to saner traffic engineering methodologies.</div>
          </div>
        </li>
      </div>
      <div>
        <li class="comment" id="28709063931038388">
          <!--
          <div class="avatar-image-container">
            <img src="https://resources.blogblog.com/img/blank.gif">
          </div>
          -->
          <div class="comment-block">
            <div class="comment-header">
              <cite class="user"><a href="None" rel="nofollow">Shawn</a></cite>
              <span class="datetime secondary-text">
                <a rel="nofollow" id="c28709063931038388" href="#28709063931038388">13 October 2014 17:11</a>
              </span>
            </div>
            <div class="comment-content">Some content providers have moved (some are moving) toward TCP anycast (just like CDNs), and as far as I can tell per packet loadbalancing as well as BGP multi-path AS-Path relax are the enemies of both TCP and chatty UDP anycast (AKA. DNSSEC) over internet. Please don&#39;t do that!</div>
          </div>
        </li>
      </div>
      <div>
        <li class="comment" id="6784547015671026785">
          <!--
          <div class="avatar-image-container">
            <img src="https://lh3.googleusercontent.com/zFdxGE77vvD2w5xHy6jkVuElKv-U9_9qLkRYK8OnbDeJPtjSZ82UPq5w6hJ-SA=s35">
          </div>
          -->
          <div class="comment-block">
            <div class="comment-header">
              <cite class="user"><a href="https://www.blogger.com/profile/12912702162710760711" rel="nofollow">Bogdan Golab</a></cite>
              <span class="datetime secondary-text">
                <a rel="nofollow" id="c6784547015671026785" href="#6784547015671026785">13 October 2014 22:13</a>
              </span>
            </div>
            <div class="comment-content">Flowlets allows to change the switching path e.g. when we want to reduce load on one paths and move traffic to another one:<br />http://nms.lcs.mit.edu/~kandula/data/FLARE_HotNets04_web.ppt<br />It&#39;s an interesting idea: you can change path of the flow once the gap between bursts of the flow is longer than the trip time to the merging point (assume that we have splitting and mergin point of two splitted paths). This way we can avoid re-ordering as we make sure that merging point is reached by the previouse burst of the same flow.</div>
          </div>
        </li>
      </div>
      <div>
        <li class="comment" id="7787447890823043468">
          <!--
          <div class="avatar-image-container">
            <img src="https://lh3.googleusercontent.com/zFdxGE77vvD2w5xHy6jkVuElKv-U9_9qLkRYK8OnbDeJPtjSZ82UPq5w6hJ-SA=s35">
          </div>
          -->
          <div class="comment-block">
            <div class="comment-header">
              <cite class="user"><a href="https://www.blogger.com/profile/16115281578739979183" rel="nofollow">Dave Taht</a></cite>
              <span class="datetime secondary-text">
                <a rel="nofollow" id="c7787447890823043468" href="#7787447890823043468">13 October 2014 22:28</a>
              </span>
            </div>
            <div class="comment-content">Meh. Still sounded like bufferbloat to me. Using TCP trace on your RTTs on your capture and xplot.org is generally better than the wireshark equivalents. Try it. Post the plots.<br /><br />Classic tcptrace xplot.org plots here, and worth looking at in context with your problem. <br /><br />http://gettys.wordpress.com/2010/12/06/whose-house-is-of-glasse-must-not-throw-stones-at-another/<br /><br />On your packet re-ordering idea, many wifi aps tend to reorder when doing retries - which is a GOOD thing - as it lowers latency on the AP. <br /><br />TCP stream reassembly is the job of the OS and linux and osx handle it well. Modern Linux&#39;s, especially. <br /><br />Windows - even modern versions of windows - does it really badly. Redmond is asleep at the switch. </div>
          </div>
        </li>
      </div>
      <div>
        <li class="comment" id="5991483308447511846">
          <!--
          <div class="avatar-image-container">
            <img src="https://lh3.googleusercontent.com/zFdxGE77vvD2w5xHy6jkVuElKv-U9_9qLkRYK8OnbDeJPtjSZ82UPq5w6hJ-SA=s35">
          </div>
          -->
          <div class="comment-block">
            <div class="comment-header">
              <cite class="user"><a href="https://www.blogger.com/profile/16115281578739979183" rel="nofollow">Dave Taht</a></cite>
              <span class="datetime secondary-text">
                <a rel="nofollow" id="c5991483308447511846" href="#5991483308447511846">13 October 2014 22:29</a>
              </span>
            </div>
            <div class="comment-content">And oh, yea, if have WRED, use it, if you can configure it.<br /><br />For all other things, there&#39;s fq_codel.<br /><br />https://tools.ietf.org/html/draft-hoeiland-joergensen-aqm-fq-codel-00</div>
          </div>
        </li>
      </div>
      <div>
        <li class="comment" id="8454766828320677224">
          <!--
          <div class="avatar-image-container">
            <img src="https://lh3.googleusercontent.com/zFdxGE77vvD2w5xHy6jkVuElKv-U9_9qLkRYK8OnbDeJPtjSZ82UPq5w6hJ-SA=s35">
          </div>
          -->
          <div class="comment-block">
            <div class="comment-header">
              <cite class="user"><a href="https://www.blogger.com/profile/16115281578739979183" rel="nofollow">Dave Taht</a></cite>
              <span class="datetime secondary-text">
                <a rel="nofollow" id="c8454766828320677224" href="#8454766828320677224">13 October 2014 22:33</a>
              </span>
            </div>
            <div class="comment-content">And while I&#39;m at it, many people implementing &quot;SFQ&quot; DO permute the hash every 10 seconds, as that is what wondershaper did, and zillions of people just blindly copied that. It forces re-ordering every 10 seconds, which kept latency low, and acted as a poor mans AQM, in it&#39;s own weird way. <br /><br />It&#39;s easy to see a misconfigured SFQ doing that if you have captures. 10 second period for the scrambling, under load.<br /><br />This dumb behavior in Linux&#39;s SFQ implementation was fixed around version 3.6, I believe, so periodic permutation no longer does that harm (but no longer acts as a poor man&#39;s AQM), but it will take a decade for that to sort itself out in the field.<br /><br />http://www.bufferbloat.net/projects/cerowrt/wiki/Wondershaper_Must_Die</div>
          </div>
        </li>
      </div>
      <div>
        <li class="comment" id="3711407240444783124">
          <!--
          <div class="avatar-image-container">
            <img src="https://lh3.googleusercontent.com/zFdxGE77vvD2w5xHy6jkVuElKv-U9_9qLkRYK8OnbDeJPtjSZ82UPq5w6hJ-SA=s35">
          </div>
          -->
          <div class="comment-block">
            <div class="comment-header">
              <cite class="user"><a href="https://www.blogger.com/profile/05334725096572895520" rel="nofollow">Job</a></cite>
              <span class="datetime secondary-text">
                <a rel="nofollow" id="c3711407240444783124" href="#3711407240444783124">22 October 2014 21:02</a>
              </span>
            </div>
            <div class="comment-content">In the scenario where you use MPLS pseudo-wires without MPLS Control-Word set no the packets, you can very easily end up re-ordering packets towards MAC addresses starting with a 4 or a 6, I did a presentation about that some time ago:<br /><br />PDF: https://www.nanog.org/meetings/nanog57/presentations/Tuesday/tues.general.SnijdersWheeler.MACaddresses.14.pdf<br /><br />Video: https://www.nanog.org/meetings/nanog57/presentations/Tuesday/tue.poor-mac-address.snijders.wmv</div>
          </div>
        </li>
      </div>
  </ol>

    </div>
  </div>
</div>
