<div class="comments post" id="comments">
  <h4>7 comments:</h4>
  <div class="comments-content">
    <div class="comment-thread">
        <ol>
      <div>
        <li class="comment" id="3819131404503107092">
          <!--
          <div class="avatar-image-container">
            <img src="https://resources.blogblog.com/img/blank.gif">
          </div>
          -->
          <div class="comment-block">
            <div class="comment-header">
              <cite class="user"><a href="http://fud.no" rel="nofollow">Tore Anderson</a></cite>
              <span class="datetime secondary-text">
                <a rel="nofollow" id="c3819131404503107092" href="#3819131404503107092">21 November 2012 08:39</a>
              </span>
            </div>
            <div class="comment-content">Hi Ivan,<br /><br />I disagree with a few things here:<br /><br />- &quot;You MUST clear the A flag in the prefixes advertised by the router to enforce DHCPv6 address assignment&quot; - disagree. It is my understanding that the SLAAC (A flag) and DHCPv6 (M flag) are mutually independent. If you set both, the host will obtain addresses from both methods. RFC4861 section 3 says clearly that SLAAC and DHCPv6 is &quot;*and*/or&quot;, not strictly &quot;or&quot;.<br /><br />- &quot;Removing the on-link prefix from the RA messages will stop SLAAC&quot; - if you by this mean &quot;clearing the L flag&quot;, I disagree. SLAAC works for off-link prefixes just as well as for on-link ones. If you on the other hand meant &quot;removing the prefix information option completely&quot;, I agree.<br /><br />- &quot;The routers supporting SLAAC ...&quot; - this is somewhat misleading. Routers don&#39;t support SLAAC, hosts do. The only thing the router does is to inform the host that it may perform SLAAC or not by using the A flag.<br /><br />Other than that, a few other things I&#39;ve found that people often find confusing, include:<br /><br />- The O flag is meaningless if the M flag is set, as the O flag is basically a subset of the M flag.<br /><br />- When it comes to DNS server assignment, there are OS-es that only support DHCPv6 (e.g., Windows), and there are some that only support the RDNSS Option (e.g., Mac OS X 10.6.x). Therefore, for maximum host compatibility, I recommend using both simultaneously.<br /><br />- A prefix information option with both A and L flags unset is meaningless and might as well be removed.<br /><br />- SLAAC can only occur for prefixes with a length of 64, so setting the A flag for other prefix lenghts is meaningless. (The L flag, on the other hand, works for any prefix length.)<br /><br />- DHCPv6 does not carry prefix length information, so a prefix information option with L=1 is the *only* way a host may acquire an on-link route.<br /><br />- Receipt of a RA (with lifetime &gt; 0) will cause the host to install a default route to the RA&#39;s source address. This is the *only* way to advertise a default route in IPv6 (on Ethernet at least), as DHCPv6 cannot carry this information. Furthermore, the RA is guaranteed to come from a link-local address (within fe80::/64), which is crucial in making off-link prefixes work.<br /><br />Tore</div>
          </div>
        </li>
      </div>
      <div>
        <li class="comment" id="1032736693214825654">
          <!--
          <div class="avatar-image-container">
            <img src="https://resources.blogblog.com/img/blank.gif">
          </div>
          -->
          <div class="comment-block">
            <div class="comment-header">
              <cite class="user"><a href="None" rel="nofollow">IPv6 Newb</a></cite>
              <span class="datetime secondary-text">
                <a rel="nofollow" id="c1032736693214825654" href="#1032736693214825654">21 November 2012 13:39</a>
              </span>
            </div>
            <div class="comment-content">A prefix information option with both A and L flags unset is meaningless and might as well be removed.<br />  --- Why is this?  <br /><br />BTW I&#39;m really confused as to what on-link is.  In IPv4 on-link meant that you would send a broadcast to find a neighbor rather than direct to the router.  How does this compare to IPv6 and why cant SLAAC be on-link?<br /><br /></div>
              <div class="comment-replies">
                <div class="comment-thread inline-thread">
                  <span class="thread-count"><a>Replies</a></span>
                    <ol>
      <div>
        <li class="comment" id="378502923533836977">
          <!--
          <div class="avatar-image-container">
            <img src="https://lh3.googleusercontent.com/zFdxGE77vvD2w5xHy6jkVuElKv-U9_9qLkRYK8OnbDeJPtjSZ82UPq5w6hJ-SA=s35">
          </div>
          -->
          <div class="comment-block">
            <div class="comment-header">
              <cite class="user"><a href="https://www.blogger.com/profile/13457151406311272386" rel="nofollow">Ivan Pepelnjak</a></cite>
              <span class="datetime secondary-text">
                <a rel="nofollow" id="c378502923533836977" href="#378502923533836977">21 November 2012 18:40</a>
              </span>
            </div>
            <div class="comment-content">Follow-up post scheduled for early next week. I wouldn&#39;t want to bore my US readers with these details during the Thanksgiving weekend.</div>
          </div>
        </li>
      </div>
  </ol>

                </div>
              </div>
          </div>
        </li>
      </div>
      <div>
        <li class="comment" id="3562244710228533733">
          <!--
          <div class="avatar-image-container">
            <img src="https://resources.blogblog.com/img/blank.gif">
          </div>
          -->
          <div class="comment-block">
            <div class="comment-header">
              <cite class="user"><a href="http://www.convergence.cx" rel="nofollow">lochii</a></cite>
              <span class="datetime secondary-text">
                <a rel="nofollow" id="c3562244710228533733" href="#3562244710228533733">21 November 2012 15:30</a>
              </span>
            </div>
            <div class="comment-content">I don&#39;t think I&#39;d be recommending L-less RA as a security / TE measure, the hosts could just as well configure the addressing statically!</div>
              <div class="comment-replies">
                <div class="comment-thread inline-thread">
                  <span class="thread-count"><a>Replies</a></span>
                    <ol>
      <div>
        <li class="comment" id="2196658346716991054">
          <!--
          <div class="avatar-image-container">
            <img src="https://lh3.googleusercontent.com/zFdxGE77vvD2w5xHy6jkVuElKv-U9_9qLkRYK8OnbDeJPtjSZ82UPq5w6hJ-SA=s35">
          </div>
          -->
          <div class="comment-block">
            <div class="comment-header">
              <cite class="user"><a href="https://www.blogger.com/profile/13457151406311272386" rel="nofollow">Ivan Pepelnjak</a></cite>
              <span class="datetime secondary-text">
                <a rel="nofollow" id="c2196658346716991054" href="#2196658346716991054">21 November 2012 18:46</a>
              </span>
            </div>
            <div class="comment-content">Thank you! Updated.</div>
          </div>
        </li>
      </div>
  </ol>

                </div>
              </div>
          </div>
        </li>
      </div>
      <div>
        <li class="comment" id="5252787293725762242">
          <!--
          <div class="avatar-image-container">
            <img src="https://lh3.googleusercontent.com/zFdxGE77vvD2w5xHy6jkVuElKv-U9_9qLkRYK8OnbDeJPtjSZ82UPq5w6hJ-SA=s35">
          </div>
          -->
          <div class="comment-block">
            <div class="comment-header">
              <cite class="user"><a href="https://www.blogger.com/profile/05159931748069732652" rel="nofollow">amatesi</a></cite>
              <span class="datetime secondary-text">
                <a rel="nofollow" id="c5252787293725762242" href="#5252787293725762242">09 January 2016 13:13</a>
              </span>
            </div>
            <div class="comment-content">Hi Ivan and sorry for the late comment - I was wondering if you knew how to deal with NLB-scenarios?<br /><br />In other words, say you have 2 hosts configured with (Windows) NLB (whereas 2 hosts share the same IPv6 Address).<br /><br />- Let&#39;s say the shared IPv6 Address is meant to be used as the Default Gateway on a LAN.<br /><br />How would you go about it?</div>
              <div class="comment-replies">
                <div class="comment-thread inline-thread">
                  <span class="thread-count"><a>Replies</a></span>
                    <ol>
      <div>
        <li class="comment" id="982560681846771604">
          <!--
          <div class="avatar-image-container">
            <img src="https://lh3.googleusercontent.com/zFdxGE77vvD2w5xHy6jkVuElKv-U9_9qLkRYK8OnbDeJPtjSZ82UPq5w6hJ-SA=s35">
          </div>
          -->
          <div class="comment-block">
            <div class="comment-header">
              <cite class="user"><a href="https://www.blogger.com/profile/13457151406311272386" rel="nofollow">Ivan Pepelnjak</a></cite>
              <span class="datetime secondary-text">
                <a rel="nofollow" id="c982560681846771604" href="#982560681846771604">09 January 2016 20:32</a>
              </span>
            </div>
            <div class="comment-content">I wouldn&#39;t. NLB is an obsolete technology, and I don&#39;t know how well it&#39;s integrated with IPv6 (if at all).</div>
          </div>
        </li>
      </div>
      <div>
        <li class="comment" id="8481492716320897759">
          <!--
          <div class="avatar-image-container">
            <img src="https://lh3.googleusercontent.com/zFdxGE77vvD2w5xHy6jkVuElKv-U9_9qLkRYK8OnbDeJPtjSZ82UPq5w6hJ-SA=s35">
          </div>
          -->
          <div class="comment-block">
            <div class="comment-header">
              <cite class="user"><a href="https://www.blogger.com/profile/05159931748069732652" rel="nofollow">amatesi</a></cite>
              <span class="datetime secondary-text">
                <a rel="nofollow" id="c8481492716320897759" href="#8481492716320897759">10 January 2016 04:30</a>
              </span>
            </div>
            <div class="comment-content">Where did you read that NLB is obsolete ?<br /><br />- I am confirming that NLB works very well for both IPv4 and IPv6.<br /><br />The issue I have is with RAs (and the crippled DHCPv6 services not being able to send a *specific* Default Gateway).</div>
          </div>
        </li>
      </div>
  </ol>

                </div>
              </div>
          </div>
        </li>
      </div>
      <div>
        <li class="comment" id="4215441707238964151">
          <!--
          <div class="avatar-image-container">
            <img src="https://resources.blogblog.com/img/blank.gif">
          </div>
          -->
          <div class="comment-block">
            <div class="comment-header">
              <cite class="user"><a href="http://layer9.wordpress.com" rel="nofollow">Michael</a></cite>
              <span class="datetime secondary-text">
                <a rel="nofollow" id="c4215441707238964151" href="#4215441707238964151">02 January 2018 13:40</a>
              </span>
            </div>
            <div class="comment-content">Hi Ivan,<br /><br />I just had a case where an RA dropped to a VLAN where it doesn&#39;t belong. This caused servers to add an prefix to their routing tables as &quot;on-link&quot;.<br /><br />While it&#39;s possible to set the lifetime of the router itself to 0 and remove the default route from the routing table I haven&#39;t found a way to remove the on-link route automatically as well.<br /><br />Do you know if this possible using NDP?<br /><br />Thanks<br />Michael</div>
              <div class="comment-replies">
                <div class="comment-thread inline-thread">
                  <span class="thread-count"><a>Replies</a></span>
                    <ol>
      <div>
        <li class="comment" id="7669921197466117326">
          <!--
          <div class="avatar-image-container">
            <img src="https://lh3.googleusercontent.com/zFdxGE77vvD2w5xHy6jkVuElKv-U9_9qLkRYK8OnbDeJPtjSZ82UPq5w6hJ-SA=s35">
          </div>
          -->
          <div class="comment-block">
            <div class="comment-header">
              <cite class="user"><a href="https://www.blogger.com/profile/13457151406311272386" rel="nofollow">Ivan Pepelnjak</a></cite>
              <span class="datetime secondary-text">
                <a rel="nofollow" id="c7669921197466117326" href="#7669921197466117326">02 January 2018 14:21</a>
              </span>
            </div>
            <div class="comment-content">Advertise the same prefix without the on-link bit? Change the lifetime of the prefix to zero?</div>
          </div>
        </li>
      </div>
  </ol>

                </div>
              </div>
          </div>
        </li>
      </div>
      <div>
        <li class="comment" id="7332360291502466404">
          <!--
          <div class="avatar-image-container">
            <img src="https://resources.blogblog.com/img/blank.gif">
          </div>
          -->
          <div class="comment-block">
            <div class="comment-header">
              <cite class="user"><a href="http://layer9.wordpress.com" rel="nofollow">Michael</a></cite>
              <span class="datetime secondary-text">
                <a rel="nofollow" id="c7332360291502466404" href="#7332360291502466404">02 January 2018 15:14</a>
              </span>
            </div>
            <div class="comment-content">Thanks. I already tried that and it didn&#39;t work. According to the manpage of radvd (which is used for sending the RAs) the lifetime for on-link determination of the prefix will be ignored by the client when set to less than two hours:<br /><br />&gt; AdvValidLifetime seconds|infinity<br />&gt;<br />&gt; The  length  of  time in seconds (relative to the time the packet is sent) that the<br />&gt; prefix is valid for the purpose of on-link determination.  The symbolic value infinity<br />&gt; represents infinity (i.e. a value of all one bits (0xffffffff)). The valid lifetime is<br />&gt; also used by RFC 4862.<br />&gt;<br />&gt; Note that clients will ignore AdvValidLifetime of an existing prefix if the lifetime is<br />&gt; below two hours, as required in RFC 4862 Section 5.5.3 point e).<br /><br />I have not read the RFC yet. At least I was able to reduce the lifetime of the routing table entry to two hours. Which however, if this happens in production, is not very helpful.<br /></div>
              <div class="comment-replies">
                <div class="comment-thread inline-thread">
                  <span class="thread-count"><a>Replies</a></span>
                    <ol>
      <div>
        <li class="comment" id="8816866990371059001">
          <!--
          <div class="avatar-image-container">
            <img src="https://lh3.googleusercontent.com/zFdxGE77vvD2w5xHy6jkVuElKv-U9_9qLkRYK8OnbDeJPtjSZ82UPq5w6hJ-SA=s35">
          </div>
          -->
          <div class="comment-block">
            <div class="comment-header">
              <cite class="user"><a href="https://www.blogger.com/profile/13457151406311272386" rel="nofollow">Ivan Pepelnjak</a></cite>
              <span class="datetime secondary-text">
                <a rel="nofollow" id="c8816866990371059001" href="#8816866990371059001">02 January 2018 20:29</a>
              </span>
            </div>
            <div class="comment-content">That sounds about right (and yes, IIRC that&#39;s what the RFC says). Interesting to see radvd being so strict. However, you can still advertise the prefix with long-enough lifetime and without on-link bit, and when that&#39;s picked up, stop advertising it and wait for 2 hours.</div>
          </div>
        </li>
      </div>
  </ol>

                </div>
              </div>
          </div>
        </li>
      </div>
      <div>
        <li class="comment" id="2104">
          <!--
          <div class="avatar-image-container">
            <img src="">
          </div>
          -->
          <div class="comment-block">
            <div class="comment-header">
              <cite class="user"><a href="" rel="nofollow">Scott</a></cite>
              <span class="datetime secondary-text">
                <a rel="nofollow" id="c2104" href="#2104">22 February 2024 06:20</a>
              </span>
            </div>
            <div class="comment-content"><p>&quot;A prefix information option with both A and L flags unset is meaningless and might as well be removed.&quot;</p>

<p>I&#39;m not sure this is true.  You can statically address a host, prevent it from also using SLAAC (A=0) and want to force everything to a default router (L=0).</p>

<p>I assume you could so some creative routing A=0,L=0 too.  ie. one router is the default but another might be a better first hop for a specific prefix.</p>

<p>I&#39;ve been trying to get private vlans working with FreeBSD hosts but when you statically assign an IPv6 address it adds the derived prefix to the prefix table as on-link, even with a router advertising the prefix with L=0.  Same for Windows.  One workaround is to use /128 as the prefixlen for the static address.  If you&#39;re not using community vlans that&#39;s not great though as hosts in the same community would still talk via a router.</p>

<p>This behaviour of both OSes seems contrary to RFC 5942: &quot;The assignment of an IPv6 address ... MUST NOT implicitly cause a prefix derived from that address to be treated as on-link and added to the Prefix List.&quot;</p>
</div>
              <div class="comment-replies">
                <div class="comment-thread inline-thread">
                  <span class="thread-count"><a>Replies</a></span>
                    <ol>
      <div>
        <li class="comment" id="2105">
          <!--
          <div class="avatar-image-container">
            <img src="">
          </div>
          -->
          <div class="comment-block">
            <div class="comment-header">
              <cite class="user"><a href="" rel="nofollow">Ivan Pepelnjak</a></cite>
              <span class="datetime secondary-text">
                <a rel="nofollow" id="c2105" href="#2105">22 February 2024 07:22</a>
              </span>
            </div>
            <div class="comment-content"><p>&gt; This behaviour of both OSes seems contrary to RFC 5942: &quot;The assignment of an IPv6 address ... MUST NOT implicitly cause a prefix derived from that address to be treated as on-link and added to the Prefix List.&quot;</p>

<p>One could argue that you&#39;re not assigning an address but a prefix to an interface as you specify the prefix length when configuring the interface IPv6 address.</p>

<p>As for &quot;the hosts can talk through a router&quot;, that&#39;s always the case with private VLANs, and you have to stop that on the router.</p>
</div>
          </div>
        </li>
      </div>
      <div>
        <li class="comment" id="2106">
          <!--
          <div class="avatar-image-container">
            <img src="">
          </div>
          -->
          <div class="comment-block">
            <div class="comment-header">
              <cite class="user"><a href="" rel="nofollow"> Scott</a></cite>
              <span class="datetime secondary-text">
                <a rel="nofollow" id="c2106" href="#2106">22 February 2024 12:57</a>
              </span>
            </div>
            <div class="comment-content"><p>Thanks for the reply Ivan.</p>

<p>When I said &quot;that&#39;s not great though as hosts in the same community would still talk via a router&quot; - this is not the behaviour you want on a community vlan (otherwise why would you create the community vlan in the first place?).  It&#39;s isolated vlans where you want layer 2 segmentation.</p>

<p>Private vlans with inter-host controls performed at the router are made possible for IPv4 by a combination of local routing, no ip redirects, and local proxy-arp.  However for IPv6, while the first two functions are possible (at least on a Cisco router), the third is not.  It makes sense that IPv6 local proxy-arp is unavailable/impossible since ND is done with multicasts, not broadcasts.  Therefore to get private vlans working with IPv6 you must be able to force the hosts to consider the prefix derived by their address and prefix length to be considered &quot;off-link&quot;, and therefore they should forward all traffic to the default router. (Mimicking the local proxy-arp behaviour).</p>

<p>As I said both Windows and FreeBSD (I&#39;m yet to test Linux) both add the derived prefix to the prefix table when you statically configure an address - despite what they may learn from an RA - and in violation of RFC 5942.  On the other hand if they use SLAAC by learning the prefix from an RA, then if that RA says the prefix is not on-link (L=0) then neither OS adds the prefix to the prefix table.</p>

<p>So I have successfully implemented isolated private vlans with IPv6 with SLAAC/DHCPv6, but not static addressing.  Well, static with /128 prefix lengths work.</p>

<p>Have you ever come across private vlans and IPv6?</p>

<p>Thanks.</p>
</div>
          </div>
        </li>
      </div>
  </ol>

                </div>
              </div>
          </div>
        </li>
      </div>
  </ol>

    </div>
  </div>
</div>
