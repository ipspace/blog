<div class="comments post" id="comments">
  <h4>22 comments:</h4>
  <div class="comments-content">
    <div class="comment-thread">
        <ol>
      <div>
        <li class="comment" id="1782958878908345545">
          <!--
          <div class="avatar-image-container">
            <img src="https://lh3.googleusercontent.com/zFdxGE77vvD2w5xHy6jkVuElKv-U9_9qLkRYK8OnbDeJPtjSZ82UPq5w6hJ-SA=s35">
          </div>
          -->
          <div class="comment-block">
            <div class="comment-header">
              <cite class="user"><a href="https://www.blogger.com/profile/11919257241007039006" rel="nofollow">Unknown</a></cite>
              <span class="datetime secondary-text">
                <a rel="nofollow" id="c1782958878908345545" href="#1782958878908345545">15 December 2006 16:41</a>
              </span>
            </div>
            <div class="comment-content">when you use the new zone base fw feature. when you drop and log all other traffic in a policy, is the log function done using CEF or process switching?</div>
          </div>
        </li>
      </div>
      <div>
        <li class="comment" id="8456080018885176128">
          <!--
          <div class="avatar-image-container">
            <img src="https://lh3.googleusercontent.com/zFdxGE77vvD2w5xHy6jkVuElKv-U9_9qLkRYK8OnbDeJPtjSZ82UPq5w6hJ-SA=s35">
          </div>
          -->
          <div class="comment-block">
            <div class="comment-header">
              <cite class="user"><a href="https://www.blogger.com/profile/13457151406311272386" rel="nofollow">Ivan Pepelnjak</a></cite>
              <span class="datetime secondary-text">
                <a rel="nofollow" id="c8456080018885176128" href="#8456080018885176128">15 December 2006 19:21</a>
              </span>
            </div>
            <div class="comment-content">The log function uses CEF switching (<a href="http://ioshints.blogspot.com/2006/12/which-switching-path-does-ios-feature.html">explained in a more detailed answer</a>).</div>
          </div>
        </li>
      </div>
      <div>
        <li class="comment" id="3118173507826160763">
          <!--
          <div class="avatar-image-container">
            <img src="https://lh3.googleusercontent.com/zFdxGE77vvD2w5xHy6jkVuElKv-U9_9qLkRYK8OnbDeJPtjSZ82UPq5w6hJ-SA=s35">
          </div>
          -->
          <div class="comment-block">
            <div class="comment-header">
              <cite class="user"><a href="https://www.blogger.com/profile/13821480131061730699" rel="nofollow">Unknown</a></cite>
              <span class="datetime secondary-text">
                <a rel="nofollow" id="c3118173507826160763" href="#3118173507826160763">05 February 2007 14:56</a>
              </span>
            </div>
            <div class="comment-content">Hello, <br /><br />is it mandatory to use "Class class-default --> Drop" statement in  Policy map or Policy map automatically rejects everything what is not permitted/inspected? For example I would like to permit https traffic and reject everything else. Do I need to input "Class class-default --> Drop" ?<br /><br />Thank you and Kind regards,Marko</div>
          </div>
        </li>
      </div>
      <div>
        <li class="comment" id="5201265859775272088">
          <!--
          <div class="avatar-image-container">
            <img src="https://lh3.googleusercontent.com/zFdxGE77vvD2w5xHy6jkVuElKv-U9_9qLkRYK8OnbDeJPtjSZ82UPq5w6hJ-SA=s35">
          </div>
          -->
          <div class="comment-block">
            <div class="comment-header">
              <cite class="user"><a href="https://www.blogger.com/profile/13457151406311272386" rel="nofollow">Ivan Pepelnjak</a></cite>
              <span class="datetime secondary-text">
                <a rel="nofollow" id="c5201265859775272088" href="#5201265859775272088">05 February 2007 18:30</a>
              </span>
            </div>
            <div class="comment-content">As the answer might interest many readers, <a href="http://ioshints.blogspot.com/2007/02/default-action-in-firewall-policy-maps.html">I wrote a new post about it</a>.</div>
          </div>
        </li>
      </div>
      <div>
        <li class="comment" id="8309785442244622659">
          <!--
          <div class="avatar-image-container">
            <img src="https://resources.blogblog.com/img/blank.gif">
          </div>
          -->
          <div class="comment-block">
            <div class="comment-header">
              <cite class="user"><a href="None" rel="nofollow">Anonymous</a></cite>
              <span class="datetime secondary-text">
                <a rel="nofollow" id="c8309785442244622659" href="#8309785442244622659">05 May 2007 11:55</a>
              </span>
            </div>
            <div class="comment-content">I've read your book, which I found clear and well put together.<BR/><BR/>I was, however, left wondering why there was such little apparent use made of the feature in real life.<BR/><BR/>IOS Zone-based firewalls are supposed to be easier to set up and understand (arguable), more precise, and possibly offering higher throughput, but there seem to be relatively few examples of their use, even with their support in SDM 2.4.<BR/><BR/>Is it because<BR/><BR/>(a) they are a relatively recent addition to IOS and so there is less documentation / experience / expertise available for their use.<BR/><BR/>(b) they are not easier to configure/maintain in practice.<BR/><BR/>For example you still need to use Access Control Lists to let particular types of icmp through, because the ZBF operates on a protocol basis.<BR/><BR/>And, instead of an easy to read list of what is blocked/passed, you have zones, zone links, protocol inspection rules, etc. Even with SDM, there is a good deal of setting up of the building blocks before you can use them.<BR/><BR/>Am I missing something?</div>
          </div>
        </li>
      </div>
      <div>
        <li class="comment" id="4680666118297187931">
          <!--
          <div class="avatar-image-container">
            <img src="https://lh3.googleusercontent.com/zFdxGE77vvD2w5xHy6jkVuElKv-U9_9qLkRYK8OnbDeJPtjSZ82UPq5w6hJ-SA=s35">
          </div>
          -->
          <div class="comment-block">
            <div class="comment-header">
              <cite class="user"><a href="https://www.blogger.com/profile/13457151406311272386" rel="nofollow">Ivan Pepelnjak</a></cite>
              <span class="datetime secondary-text">
                <a rel="nofollow" id="c4680666118297187931" href="#4680666118297187931">05 May 2007 14:59</a>
              </span>
            </div>
            <div class="comment-content">Thanks for your thoughts about the book :)<BR/><BR/>I would assume that the (current)low acceptance of the zone-based configuration is based both on the release it's available in (I would never put an "experimental" IOS release like a T release in my production network unless forced to do so by a mandatory feature or new hardware platform) as well as relative unfamiliarity (people still think in terms of access lists).<BR/><BR/>I also agree with you that the configuration interface is a bit baroque (with classes, policies, inter-zone service policies ...) and it's definitely easier to write an access list ... if you have only two zones. However, try writing an access list for a complex firewall with 4 or 5 zones (where you have to merge all your inter-zone policies into a single access list) and you'll start appreciating the zone-based configuration. The configuration model is even more useful if you have multiple zones that have the same inter-zone policy toward a target zone (for example, all internal zones have the same policy toward the Internet).<BR/><BR/>Having said all that, a year ago, I would probably still stick to the access-lists (even if the zone-based configuration would be available in a GD release) if I'd have to do a quick configuration job. Having climbed the learning curve, I will definitely use the new approach in my future projects ... once it becomes available in a stable major release.</div>
          </div>
        </li>
      </div>
      <div>
        <li class="comment" id="8603236615876079489">
          <!--
          <div class="avatar-image-container">
            <img src="https://resources.blogblog.com/img/blank.gif">
          </div>
          -->
          <div class="comment-block">
            <div class="comment-header">
              <cite class="user"><a href="None" rel="nofollow">Anonymous</a></cite>
              <span class="datetime secondary-text">
                <a rel="nofollow" id="c8603236615876079489" href="#8603236615876079489">06 May 2007 14:16</a>
              </span>
            </div>
            <div class="comment-content">I have just provisioned a router with from scratch using SDM2.4.<BR/><BR/>It now installs a zone-based firewall by default.<BR/><BR/>I am struggling to<BR/><BR/>(1) get BGP going, to pick up bogon lists from cymru (repeated no route to peer messages)<BR/><BR/>(2)  L2TP/IPSec connections.<BR/><BR/>This is a straightforward DSL+LAN setup (no DMZ).<BR/><BR/>My main issue (apart from the sheer number of settings that SDM generates) is a confusion between when to use self and when to use in/outside.</div>
          </div>
        </li>
      </div>
      <div>
        <li class="comment" id="7027510866129438382">
          <!--
          <div class="avatar-image-container">
            <img src="https://resources.blogblog.com/img/blank.gif">
          </div>
          -->
          <div class="comment-block">
            <div class="comment-header">
              <cite class="user"><a href="None" rel="nofollow">Anonymous</a></cite>
              <span class="datetime secondary-text">
                <a rel="nofollow" id="c7027510866129438382" href="#7027510866129438382">07 May 2007 22:38</a>
              </span>
            </div>
            <div class="comment-content">The trick seems to be to allow isakmp & esp from out to self, and to add a static route to the cymru bgp peer.</div>
          </div>
        </li>
      </div>
      <div>
        <li class="comment" id="6564776262219306583">
          <!--
          <div class="avatar-image-container">
            <img src="https://lh3.googleusercontent.com/zFdxGE77vvD2w5xHy6jkVuElKv-U9_9qLkRYK8OnbDeJPtjSZ82UPq5w6hJ-SA=s35">
          </div>
          -->
          <div class="comment-block">
            <div class="comment-header">
              <cite class="user"><a href="https://www.blogger.com/profile/13457151406311272386" rel="nofollow">Ivan Pepelnjak</a></cite>
              <span class="datetime secondary-text">
                <a rel="nofollow" id="c6564776262219306583" href="#6564776262219306583">08 May 2007 06:28</a>
              </span>
            </div>
            <div class="comment-content">You're right regarding the IPSec issues, I also wrote a post <A HREF="http://ioshints.blogspot.com/2007/05/self-zone-in-zone-based-firewall.html" REL="nofollow">detailing the rules of the <B>self</B> zone usage</A>.<BR/><BR/>As for the BGP session, it looks like the router is not willing to use the default route to get to its BGP peer. Interesting, will check it in my lab :)</div>
          </div>
        </li>
      </div>
      <div>
        <li class="comment" id="529543502780548877">
          <!--
          <div class="avatar-image-container">
            <img src="https://resources.blogblog.com/img/blank.gif">
          </div>
          -->
          <div class="comment-block">
            <div class="comment-header">
              <cite class="user"><a href="None" rel="nofollow">Anonymous</a></cite>
              <span class="datetime secondary-text">
                <a rel="nofollow" id="c529543502780548877" href="#529543502780548877">11 May 2007 00:55</a>
              </span>
            </div>
            <div class="comment-content">The other thing that I am noticing is that cymru BGP appears to be trying to send a message from port 179 into a random high-numbered port in my router.  This gets blocked, even though I am inspecting outgoing bgp.<BR/><BR/>Perhaps it is something to do with the time it takes to build IPS signatures as the ATM goes up</div>
          </div>
        </li>
      </div>
      <div>
        <li class="comment" id="581757868414463741">
          <!--
          <div class="avatar-image-container">
            <img src="https://resources.blogblog.com/img/blank.gif">
          </div>
          -->
          <div class="comment-block">
            <div class="comment-header">
              <cite class="user"><a href="None" rel="nofollow">Anonymous</a></cite>
              <span class="datetime secondary-text">
                <a rel="nofollow" id="c581757868414463741" href="#581757868414463741">05 June 2007 00:39</a>
              </span>
            </div>
            <div class="comment-content">A further example that would be helpful is the setup for SIP.<BR/><BR/>I notice that just opening SIP and RTP (in my case 5004 or 5006) does not help. I also seem to have to open UDP to get the RTP connection to work; otherwise, it just seems to be blocked, even if it is open.<BR/><BR/>Thanks.</div>
          </div>
        </li>
      </div>
      <div>
        <li class="comment" id="9151212678508578273">
          <!--
          <div class="avatar-image-container">
            <img src="https://resources.blogblog.com/img/blank.gif">
          </div>
          -->
          <div class="comment-block">
            <div class="comment-header">
              <cite class="user"><a href="None" rel="nofollow">Anonymous</a></cite>
              <span class="datetime secondary-text">
                <a rel="nofollow" id="c9151212678508578273" href="#9151212678508578273">25 June 2007 09:02</a>
              </span>
            </div>
            <div class="comment-content">An apparent limitation of the ZBF approach is that out-of-order packets in TCP streams are not cached and reassembled before they are inspected by IPS or the firewall http://www.cisco.com/en/US/products/ps6441/products_feature_guide09186a0080768229.html<BR/><BR/>What difference does this make in real life?</div>
          </div>
        </li>
      </div>
      <div>
        <li class="comment" id="6092871295987279889">
          <!--
          <div class="avatar-image-container">
            <img src="https://lh3.googleusercontent.com/zFdxGE77vvD2w5xHy6jkVuElKv-U9_9qLkRYK8OnbDeJPtjSZ82UPq5w6hJ-SA=s35">
          </div>
          -->
          <div class="comment-block">
            <div class="comment-header">
              <cite class="user"><a href="https://www.blogger.com/profile/13457151406311272386" rel="nofollow">Ivan Pepelnjak</a></cite>
              <span class="datetime secondary-text">
                <a rel="nofollow" id="c6092871295987279889" href="#6092871295987279889">25 June 2007 18:52</a>
              </span>
            </div>
            <div class="comment-content">I <A HREF="http://ioshints.blogspot.com/2007/01/firewalls-kill-tcp-performance-when.html" REL="nofollow">wrote a post about this problem</A> a while ago, but as it was mis-labeled, even I had problems finding it :( ... fixed now.<BR/><BR/>The only situation where you'd get out-of-order TCP packets in real life is if a box anywhere in the end-to-end path is doing per-packet load sharing ... or if you do weird QoS stuff classifying some TCP packets in a session in a different class than others (for example, mark long packets low-priority).</div>
          </div>
        </li>
      </div>
      <div>
        <li class="comment" id="4473495474711736867">
          <!--
          <div class="avatar-image-container">
            <img src="https://resources.blogblog.com/img/blank.gif">
          </div>
          -->
          <div class="comment-block">
            <div class="comment-header">
              <cite class="user"><a href="None" rel="nofollow">Anonymous</a></cite>
              <span class="datetime secondary-text">
                <a rel="nofollow" id="c4473495474711736867" href="#4473495474711736867">12 March 2008 10:01</a>
              </span>
            </div>
            <div class="comment-content">I notice that configuring deep packet (L7) http inspection seems to kill my download speed. Is there a work-around?</div>
          </div>
        </li>
      </div>
      <div>
        <li class="comment" id="7814092516428975273">
          <!--
          <div class="avatar-image-container">
            <img src="https://lh3.googleusercontent.com/zFdxGE77vvD2w5xHy6jkVuElKv-U9_9qLkRYK8OnbDeJPtjSZ82UPq5w6hJ-SA=s35">
          </div>
          -->
          <div class="comment-block">
            <div class="comment-header">
              <cite class="user"><a href="https://www.blogger.com/profile/13457151406311272386" rel="nofollow">Ivan Pepelnjak</a></cite>
              <span class="datetime secondary-text">
                <a rel="nofollow" id="c7814092516428975273" href="#7814092516428975273">13 March 2008 11:24</a>
              </span>
            </div>
            <div class="comment-content">Apart from buying a faster router, disabling the deep packet inspection or upgrading IOS (and hoping that a newer release is more optimized), there's not much you can do, it's a CPU-intensive task. Just to be on the safe side, inspect the "show proc cpu" output to verify that the CPU load is really getting close to 100%.</div>
          </div>
        </li>
      </div>
      <div>
        <li class="comment" id="844604590708936109">
          <!--
          <div class="avatar-image-container">
            <img src="https://resources.blogblog.com/img/blank.gif">
          </div>
          -->
          <div class="comment-block">
            <div class="comment-header">
              <cite class="user"><a href="None" rel="nofollow">John Moseley</a></cite>
              <span class="datetime secondary-text">
                <a rel="nofollow" id="c844604590708936109" href="#844604590708936109">08 January 2010 21:46</a>
              </span>
            </div>
            <div class="comment-content">Hi guys, I&#39;m slightly confused.  Is the zone based feature available on Cisco ASA&#39;s or is it purely a router feature?  If it is available what OS version?<br /><br />Many Thanks</div>
          </div>
        </li>
      </div>
      <div>
        <li class="comment" id="5725830241672436463">
          <!--
          <div class="avatar-image-container">
            <img src="https://resources.blogblog.com/img/blank.gif">
          </div>
          -->
          <div class="comment-block">
            <div class="comment-header">
              <cite class="user"><a href="None" rel="nofollow">Ivan Pepelnjak</a></cite>
              <span class="datetime secondary-text">
                <a rel="nofollow" id="c5725830241672436463" href="#5725830241672436463">09 January 2010 20:22</a>
              </span>
            </div>
            <div class="comment-content">This book describes the IOS implementation (available in 12.4T and 15.0). Something very similar is available in ASA.</div>
          </div>
        </li>
      </div>
      <div>
        <li class="comment" id="7295103162812699119">
          <!--
          <div class="avatar-image-container">
            <img src="https://resources.blogblog.com/img/blank.gif">
          </div>
          -->
          <div class="comment-block">
            <div class="comment-header">
              <cite class="user"><a href="None" rel="nofollow">Victor</a></cite>
              <span class="datetime secondary-text">
                <a rel="nofollow" id="c7295103162812699119" href="#7295103162812699119">30 May 2010 00:58</a>
              </span>
            </div>
            <div class="comment-content">Hello Ivan,<br /><br />Could you pls provide any insight about inspecting mpls encapsulated traffic with ZBF? I&#39;ve been unable to find much information about such topic? I heard about an specific solution using an special hairpin to decapsulate and loop back the traffic using a tunnel interface.<br /><br />Thanks.... Victor.</div>
          </div>
        </li>
      </div>
      <div>
        <li class="comment" id="5682369716778181411">
          <!--
          <div class="avatar-image-container">
            <img src="https://resources.blogblog.com/img/blank.gif">
          </div>
          -->
          <div class="comment-block">
            <div class="comment-header">
              <cite class="user"><a href="None" rel="nofollow">Ivan Pepelnjak</a></cite>
              <span class="datetime secondary-text">
                <a rel="nofollow" id="c5682369716778181411" href="#5682369716778181411">30 May 2010 16:13</a>
              </span>
            </div>
            <div class="comment-content">Never tried that. I would assume ZBF works only on pure IP traffic. What exactly are you looking for?</div>
          </div>
        </li>
      </div>
      <div>
        <li class="comment" id="3366312313158156171">
          <!--
          <div class="avatar-image-container">
            <img src="https://resources.blogblog.com/img/blank.gif">
          </div>
          -->
          <div class="comment-block">
            <div class="comment-header">
              <cite class="user"><a href="None" rel="nofollow">Victor.</a></cite>
              <span class="datetime secondary-text">
                <a rel="nofollow" id="c3366312313158156171" href="#3366312313158156171">01 June 2010 01:42</a>
              </span>
            </div>
            <div class="comment-content">Hi Ivan, thank you for your response, I&#39;m working on a exercise where they ask to apply inspection (ZBF) to the VPN traffic between two PEs. Basically the solution provided is creating a new VRF on the device along with a Tunnel, one of the Tunnel interfaces belong to the newly created VRF and the other to the VRF already present, essentially linking both VRF&#39;s back-to-back on the same router. Finally the policies are applied on the tunnel interface, where the traffic is transiting unlabeled. Until now, this solution (VRFs workaround) has been difficult to understand.<br />By the way, your book on this subject has been a good reading.<br />Thanks in advance for your help. Regards.... Victor.</div>
          </div>
        </li>
      </div>
      <div>
        <li class="comment" id="5799293649154071422">
          <!--
          <div class="avatar-image-container">
            <img src="https://resources.blogblog.com/img/blank.gif">
          </div>
          -->
          <div class="comment-block">
            <div class="comment-header">
              <cite class="user"><a href="None" rel="nofollow">Carlos</a></cite>
              <span class="datetime secondary-text">
                <a rel="nofollow" id="c5799293649154071422" href="#5799293649154071422">06 May 2011 01:07</a>
              </span>
            </div>
            <div class="comment-content">Hi Ivan,<br /><br />I have just read your book on deploying ZBF and was a great read. Really helped to break down ZBF for me so thanks. <br /><br />One thing I noticed is your method for all out traffic to be inspected (listing 3-5) says <br />policy-map type inspect InsideToOutside<br />   class class-default<br />      inspect<br /><br />I am using that latest release of IOS 15.1(4)m and it seems that you can no longer use inspect on the class-default anymore.<br /><br />rtr(config-pmap)# class class-default<br />rtr(config-pmap-c)#  inspect<br />%Action inspect cannot be added to class-default<br /><br />Just wondering what you recommend in place of this? Was thinking to use a class map inspect for tcp,udp,icmp.<br /><br />Thanks</div>
          </div>
        </li>
      </div>
      <div>
        <li class="comment" id="3946335531141557875">
          <!--
          <div class="avatar-image-container">
            <img src="https://resources.blogblog.com/img/blank.gif">
          </div>
          -->
          <div class="comment-block">
            <div class="comment-header">
              <cite class="user"><a href="None" rel="nofollow">Ivan Pepelnjak</a></cite>
              <span class="datetime secondary-text">
                <a rel="nofollow" id="c3946335531141557875" href="#3946335531141557875">08 May 2011 11:07</a>
              </span>
            </div>
            <div class="comment-content">Weird. The workaround would be to create a class that matches TCP, UDP or ICMP.<br /><br />Not sure whether you&#39;d have to put FTP/SIP in a separate class to ensure ZBF does deep(er) packet inspection.</div>
          </div>
        </li>
      </div>
  </ol>

    </div>
  </div>
</div>
