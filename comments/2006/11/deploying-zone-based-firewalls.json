{
  "comments": [
    {
      "date": "15 December 2006 16:41",
      "html": "when you use the new zone base fw feature. when you drop and log all other traffic in a policy, is the log function done using CEF or process switching?",
      "id": "1782958878908345545",
      "image": "https://lh3.googleusercontent.com/zFdxGE77vvD2w5xHy6jkVuElKv-U9_9qLkRYK8OnbDeJPtjSZ82UPq5w6hJ-SA=s35",
      "name": "Unknown",
      "profile": "https://www.blogger.com/profile/11919257241007039006",
      "pub": "2006-12-15T16:41:00.000+01:00",
      "ref": "116378849409736138",
      "type": "comment"
    },
    {
      "date": "15 December 2006 19:21",
      "html": "The log function uses CEF switching (<a href=\"http://ioshints.blogspot.com/2006/12/which-switching-path-does-ios-feature.html\">explained in a more detailed answer</a>).",
      "id": "8456080018885176128",
      "image": "https://lh3.googleusercontent.com/zFdxGE77vvD2w5xHy6jkVuElKv-U9_9qLkRYK8OnbDeJPtjSZ82UPq5w6hJ-SA=s35",
      "name": "Ivan Pepelnjak",
      "profile": "https://www.blogger.com/profile/13457151406311272386",
      "pub": "2006-12-15T19:21:00.000+01:00",
      "ref": "116378849409736138",
      "type": "comment"
    },
    {
      "date": "05 February 2007 14:56",
      "html": "Hello, <br /><br />is it mandatory to use \"Class class-default --> Drop\" statement in  Policy map or Policy map automatically rejects everything what is not permitted/inspected? For example I would like to permit https traffic and reject everything else. Do I need to input \"Class class-default --> Drop\" ?<br /><br />Thank you and Kind regards,Marko",
      "id": "3118173507826160763",
      "image": "https://lh3.googleusercontent.com/zFdxGE77vvD2w5xHy6jkVuElKv-U9_9qLkRYK8OnbDeJPtjSZ82UPq5w6hJ-SA=s35",
      "name": "Unknown",
      "profile": "https://www.blogger.com/profile/13821480131061730699",
      "pub": "2007-02-05T14:56:00.000+01:00",
      "ref": "116378849409736138",
      "type": "comment"
    },
    {
      "date": "05 February 2007 18:30",
      "html": "As the answer might interest many readers, <a href=\"http://ioshints.blogspot.com/2007/02/default-action-in-firewall-policy-maps.html\">I wrote a new post about it</a>.",
      "id": "5201265859775272088",
      "image": "https://lh3.googleusercontent.com/zFdxGE77vvD2w5xHy6jkVuElKv-U9_9qLkRYK8OnbDeJPtjSZ82UPq5w6hJ-SA=s35",
      "name": "Ivan Pepelnjak",
      "profile": "https://www.blogger.com/profile/13457151406311272386",
      "pub": "2007-02-05T18:30:00.000+01:00",
      "ref": "116378849409736138",
      "type": "comment"
    },
    {
      "date": "05 May 2007 11:55",
      "html": "I've read your book, which I found clear and well put together.<BR/><BR/>I was, however, left wondering why there was such little apparent use made of the feature in real life.<BR/><BR/>IOS Zone-based firewalls are supposed to be easier to set up and understand (arguable), more precise, and possibly offering higher throughput, but there seem to be relatively few examples of their use, even with their support in SDM 2.4.<BR/><BR/>Is it because<BR/><BR/>(a) they are a relatively recent addition to IOS and so there is less documentation / experience / expertise available for their use.<BR/><BR/>(b) they are not easier to configure/maintain in practice.<BR/><BR/>For example you still need to use Access Control Lists to let particular types of icmp through, because the ZBF operates on a protocol basis.<BR/><BR/>And, instead of an easy to read list of what is blocked/passed, you have zones, zone links, protocol inspection rules, etc. Even with SDM, there is a good deal of setting up of the building blocks before you can use them.<BR/><BR/>Am I missing something?",
      "id": "8309785442244622659",
      "image": "https://resources.blogblog.com/img/blank.gif",
      "name": "Anonymous",
      "profile": null,
      "pub": "2007-05-05T11:55:00.000+02:00",
      "ref": "116378849409736138",
      "type": "comment"
    },
    {
      "date": "05 May 2007 14:59",
      "html": "Thanks for your thoughts about the book :)<BR/><BR/>I would assume that the (current)low acceptance of the zone-based configuration is based both on the release it's available in (I would never put an \"experimental\" IOS release like a T release in my production network unless forced to do so by a mandatory feature or new hardware platform) as well as relative unfamiliarity (people still think in terms of access lists).<BR/><BR/>I also agree with you that the configuration interface is a bit baroque (with classes, policies, inter-zone service policies ...) and it's definitely easier to write an access list ... if you have only two zones. However, try writing an access list for a complex firewall with 4 or 5 zones (where you have to merge all your inter-zone policies into a single access list) and you'll start appreciating the zone-based configuration. The configuration model is even more useful if you have multiple zones that have the same inter-zone policy toward a target zone (for example, all internal zones have the same policy toward the Internet).<BR/><BR/>Having said all that, a year ago, I would probably still stick to the access-lists (even if the zone-based configuration would be available in a GD release) if I'd have to do a quick configuration job. Having climbed the learning curve, I will definitely use the new approach in my future projects ... once it becomes available in a stable major release.",
      "id": "4680666118297187931",
      "image": "https://lh3.googleusercontent.com/zFdxGE77vvD2w5xHy6jkVuElKv-U9_9qLkRYK8OnbDeJPtjSZ82UPq5w6hJ-SA=s35",
      "name": "Ivan Pepelnjak",
      "profile": "https://www.blogger.com/profile/13457151406311272386",
      "pub": "2007-05-05T14:59:00.000+02:00",
      "ref": "116378849409736138",
      "type": "comment"
    },
    {
      "date": "06 May 2007 14:16",
      "html": "I have just provisioned a router with from scratch using SDM2.4.<BR/><BR/>It now installs a zone-based firewall by default.<BR/><BR/>I am struggling to<BR/><BR/>(1) get BGP going, to pick up bogon lists from cymru (repeated no route to peer messages)<BR/><BR/>(2)  L2TP/IPSec connections.<BR/><BR/>This is a straightforward DSL+LAN setup (no DMZ).<BR/><BR/>My main issue (apart from the sheer number of settings that SDM generates) is a confusion between when to use self and when to use in/outside.",
      "id": "8603236615876079489",
      "image": "https://resources.blogblog.com/img/blank.gif",
      "name": "Anonymous",
      "profile": null,
      "pub": "2007-05-06T14:16:00.000+02:00",
      "ref": "116378849409736138",
      "type": "comment"
    },
    {
      "date": "07 May 2007 22:38",
      "html": "The trick seems to be to allow isakmp & esp from out to self, and to add a static route to the cymru bgp peer.",
      "id": "7027510866129438382",
      "image": "https://resources.blogblog.com/img/blank.gif",
      "name": "Anonymous",
      "profile": null,
      "pub": "2007-05-07T22:38:00.000+02:00",
      "ref": "116378849409736138",
      "type": "comment"
    },
    {
      "date": "08 May 2007 06:28",
      "html": "You're right regarding the IPSec issues, I also wrote a post <A HREF=\"http://ioshints.blogspot.com/2007/05/self-zone-in-zone-based-firewall.html\" REL=\"nofollow\">detailing the rules of the <B>self</B> zone usage</A>.<BR/><BR/>As for the BGP session, it looks like the router is not willing to use the default route to get to its BGP peer. Interesting, will check it in my lab :)",
      "id": "6564776262219306583",
      "image": "https://lh3.googleusercontent.com/zFdxGE77vvD2w5xHy6jkVuElKv-U9_9qLkRYK8OnbDeJPtjSZ82UPq5w6hJ-SA=s35",
      "name": "Ivan Pepelnjak",
      "profile": "https://www.blogger.com/profile/13457151406311272386",
      "pub": "2007-05-08T06:28:00.000+02:00",
      "ref": "116378849409736138",
      "type": "comment"
    },
    {
      "date": "11 May 2007 00:55",
      "html": "The other thing that I am noticing is that cymru BGP appears to be trying to send a message from port 179 into a random high-numbered port in my router.  This gets blocked, even though I am inspecting outgoing bgp.<BR/><BR/>Perhaps it is something to do with the time it takes to build IPS signatures as the ATM goes up",
      "id": "529543502780548877",
      "image": "https://resources.blogblog.com/img/blank.gif",
      "name": "Anonymous",
      "profile": null,
      "pub": "2007-05-11T00:55:00.000+02:00",
      "ref": "116378849409736138",
      "type": "comment"
    },
    {
      "date": "05 June 2007 00:39",
      "html": "A further example that would be helpful is the setup for SIP.<BR/><BR/>I notice that just opening SIP and RTP (in my case 5004 or 5006) does not help. I also seem to have to open UDP to get the RTP connection to work; otherwise, it just seems to be blocked, even if it is open.<BR/><BR/>Thanks.",
      "id": "581757868414463741",
      "image": "https://resources.blogblog.com/img/blank.gif",
      "name": "Anonymous",
      "profile": null,
      "pub": "2007-06-05T00:39:00.000+02:00",
      "ref": "116378849409736138",
      "type": "comment"
    },
    {
      "date": "25 June 2007 09:02",
      "html": "An apparent limitation of the ZBF approach is that out-of-order packets in TCP streams are not cached and reassembled before they are inspected by IPS or the firewall http://www.cisco.com/en/US/products/ps6441/products_feature_guide09186a0080768229.html<BR/><BR/>What difference does this make in real life?",
      "id": "9151212678508578273",
      "image": "https://resources.blogblog.com/img/blank.gif",
      "name": "Anonymous",
      "profile": null,
      "pub": "2007-06-25T09:02:00.000+02:00",
      "ref": "116378849409736138",
      "type": "comment"
    },
    {
      "date": "25 June 2007 18:52",
      "html": "I <A HREF=\"http://ioshints.blogspot.com/2007/01/firewalls-kill-tcp-performance-when.html\" REL=\"nofollow\">wrote a post about this problem</A> a while ago, but as it was mis-labeled, even I had problems finding it :( ... fixed now.<BR/><BR/>The only situation where you'd get out-of-order TCP packets in real life is if a box anywhere in the end-to-end path is doing per-packet load sharing ... or if you do weird QoS stuff classifying some TCP packets in a session in a different class than others (for example, mark long packets low-priority).",
      "id": "6092871295987279889",
      "image": "https://lh3.googleusercontent.com/zFdxGE77vvD2w5xHy6jkVuElKv-U9_9qLkRYK8OnbDeJPtjSZ82UPq5w6hJ-SA=s35",
      "name": "Ivan Pepelnjak",
      "profile": "https://www.blogger.com/profile/13457151406311272386",
      "pub": "2007-06-25T18:52:00.000+02:00",
      "ref": "116378849409736138",
      "type": "comment"
    },
    {
      "date": "12 March 2008 10:01",
      "html": "I notice that configuring deep packet (L7) http inspection seems to kill my download speed. Is there a work-around?",
      "id": "4473495474711736867",
      "image": "https://resources.blogblog.com/img/blank.gif",
      "name": "Anonymous",
      "profile": null,
      "pub": "2008-03-12T10:01:00.000+01:00",
      "ref": "116378849409736138",
      "type": "comment"
    },
    {
      "date": "13 March 2008 11:24",
      "html": "Apart from buying a faster router, disabling the deep packet inspection or upgrading IOS (and hoping that a newer release is more optimized), there's not much you can do, it's a CPU-intensive task. Just to be on the safe side, inspect the \"show proc cpu\" output to verify that the CPU load is really getting close to 100%.",
      "id": "7814092516428975273",
      "image": "https://lh3.googleusercontent.com/zFdxGE77vvD2w5xHy6jkVuElKv-U9_9qLkRYK8OnbDeJPtjSZ82UPq5w6hJ-SA=s35",
      "name": "Ivan Pepelnjak",
      "profile": "https://www.blogger.com/profile/13457151406311272386",
      "pub": "2008-03-13T11:24:00.000+01:00",
      "ref": "116378849409736138",
      "type": "comment"
    },
    {
      "date": "08 January 2010 21:46",
      "html": "Hi guys, I&#39;m slightly confused.  Is the zone based feature available on Cisco ASA&#39;s or is it purely a router feature?  If it is available what OS version?<br /><br />Many Thanks",
      "id": "844604590708936109",
      "image": "https://resources.blogblog.com/img/blank.gif",
      "name": "John Moseley",
      "profile": null,
      "pub": "2010-01-08T21:46:46.000+01:00",
      "ref": "116378849409736138",
      "type": "comment"
    },
    {
      "date": "09 January 2010 20:22",
      "html": "This book describes the IOS implementation (available in 12.4T and 15.0). Something very similar is available in ASA.",
      "id": "5725830241672436463",
      "image": "https://resources.blogblog.com/img/blank.gif",
      "name": "Ivan Pepelnjak",
      "profile": null,
      "pub": "2010-01-09T20:22:37.000+01:00",
      "ref": "116378849409736138",
      "type": "comment"
    },
    {
      "date": "30 May 2010 00:58",
      "html": "Hello Ivan,<br /><br />Could you pls provide any insight about inspecting mpls encapsulated traffic with ZBF? I&#39;ve been unable to find much information about such topic? I heard about an specific solution using an special hairpin to decapsulate and loop back the traffic using a tunnel interface.<br /><br />Thanks.... Victor.",
      "id": "7295103162812699119",
      "image": "https://resources.blogblog.com/img/blank.gif",
      "name": "Victor",
      "profile": null,
      "pub": "2010-05-30T00:58:09.000+02:00",
      "ref": "116378849409736138",
      "type": "comment"
    },
    {
      "date": "30 May 2010 16:13",
      "html": "Never tried that. I would assume ZBF works only on pure IP traffic. What exactly are you looking for?",
      "id": "5682369716778181411",
      "image": "https://resources.blogblog.com/img/blank.gif",
      "name": "Ivan Pepelnjak",
      "profile": null,
      "pub": "2010-05-30T16:13:20.000+02:00",
      "ref": "116378849409736138",
      "type": "comment"
    },
    {
      "date": "01 June 2010 01:42",
      "html": "Hi Ivan, thank you for your response, I&#39;m working on a exercise where they ask to apply inspection (ZBF) to the VPN traffic between two PEs. Basically the solution provided is creating a new VRF on the device along with a Tunnel, one of the Tunnel interfaces belong to the newly created VRF and the other to the VRF already present, essentially linking both VRF&#39;s back-to-back on the same router. Finally the policies are applied on the tunnel interface, where the traffic is transiting unlabeled. Until now, this solution (VRFs workaround) has been difficult to understand.<br />By the way, your book on this subject has been a good reading.<br />Thanks in advance for your help. Regards.... Victor.",
      "id": "3366312313158156171",
      "image": "https://resources.blogblog.com/img/blank.gif",
      "name": "Victor.",
      "profile": null,
      "pub": "2010-06-01T01:42:03.000+02:00",
      "ref": "116378849409736138",
      "type": "comment"
    },
    {
      "date": "06 May 2011 01:07",
      "html": "Hi Ivan,<br /><br />I have just read your book on deploying ZBF and was a great read. Really helped to break down ZBF for me so thanks. <br /><br />One thing I noticed is your method for all out traffic to be inspected (listing 3-5) says <br />policy-map type inspect InsideToOutside<br />   class class-default<br />      inspect<br /><br />I am using that latest release of IOS 15.1(4)m and it seems that you can no longer use inspect on the class-default anymore.<br /><br />rtr(config-pmap)# class class-default<br />rtr(config-pmap-c)#  inspect<br />%Action inspect cannot be added to class-default<br /><br />Just wondering what you recommend in place of this? Was thinking to use a class map inspect for tcp,udp,icmp.<br /><br />Thanks",
      "id": "5799293649154071422",
      "image": "https://resources.blogblog.com/img/blank.gif",
      "name": "Carlos",
      "profile": null,
      "pub": "2011-05-06T01:07:53.660+02:00",
      "ref": "116378849409736138",
      "type": "comment"
    },
    {
      "date": "08 May 2011 11:07",
      "html": "Weird. The workaround would be to create a class that matches TCP, UDP or ICMP.<br /><br />Not sure whether you&#39;d have to put FTP/SIP in a separate class to ensure ZBF does deep(er) packet inspection.",
      "id": "3946335531141557875",
      "image": "https://resources.blogblog.com/img/blank.gif",
      "name": "Ivan Pepelnjak",
      "profile": null,
      "pub": "2011-05-08T11:07:38.046+02:00",
      "ref": "116378849409736138",
      "type": "comment"
    }
  ],
  "count": 22,
  "id": "116378849409736138",
  "type": "post",
  "url": "2006/11/deploying-zone-based-firewalls.html"
}