<div class="comments post" id="comments">
  <h4>2 comments:</h4>
  <div class="comments-content">
    <div class="comment-thread">
        <ol>
      <div>
        <li class="comment" id="2045">
          <!--
          <div class="avatar-image-container">
            <img src="">
          </div>
          -->
          <div class="comment-block">
            <div class="comment-header">
              <cite class="user"><a href="" rel="nofollow">Anonymous</a></cite>
              <span class="datetime secondary-text">
                <a rel="nofollow" id="c2045" href="#2045">19 December 2023 08:22</a>
              </span>
            </div>
            <div class="comment-content"><p>There&#39;s a hint in your topology file.  </p>

<p>&gt; Each one has a public AS number.  </p>

<p>None of them has a public AS number. They all have a private AS number.</p>

<p>&gt; The only change you can make is a new BGP session between PE2 and PE2.  </p>

<p>It should be PE3 there.  </p>

<p>To meet your requirements I would configure BGP with something along &quot;neighbor 172.29.42.x local-as 65003 no-prepend&quot; on PE2 respectively &quot;neighbor 172.29.42.x local-as 65000 no-prepend&quot; on PE3 and &quot;neighbor 172.29.42.x next-hop-self&quot; on both PE2 and PE3.  </p>

<p>I haven&#39;t tested it with your lab tool.</p>
</div>
              <div class="comment-replies">
                <div class="comment-thread inline-thread">
                  <span class="thread-count"><a>Replies</a></span>
                    <ol>
      <div>
        <li class="comment" id="2046">
          <!--
          <div class="avatar-image-container">
            <img src="">
          </div>
          -->
          <div class="comment-block">
            <div class="comment-header">
              <cite class="user"><a href="" rel="nofollow"> chris</a></cite>
              <span class="datetime secondary-text">
                <a rel="nofollow" id="c2046" href="#2046">19 December 2023 11:27</a>
              </span>
            </div>
            <div class="comment-content"><p>Not sure it would work, it seems that you cannot use local-as with the same value as the AS of the peer:</p>

<p>https://www.cisco.com/c/en/us/support/docs/ip/border-gateway-protocol-bgp/13761-39.html</p>

<p>&quot;Local-AS cannot have the local BGP protocol AS number or the AS number of the remote peer.&quot;</p>
</div>
          </div>
        </li>
      </div>
      <div>
        <li class="comment" id="2047">
          <!--
          <div class="avatar-image-container">
            <img src="">
          </div>
          -->
          <div class="comment-block">
            <div class="comment-header">
              <cite class="user"><a href="" rel="nofollow">Ivan Pepelnjak</a></cite>
              <span class="datetime secondary-text">
                <a rel="nofollow" id="c2047" href="#2047">20 December 2023 08:00</a>
              </span>
            </div>
            <div class="comment-content"><p>@Anonymous: thanks a million for the typo report. Hopefully, I fixed everything you mentioned.</p>

<p>As for the &quot;hint in the topology file&quot; -- I had to use that parameter to prevent the automatic configuration of a BGP session between PE2 and PE3. Found a better way to do that.</p>
</div>
          </div>
        </li>
      </div>
  </ol>

                </div>
              </div>
          </div>
        </li>
      </div>
      <div>
        <li class="comment" id="2051">
          <!--
          <div class="avatar-image-container">
            <img src="">
          </div>
          -->
          <div class="comment-block">
            <div class="comment-header">
              <cite class="user"><a href="" rel="nofollow"> PJO</a></cite>
              <span class="datetime secondary-text">
                <a rel="nofollow" id="c2051" href="#2051">20 December 2023 01:39</a>
              </span>
            </div>
            <div class="comment-content"><p>I think i got it right !
My only assumption is that the PE/RR peers use next-hop-self knobs, which makes sense at least for PE1 and PE4. An alternative is to advertise the network 172.29.42.0/24 into BGP, which is not forbidden :)</p>

<p>For my lab, i replaced backbone AS by 5000 and 5003 in order to use public AS and it is still OK !</p>

<p>Thanks Ivan for the fun !</p>

<pre>
x2#sh ip bgp | b Netw
     Network          Next Hop            Metric LocPrf Weight Path
 *&gt;  192.168.100.0    10.1.0.17                              0 5003 65100 i
 *&gt;  192.168.107.0    0.0.0.0                  0         32768 i
x2#
</pre>
</div>
          </div>
        </li>
      </div>
  </ol>

    </div>
  </div>
</div>
