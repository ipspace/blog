
<div class="comments post" id="comments">
  <h4>1 comments:</h4>
  <div class="comments-content">
    <div class="comment-thread">
        <ol>
      <div>
        <li class="comment" id="42">
          <!--
          <div class="avatar-image-container">
            <img src="">
          </div>
          -->
          <div class="comment-block">
            <div class="comment-header">
              <cite class="user"><a href="" rel="nofollow"> Kamil</a></cite>
              <span class="datetime secondary-text">
                <a rel="nofollow" id="c42" href="#42">19 May 2020 11:06</a>
              </span>
            </div>
            <div class="comment-content"><p>To even achieve more flexibility like working with 2FA/manual authentication uri module comes into rescue as it allows to reuse session cookie for any subsequent calls i.e. loop statements (ones ending up with subsequent authentication sessions). An example would be:</p>

<p>Role:</p>

<hr />

<ul>
<li><p>name: Login
uri:
url: https://{{ inventory_hostname }}/api/aaaLogin.json
method: POST
body: '"{ "aaaUser" : { "attributes" : { "name" : "{{ username }}" , "pwd" : "{{ password }}" } } }"'
status_code: 200
validate_certs: False
headers:
  Content-Type: "application/json"
no_log: True
register: login</p></li>
<li><p>name: Add Bridge Domain
uri:
url: https://{{ inventory_hostname }}/api/node/mo/uni/tn-{{ item.tenant }}/BD-{{ item.name }}.json
body: {"fvBD":{"attributes":{"dn":"uni/tn-{{ item.tenant }}/BD-{{ item.name }}","name":"{{ item.name }}","descr":"{{ item.description }}","unicastRoute":"{{ item.unicast }}","rn":"BD-{{ item.name }}","status":"created"},"children":[{"fvRsCtx":{"attributes":{"tnFvCtxName":"{{ item.vrf }}","status":"created,modified"},"children":[]}}]}}
method: POST
body_format: json
return_content: yes
validate_certs: False
headers:
  Cookie: "{{ login.set_cookie }}"
loop: "{{ bd }}"</p></li>
</ul>

<p>Vars file for loop:</p>

<hr />

<p>bd:
 - {tenant: "common", name: "bd_192.168.1.0/24", description: "default", unicast: "false", vrf: "default"} 
 - {tenant: "common", name: "bd_192.168.2.0/24", description: "default", unicast: "true", vrf: "default"} 
 - {tenant: "common", name: "bd_192.168.3.0/24", description: "default", unicast: "false", vrf: "default"} </p>
</div>
          </div>
        </li>
      </div>
  </ol>

    </div>
  </div>
</div>