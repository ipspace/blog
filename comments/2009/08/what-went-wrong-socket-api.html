<div class="comments post" id="comments">
  <h4>18 comments:</h4>
  <div class="comments-content">
    <div class="comment-thread">
        <ol>
      <div>
        <li class="comment" id="7587244060907122781">
          <!--
          <div class="avatar-image-container">
            <img src="https://resources.blogblog.com/img/blank.gif">
          </div>
          -->
          <div class="comment-block">
            <div class="comment-header">
              <cite class="user"><a href="None" rel="nofollow">chris</a></cite>
              <span class="datetime secondary-text">
                <a rel="nofollow" id="c7587244060907122781" href="#7587244060907122781">24 August 2009 16:04</a>
              </span>
            </div>
            <div class="comment-content">I agree this API is totally brain-dead. It is essentially synchronous (well, you can use non-blocking sockets for connect/send/rcv/...) whereas it should be event-driven. The DNS API doesn&#39;t provide a way to resolve names asynchronously (you can use threads with &quot;_r&quot; functions, but the programs become quickly a big mess). Also a big mess when you want to do low-levels things like setting the TTL or other funny things, which are often not portable.</div>
          </div>
        </li>
      </div>
      <div>
        <li class="comment" id="8985840647131290284">
          <!--
          <div class="avatar-image-container">
            <img src="https://resources.blogblog.com/img/blank.gif">
          </div>
          -->
          <div class="comment-block">
            <div class="comment-header">
              <cite class="user"><a href="None" rel="nofollow">Guest</a></cite>
              <span class="datetime secondary-text">
                <a rel="nofollow" id="c8985840647131290284" href="#8985840647131290284">25 August 2009 01:58</a>
              </span>
            </div>
            <div class="comment-content">Any thoughts on SCTP?</div>
          </div>
        </li>
      </div>
      <div>
        <li class="comment" id="552198672887333721">
          <!--
          <div class="avatar-image-container">
            <img src="https://resources.blogblog.com/img/blank.gif">
          </div>
          -->
          <div class="comment-block">
            <div class="comment-header">
              <cite class="user"><a href="None" rel="nofollow">Guest</a></cite>
              <span class="datetime secondary-text">
                <a rel="nofollow" id="c552198672887333721" href="#552198672887333721">25 August 2009 10:42</a>
              </span>
            </div>
            <div class="comment-content">getaddrinfo provides the correct loop. Please do not copy and waste programms from 1983.</div>
          </div>
        </li>
      </div>
      <div>
        <li class="comment" id="6114819583153298194">
          <!--
          <div class="avatar-image-container">
            <img src="https://resources.blogblog.com/img/blank.gif">
          </div>
          -->
          <div class="comment-block">
            <div class="comment-header">
              <cite class="user"><a href="None" rel="nofollow">Guest</a></cite>
              <span class="datetime secondary-text">
                <a rel="nofollow" id="c6114819583153298194" href="#6114819583153298194">25 August 2009 10:45</a>
              </span>
            </div>
            <div class="comment-content">And PLEASE, pretty please, do link to documentation pages! Wikipedia is NOT a trusted source for programmers. If you really programm without reading the manual ... please do not blog about.</div>
          </div>
        </li>
      </div>
      <div>
        <li class="comment" id="2597063273370684138">
          <!--
          <div class="avatar-image-container">
            <img src="https://resources.blogblog.com/img/blank.gif">
          </div>
          -->
          <div class="comment-block">
            <div class="comment-header">
              <cite class="user"><a href="None" rel="nofollow">Ivan Pepelnjak</a></cite>
              <span class="datetime secondary-text">
                <a rel="nofollow" id="c2597063273370684138" href="#2597063273370684138">25 August 2009 15:22</a>
              </span>
            </div>
            <div class="comment-content">Dear Guest!<br /><br />First of all, I love good discussion ... but prefer to have it with people who have at least a unique (even if fictitious) identity, so I would appreciate if you could use a unique identifier for comments that might evolve into an (hopefully interesting) discussion.<br /><br />Now for the getaddrinfo: I don&#39;t understand what you mean with the &quot;correct loop&quot;. While the getaddrinfo is supposed to provide more than one address,it looks like that&#39;s not always the case. What were you trying to say?</div>
          </div>
        </li>
      </div>
      <div>
        <li class="comment" id="5629498755715719745">
          <!--
          <div class="avatar-image-container">
            <img src="https://resources.blogblog.com/img/blank.gif">
          </div>
          -->
          <div class="comment-block">
            <div class="comment-header">
              <cite class="user"><a href="None" rel="nofollow">Ivan Pepelnjak</a></cite>
              <span class="datetime secondary-text">
                <a rel="nofollow" id="c5629498755715719745" href="#5629498755715719745">25 August 2009 15:23</a>
              </span>
            </div>
            <div class="comment-content">SCTP looks good (at least from the distance), but is unfortunately totally useless (also because of broken Socket API :).</div>
          </div>
        </li>
      </div>
      <div>
        <li class="comment" id="8058343278400913922">
          <!--
          <div class="avatar-image-container">
            <img src="https://resources.blogblog.com/img/blank.gif">
          </div>
          -->
          <div class="comment-block">
            <div class="comment-header">
              <cite class="user"><a href="None" rel="nofollow">Ivan Pepelnjak</a></cite>
              <span class="datetime secondary-text">
                <a rel="nofollow" id="c8058343278400913922" href="#8058343278400913922">25 August 2009 15:27</a>
              </span>
            </div>
            <div class="comment-content">Please note that this is NOT a programming blog. I am not trying to teach anyone how to program client-server architectures in C (or any other programming language); there are millions of people better qualified to do that.<br /><br />What I&#39;m saying is that the Socket API is conceptually broken and that the handling of L3 addresses that the applications are forced to do severely hinders our ability to address problems we&#39;re having with the exploding Internet.<br /><br />My reference to the Wikipedia is not meant to give a programmer a pointer to a reference documentation (which, BTW, differs between operating systems), but to give some background information to those that are not familiar with the structure of the Socket API (not everyone has been blessed with exposure to C++ programming), so that they could better understand my arguments.<br /><br />If someone is trying to learn programming reading my blog posts, he&#39;s found a wrong source.</div>
          </div>
        </li>
      </div>
      <div>
        <li class="comment" id="8107727590488558108">
          <!--
          <div class="avatar-image-container">
            <img src="https://resources.blogblog.com/img/blank.gif">
          </div>
          -->
          <div class="comment-block">
            <div class="comment-header">
              <cite class="user"><a href="None" rel="nofollow">Ivan Pepelnjak</a></cite>
              <span class="datetime secondary-text">
                <a rel="nofollow" id="c8107727590488558108" href="#8107727590488558108">25 August 2009 15:30</a>
              </span>
            </div>
            <div class="comment-content">There&#39;s always something more to be said :) Last but not least, the Wikipedia article about Berkeley sockets does provide all the relevant references and external links at the end of the article, so those that need a trusted official source can find them ;)</div>
          </div>
        </li>
      </div>
      <div>
        <li class="comment" id="7367418251242347474">
          <!--
          <div class="avatar-image-container">
            <img src="https://resources.blogblog.com/img/blank.gif">
          </div>
          -->
          <div class="comment-block">
            <div class="comment-header">
              <cite class="user"><a href="None" rel="nofollow">Fabio</a></cite>
              <span class="datetime secondary-text">
                <a rel="nofollow" id="c7367418251242347474" href="#7367418251242347474">27 August 2009 17:42</a>
              </span>
            </div>
            <div class="comment-content">Ivan,<br /><br />I cannot speak for windows or linux systems, but in FreeBSD (and other BSD systems) getadddrinfo does the job properly.<br /><br />Of course, since a name can have several IP addresses, you need to loop it till you get a connection. You can even use wildcards as parameters to getaddrinfo so you&#39;ll be able to try all address on all family address available for that name. It&#39;s up to the programmer to do it properly.<br /><br />From &quot;man getaddrinfo&quot; (FreeBSD 7.1):<br /><br />     The following code tries to connect to ``www.kame.net&#39;&#39; service ``http&#39;&#39;<br />     via a stream socket.  It loops through all the addresses available,<br />     regardless of address family.  If the destination resolves to an IPv4<br />     address, it will use an AF_INET socket.  Similarly, if it resolves to<br />     IPv6, an AF_INET6 socket is used.  Observe that there is no hardcoded<br />     reference to a particular address family.  The code works even if<br />     getaddrinfo() returns addresses that are not IPv4/v6.<br /><br />           struct addrinfo hints, *res, *res0;<br />           int error;<br />           int s;<br />           const char *cause = NULL;<br /><br />           memset(&amp;hints, 0, sizeof(hints));<br />           hints.ai_family = PF_UNSPEC;<br />           hints.ai_socktype = SOCK_STREAM;<br />           error = getaddrinfo(&quot;www.kame.net&quot;, &quot;http&quot;, &amp;hints, &amp;res0);<br />           if (error) {<br />                   errx(1, &quot;%s&quot;, gai_strerror(error));<br />                   /*NOTREACHED*/<br />           }<br />           s = -1;<br />           for (res = res0; res; res = res-&gt;ai_next) {<br />                   s = socket(res-&gt;ai_family, res-&gt;ai_socktype,<br />                       res-&gt;ai_protocol);<br />                   if (s &lt; 0) {<br />                           cause = &quot;socket&quot;;<br />                           continue;<br />                   }<br /><br />                   if (connect(s, res-&gt;ai_addr, res-&gt;ai_addrlen) &lt; 0) {<br />                           cause = &quot;connect&quot;;<br />                           close(s);<br />                           s = -1;<br />                           continue;<br />                   }<br /><br />                   break;  /* okay we got one */<br />           }<br />           if (s &lt; 0) {<br />                   err(1, &quot;%s&quot;, cause);<br />                   /*NOTREACHED*/<br />           }<br />           freeaddrinfo(res0);<br /><br />They are still using the BSD API, but didn&#39;t update their version, though.</div>
          </div>
        </li>
      </div>
      <div>
        <li class="comment" id="4057932009057270542">
          <!--
          <div class="avatar-image-container">
            <img src="https://resources.blogblog.com/img/blank.gif">
          </div>
          -->
          <div class="comment-block">
            <div class="comment-header">
              <cite class="user"><a href="None" rel="nofollow">Patryk K</a></cite>
              <span class="datetime secondary-text">
                <a rel="nofollow" id="c4057932009057270542" href="#4057932009057270542">27 August 2009 17:58</a>
              </span>
            </div>
            <div class="comment-content">I can&#39;t agree with this - lib C provides you with basic functionaly for simple reason more functionality you will put there more bugs you will  create and more testig it&#39;s required this will have performance impact as well.Lib C is not right place to put this additional functionality <br />have a look to other utility libraries there, this is their desing principal.</div>
          </div>
        </li>
      </div>
      <div>
        <li class="comment" id="2387816746814800416">
          <!--
          <div class="avatar-image-container">
            <img src="https://resources.blogblog.com/img/blank.gif">
          </div>
          -->
          <div class="comment-block">
            <div class="comment-header">
              <cite class="user"><a href="None" rel="nofollow">SCTP question Guest</a></cite>
              <span class="datetime secondary-text">
                <a rel="nofollow" id="c2387816746814800416" href="#2387816746814800416">27 August 2009 18:07</a>
              </span>
            </div>
            <div class="comment-content">Do you believe this offers hope?<br /><br />http://tools.ietf.org/html/draft-ietf-tsvwg-sctpsocket-19<br /><br />It would appear that the multihoming issue could get better, assuming the one-to-many API gets deployed. I haven&#39;t had a chance to play around with it yet, but libsctp appears to be the Linux implementation.<br /><br />&quot;If a bind() is not called prior to a sendmsg() call that initiates a<br />   new association, the system picks an ephemeral port and will choose<br />   an address set equivalent to binding with a wildcard address.  One of<br />   those addresses will be the primary address for the association.<br />   This automatically enables the multi-homing capability of SCTP.&quot;<br /><br />Also, sctp_getpaddrs looks promising, returning all of the addresses of an existing endpoint. Now how that works in practice? Not sure...<br /><br />And as usual, thanks for the insights!</div>
          </div>
        </li>
      </div>
      <div>
        <li class="comment" id="5283297461465532223">
          <!--
          <div class="avatar-image-container">
            <img src="https://resources.blogblog.com/img/blank.gif">
          </div>
          -->
          <div class="comment-block">
            <div class="comment-header">
              <cite class="user"><a href="None" rel="nofollow">Ivan Pepelnjak</a></cite>
              <span class="datetime secondary-text">
                <a rel="nofollow" id="c5283297461465532223" href="#5283297461465532223">30 August 2009 10:10</a>
              </span>
            </div>
            <div class="comment-content">The modified Socket API is already implemented in Linux and not used for a simple reason: you have to indicate which transport protocol to use in your application and there&#39;s no push to change existing applications.</div>
          </div>
        </li>
      </div>
      <div>
        <li class="comment" id="4755740148120941033">
          <!--
          <div class="avatar-image-container">
            <img src="https://resources.blogblog.com/img/blank.gif">
          </div>
          -->
          <div class="comment-block">
            <div class="comment-header">
              <cite class="user"><a href="None" rel="nofollow">Phil P</a></cite>
              <span class="datetime secondary-text">
                <a rel="nofollow" id="c4755740148120941033" href="#4755740148120941033">02 April 2010 11:04</a>
              </span>
            </div>
            <div class="comment-content">This assumes the programmer knows what a network is and how it works. Very few among the best of programmers do, and most of those are too lazy to do this much work to create a robust application. <br /><br />If we truly want reliable network applications, the API for opening a socket should be something along the lines of:<br /><br />Stream myStream;<br /><br />try {<br />    myStream = Network.Connect(&quot;somehost.foobar.com&quot;, &quot;http&quot;);<br />} catch (NetworkException) {<br />    // Oops, it didn&#39;t work. Deal with it somehow.<br />}<br /><br />DoSomething(myStream);<br /><br />Anything more complicated will result in a handful of well-behaved applications and a vast multitude of crap.</div>
          </div>
        </li>
      </div>
      <div>
        <li class="comment" id="3028718212026341099">
          <!--
          <div class="avatar-image-container">
            <img src="https://resources.blogblog.com/img/blank.gif">
          </div>
          -->
          <div class="comment-block">
            <div class="comment-header">
              <cite class="user"><a href="None" rel="nofollow">Ivan Pepelnjak</a></cite>
              <span class="datetime secondary-text">
                <a rel="nofollow" id="c3028718212026341099" href="#3028718212026341099">02 April 2010 11:21</a>
              </span>
            </div>
            <div class="comment-content">Thank you, Phil! A fantastic summary of what I’ve been trying to say.</div>
          </div>
        </li>
      </div>
      <div>
        <li class="comment" id="6212051357633539538">
          <!--
          <div class="avatar-image-container">
            <img src="https://resources.blogblog.com/img/blank.gif">
          </div>
          -->
          <div class="comment-block">
            <div class="comment-header">
              <cite class="user"><a href="None" rel="nofollow">lateagain</a></cite>
              <span class="datetime secondary-text">
                <a rel="nofollow" id="c6212051357633539538" href="#6212051357633539538">18 February 2012 17:20</a>
              </span>
            </div>
            <div class="comment-content">I&#39;d be interested to hear what you think about the recent extension to sockets called ZeroMQ. <br />Does it fix &quot;what went wrong&quot; ?</div>
          </div>
        </li>
      </div>
      <div>
        <li class="comment" id="443078493779428740">
          <!--
          <div class="avatar-image-container">
            <img src="https://resources.blogblog.com/img/blank.gif">
          </div>
          -->
          <div class="comment-block">
            <div class="comment-header">
              <cite class="user"><a href="http://irati.eu" rel="nofollow">Eduard Grasa</a></cite>
              <span class="datetime secondary-text">
                <a rel="nofollow" id="c443078493779428740" href="#443078493779428740">15 February 2013 13:57</a>
              </span>
            </div>
            <div class="comment-content">I agree that the sockets API doesn&#39;t facilitate building distributed applications at all. A decent API would be oriented towards Inter Process Communication (IPC), and provide primitives to allocate flows between applications by name, allowing a certain QoS specification (for example: allocate me a flow to application B, and data should be delivered in order, reliably, maximum this delay). How to honour this request is the business of the &quot;networking stack&quot;, not the application.<br /><br />I think that one of the main issues is that the current networking &quot;protocol suite&quot; is oriented towards moving data between interfaces of computers, instead of allowing applications to communicate (the issue is not just the sockets interface...)</div>
          </div>
        </li>
      </div>
      <div>
        <li class="comment" id="4002598738248187443">
          <!--
          <div class="avatar-image-container">
            <img src="https://lh3.googleusercontent.com/zFdxGE77vvD2w5xHy6jkVuElKv-U9_9qLkRYK8OnbDeJPtjSZ82UPq5w6hJ-SA=s35">
          </div>
          -->
          <div class="comment-block">
            <div class="comment-header">
              <cite class="user"><a href="https://www.blogger.com/profile/08666884475278931314" rel="nofollow">Santhosh Ram</a></cite>
              <span class="datetime secondary-text">
                <a rel="nofollow" id="c4002598738248187443" href="#4002598738248187443">07 July 2016 16:22</a>
              </span>
            </div>
            <div class="comment-content">Ivan, This is a old post. But I would like point out that the following statement is patently false..<br /><br />&quot;However, most of the applications will perform the gethostbyname() call which returns one of the addresses (regardless of whether it’s reachable or not) that is then passed to the connect() call. &quot;<br /><br />The long deprecated gethostbyname() can indeed return multiple IP addresses if the DNS reply has multiple A records. The main reason gethostbyname() was deprecated in favor of getaddrinfo() is because of the lack of IPv6 support in the former and not because the former could return only one IP address. The link you gave to explain the issue with getaddrinfo() is invalid now. If there is an alternate link please share it.</div>
              <div class="comment-replies">
                <div class="comment-thread inline-thread">
                  <span class="thread-count"><a>Replies</a></span>
                    <ol>
      <div>
        <li class="comment" id="8756760196306093850">
          <!--
          <div class="avatar-image-container">
            <img src="https://lh3.googleusercontent.com/zFdxGE77vvD2w5xHy6jkVuElKv-U9_9qLkRYK8OnbDeJPtjSZ82UPq5w6hJ-SA=s35">
          </div>
          -->
          <div class="comment-block">
            <div class="comment-header">
              <cite class="user"><a href="https://www.blogger.com/profile/13457151406311272386" rel="nofollow">Ivan Pepelnjak</a></cite>
              <span class="datetime secondary-text">
                <a rel="nofollow" id="c8756760196306093850" href="#8756760196306093850">08 July 2016 16:04</a>
              </span>
            </div>
            <div class="comment-content">(Somewhat) fixed the text. Thank you!</div>
          </div>
        </li>
      </div>
  </ol>

                </div>
              </div>
          </div>
        </li>
      </div>
  </ol>

    </div>
  </div>
</div>
