{
   "comments": [
      {
         "comments": [
            {
               "date": "09 May 2022 04:14",
               "html": "<p>Yeah, Arista managed to use ARP or MAC table to do that on some merchant silicon ASIC. At the very least, that requires the ability of the lookup table to match a field at unusual offset.</p>\n\n<p>As for next hop rewrite, the result of that lookup could point to a dummy per-next-hop VRF with a default route pointing to the next hop.</p>\n",
               "id": "1220",
               "name": " Ivan Pepelnjak",
               "pub": "2022-05-09T16:14:53",
               "ref": "1219",
               "type": "comment"
            },
            {
               "date": "09 May 2022 05:13",
               "html": "<p>The same trick, perhaps using the same merchant silicon ASIC, was used by Brocade (now Extreme). Others using said merchant silicon ASIC may have used this as well.</p>\n\n<p>AFAIR the actual prefix length stored in CAM was configurable. As such this would probably need the ability to apply a mask while addressing CAM.</p>\n\n<p>Using IP forwarding entries (&quot;ARP table&quot;) would probably suffice to save next hop information. I did not think of that, thanks! But different to an ARP or multicast group entry, the longest prefix match via TCAM might return a better match when, e.g., /24 prefixes are added to the fixed table, but, e.g., a /28 is found via TCAM.</p>\n\n<p>So a piece that may be missing in other ASICs could be the ability to use two different lookup operations and use the longest match from those for the forwarding decision.</p>\n\n<p>I had some indirection as described by you in mind when writing my comment. I have no idea if usual ASICs allow to add something like this to the processing pipeline if it was not envisioned when designing the ASIC. This is probably highly implementation specific.</p>\n",
               "id": "1222",
               "name": " Erik Auerswald",
               "pub": "2022-05-09T17:13:45",
               "ref": "1220",
               "type": "comment"
            }
         ],
         "date": "09 May 2022 11:05",
         "html": "<p>Another mechanism used in some routers (&quot;switches&quot;) is to use CAM table space for one prefix length, e.g., /24, in addition to TCAM. The route lookup then uses both a longest prefix match via TCAM and a CAM lookup for the designated prefix length to determine the next hop.</p>\n\n<p>Of course this requires CAM in addition to TCAM in the ASIC. I would expect that the ASIC&#39;s forwarding pipeline needs support for this scheme, too (e.g., CAM lookup results usually do not include the next hop rewrite information required for IP forwarding). So this is probably not applicable to the ASIC in question.</p>\n",
         "id": "1219",
         "name": "Erik Auerswald",
         "pub": "2022-05-09T11:05:24",
         "type": "comment"
      },
      {
         "date": "09 May 2022 04:38",
         "html": "<p>An alternative to SRD is to use BGP to manage the FIB. BGP allows the active routes to be quickly updated and when coupled with real-time top prefix measurements can significantly increase the effectiveness of a small hardware forwarding table, see <a href=\"https://blog.sflow.com/2016/07/internet-router-using-merchant-silicon.html\">Internet router using merchant silicon</a></p>\n",
         "id": "1221",
         "name": " Peter Phaal",
         "pub": "2022-05-09T16:38:45",
         "type": "comment"
      }
   ],
   "count": 2,
   "type": "post",
   "url": "2022/05/living-small-forwarding-tables.html"
}
