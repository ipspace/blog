<div class="comments post" id="comments">
  <h4>13 comments:</h4>
  <div class="comments-content">
    <div class="comment-thread">
        <ol>
      <div>
        <li class="comment" id="6639116229003449069">
          <div class="comment-block">
            <div class="comment-header">
              <cite class="user"><a href="" rel="nofollow">Anonymous</a></cite>
              <span class="datetime secondary-text">
                <a rel="nofollow" id="c6639116229003449069" href="#6639116229003449069">08 September 2008 14:05</a>
              </span>
            </div>
            <div class="comment-content">Heh, that's pretty clever.</div>
          </div>
        </li>
      </div>
      <div>
        <li class="comment" id="354863510379584504">
          <div class="comment-block">
            <div class="comment-header">
              <cite class="user"><a href="https://www.blogger.com/profile/00689623877672895386" rel="nofollow">Unknown</a></cite>
              <span class="datetime secondary-text">
                <a rel="nofollow" id="c354863510379584504" href="#354863510379584504">08 September 2008 15:11</a>
              </span>
            </div>
            <div class="comment-content">Now only if we could do that for an access point.</div>
          </div>
        </li>
      </div>
      <div>
        <li class="comment" id="8523644068905829232">
          <div class="comment-block">
            <div class="comment-header">
              <cite class="user"><a href="https://www.blogger.com/profile/02745806398659871393" rel="nofollow">ryan</a></cite>
              <span class="datetime secondary-text">
                <a rel="nofollow" id="c8523644068905829232" href="#8523644068905829232">08 September 2008 16:10</a>
              </span>
            </div>
            <div class="comment-content">that's very cool.</div>
          </div>
        </li>
      </div>
      <div>
        <li class="comment" id="3801282120317410808">
          <div class="comment-block">
            <div class="comment-header">
              <cite class="user"><a href="https://www.blogger.com/profile/12771770174520316412" rel="nofollow">Unknown</a></cite>
              <span class="datetime secondary-text">
                <a rel="nofollow" id="c3801282120317410808" href="#3801282120317410808">08 September 2008 16:38</a>
              </span>
            </div>
            <div class="comment-content">It could be done on Access point if its PoE-powered. Shut and no shut the port will do the trick.</div>
          </div>
        </li>
      </div>
      <div>
        <li class="comment" id="4396949616548990980">
          <div class="comment-block">
            <div class="comment-header">
              <cite class="user"><a href="" rel="nofollow">Anonymous</a></cite>
              <span class="datetime secondary-text">
                <a rel="nofollow" id="c4396949616548990980" href="#4396949616548990980">08 September 2008 23:24</a>
              </span>
            </div>
            <div class="comment-content">It's also possible without EEM applets:<BR/><BR/>time-range wireless-enabled<BR/>  periodic daily 06:00 to 22:00<BR/>access-list 101 permit ip any any time-range wireless-enabled<BR/>access-list 101 deny ip any any<BR/>interface dot11radio0<BR/>  ip access-group 101 in</div>
          </div>
        </li>
      </div>
      <div>
        <li class="comment" id="2858705174584126173">
          <div class="comment-block">
            <div class="comment-header">
              <cite class="user"><a href="https://www.blogger.com/profile/00689623877672895386" rel="nofollow">Unknown</a></cite>
              <span class="datetime secondary-text">
                <a rel="nofollow" id="c2858705174584126173" href="#2858705174584126173">09 September 2008 00:32</a>
              </span>
            </div>
            <div class="comment-content">While applying an access-list has it's advantages, it's not the same as shutting down an interface.  There are always different scenarios for every unique situation and having the ability to physically shut off a wireless interface on an access point based on time of day could be useful.</div>
          </div>
        </li>
      </div>
      <div>
        <li class="comment" id="3410955485992668876">
          <div class="comment-block">
            <div class="comment-header">
              <cite class="user"><a href="https://www.blogger.com/profile/11701648298424903520" rel="nofollow">Jordan</a></cite>
              <span class="datetime secondary-text">
                <a rel="nofollow" id="c3410955485992668876" href="#3410955485992668876">10 September 2008 14:29</a>
              </span>
            </div>
            <div class="comment-content">This EEM stuff is neat.  Is it possible to trigger an EEM applet whenever the WAN Ethernet interface gets a new DHCP lease, or when the DHCP-assigned default gateway changes?</div>
          </div>
        </li>
      </div>
      <div>
        <li class="comment" id="1432296881200420356">
          <div class="comment-block">
            <div class="comment-header">
              <cite class="user"><a href="https://www.blogger.com/profile/13457151406311272386" rel="nofollow">Ivan Pepelnjak</a></cite>
              <span class="datetime secondary-text">
                <a rel="nofollow" id="c1432296881200420356" href="#1432296881200420356">10 September 2008 18:08</a>
              </span>
            </div>
            <div class="comment-content">@Jordan: it could be done, if nothing else, you could write a Tcl policy with hooked on a periodic timer event. The Tcl policy would then inspect DHCP state and act as needed.<BR/><BR/>There might be some other solution for your problem, but I need to understand the problem first.</div>
          </div>
        </li>
      </div>
      <div>
        <li class="comment" id="1206365088224039258">
          <div class="comment-block">
            <div class="comment-header">
              <cite class="user"><a href="https://www.blogger.com/profile/11701648298424903520" rel="nofollow">Jordan</a></cite>
              <span class="datetime secondary-text">
                <a rel="nofollow" id="c1206365088224039258" href="#1206365088224039258">10 September 2008 18:55</a>
              </span>
            </div>
            <div class="comment-content">We have a router with two Ethernet WAN interfaces connecting us to two ISPs.  One of the WAN connections is slower, but more reliable and provides us with static addresses; the other is much faster (cable modem), but only has a single IP address assigned by DHCP.  So to make the most of both, we use route maps to push the majority of traffic that originates inside our network over the cable modem (through overloaded dynamic NAT) while reserving the other WAN for incoming traffic addressed to our static IPs (via static NAT to specific inside hosts).<BR/><BR/>Since the cable modem ISP is the default route for most traffic, we wanted the ability to fall back to the other WAN link if the cable modem network should go down.  To address this, we track the DHCP-assigned route with "ip dhcp client route track" and we also use an SLA with RTR to monitor that link by ensuring we can ping that router.  If we can't get packets through the cable modem link, the SLA setup takes the cable modem route out of circulation and all traffic get shunted over the other WAN link (again with overloaded dynamic NAT).<BR/><BR/>The cable modem ISP is pretty good about renewing leases, such that this router has been able to keep the same "dynamic" IP address for the past 4 years.  This is fortunate, because the IOS doesn't seem to have a way to set the SLA to ping a DHCP-assigned gateway address and so we've had to statically configure the ISP's default gateway's IP address in our SLA config.<BR/><BR/>It all works very well, even though statically-configuring the router's IP in the SLA is less-than-ideal.  Here's where the problem comes in, though:<BR/><BR/>Recently, the ISP renumbered their network, and assigned us a new IP address by DHCP.  This of course caused the SLA stuff to break until we went in and changed the SLA config to ping the ISP's router's new address.  Every time the ISP changes their network in the future, we'll have to do this again.<BR/><BR/>While this might be something that only comes up every year or two, it could also turn out to happen a lot more often (for example, if the ISP changes their policies on long-lived DHCP leases).  So, my hope is to use IOS' EEM capabilities to automate the process of noticing that the DHCP-assigned default gateway has changed and then automatically update the SLA when that happens.<BR/><BR/>Any thoughts on whether this would be possible?<BR/><BR/>Thanks!</div>
          </div>
        </li>
      </div>
      <div>
        <li class="comment" id="7290930411844280853">
          <div class="comment-block">
            <div class="comment-header">
              <cite class="user"><a href="https://www.blogger.com/profile/13457151406311272386" rel="nofollow">Ivan Pepelnjak</a></cite>
              <span class="datetime secondary-text">
                <a rel="nofollow" id="c7290930411844280853" href="#7290930411844280853">10 September 2008 19:06</a>
              </span>
            </div>
            <div class="comment-content">@Jordan: Great explanation, thanks. I'll try to figure out something.</div>
          </div>
        </li>
      </div>
      <div>
        <li class="comment" id="9002095282326405723">
          <div class="comment-block">
            <div class="comment-header">
              <cite class="user"><a href="" rel="nofollow">Anonymous</a></cite>
              <span class="datetime secondary-text">
                <a rel="nofollow" id="c9002095282326405723" href="#9002095282326405723">17 September 2008 13:22</a>
              </span>
            </div>
            <div class="comment-content">slightly OT for this IOS blog, but as David asked in the second response:-<BR/>For cheap/plastic/non-industrial Access Points the easiest solution is a mains-plug-in-the-socket timeswitch, either rotary "peg-type" or digital. Don't forget summer/daylight changes or if less critical allow an extra couple of hours either way.<BR/>More complex but scriptable is to switch the DC power lead to the Access Point via a suitable relay, maybe fed from a LPT port (and a Molex or Berg power conn for relay power: look for transistor relay-driver circuits on net) Linux+lptswitch will do it on an old 486, so its SSH-able and tcl-able, or you can simply script it locally. If the cheap access point is near (5-10metres) some server boxes with LPT ports this is easier than a headless-but-huge 1998 desktop on a shelf running ssh :)<BR/>POE is really the way to do it for non-IOS devices IMHelectronicO<BR/>(Gord as anon)</div>
          </div>
        </li>
      </div>
      <div>
        <li class="comment" id="4806573156244547518">
          <div class="comment-block">
            <div class="comment-header">
              <cite class="user"><a href="https://www.blogger.com/profile/13457151406311272386" rel="nofollow">Ivan Pepelnjak</a></cite>
              <span class="datetime secondary-text">
                <a rel="nofollow" id="c4806573156244547518" href="#4806573156244547518">17 September 2008 18:19</a>
              </span>
            </div>
            <div class="comment-content">There are also "power control" devices on the market. You can telnet/HTTP to such a device and turn the power off or on (or trigger a power-off of controlled length to power-cycle a box).</div>
          </div>
        </li>
      </div>
      <div>
        <li class="comment" id="2990646157263967323">
          <div class="comment-block">
            <div class="comment-header">
              <cite class="user"><a href="" rel="nofollow">Jeremy</a></cite>
              <span class="datetime secondary-text">
                <a rel="nofollow" id="c2990646157263967323" href="#2990646157263967323">21 September 2009 22:31</a>
              </span>
            </div>
            <div class="comment-content">Back to Jordan&#39;s question.  I believe it is possible.  You didn&#39;t mention what device/IOS/EEM version you are running but you should be able to look for this syslog message<br /><br />%DHCP-6-ADDRESS_ASSIGN: Interface Ethernet0/0 assigned DHCP address 10.10.1.2, mask 255.255.255.0, hostname R2<br /><br />Upon receiving this message you could compare it to the previous address and if it changes update your SLA configuration.</div>
          </div>
        </li>
      </div>
  </ol>

    </div>
  </div>
</div>
