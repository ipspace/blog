<div class="comments post" id="comments">
  <h4>14 comments:</h4>
  <div class="comments-content">
    <div class="comment-thread">
        <ol>
      <div>
        <li class="comment" id="2018328997571858905">
          <!--
          <div class="avatar-image-container">
            <img src="https://resources.blogblog.com/img/blank.gif">
          </div>
          -->
          <div class="comment-block">
            <div class="comment-header">
              <cite class="user"><a href="None" rel="nofollow">Anonymous</a></cite>
              <span class="datetime secondary-text">
                <a rel="nofollow" id="c2018328997571858905" href="#2018328997571858905">11 December 2008 09:40</a>
              </span>
            </div>
            <div class="comment-content">On distributed platforms its worse. On Cat6500/7600 even packet counters change every 10 seconds on most interfaces.</div>
          </div>
        </li>
      </div>
      <div>
        <li class="comment" id="3660082235086536521">
          <!--
          <div class="avatar-image-container">
            <img src="https://lh3.googleusercontent.com/zFdxGE77vvD2w5xHy6jkVuElKv-U9_9qLkRYK8OnbDeJPtjSZ82UPq5w6hJ-SA=s35">
          </div>
          -->
          <div class="comment-block">
            <div class="comment-header">
              <cite class="user"><a href="https://www.blogger.com/profile/13457151406311272386" rel="nofollow">Ivan Pepelnjak</a></cite>
              <span class="datetime secondary-text">
                <a rel="nofollow" id="c3660082235086536521" href="#3660082235086536521">11 December 2008 10:35</a>
              </span>
            </div>
            <div class="comment-content">I would understand the delay on a distributed platform. After all, the counters are on a different CPU and have to be transferred every now and then. Of course one could implement a smarter on-demand scheme :)<BR/><BR/>What really annoys me is that they didn't even think about using real-time counters on single CPU non-distributed non-accelerated platforms. The actual counters are obviously implemented in software and reside in the same memory as the MIB structures ... and still someone had the dilbertesque idea of copying the values between the two structures every 10 seconds.</div>
          </div>
        </li>
      </div>
      <div>
        <li class="comment" id="6768705791268438836">
          <!--
          <div class="avatar-image-container">
            <img src="https://lh3.googleusercontent.com/zFdxGE77vvD2w5xHy6jkVuElKv-U9_9qLkRYK8OnbDeJPtjSZ82UPq5w6hJ-SA=s35">
          </div>
          -->
          <div class="comment-block">
            <div class="comment-header">
              <cite class="user"><a href="https://www.blogger.com/profile/08629115121576798324" rel="nofollow">xabrouck</a></cite>
              <span class="datetime secondary-text">
                <a rel="nofollow" id="c6768705791268438836" href="#6768705791268438836">11 December 2008 15:18</a>
              </span>
            </div>
            <div class="comment-content">could that help by any chance?<BR/><BR/>R1(config)#event manager applet plop<BR/>R1(config-applet)#event snmp oid xxx poll-interval ?<BR/>  &lt;0-4294967295&gt;  Enter seconds[.milliseconds] value</div>
          </div>
        </li>
      </div>
      <div>
        <li class="comment" id="4582879514242370904">
          <!--
          <div class="avatar-image-container">
            <img src="https://lh3.googleusercontent.com/zFdxGE77vvD2w5xHy6jkVuElKv-U9_9qLkRYK8OnbDeJPtjSZ82UPq5w6hJ-SA=s35">
          </div>
          -->
          <div class="comment-block">
            <div class="comment-header">
              <cite class="user"><a href="https://www.blogger.com/profile/13457151406311272386" rel="nofollow">Ivan Pepelnjak</a></cite>
              <span class="datetime secondary-text">
                <a rel="nofollow" id="c4582879514242370904" href="#4582879514242370904">11 December 2008 22:32</a>
              </span>
            </div>
            <div class="comment-content">@Xavier: Unfortunately, the problem lies in the actual values of the MIB variables, not the way EEM polls them. The values change only every 10 seconds ... and you have to be very careful with the 'event snmp poll-interval' that you don't get false positives.</div>
          </div>
        </li>
      </div>
      <div>
        <li class="comment" id="8891216647169519999">
          <!--
          <div class="avatar-image-container">
            <img src="https://resources.blogblog.com/img/blank.gif">
          </div>
          -->
          <div class="comment-block">
            <div class="comment-header">
              <cite class="user"><a href="None" rel="nofollow">Anonymous</a></cite>
              <span class="datetime secondary-text">
                <a rel="nofollow" id="c8891216647169519999" href="#8891216647169519999">13 December 2008 21:49</a>
              </span>
            </div>
            <div class="comment-content">Can the voice stream be detected by inspecting SIP transactions? When ip inspect sip and ip nat are both enabled the inspection engines is adding UDP translation entries for the RTP/UDP traffic.</div>
          </div>
        </li>
      </div>
      <div>
        <li class="comment" id="195842667456980255">
          <!--
          <div class="avatar-image-container">
            <img src="https://lh3.googleusercontent.com/zFdxGE77vvD2w5xHy6jkVuElKv-U9_9qLkRYK8OnbDeJPtjSZ82UPq5w6hJ-SA=s35">
          </div>
          -->
          <div class="comment-block">
            <div class="comment-header">
              <cite class="user"><a href="https://www.blogger.com/profile/13457151406311272386" rel="nofollow">Ivan Pepelnjak</a></cite>
              <span class="datetime secondary-text">
                <a rel="nofollow" id="c195842667456980255" href="#195842667456980255">15 December 2008 10:23</a>
              </span>
            </div>
            <div class="comment-content">There are numerous ways to detect VoIP/SIP traffic. The original solution (follow the links in the article) uses access list logging and EEM applet triggering on the ACL ... but it would be so much cleaner to use the proper SNMP variables.</div>
          </div>
        </li>
      </div>
      <div>
        <li class="comment" id="5528790022792436877">
          <!--
          <div class="avatar-image-container">
            <img src="https://resources.blogblog.com/img/blank.gif">
          </div>
          -->
          <div class="comment-block">
            <div class="comment-header">
              <cite class="user"><a href="None" rel="nofollow">Anonymous</a></cite>
              <span class="datetime secondary-text">
                <a rel="nofollow" id="c5528790022792436877" href="#5528790022792436877">19 March 2009 05:50</a>
              </span>
            </div>
            <div class="comment-content">Hi ivan <BR/><BR/>i am new to cisco qos. I have a silly doubt about cbwfq. as i have read that we can only use 75% of the bandwidth for the custom queues as the rest 25% is reserved for the keepalives and routing protocol updates. <BR/><BR/>now if i want to set 50% of bandwidth for a particular queue should it 50% of the total bandwidth or 50% of the availble 75% of the bandwidth. <BR/><BR/>i couldnt find answer for this anywhere. i would be glad if you can help me out . <BR/><BR/>Regards<BR/><BR/>sebastan</div>
          </div>
        </li>
      </div>
      <div>
        <li class="comment" id="6482898479192192580">
          <!--
          <div class="avatar-image-container">
            <img src="https://resources.blogblog.com/img/blank.gif">
          </div>
          -->
          <div class="comment-block">
            <div class="comment-header">
              <cite class="user"><a href="None" rel="nofollow">Andr√©s Pedro Spano</a></cite>
              <span class="datetime secondary-text">
                <a rel="nofollow" id="c6482898479192192580" href="#6482898479192192580">23 July 2009 16:25</a>
              </span>
            </div>
            <div class="comment-content">Sebastan,<br /><br />You&#39;re correct, if you not put the command Max reserved-bandwith 100 percent. You have 75%. that is considered 100% and then the 50% of that.<br /><br />Regards<br />Andy</div>
          </div>
        </li>
      </div>
      <div>
        <li class="comment" id="260122148273659677">
          <!--
          <div class="avatar-image-container">
            <img src="https://resources.blogblog.com/img/blank.gif">
          </div>
          -->
          <div class="comment-block">
            <div class="comment-header">
              <cite class="user"><a href="None" rel="nofollow">WB</a></cite>
              <span class="datetime secondary-text">
                <a rel="nofollow" id="c260122148273659677" href="#260122148273659677">23 August 2009 11:27</a>
              </span>
            </div>
            <div class="comment-content">Hello Ivan,<br />first of all: thank you for sharing your so creative and precise work. It is a pleasure and I will always reference to you as the original source<br /><br />I tried to rebuild a scenario and to check the values because I am also concerned about the correctness of the measurement tools. You write that the counter for a given cbQosCMPrePolicyByte64-counter of an active class i only updated every 10 seconds.<br />I found something different (better) which is perhaps due to the ios version I used for testing.<br />setting: 2811, <br />show policy-map int s0/0/0 | sec SSL<br /> Class-map: SSL (match-all)<br />   38614111 packets, 19113935500 bytes<br />   5 minute offered rate 21000 bps, drop rate 0 bps<br />   Match: protocol secure-http<br />   Queueing<br />   queue limit 64 packets<br />   (queue depth/total drops/no-buffer drops) 2/11305151/0<br />   (pkts output/bytes output) 27308959/12934044900<br />   bandwidth 20% (200 kbps)<br /><br />tcl-hack:<br />R1#more flash:showcounter3.tcl<br />set cnt 0<br />set maxcnt 20<br />set delay 100<br />puts &quot;Gleich beginnt die Counter-Sammlung.\n&quot;<br />after 1000<br />while {$cnt &lt; $maxcnt } {<br />  set zaehlarray($cnt) [exec &quot;show policy-map interface s0/0/0 | i 191&quot;]<br />  set zaehlarray2($cnt) [snmp_getone INSQOSR cbQosCMPrePolicyByte64.50.13986465]<br />  incr cnt<br />  if { $cnt != $maxcnt } { after $delay }<br />}<br />puts &quot;Counter-Sammlung abgeschlossen. Gleich beginnt die Ausgabe.&quot;<br />after 1000<br />set cnt 0<br />while {$cnt &lt; $maxcnt } {<br />  puts $zaehlarray($cnt)<br />  puts $zaehlarray2($cnt)<br />  incr cnt<br />}<br /><br />Result:<br />R1#tclsh flash:showcounter3.tcl<br />Gleich beginnt die Counter-Sammlung.<br /><br />Counter-Sammlung abgeschlossen. Gleich beginnt die Ausgabe.<br />      38639819 packets, 19115220900 bytes<br /><br />{&lt;obj oid=&#39;cbQosCMPrePolicyByte64.50.13986465&#39; val=&#39;0x4735b1fa4&#39;/&gt;}<br />      38639826 packets, 19115221250 bytes<br /><br />{&lt;obj oid=&#39;cbQosCMPrePolicyByte64.50.13986465&#39; val=&#39;0x4735b2102&#39;/&gt;}<br />      38639834 packets, 19115221650 bytes<br /><br />{&lt;obj oid=&#39;cbQosCMPrePolicyByte64.50.13986465&#39; val=&#39;0x4735b2292&#39;/&gt;}<br />      38639844 packets, 19115222150 bytes<br /><br />{&lt;obj oid=&#39;cbQosCMPrePolicyByte64.50.13986465&#39; val=&#39;0x4735b2486&#39;/&gt;}<br />      38639853 packets, 19115222600 bytes<br /><br />{&lt;obj oid=&#39;cbQosCMPrePolicyByte64.50.13986465&#39; val=&#39;0x4735b2648&#39;/&gt;}<br />      38639862 packets, 19115223050 bytes<br /><br />{&lt;obj oid=&#39;cbQosCMPrePolicyByte64.50.13986465&#39; val=&#39;0x4735b280a&#39;/&gt;}<br />      38639868 packets, 19115223350 bytes<br /><br />{&lt;obj oid=&#39;cbQosCMPrePolicyByte64.50.13986465&#39; val=&#39;0x4735b2936&#39;/&gt;}<br />      38639874 packets, 19115223650 bytes<br /><br />{&lt;obj oid=&#39;cbQosCMPrePolicyByte64.50.13986465&#39; val=&#39;0x4735b2a62&#39;/&gt;}<br />      38639881 packets, 19115224000 bytes<br /><br />{&lt;obj oid=&#39;cbQosCMPrePolicyByte64.50.13986465&#39; val=&#39;0x4735b2bc0&#39;/&gt;}<br />      38639890 packets, 19115224450 bytes<br /><br />When I compare the hex-values with the values from the show policy-map-command, they are exact the same.<br />What do you think? ios: c2800nm-adventerprisek9-mz.124-24.T1.bin<br />regards, William</div>
          </div>
        </li>
      </div>
      <div>
        <li class="comment" id="1490882067016235222">
          <!--
          <div class="avatar-image-container">
            <img src="https://resources.blogblog.com/img/blank.gif">
          </div>
          -->
          <div class="comment-block">
            <div class="comment-header">
              <cite class="user"><a href="None" rel="nofollow">Ivan Pepelnjak</a></cite>
              <span class="datetime secondary-text">
                <a rel="nofollow" id="c1490882067016235222" href="#1490882067016235222">23 August 2009 13:45</a>
              </span>
            </div>
            <div class="comment-content">Here&#39;s my wild guess: the &quot;show policy-map&quot; command might also update the SNMP counters.<br /><br />Can you redo the tests without the &quot;show policy-map&quot;?</div>
          </div>
        </li>
      </div>
      <div>
        <li class="comment" id="876793968384745892">
          <!--
          <div class="avatar-image-container">
            <img src="https://resources.blogblog.com/img/blank.gif">
          </div>
          -->
          <div class="comment-block">
            <div class="comment-header">
              <cite class="user"><a href="None" rel="nofollow">WB</a></cite>
              <span class="datetime secondary-text">
                <a rel="nofollow" id="c876793968384745892" href="#876793968384745892">23 August 2009 23:33</a>
              </span>
            </div>
            <div class="comment-content">You are absolutely right! Using the same script, just taking out the show-policy-map line and the puts-line for the not used array:<br /><br />several runs over 20 seconds:<br />I got 4 values: aa-bb-cc-dd where bb and cc where between 8.8 and 9 seconds long<br /><br />I was wondering over the involved processes:<br /><br />so the one with ONLY snmp-get showed from a second vty during the tcl-run:<br /><br />R1#show proc cpu sorted 5sec<br />CPU utilization for five seconds: 21%/7%; one minute: 11%; five minutes: 10%<br /> PID Runtime(ms)     Invoked      uSecs   5Sec   1Min   5Min TTY Process<br /> 304        1340         114      11754 11.90%  1.71%  0.36% 514 Tcl Serv - tty51<br /> 179        5436   245958062          0  1.11%  1.20%  1.20%   0 HQF Shaper Backg<br />   2         724      197138          3  0.07%  0.04%  0.05%   0 Load Meter<br />  65         188     3942710          0  0.07%  0.02%  0.00%   0 Netclock Backgro<br />  56        1460      251635          5  0.07%  0.00%  0.00%   0 HC Counter Timer<br /> 180         908     9854235          0  0.07%  0.06%  0.07%   0 RBSCP Background<br />  42        1108      985723          1  0.07%  0.03%  0.02%   0 Per-Second Jobs<br />   7           0           2          0  0.00%  0.00%  0.00%   0 Timers<br />   6          12          16        750  0.00%  0.00%  0.00%   0 Pool Manager<br /><br />(second part in second post)</div>
          </div>
        </li>
      </div>
      <div>
        <li class="comment" id="8935369304722678933">
          <!--
          <div class="avatar-image-container">
            <img src="https://resources.blogblog.com/img/blank.gif">
          </div>
          -->
          <div class="comment-block">
            <div class="comment-header">
              <cite class="user"><a href="None" rel="nofollow">WB</a></cite>
              <span class="datetime secondary-text">
                <a rel="nofollow" id="c8935369304722678933" href="#8935369304722678933">23 August 2009 23:33</a>
              </span>
            </div>
            <div class="comment-content">the one with snmp AND show-command (after a while waiting):<br /><br />R1#show proc cpu sorted 5sec<br />CPU utilization for five seconds: 40%/8%; one minute: 14%; five minutes: 11%<br /> PID Runtime(ms)     Invoked      uSecs   5Sec   1Min   5Min TTY Process<br /> 304        3592          84      42761 31.26%  4.76%  1.02% 514 Tcl Serv - tty51<br /> 179        5448   246005037          0  0.79%  1.15%  1.19%   0 HQF Shaper Backg<br />   1         208        2419         85  0.15%  0.01%  0.00%   0 Chunk Manager<br />  41         120      985852          0  0.07%  0.00%  0.00%   0 TTY Background<br />  65         188     3943482          0  0.07%  0.02%  0.00%   0 Netclock Backgro<br /> 146        1632     1525441          1  0.07%  0.02%  0.00%   0 CEF: IPv4 proces<br /> 180         920     9856122          0  0.07%  0.06%  0.07%   0 RBSCP Background<br />  38       10316      256052         40  0.07%  0.01%  0.00%   0 Net Background<br />  33          60      985875          0  0.07%  0.00%  0.00%   0 GraphIt<br /> 190         144     1925419          0  0.07%  0.01%  0.00%   0 CCE DP URLF cach<br /> 258         424     4929352          0  0.07%  0.02%  0.00%   0 Atheros LED Ctro<br />  11           0           1          0  0.00%  0.00%  0.00%   0 IPC Zone Manager<br />  12          96      962743          0  0.00%  0.00%  0.00%   0 IPC Periodic Tim<br /><br />Interesting is the double amount of total cpu-time. If the shown processes do really reveal anything about which process might be resonsible for the updating of the mib I cannot see.<br /><br />Well I totally agree with you: 9-10 seconds of a dead counter in an important monitoring-mib for qos seems not to be good.<br /><br />To get precise data what do you suggest? Perhaps all the netmon-vendors have to include a small script in future which executes a show-policy-map-interface-command first before they poll the counter .  :-D<br /><br />I thought I could get the info out of the device but know I come back to using taps and do the analysis separate.<br /><br />regards, William</div>
          </div>
        </li>
      </div>
      <div>
        <li class="comment" id="1264452145558339527">
          <!--
          <div class="avatar-image-container">
            <img src="https://resources.blogblog.com/img/blank.gif">
          </div>
          -->
          <div class="comment-block">
            <div class="comment-header">
              <cite class="user"><a href="None" rel="nofollow">Jared Valentine</a></cite>
              <span class="datetime secondary-text">
                <a rel="nofollow" id="c1264452145558339527" href="#1264452145558339527">20 January 2010 23:53</a>
              </span>
            </div>
            <div class="comment-content">Ivan/William:<br /><br />Just following up on this thread.  It looks like William has a way to make the snmp update real-time.  So my questions are:  1.) can we create a never-ending background task that runs 1 time per second that runs &quot;show policy-map&quot; so that our SNMP values are incrementing in real-time, in which case we could then create an EEM applet that accomplishes what I was originally trying to do?  <br /><br />Thanks!<br />-Jared</div>
          </div>
        </li>
      </div>
      <div>
        <li class="comment" id="1014363123482044093">
          <!--
          <div class="avatar-image-container">
            <img src="https://resources.blogblog.com/img/blank.gif">
          </div>
          -->
          <div class="comment-block">
            <div class="comment-header">
              <cite class="user"><a href="None" rel="nofollow">asceta</a></cite>
              <span class="datetime secondary-text">
                <a rel="nofollow" id="c1014363123482044093" href="#1014363123482044093">01 June 2010 16:01</a>
              </span>
            </div>
            <div class="comment-content">I&#39;ve got a problem with my 2811 router.<br /><br />I cannot use any of examples that checks snmp value. When typing &quot;event snmp oid&quot; commands I&#39;m getting &quot;Invalid input detected&quot; pointing at snmp part.<br /><br />Everything is ok with my 1841 device. I&#39;ve checked all 12.4T and 15.1 versions with no luck.<br /><br />I&#39;ve compared &quot;sh event manager version&quot;, and I see that in 2811 device there&#39;s no &quot;snmp&quot; and &quot;snmp-notification&quot; detectors.<br /><br />Why? is this platform &#39;broken&#39;? &#39;special&#39;? is there something that I should enable on device to get snmp detectors working?<br /><br />I&#39;d be very glad for any help.<br /><br />Thanks!</div>
          </div>
        </li>
      </div>
  </ol>

    </div>
  </div>
</div>
