<div class="comments post" id="comments">
  <h4>7 comments:</h4>
  <div class="comments-content">
    <div class="comment-thread">
        <ol>
      <div>
        <li class="comment" id="2476">
          <div class="comment-block">
            <div class="comment-header">
              <cite class="user"><a href="" rel="nofollow">Anonymous</a></cite>
              <span class="datetime secondary-text">
                <a rel="nofollow" id="c2476" href="#2476">04 December 2024 07:53</a>
              </span>
            </div>
            <div class="comment-content"><p>Just copy your last paragraph and upload it to ChatGPT. The answer is pretty impressive (though I&#39;m not an advocate of ChatGPT). 
Finally you could build a corresponding topology with netlab and test it.</p>
</div>
              <div class="comment-replies">
                <div class="comment-thread inline-thread">
                  <span class="thread-count"><a>Replies</a></span>
                    <ol>
      <div>
        <li class="comment" id="2477">
          <div class="comment-block">
            <div class="comment-header">
              <cite class="user"><a href="" rel="nofollow">Ivan Pepelnjak</a></cite>
              <span class="datetime secondary-text">
                <a rel="nofollow" id="c2477" href="#2477">05 December 2024 10:22</a>
              </span>
            </div>
            <div class="comment-content"><p>It&#39;s still the &quot;sloppy intern bullshit&quot; (as in &quot;some things are factually wrong&quot;) but I agree it sounds pretty impressive.</p>

<p>As for &quot;netlab topology&quot;, we might be able to inspect the forwarding tables, but who knows what would really happen in ASICs. I try to stay away from testing data-plane or real-time features in virtual labs.</p>
</div>
          </div>
        </li>
      </div>
      <div>
        <li class="comment" id="2479">
          <div class="comment-block">
            <div class="comment-header">
              <cite class="user"><a href="" rel="nofollow">Anonymous</a></cite>
              <span class="datetime secondary-text">
                <a rel="nofollow" id="c2479" href="#2479">05 December 2024 08:14</a>
              </span>
            </div>
            <div class="comment-content"><p>I think with a test lab (IOS XE with per-prefix VPN labels) you would be able to prove the oxymoron with the help of debug outputs. I see no need for support of data-plane features in this case. <br />
You will never know the internals of ASICs anyway unless you sign an NDA.</p>
</div>
          </div>
        </li>
      </div>
  </ol>

                </div>
              </div>
          </div>
        </li>
      </div>
      <div>
        <li class="comment" id="2478">
          <div class="comment-block">
            <div class="comment-header">
              <cite class="user"><a href="" rel="nofollow">Thomas </a></cite>
              <span class="datetime secondary-text">
                <a rel="nofollow" id="c2478" href="#2478">05 December 2024 07:07</a>
              </span>
            </div>
            <div class="comment-content">Correction: Add path on RR or unique RD on PE. Both ensure that path hiding at RR doesn&rsquo;t occur.<br />

<p>And how do you potentially monitor. BMP Local RIB, RFC 9069 with Path Marking, https://datatracker.ietf.org/doc/html/draft-ietf-grow-bmp-path-marking-tlv.</p>
</div>
          </div>
        </li>
      </div>
      <div>
        <li class="comment" id="2480">
          <div class="comment-block">
            <div class="comment-header">
              <cite class="user"><a href="" rel="nofollow"> Roman</a></cite>
              <span class="datetime secondary-text">
                <a rel="nofollow" id="c2480" href="#2480">07 December 2024 01:29</a>
              </span>
            </div>
            <div class="comment-content"><p>You have no mass withdrawal mechanism for L3VPN PE-CE link fail scenario, so BGP PIC EDGE is a kind of impossible in this use case.</p>

<p>There was a draft to introduce such thing to enable BGP PIC edge for L3VPN https://www.ietf.org/archive/id/draft-raszuk-aggr-withdraw-00.txt but nobody cares.</p>

<p>PE fail scenario is still relevant, but that is another story even if per-vrf label allocation mode is used. You just need to advertise BestExternal route labels in a per-NH fashion.</p>
</div>
          </div>
        </li>
      </div>
      <div>
        <li class="comment" id="2503">
          <div class="comment-block">
            <div class="comment-header">
              <cite class="user"><a href="" rel="nofollow"> Harold Ritter</a></cite>
              <span class="datetime secondary-text">
                <a rel="nofollow" id="c2503" href="#2503">09 January 2025 06:55</a>
              </span>
            </div>
            <div class="comment-content">per-ce label allocation mode is actually supported in IOS-XE through the following configuration:<br />

<p>mpls label mode &#123;vrf vrf-name | all-vrfs&#125; protocol &#123;bgp-vpnv4 | bgp-vpnv6 | all-afs&#125; &#123;per-ce&#125;</p>
</div>
          </div>
        </li>
      </div>
      <div>
        <li class="comment" id="2572">
          <div class="comment-block">
            <div class="comment-header">
              <cite class="user"><a href="" rel="nofollow"> Blake</a></cite>
              <span class="datetime secondary-text">
                <a rel="nofollow" id="c2572" href="#2572">22 March 2025 12:00</a>
              </span>
            </div>
            <div class="comment-content"><p>Great stuff Ivan.
Totally agree with Thomas on unique RDs per PE.  I just have JunOS auto-generate type 1 RDs based on the PE loopback, which has the added bonus of not having to configure it manually for each VRF.  https://www.juniper.net/documentation/us/en/software/junos/cli-reference/topics/ref/statement/route-distinguisher-id-edit-routing-options.html</p>

<p>Here are some other &quot;fun&quot; JunOS L3VPN PE protection/multipath tidbits I&#39;ve learned recently:</p>

<p>PE-CE link protection <em>requires</em> vrf-table-label as of JunOS 12.3.
https://www.juniper.net/documentation/us/en/software/junos/vpn-l3/topics/topic-map/l3-vpns-pe-link-protection.html
I tried it in the lab without it, &amp; it causes a circular VPN label generation ping-pong fight between the PEs...  (bug or feature?)</p>

<p>chained-composite-nexthop and vpn-unequal-cost equal-external-internal nerd knobs are mutually exclusive:
https://www.juniper.net/documentation/us/en/software/junos/vpn-l3/topics/topic-map/l3-vpns-load-balancing.html</p>
</div>
              <div class="comment-replies">
                <div class="comment-thread inline-thread">
                  <span class="thread-count"><a>Replies</a></span>
                    <ol>
      <div>
        <li class="comment" id="2573">
          <div class="comment-block">
            <div class="comment-header">
              <cite class="user"><a href="" rel="nofollow"> Ivan Pepelnjak</a></cite>
              <span class="datetime secondary-text">
                <a rel="nofollow" id="c2573" href="#2573">22 March 2025 08:48</a>
              </span>
            </div>
            <div class="comment-content"><p>Thank you! It&#39;s always &quot;lovely&quot; to discover these unexpected details.</p>
</div>
          </div>
        </li>
      </div>
  </ol>

                </div>
              </div>
          </div>
        </li>
      </div>
      <div>
        <li class="comment" id="2790">
          <div class="comment-block">
            <div class="comment-header">
              <cite class="user"><a href="" rel="nofollow">Andrea Di Donato</a></cite>
              <span class="datetime secondary-text">
                <a rel="nofollow" id="c2790" href="#2790">01 November 2025 11:30</a>
              </span>
            </div>
            <div class="comment-content">regarding this statement:<br />
&quot;<br />
However, using per-prefix VPN labels (the default on Cisco IOS, where we first encountered the PIC Edge idea) effectively blocks the Prefix Independent Convergence part of the PIC Edge as each prefix uses a different VPN MPLS label. The only way to reduce the number of FIB updates seems to be the per-CE label allocation mode.<br />
&quot;<br />

<p>I might be missing something but I have always assumed that the Junos&#39; command chained-composite-next-hop and Cisco&#39;s IOSXR BGP PIC CORE allow PIC even when there&#39;s a service label per prefix since the service label is at the very top level of the FIB hierarchy and not at the very end anymore. </p>
</div>
          </div>
        </li>
      </div>
      <div>
        <li class="comment" id="2794">
          <div class="comment-block">
            <div class="comment-header">
              <cite class="user"><a href="" rel="nofollow"> andrea di donato</a></cite>
              <span class="datetime secondary-text">
                <a rel="nofollow" id="c2794" href="#2794">05 November 2025 02:32</a>
              </span>
            </div>
            <div class="comment-content"><p>what about solving the issue by not using &#39;BGP Best External&#39; but a better &#39;admin distance&#39; (in cisco terms) for the eBGP prefixes ? 
In Junos it&#39;d be the command &#39;preference X&#39; with X &lt; 170 within the BGP peer Group of type external. In that case the eBGP route would always be active on the backup egress PE. </p>

<p>Cheers/ciao</p>

<p>Andrea</p>
</div>
          </div>
        </li>
      </div>
  </ol>

    </div>
  </div>
</div>
