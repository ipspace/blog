<div class="comments post" id="comments">
  <h4>1 comments:</h4>
  <div class="comments-content">
    <div class="comment-thread">
        <ol>
      <div>
        <li class="comment" id="2396">
          <div class="comment-block">
            <div class="comment-header">
              <cite class="user"><a href="" rel="nofollow"> Daniel S</a></cite>
              <span class="datetime secondary-text">
                <a rel="nofollow" id="c2396" href="#2396">29 August 2024 09:07</a>
              </span>
            </div>
            <div class="comment-content"><p>Thank you for pointing out that this is still a thing. I learned about those hub/common/services networks during my early days as a network engineer running a MPLS network. Unfortunatly I&#39;ve never seen it anywhere else, despite it being a really cool &quot;trick&quot;. Thaught it a lot of other engineers who where learing about MPLS and BGP and it makes me happy seeing it&#39;s still alive with EVPN. Thank you.</p>
</div>
              <div class="comment-replies">
                <div class="comment-thread inline-thread">
                  <span class="thread-count"><a>Replies</a></span>
                    <ol>
      <div>
        <li class="comment" id="2397">
          <div class="comment-block">
            <div class="comment-header">
              <cite class="user"><a href="" rel="nofollow">Ivan Pepelnjak</a></cite>
              <span class="datetime secondary-text">
                <a rel="nofollow" id="c2397" href="#2397">29 August 2024 09:36</a>
              </span>
            </div>
            <div class="comment-content"><p>I think we deployed it at one customer who wanted to push all inter-site traffic through a centralized firewall. The hub site advertised the default route and collected the routes from the spoke sites.</p>
</div>
          </div>
        </li>
      </div>
      <div>
        <li class="comment" id="2398">
          <div class="comment-block">
            <div class="comment-header">
              <cite class="user"><a href="" rel="nofollow">Keanu L </a></cite>
              <span class="datetime secondary-text">
                <a rel="nofollow" id="c2398" href="#2398">29 August 2024 11:41</a>
              </span>
            </div>
            <div class="comment-content"><p>Hi Ivan,</p>

<p>Out of curiosity, for the design you implemented for the centralized firewall, was your VPN label allocation for the HUB VRF done per prefix or per CE allocation?</p>

<p>With per VRF VPN label allocation, the PE hosting the hub VRF would perform an IP lookup after popping the VPN label. Since it has all the routes to the other spokes, traffic between spoke sites would be possible without going through the firewall. Spokes could reach each other via the hub, as they are drawn by the default route.</p>

<p>I had a similar use case for a customer in Arista, where currently only the per VRF label allocation mode is supported. We had to be a bit more creative and ended up using two HUB VRFs: one for traffic coming from the spokes (HUB-IN) and one for traffic going to the spokes (HUB-OUT). The first HUB VRF would only export the default route learned from the firewall in MP-BGP, while the second VRF would only import the spokes&#39; routes.</p>
</div>
          </div>
        </li>
      </div>
  </ol>

                </div>
              </div>
          </div>
        </li>
      </div>
  </ol>

    </div>
  </div>
</div>
