<div class="comments post" id="comments">
  <h4>35 comments:</h4>
  <div class="comments-content">
    <div class="comment-thread">
        <ol>
      <div>
        <li class="comment" id="4346036584161766922">
          <!--
          <div class="avatar-image-container">
            <img src="https://resources.blogblog.com/img/blank.gif">
          </div>
          -->
          <div class="comment-block">
            <div class="comment-header">
              <cite class="user"><a href="None" rel="nofollow">MMK</a></cite>
              <span class="datetime secondary-text">
                <a rel="nofollow" id="c4346036584161766922" href="#4346036584161766922">18 April 2011 12:22</a>
              </span>
            </div>
            <div class="comment-content">Hey Ivan,<br /><br />Just few words of appreciation for you... is there no saturday or no sunday for you?? Dont you take holidays??? When do you actually rest.... Wish I had the same dedication :(</div>
          </div>
        </li>
      </div>
      <div>
        <li class="comment" id="3662014052370672231">
          <!--
          <div class="avatar-image-container">
            <img src="https://resources.blogblog.com/img/blank.gif">
          </div>
          -->
          <div class="comment-block">
            <div class="comment-header">
              <cite class="user"><a href="None" rel="nofollow">NotSoAnonymous</a></cite>
              <span class="datetime secondary-text">
                <a rel="nofollow" id="c3662014052370672231" href="#3662014052370672231">19 April 2011 00:18</a>
              </span>
            </div>
            <div class="comment-content">Love this part --&gt; &quot;....but it got too complex for the customer (and they were absolutely right to reject it and fall back to simpler options)&quot;</div>
          </div>
        </li>
      </div>
      <div>
        <li class="comment" id="3303409880164024326">
          <!--
          <div class="avatar-image-container">
            <img src="https://resources.blogblog.com/img/blank.gif">
          </div>
          -->
          <div class="comment-block">
            <div class="comment-header">
              <cite class="user"><a href="None" rel="nofollow">Calin C.</a></cite>
              <span class="datetime secondary-text">
                <a rel="nofollow" id="c3303409880164024326" href="#3303409880164024326">19 April 2011 11:22</a>
              </span>
            </div>
            <div class="comment-content">Regarding your drawing, I have a question. If you would design this scenario in a redundant way (active - standby, with asymetrical traffic), and for some reason the FW lose the connection, both think they are the active ones, right? I think we&#39;ll have the same problem as described here, but from the opposite direction.<br />Please correct me if I&#39;m wrong.<br /><br />So, beside your Google style solution, there is no other alternative?<br /><br />Thanks</div>
          </div>
        </li>
      </div>
      <div>
        <li class="comment" id="6666431934389102449">
          <!--
          <div class="avatar-image-container">
            <img src="https://resources.blogblog.com/img/blank.gif">
          </div>
          -->
          <div class="comment-block">
            <div class="comment-header">
              <cite class="user"><a href="None" rel="nofollow">mnantel</a></cite>
              <span class="datetime secondary-text">
                <a rel="nofollow" id="c6666431934389102449" href="#6666431934389102449">19 April 2011 12:45</a>
              </span>
            </div>
            <div class="comment-content">Ivan,<br />To reduce the risk of the datacenter interconnect, what I have done in multiple occasions within the past year was recommend a strategy where the client had a primary fast datacenter interconnect (usually dark fiber) between his 2 sites and as a backup to that use an L2TPv3 pseudowire over what is usually the client&#39;s existing L3 WAN. To avoid bridging each site&#39;s STP domain, I would use either REP (Cisco) or RRPP (HP) as a ring protocol responsible for the datacenter &quot;ring&quot;, each link being terminated on either ME3400s with Cisco or an IRF pair of A-series HP switches.<br /><br />With REP, you can only break the ring with STP in one location, and you have to use a stackwise pair in the other end with flex links to both of the local &quot;ring devices&quot;. One of the Cisco Live sessions had some nice designs that suggested that, and it works very well.<br /><br />With an IRF pair, those problems are taken care of as the device is a single entity, and thus only runs the ring protocol over the datacenter interconnect (the private fiber and the pseudowire).<br /><br />The end result is that the risks of a dual active, split-brain scenario are very much reduced, and the ring protocol ensures fast convergence and STP domain isolation.</div>
          </div>
        </li>
      </div>
      <div>
        <li class="comment" id="6262828445169809588">
          <!--
          <div class="avatar-image-container">
            <img src="https://resources.blogblog.com/img/blank.gif">
          </div>
          -->
          <div class="comment-block">
            <div class="comment-header">
              <cite class="user"><a href="None" rel="nofollow">mnantel</a></cite>
              <span class="datetime secondary-text">
                <a rel="nofollow" id="c6262828445169809588" href="#6262828445169809588">19 April 2011 13:05</a>
              </span>
            </div>
            <div class="comment-content">And here is the schema that should have accompanied that explanation...</div>
          </div>
        </li>
      </div>
      <div>
        <li class="comment" id="388153487787519320">
          <!--
          <div class="avatar-image-container">
            <img src="https://resources.blogblog.com/img/blank.gif">
          </div>
          -->
          <div class="comment-block">
            <div class="comment-header">
              <cite class="user"><a href="None" rel="nofollow">Ivan Pepelnjak</a></cite>
              <span class="datetime secondary-text">
                <a rel="nofollow" id="c388153487787519320" href="#388153487787519320">19 April 2011 13:12</a>
              </span>
            </div>
            <div class="comment-content">In your scenario, both firewalls will become active.<br /><br />Alternatives depend on how reliable you want your design to be and how reliable you think your DCI link is (see also the comment from mnantel)</div>
          </div>
        </li>
      </div>
      <div>
        <li class="comment" id="7075079401917627170">
          <!--
          <div class="avatar-image-container">
            <img src="https://resources.blogblog.com/img/blank.gif">
          </div>
          -->
          <div class="comment-block">
            <div class="comment-header">
              <cite class="user"><a href="None" rel="nofollow">Anonymous</a></cite>
              <span class="datetime secondary-text">
                <a rel="nofollow" id="c7075079401917627170" href="#7075079401917627170">19 April 2011 14:16</a>
              </span>
            </div>
            <div class="comment-content">Can u tell me Ciscolive session where these designs were discussed?</div>
          </div>
        </li>
      </div>
      <div>
        <li class="comment" id="4925213464114941065">
          <!--
          <div class="avatar-image-container">
            <img src="https://resources.blogblog.com/img/blank.gif">
          </div>
          -->
          <div class="comment-block">
            <div class="comment-header">
              <cite class="user"><a href="None" rel="nofollow">mnantel</a></cite>
              <span class="datetime secondary-text">
                <a rel="nofollow" id="c4925213464114941065" href="#4925213464114941065">19 April 2011 17:53</a>
              </span>
            </div>
            <div class="comment-content">BRKSPG-2205, titled Deploying and Designing with the Resilient Ethernet Protocol. PDF page 69 describes such solutions.</div>
          </div>
        </li>
      </div>
      <div>
        <li class="comment" id="2027602927748804167">
          <!--
          <div class="avatar-image-container">
            <img src="https://resources.blogblog.com/img/blank.gif">
          </div>
          -->
          <div class="comment-block">
            <div class="comment-header">
              <cite class="user"><a href="None" rel="nofollow">nd</a></cite>
              <span class="datetime secondary-text">
                <a rel="nofollow" id="c2027602927748804167" href="#2027602927748804167">20 April 2011 10:18</a>
              </span>
            </div>
            <div class="comment-content">Hi Ivan,<br />&gt; Unless you believe in the miracles of TCP-based anycasting<br />What problems do you expect there? Rare session failures and reshakings... anything else?</div>
          </div>
        </li>
      </div>
      <div>
        <li class="comment" id="2143473716224851553">
          <!--
          <div class="avatar-image-container">
            <img src="https://resources.blogblog.com/img/blank.gif">
          </div>
          -->
          <div class="comment-block">
            <div class="comment-header">
              <cite class="user"><a href="None" rel="nofollow">Ivan Pepelnjak</a></cite>
              <span class="datetime secondary-text">
                <a rel="nofollow" id="c2143473716224851553" href="#2143473716224851553">20 April 2011 10:29</a>
              </span>
            </div>
            <div class="comment-content">It probably depends on how far apart your data centers are and whether they connect to the same ISP or different ISPs. <br /><br />If the difference in paths needed to reach them (as seen from outside) is big enough, anycasting should work like a dream ... but then you&#39;d probably need a different DCI design anyway as your DCI link won&#39;t have infinite bandwidth.</div>
          </div>
        </li>
      </div>
      <div>
        <li class="comment" id="1158379520693110882">
          <!--
          <div class="avatar-image-container">
            <img src="https://resources.blogblog.com/img/blank.gif">
          </div>
          -->
          <div class="comment-block">
            <div class="comment-header">
              <cite class="user"><a href="None" rel="nofollow">nd</a></cite>
              <span class="datetime secondary-text">
                <a rel="nofollow" id="c1158379520693110882" href="#1158379520693110882">20 April 2011 10:48</a>
              </span>
            </div>
            <div class="comment-content">We go perfectly with 70 msecs between DCs and IPSec for interconnect over Internet. No L2, unique subnets with reliable routing and simple troubleshooting.<br />ISPs must be different anyway for redundancy. Loadbalancing is a metter of playing with communities.</div>
          </div>
        </li>
      </div>
      <div>
        <li class="comment" id="2689893022597846876">
          <!--
          <div class="avatar-image-container">
            <img src="https://resources.blogblog.com/img/blank.gif">
          </div>
          -->
          <div class="comment-block">
            <div class="comment-header">
              <cite class="user"><a href="None" rel="nofollow">Ronald Bartels</a></cite>
              <span class="datetime secondary-text">
                <a rel="nofollow" id="c2689893022597846876" href="#2689893022597846876">20 April 2011 13:17</a>
              </span>
            </div>
            <div class="comment-content">I would suggest my solution but don&#39;t want to risk the holy cow battle all over again...</div>
          </div>
        </li>
      </div>
      <div>
        <li class="comment" id="2107880114556195265">
          <!--
          <div class="avatar-image-container">
            <img src="https://resources.blogblog.com/img/blank.gif">
          </div>
          -->
          <div class="comment-block">
            <div class="comment-header">
              <cite class="user"><a href="None" rel="nofollow">Ivan Pepelnjak</a></cite>
              <span class="datetime secondary-text">
                <a rel="nofollow" id="c2107880114556195265" href="#2107880114556195265">20 April 2011 13:38</a>
              </span>
            </div>
            <div class="comment-content">Sounds reasonable. Anycasting or two different prefixes?</div>
          </div>
        </li>
      </div>
      <div>
        <li class="comment" id="8823481889587494987">
          <!--
          <div class="avatar-image-container">
            <img src="https://resources.blogblog.com/img/blank.gif">
          </div>
          -->
          <div class="comment-block">
            <div class="comment-header">
              <cite class="user"><a href="None" rel="nofollow">Ivan Pepelnjak</a></cite>
              <span class="datetime secondary-text">
                <a rel="nofollow" id="c8823481889587494987" href="#8823481889587494987">20 April 2011 13:39</a>
              </span>
            </div>
            <div class="comment-content">By all means, please do. I promise there will be no bovine certification discussions  :-E</div>
          </div>
        </li>
      </div>
      <div>
        <li class="comment" id="7807401291314849685">
          <!--
          <div class="avatar-image-container">
            <img src="https://resources.blogblog.com/img/blank.gif">
          </div>
          -->
          <div class="comment-block">
            <div class="comment-header">
              <cite class="user"><a href="None" rel="nofollow">nd</a></cite>
              <span class="datetime secondary-text">
                <a rel="nofollow" id="c7807401291314849685" href="#7807401291314849685">20 April 2011 13:56</a>
              </span>
            </div>
            <div class="comment-content">Single prefix. It&#39;s more then resonable comparing pricing, stability and simplicity against solutions vendors push out of their clouds.</div>
          </div>
        </li>
      </div>
      <div>
        <li class="comment" id="706754559989013855">
          <!--
          <div class="avatar-image-container">
            <img src="https://resources.blogblog.com/img/blank.gif">
          </div>
          -->
          <div class="comment-block">
            <div class="comment-header">
              <cite class="user"><a href="None" rel="nofollow">Ivan Pepelnjak</a></cite>
              <span class="datetime secondary-text">
                <a rel="nofollow" id="c706754559989013855" href="#706754559989013855">20 April 2011 14:21</a>
              </span>
            </div>
            <div class="comment-content">I would love to hear more. If you&#39;re willing to share anything (off-the record and totally anonymously, of course), please get in touch with me (contact link on the top of the page for example)</div>
          </div>
        </li>
      </div>
      <div>
        <li class="comment" id="2777922181563984335">
          <!--
          <div class="avatar-image-container">
            <img src="https://resources.blogblog.com/img/blank.gif">
          </div>
          -->
          <div class="comment-block">
            <div class="comment-header">
              <cite class="user"><a href="None" rel="nofollow">Ronald Bartels</a></cite>
              <span class="datetime secondary-text">
                <a rel="nofollow" id="c2777922181563984335" href="#2777922181563984335">20 April 2011 21:27</a>
              </span>
            </div>
            <div class="comment-content">Well firstly anyone who uses the word pseudowire deserves to become a bovine sacrifice.<br /><br />Secondly, I think you did a Hitchhiker&#39;s.  The answer is 42 but what is the question?</div>
          </div>
        </li>
      </div>
      <div>
        <li class="comment" id="2218033436960615248">
          <!--
          <div class="avatar-image-container">
            <img src="https://resources.blogblog.com/img/blank.gif">
          </div>
          -->
          <div class="comment-block">
            <div class="comment-header">
              <cite class="user"><a href="None" rel="nofollow">Anonymous</a></cite>
              <span class="datetime secondary-text">
                <a rel="nofollow" id="c2218033436960615248" href="#2218033436960615248">21 April 2011 00:07</a>
              </span>
            </div>
            <div class="comment-content">Hi Evan,<br /><br />To be be honest I don&#39;t see a problem that can&#39;t be solved in the architecture in your first diagram. If a split brain situation occurs then propagate the external IP prefix to only one WAN router. (based on the quorum reachability)<br /><br />What am I overlooking here?<br /><br />Best regards,</div>
          </div>
        </li>
      </div>
      <div>
        <li class="comment" id="1761067353132547184">
          <!--
          <div class="avatar-image-container">
            <img src="https://resources.blogblog.com/img/blank.gif">
          </div>
          -->
          <div class="comment-block">
            <div class="comment-header">
              <cite class="user"><a href="None" rel="nofollow">Anonymous</a></cite>
              <span class="datetime secondary-text">
                <a rel="nofollow" id="c1761067353132547184" href="#1761067353132547184">21 April 2011 00:10</a>
              </span>
            </div>
            <div class="comment-content">My appologies, made a typo, s/Evan/Ivan</div>
          </div>
        </li>
      </div>
      <div>
        <li class="comment" id="7510509058402840974">
          <!--
          <div class="avatar-image-container">
            <img src="https://resources.blogblog.com/img/blank.gif">
          </div>
          -->
          <div class="comment-block">
            <div class="comment-header">
              <cite class="user"><a href="None" rel="nofollow">Ivan Pepelnjak</a></cite>
              <span class="datetime secondary-text">
                <a rel="nofollow" id="c7510509058402840974" href="#7510509058402840974">21 April 2011 07:23</a>
              </span>
            </div>
            <div class="comment-content">What would you use instead of &quot;pseudowire&quot;? That&#39;s how the technology used to implement P2P Ethernet links across MPLS or IP clouds happens to be called. Not my choice.</div>
          </div>
        </li>
      </div>
      <div>
        <li class="comment" id="9077223744695034905">
          <!--
          <div class="avatar-image-container">
            <img src="https://resources.blogblog.com/img/blank.gif">
          </div>
          -->
          <div class="comment-block">
            <div class="comment-header">
              <cite class="user"><a href="None" rel="nofollow">Ivan Pepelnjak</a></cite>
              <span class="datetime secondary-text">
                <a rel="nofollow" id="c9077223744695034905" href="#9077223744695034905">21 April 2011 07:26</a>
              </span>
            </div>
            <div class="comment-content">Assuming you could reliably detect that the DCI link is down (which was one of the trickier part of my L3 design I mentioned in the post), the DCI link failure would effectively cut off one DC from the Internet.<br /><br />Also, assuming your right DC is the &quot;chosen victim&quot;, how does it know the DCI link failed (and it should cut itself from the Internet) and not the left DC (in which case it should not do so)?</div>
              <div class="comment-replies">
                <div class="comment-thread inline-thread">
                  <span class="thread-count"><a>Replies</a></span>
                    <ol>
      <div>
        <li class="comment" id="2092709108566215138">
          <!--
          <div class="avatar-image-container">
            <img src="https://4.bp.blogspot.com/-6FrHoMlmQZA/XU1v0z7Jc3I/AAAAAAAAE3A/aF_iJtf1iXIn-z6MWJKMrs-nZ9Jilk-IACK4BGAYYCw/s32/IMG_1606.JPG">
          </div>
          -->
          <div class="comment-block">
            <div class="comment-header">
              <cite class="user"><a href="https://www.blogger.com/profile/11059180104069090363" rel="nofollow">Ariel Liguori</a></cite>
              <span class="datetime secondary-text">
                <a rel="nofollow" id="c2092709108566215138" href="#2092709108566215138">18 May 2017 14:30</a>
              </span>
            </div>
            <div class="comment-content">I know that i&#39;m quoting an OLD post, but this happened me few months ago and we go ahead with BGP conditional advertisment to do the trick, is tremendous complex design and operation, but they agreed.</div>
          </div>
        </li>
      </div>
  </ol>

                </div>
              </div>
          </div>
        </li>
      </div>
      <div>
        <li class="comment" id="1823032352730793548">
          <!--
          <div class="avatar-image-container">
            <img src="https://resources.blogblog.com/img/blank.gif">
          </div>
          -->
          <div class="comment-block">
            <div class="comment-header">
              <cite class="user"><a href="None" rel="nofollow">nd</a></cite>
              <span class="datetime secondary-text">
                <a rel="nofollow" id="c1823032352730793548" href="#1823032352730793548">21 April 2011 09:27</a>
              </span>
            </div>
            <div class="comment-content">Hi Ivan,<br />Thanks for conversation yesterday. Still I think anycast is much better solution for lots of designs today. Despite you say it could not work in some situations, I can find too few of them.<br />Even if a weird ISP gets equal path via different peers (very uncommon situation) it would be unbelivably weird of him to configure ebgp load sharing and further more balancing per packet not flow. True miracle are things working without human intervention, it&#39;s architect&#39;s/engineer&#39;s job to find these 1% issue cases and fix them.<br />People do not rely on anycast because they were tought in their childhood &quot;TCP-anycast doesn&#39;t work, forget it!&quot; Well, it does in fact and saves huge amunts of money and nerves.<br />Solution is not for vendors or integrators getting money for selling boxes and complicated designs. It&#39;s for internal staff willing to sleep well and get money for doing nothing.<br /><br />Anycast is not for clusters. Who cares? They are back-ends. You can choose DCI with AToM and pay for it or create your own with L2TPv3+IPSec+Internet to syncronize them. Traffic will go through the same ISP equipment with the same delays/jitter/ploss. These L2 links must be kept as few as possible or totally avoided by configuring primary/secondary options on front-ends.<br /><br />HTTP can work with anycast and it&#39;s the major application companies need today, even global monsters. I bet there are so few tcp applications lacking support of this technology that it should be brought back to humankind.<br /><br />If there&#39;s anyone with a large company network to design I&#39;d love to participate and implement anycast. Really. &#39;Cos it works! =)</div>
          </div>
        </li>
      </div>
      <div>
        <li class="comment" id="7959571240282557349">
          <!--
          <div class="avatar-image-container">
            <img src="https://resources.blogblog.com/img/blank.gif">
          </div>
          -->
          <div class="comment-block">
            <div class="comment-header">
              <cite class="user"><a href="None" rel="nofollow">Anonymous</a></cite>
              <span class="datetime secondary-text">
                <a rel="nofollow" id="c7959571240282557349" href="#7959571240282557349">21 April 2011 10:00</a>
              </span>
            </div>
            <div class="comment-content">There are, of course, more things to consider than how to deal with DCI failure, but lets focus on this part for now.<br /><br />What I would do is create an IP SLA on both WAN routers that monitor one (or more) device(s) that can only be reached via the DCI. (for example the core router in the other data center)<br /><br />If the DCI fails then both WAN routers notice this. The question is then what should happen. It depends what services are available in both datacenters. Depending on that answer you have multiple options. You can designate one datacenter to take over all services by routing the ip-prefix to one location or you can split the ip-prefix in two (or more) and give each datacenter the part it can handle based on backend availability and expected load.<br /><br />Am I missing something?<br /><br />Best regards,</div>
          </div>
        </li>
      </div>
      <div>
        <li class="comment" id="2162346209862973795">
          <!--
          <div class="avatar-image-container">
            <img src="https://resources.blogblog.com/img/blank.gif">
          </div>
          -->
          <div class="comment-block">
            <div class="comment-header">
              <cite class="user"><a href="None" rel="nofollow">Matt</a></cite>
              <span class="datetime secondary-text">
                <a rel="nofollow" id="c2162346209862973795" href="#2162346209862973795">26 April 2011 23:32</a>
              </span>
            </div>
            <div class="comment-content">Keep in mind, some networks use systems that change BGP routes throughout the day as part of traffic engineering.  While it&#39;s not likely that the same route would be picked to flop around across many providers, it&#39;s certainly reasonable to imagine that my route to your netblock might change 3-4 times a day.  Those resetting TCP sessions may not be as rare as you think.<br /><br />Also, I guess it depends on what you consider acceptable.  To me, having user TCP connections fail (and seeing an error page) during normal operation even only once a day is unacceptable.  We should be striving for 0 errors during normal operation.  Errors should only happen during failures.</div>
          </div>
        </li>
      </div>
      <div>
        <li class="comment" id="7913139295085933844">
          <!--
          <div class="avatar-image-container">
            <img src="https://resources.blogblog.com/img/blank.gif">
          </div>
          -->
          <div class="comment-block">
            <div class="comment-header">
              <cite class="user"><a href="None" rel="nofollow">Ivan Pepelnjak</a></cite>
              <span class="datetime secondary-text">
                <a rel="nofollow" id="c7913139295085933844" href="#7913139295085933844">27 April 2011 09:39</a>
              </span>
            </div>
            <div class="comment-content">As long as your BGP core is in front of your firewalls, you won&#39;t see TCP session failures at all. They only happen if the changes in BGP routing cause the sessions to go through different set of firewalls.</div>
          </div>
        </li>
      </div>
      <div>
        <li class="comment" id="7568091019557361749">
          <!--
          <div class="avatar-image-container">
            <img src="https://resources.blogblog.com/img/blank.gif">
          </div>
          -->
          <div class="comment-block">
            <div class="comment-header">
              <cite class="user"><a href="None" rel="nofollow">Derick Winkworth</a></cite>
              <span class="datetime secondary-text">
                <a rel="nofollow" id="c7568091019557361749" href="#7568091019557361749">03 May 2011 07:35</a>
              </span>
            </div>
            <div class="comment-content">Or don&#39;t do syncrhonized firewalls at all.  I know a lot of people swear by this, but my experience has been that firewall clustering can cause more problems than resolve.  Usually when it has been useful it was because of a planned outage of one or the other firewalls.<br /><br />Some firewall vendors make active/active synchronization as easy as clicking a button and waiting a few minutes for the flow data to syncrhonize.  If we know there will be an outage, we sync then we perform the maintenance, then we un-sync.</div>
          </div>
        </li>
      </div>
      <div>
        <li class="comment" id="7180992999339725491">
          <!--
          <div class="avatar-image-container">
            <img src="https://lh3.googleusercontent.com/zFdxGE77vvD2w5xHy6jkVuElKv-U9_9qLkRYK8OnbDeJPtjSZ82UPq5w6hJ-SA=s35">
          </div>
          -->
          <div class="comment-block">
            <div class="comment-header">
              <cite class="user"><a href="https://www.blogger.com/profile/17610767928460477899" rel="nofollow">DanVoyer</a></cite>
              <span class="datetime secondary-text">
                <a rel="nofollow" id="c7180992999339725491" href="#7180992999339725491">14 January 2013 15:38</a>
              </span>
            </div>
            <div class="comment-content">Stretched clustering firewalls make sense IF:<br /><br />DCI fiber is confirmed to take different path. <br /><br />The chosen firewall is able to support LAG and is active with the chosen dynamic routing protocol. <br /><br />VRF introduce in DC.<br /><br />With that in mind, there will be &quot;lots&quot; of saving for the same type of service level.</div>
          </div>
        </li>
      </div>
      <div>
        <li class="comment" id="1079427251877127021">
          <!--
          <div class="avatar-image-container">
            <img src="https://lh3.googleusercontent.com/zFdxGE77vvD2w5xHy6jkVuElKv-U9_9qLkRYK8OnbDeJPtjSZ82UPq5w6hJ-SA=s35">
          </div>
          -->
          <div class="comment-block">
            <div class="comment-header">
              <cite class="user"><a href="https://www.blogger.com/profile/15152269960523987433" rel="nofollow">Joy Sarkar</a></cite>
              <span class="datetime secondary-text">
                <a rel="nofollow" id="c1079427251877127021" href="#1079427251877127021">23 April 2013 21:04</a>
              </span>
            </div>
            <div class="comment-content">&quot;The active-active firewalls would exchange flow information, solving the asymmetrical flow problems&quot; - Does the state needs to be in sync before the return traffic when asymetric hots the other firewall on its way out. What happens if the return packet arrives first and state sync happens a msec latter?<br /><br /></div>
              <div class="comment-replies">
                <div class="comment-thread inline-thread">
                  <span class="thread-count"><a>Replies</a></span>
                    <ol>
      <div>
        <li class="comment" id="6593431615641667758">
          <!--
          <div class="avatar-image-container">
            <img src="https://lh3.googleusercontent.com/zFdxGE77vvD2w5xHy6jkVuElKv-U9_9qLkRYK8OnbDeJPtjSZ82UPq5w6hJ-SA=s35">
          </div>
          -->
          <div class="comment-block">
            <div class="comment-header">
              <cite class="user"><a href="https://www.blogger.com/profile/13457151406311272386" rel="nofollow">Ivan Pepelnjak</a></cite>
              <span class="datetime secondary-text">
                <a rel="nofollow" id="c6593431615641667758" href="#6593431615641667758">24 April 2013 07:57</a>
              </span>
            </div>
            <div class="comment-content">Never deep-dived into those details, but based on the discussion I had with one of our security gurus, it seems the &quot;wrong&quot; box just forwards the packet to the &quot;flow owner&quot; ... and the synchronized state is needed primarily in failure scenarios.</div>
          </div>
        </li>
      </div>
  </ol>

                </div>
              </div>
          </div>
        </li>
      </div>
      <div>
        <li class="comment" id="2306454843034130969">
          <!--
          <div class="avatar-image-container">
            <img src="https://lh3.googleusercontent.com/zFdxGE77vvD2w5xHy6jkVuElKv-U9_9qLkRYK8OnbDeJPtjSZ82UPq5w6hJ-SA=s35">
          </div>
          -->
          <div class="comment-block">
            <div class="comment-header">
              <cite class="user"><a href="https://www.blogger.com/profile/18417457563490718355" rel="nofollow">Adam</a></cite>
              <span class="datetime secondary-text">
                <a rel="nofollow" id="c2306454843034130969" href="#2306454843034130969">01 November 2013 08:45</a>
              </span>
            </div>
            <div class="comment-content">So when is a DCI a &quot;DCI&quot;?<br /><br />I am considering a design for a customer in which their DCI is 4 LAGed pairs of customer-owned dark fiber between two buildings which are 100ft from each other.  (I know...not much for DR, but it&#39;s what they have to work with).  We could tag separate VLANs across the DCI to interconnect the various pairs of devices (eg. one for HSRP/IBGP on the internet edge routers, another for state-sync on the firewalls).<br /><br />Would you still frown on this architecture if the data centers were on opposite ends of the same building?<br /><br />Opposite ends of the same data center?<br /><br />Opposite ends of the same rack?<br /><br />You can see the crux of my question is becoming &quot;What precise factors make the DCI such a weak to be avoided as a cluster link.<br /><br />Is it:<br />a - High Latency?<br />b - Probability of being mechanically disturbed by the ditch diggers?<br />c - Probability of being logically disturbed by malfunctioning service provider equipment?<br />d - Using the same link to connect multiple &quot;clusters&quot;  (ie. tagging a VLAN for each cluster link instead of using a separate cable for each cluster link as would normally be the case if they were in the same data center)  I DO hate the idea that losing this DCI would require every pair of devices to simultaneously recalculate mastership.<br /><br />In my case criteria A and C are not a concern due to the short distance, and the private nature of the customer-owned fiber.  However B and D are still factors to be weighed.<br /><br />Thoughts?</div>
              <div class="comment-replies">
                <div class="comment-thread inline-thread">
                  <span class="thread-count"><a>Replies</a></span>
                    <ol>
      <div>
        <li class="comment" id="8481160749900637462">
          <!--
          <div class="avatar-image-container">
            <img src="https://lh3.googleusercontent.com/zFdxGE77vvD2w5xHy6jkVuElKv-U9_9qLkRYK8OnbDeJPtjSZ82UPq5w6hJ-SA=s35">
          </div>
          -->
          <div class="comment-block">
            <div class="comment-header">
              <cite class="user"><a href="https://www.blogger.com/profile/13457151406311272386" rel="nofollow">Ivan Pepelnjak</a></cite>
              <span class="datetime secondary-text">
                <a rel="nofollow" id="c8481160749900637462" href="#8481160749900637462">01 November 2013 08:52</a>
              </span>
            </div>
            <div class="comment-content">The answer is very simple: a single L2 network (VLAN, for example) is a single failure domain and as reliable as its weakest link.<br /><br />You want to have a single failure domain? Go ahead, create a VLAN. You want to have resilience? Do a proper L3 design.</div>
          </div>
        </li>
      </div>
  </ol>

                </div>
              </div>
          </div>
        </li>
      </div>
      <div>
        <li class="comment" id="5780025269141032324">
          <!--
          <div class="avatar-image-container">
            <img src="https://resources.blogblog.com/img/blank.gif">
          </div>
          -->
          <div class="comment-block">
            <div class="comment-header">
              <cite class="user"><a href="None" rel="nofollow">Scott</a></cite>
              <span class="datetime secondary-text">
                <a rel="nofollow" id="c5780025269141032324" href="#5780025269141032324">28 May 2014 22:46</a>
              </span>
            </div>
            <div class="comment-content">Hi Ivan,<br /><br />Regarding the line that reads, &quot;A reliable layer-3 solution is not much easier to design.&quot;  ---   Is the use of the word, &quot;not&quot; a typo perhaps?   I ask this just because I&#39;m confused, since the first sentence seems incongruent with the remainder of that paragraph.   The rest of the paragraph appears to convey that your client decided to fall back to an L3 DCI, in light of the complexity of the stretched L2 design you devised.  <br /><br />Please forgive my question, if this isn&#39;t a typo.  I ask this only for the purpose of clarifying my understanding of your post.  <br /><br />Thanks,<br />Scott<br /></div>
              <div class="comment-replies">
                <div class="comment-thread inline-thread">
                  <span class="thread-count"><a>Replies</a></span>
                    <ol>
      <div>
        <li class="comment" id="8785000754938287652">
          <!--
          <div class="avatar-image-container">
            <img src="https://lh3.googleusercontent.com/zFdxGE77vvD2w5xHy6jkVuElKv-U9_9qLkRYK8OnbDeJPtjSZ82UPq5w6hJ-SA=s35">
          </div>
          -->
          <div class="comment-block">
            <div class="comment-header">
              <cite class="user"><a href="https://www.blogger.com/profile/13457151406311272386" rel="nofollow">Ivan Pepelnjak</a></cite>
              <span class="datetime secondary-text">
                <a rel="nofollow" id="c8785000754938287652" href="#8785000754938287652">29 May 2014 09:05</a>
              </span>
            </div>
            <div class="comment-content">It&#39;s not a typo, a L3 solution advertising the same servers over multiple links is hard (particularly when firewalls and load balancers enter the picture), see this blog post for more details:<br /><br />http://blog.ipspace.net/2013/01/redundant-data-center-internet.html<br /><br />Hope this helps,<br />Ivan</div>
          </div>
        </li>
      </div>
  </ol>

                </div>
              </div>
          </div>
        </li>
      </div>
      <div>
        <li class="comment" id="6404930336842565494">
          <!--
          <div class="avatar-image-container">
            <img src="https://lh3.googleusercontent.com/zFdxGE77vvD2w5xHy6jkVuElKv-U9_9qLkRYK8OnbDeJPtjSZ82UPq5w6hJ-SA=s35">
          </div>
          -->
          <div class="comment-block">
            <div class="comment-header">
              <cite class="user"><a href="https://www.blogger.com/profile/02325877126829760739" rel="nofollow">Loco</a></cite>
              <span class="datetime secondary-text">
                <a rel="nofollow" id="c6404930336842565494" href="#6404930336842565494">20 October 2019 21:49</a>
              </span>
            </div>
            <div class="comment-content">With the last design showen, are the firewalls also configured with an active/active modus? <br /><br />also, as of the date writing this post, would you still see the last design picture + bgp advertising a specific and summary route the best viable solution, and what would be the best DCI option that would go along.</div>
          </div>
        </li>
      </div>
  </ol>

    </div>
  </div>
</div>
