<div class="comments post" id="comments">
  <h4>24 comments:</h4>
  <div class="comments-content">
    <div class="comment-thread">
        <ol>
      <div>
        <li class="comment" id="7466931480656276800">
          <div class="comment-block">
            <div class="comment-header">
              <cite class="user"><a href="" rel="nofollow">Jan Zorz</a></cite>
              <span class="datetime secondary-text">
                <a rel="nofollow" id="c7466931480656276800" href="#7466931480656276800">14 November 2011 10:14</a>
              </span>
            </div>
            <div class="comment-content">MPLS vs. traditional design during an earthquake:<br /><br />http://ripe63.ripe.net/archives/video/184/<br /><br />Worth watching, real data from Randy (IIJ)</div>
          </div>
        </li>
      </div>
      <div>
        <li class="comment" id="2146442247329103004">
          <div class="comment-block">
            <div class="comment-header">
              <cite class="user"><a href="" rel="nofollow">Jan Zorz</a></cite>
              <span class="datetime secondary-text">
                <a rel="nofollow" id="c2146442247329103004" href="#2146442247329103004">14 November 2011 10:15</a>
              </span>
            </div>
            <div class="comment-content">slides: http://ripe63.ripe.net/presentations/128-111102.ripe-quake.pdf</div>
          </div>
        </li>
      </div>
      <div>
        <li class="comment" id="4520279180591312906">
          <div class="comment-block">
            <div class="comment-header">
              <cite class="user"><a href="" rel="nofollow">Lorenzo</a></cite>
              <span class="datetime secondary-text">
                <a rel="nofollow" id="c4520279180591312906" href="#4520279180591312906">14 November 2011 10:40</a>
              </span>
            </div>
            <div class="comment-content">How to make this funny graphs?</div>
          </div>
        </li>
      </div>
      <div>
        <li class="comment" id="7385705810874615140">
          <div class="comment-block">
            <div class="comment-header">
              <cite class="user"><a href="" rel="nofollow">Ivan Pepelnjak</a></cite>
              <span class="datetime secondary-text">
                <a rel="nofollow" id="c7385705810874615140" href="#7385705810874615140">14 November 2011 13:13</a>
              </span>
            </div>
            <div class="comment-content">Not exactly (at least not the slides). Randy explained how a traditional well-designed routing-only IP network survived a major link outage. No surprises there, he knows what he&#39;s doing ;)</div>
          </div>
        </li>
      </div>
      <div>
        <li class="comment" id="8346201377232298883">
          <div class="comment-block">
            <div class="comment-header">
              <cite class="user"><a href="" rel="nofollow">Ivan Pepelnjak</a></cite>
              <span class="datetime secondary-text">
                <a rel="nofollow" id="c8346201377232298883" href="#8346201377232298883">14 November 2011 13:15</a>
              </span>
            </div>
            <div class="comment-content">See the last paragraph in this blog post: http://blog.ioshints.info/2011/10/l2-or-l3-switching-in-campus-networks.html</div>
          </div>
        </li>
      </div>
      <div>
        <li class="comment" id="4951639236389405702">
          <div class="comment-block">
            <div class="comment-header">
              <cite class="user"><a href="" rel="nofollow">Tiziano</a></cite>
              <span class="datetime secondary-text">
                <a rel="nofollow" id="c4951639236389405702" href="#4951639236389405702">14 November 2011 16:40</a>
              </span>
            </div>
            <div class="comment-content">Another interesting case where IGP-LDP sync is useful is when (OSPF or IS-IS) adjacency is &quot;up&quot; but LDP session is down. Without IGP-LDP sync a router does not change IGP path (since it does not see any topology change), therefore traffic between the two routers is black-holed (label from the other router missing !). With IG-LDP sync enabled, the IGP change path even when the LDP session is down and the (OSPF or IS-IS) adjacency is &quot;up&quot; (tested with IOS, works fine !). Principle is obviously the same, advertise link where LDP session fails with the highest metric possible.</div>
          </div>
        </li>
      </div>
      <div>
        <li class="comment" id="6953415054663463246">
          <div class="comment-block">
            <div class="comment-header">
              <cite class="user"><a href="" rel="nofollow">igp2bgp</a></cite>
              <span class="datetime secondary-text">
                <a rel="nofollow" id="c6953415054663463246" href="#6953415054663463246">14 November 2011 17:50</a>
              </span>
            </div>
            <div class="comment-content">I think if LDP run order mode, then there is no need for this. whenever ingress router get a label, it has to be distributed by egress, there is no black-hole in design.</div>
          </div>
        </li>
      </div>
      <div>
        <li class="comment" id="8529170222888630936">
          <div class="comment-block">
            <div class="comment-header">
              <cite class="user"><a href="" rel="nofollow">Tiziano</a></cite>
              <span class="datetime secondary-text">
                <a rel="nofollow" id="c8529170222888630936" href="#8529170222888630936">14 November 2011 18:01</a>
              </span>
            </div>
            <div class="comment-content">I started from different assumptions. <br />As Ivan wrote &quot;when using independent label distribution and liberal label retention mode (default settings on most modern routers)&quot;,  I assumed independent label distribution and liberal retention mode. In this case black-holes are surely possible, you get a black-hole as soon as LDP session on a link drops down (in VPN service, this happens even if LDP session drops down on the last link of the path).</div>
          </div>
        </li>
      </div>
      <div>
        <li class="comment" id="8603857661989381235">
          <div class="comment-block">
            <div class="comment-header">
              <cite class="user"><a href="" rel="nofollow">igp2bgp</a></cite>
              <span class="datetime secondary-text">
                <a rel="nofollow" id="c8603857661989381235" href="#8603857661989381235">14 November 2011 18:37</a>
              </span>
            </div>
            <div class="comment-content">juniper support order mode and igp-ldp sync, not sure what might be the deployment scenario? independent mode is default for IOS, not juniper, right?  <br />http://www.juniper.net/techpubs/en_US/junos11.3/topics/reference/standards/ldp.html</div>
          </div>
        </li>
      </div>
      <div>
        <li class="comment" id="8914631786810822110">
          <div class="comment-block">
            <div class="comment-header">
              <cite class="user"><a href="" rel="nofollow">Ivan Pepelnjak</a></cite>
              <span class="datetime secondary-text">
                <a rel="nofollow" id="c8914631786810822110" href="#8914631786810822110">14 November 2011 19:23</a>
              </span>
            </div>
            <div class="comment-content">Not sure ordered mode makes much difference (but have to check what Junos really does). Anyhow, if an LDP session breaks (or is not established yet), LSP along IGP best path either breaks or is not available at all (which might be the case in ordered mode). No difference from the packet forwarding perspective.</div>
          </div>
        </li>
      </div>
      <div>
        <li class="comment" id="6888424669457703569">
          <div class="comment-block">
            <div class="comment-header">
              <cite class="user"><a href="" rel="nofollow">igp2bgp</a></cite>
              <span class="datetime secondary-text">
                <a rel="nofollow" id="c6888424669457703569" href="#6888424669457703569">15 November 2011 00:38</a>
              </span>
            </div>
            <div class="comment-content">after heavy reading, i think in case of order ldp mode, router a will retain the lbl and ingress router won&#39;t have lsp tunnel to forwarding traffic.  ldp/igp sync up do make sense in case of order mode.</div>
          </div>
        </li>
      </div>
      <div>
        <li class="comment" id="7960740927308847432">
          <div class="comment-block">
            <div class="comment-header">
              <cite class="user"><a href="" rel="nofollow">nosx</a></cite>
              <span class="datetime secondary-text">
                <a rel="nofollow" id="c7960740927308847432" href="#7960740927308847432">15 November 2011 03:28</a>
              </span>
            </div>
            <div class="comment-content">Another valuable IGP command to prevent blackholing is:<br />max-metric router-lsa on-startup 120<br /><br />Also, for the edge devices BGP PIC can again accelerate repair for backup paths. I would like to see an article on BGP PIC, especially the &quot;no bgp recursion host&quot; piece.</div>
          </div>
        </li>
      </div>
      <div>
        <li class="comment" id="6147207312793019356">
          <div class="comment-block">
            <div class="comment-header">
              <cite class="user"><a href="" rel="nofollow">Tiziano</a></cite>
              <span class="datetime secondary-text">
                <a rel="nofollow" id="c6147207312793019356" href="#6147207312793019356">15 November 2011 09:08</a>
              </span>
            </div>
            <div class="comment-content">JUNOS also defaults to independent mode and liberal retention. One difference with IOS is that JUNOS advertise label bindings only for loopback interface instead of advertising label bindings for each network in routing table (as IOS does). You may change the default behaviour in both cases. My opinion is that JUNOS view is neater, since in a well designed IP/MPLS backbone, what you really need is a full mesh of LSP MPLS between loopbacks of PE routers (used for the full logical mesh of iBGP sessions). Adveritising label bindings for networks used to numeber point-to-point links or broadcast segments inside backbone infrastructure is a quite useless exercise.</div>
          </div>
        </li>
      </div>
      <div>
        <li class="comment" id="5965363083339748322">
          <div class="comment-block">
            <div class="comment-header">
              <cite class="user"><a href="" rel="nofollow">Tiziano</a></cite>
              <span class="datetime secondary-text">
                <a rel="nofollow" id="c5965363083339748322" href="#5965363083339748322">15 November 2011 09:15</a>
              </span>
            </div>
            <div class="comment-content">Right, if you break LSP traffic is black-holed (as a matter of fact there is an exception, if the LSP breaks on the last link and traffic is forwarded through a single MPLS label, because of PHP, traffic is not black-holed). As I pointed out in a previous post, this problem may be solved also by IGP-LDP sync.</div>
          </div>
        </li>
      </div>
      <div>
        <li class="comment" id="9080739914439852730">
          <div class="comment-block">
            <div class="comment-header">
              <cite class="user"><a href="" rel="nofollow">Ivan Pepelnjak</a></cite>
              <span class="datetime secondary-text">
                <a rel="nofollow" id="c9080739914439852730" href="#9080739914439852730">15 November 2011 09:53</a>
              </span>
            </div>
            <div class="comment-content">If the last hop in LSP breaks, BGP-free core continues to work, but MPLS/VPN breaks. Unless the egress PE-router signals implicit-null, the penultimate hop&#39;s outbound label is &quot;NO LABEL&quot;, not &quot;POP&quot;, so all the labels are removed from the stack.</div>
          </div>
        </li>
      </div>
      <div>
        <li class="comment" id="3110576724847844327">
          <div class="comment-block">
            <div class="comment-header">
              <cite class="user"><a href="" rel="nofollow">Ivan Pepelnjak</a></cite>
              <span class="datetime secondary-text">
                <a rel="nofollow" id="c3110576724847844327" href="#3110576724847844327">15 November 2011 09:55</a>
              </span>
            </div>
            <div class="comment-content">Actually, Junos uses ordered, not independent mode. Just tested it yesterday - unless you have LDP session on the last hop, the routers a few hops away don&#39;t see the label for egress PE loopback.</div>
          </div>
        </li>
      </div>
      <div>
        <li class="comment" id="6240939946586671446">
          <div class="comment-block">
            <div class="comment-header">
              <cite class="user"><a href="" rel="nofollow">Tiziano</a></cite>
              <span class="datetime secondary-text">
                <a rel="nofollow" id="c6240939946586671446" href="#6240939946586671446">15 November 2011 15:44</a>
              </span>
            </div>
            <div class="comment-content">I apologize, you are right.<br />JUNOS defaults:<br />Downstream Unsolicited label distribution (as opposed to Downstream on Demand), <br />Ordered label distribution control (as opposed to Independent), <br />Liberal label retention (as opposed to Conservative)<br /><br />Anyway, my claim on traffic black-hole remains valid, independently of label allocation mode.</div>
          </div>
        </li>
      </div>
      <div>
        <li class="comment" id="4153202097007420651">
          <div class="comment-block">
            <div class="comment-header">
              <cite class="user"><a href="" rel="nofollow">jsicuran</a></cite>
              <span class="datetime secondary-text">
                <a rel="nofollow" id="c4153202097007420651" href="#4153202097007420651">15 November 2011 18:33</a>
              </span>
            </div>
            <div class="comment-content">Excellent post again Ivan. Not an MPLS expert but read your books and others. I can understand the Targeted option and to another extent fast reroute to provide a &quot;feasible successor&quot; like quick change.<br />What about the impact of NSF and BFD features in the IGP, they too if used have an affect on the process as well. Any thoughts?<br /><br />Also, what about &quot; donwstream on demand&quot; vs. &quot;unsolcited downstream&quot; label distribution methods as part of the equation, any thoughts?</div>
          </div>
        </li>
      </div>
      <div>
        <li class="comment" id="2308044348963737332">
          <div class="comment-block">
            <div class="comment-header">
              <cite class="user"><a href="" rel="nofollow">jsicuran</a></cite>
              <span class="datetime secondary-text">
                <a rel="nofollow" id="c2308044348963737332" href="#2308044348963737332">15 November 2011 18:42</a>
              </span>
            </div>
            <div class="comment-content">also, it seems we are getting to a point in the industry that the MTU is becoming an item to be constantly considered and not overlooked or taken for granted across many network technologies, such as wireless, wan, lan, ipv6, mpls, vpns(all flavors), vpls, fabrics, security etc.</div>
          </div>
        </li>
      </div>
      <div>
        <li class="comment" id="3336683233065702307">
          <div class="comment-block">
            <div class="comment-header">
              <cite class="user"><a href="" rel="nofollow">BV</a></cite>
              <span class="datetime secondary-text">
                <a rel="nofollow" id="c3336683233065702307" href="#3336683233065702307">23 January 2012 07:26</a>
              </span>
            </div>
            <div class="comment-content">Curious, if it were an L2VPN between In/E-gress in your diagram above, would router A still send it as native IP packet to D (after the physical link between A and D is restored) ? Would there not be a VPN label on top of the IP packet ? Saw this in the 2-label VPN link you had mentioned (that there&#39;ll be a vpn label)<br /><br />Thanks.</div>
          </div>
        </li>
      </div>
      <div>
        <li class="comment" id="5721181027179487385">
          <div class="comment-block">
            <div class="comment-header">
              <cite class="user"><a href="" rel="nofollow">Ivan Pepelnjak</a></cite>
              <span class="datetime secondary-text">
                <a rel="nofollow" id="c5721181027179487385" href="#5721181027179487385">23 January 2012 08:41</a>
              </span>
            </div>
            <div class="comment-content">Before A receives a label mapping for Eg from D, the outbound action for Eg would be &quot;untagged&quot;. Any labeled packets trying to cross that link would probably be dropped. Just guessing though ...</div>
          </div>
        </li>
      </div>
      <div>
        <li class="comment" id="2003804686652235996">
          <div class="comment-block">
            <div class="comment-header">
              <cite class="user"><a href="https://au.linkedin.com/pub/kim-bartlett/17/721/74a" rel="nofollow">Kim Bartlett</a></cite>
              <span class="datetime secondary-text">
                <a rel="nofollow" id="c2003804686652235996" href="#2003804686652235996">29 October 2015 12:39</a>
              </span>
            </div>
            <div class="comment-content">Ivan, I know this is an older post but still great! I was researching the Session Protection feature for my studies, and was glad to find your blog. </div>
          </div>
        </li>
      </div>
      <div>
        <li class="comment" id="2025265063334625620">
          <div class="comment-block">
            <div class="comment-header">
              <cite class="user"><a href="https://www.blogger.com/profile/05595770841652422055" rel="nofollow">Unknown</a></cite>
              <span class="datetime secondary-text">
                <a rel="nofollow" id="c2025265063334625620" href="#2025265063334625620">04 November 2016 01:15</a>
              </span>
            </div>
            <div class="comment-content">would LFA help to keep the traffic on A-B-C-D path when link comes up between A-D until a label is received? LFA should install FRR route towards B on A and it should still be effective until a new route/label is received from D after link up. Link up should be a MBB scenario, IMO. </div>
              <div class="comment-replies">
                <div class="comment-thread inline-thread">
                  <span class="thread-count"><a>Replies</a></span>
                    <ol>
      <div>
        <li class="comment" id="800071677470416182">
          <div class="comment-block">
            <div class="comment-header">
              <cite class="user"><a href="https://www.blogger.com/profile/13457151406311272386" rel="nofollow">Ivan Pepelnjak</a></cite>
              <span class="datetime secondary-text">
                <a rel="nofollow" id="c800071677470416182" href="#800071677470416182">05 November 2016 10:19</a>
              </span>
            </div>
            <div class="comment-content">I don&#39;t think so. LFA kicks in as a temporary measure after a link loss. Simple Segment Routing would be my preferred alternative these days.</div>
          </div>
        </li>
      </div>
  </ol>

                </div>
              </div>
          </div>
        </li>
      </div>
      <div>
        <li class="comment" id="1830">
          <!--
          <div class="avatar-image-container">
            <img src="">
          </div>
          -->
          <div class="comment-block">
            <div class="comment-header">
              <cite class="user"><a href="" rel="nofollow"> ANDREA DI DONATO</a></cite>
              <span class="datetime secondary-text">
                <a rel="nofollow" id="c1830" href="#1830">24 May 2023 12:40</a>
              </span>
            </div>
            <div class="comment-content"><p>I am wondering whether the various vendors&#39; implementations allow the IGP and the LDP to be always synchronised in an ECMP scenario, this way making this feature not needed in such scenario. I&#39;m also wondering whether this is true for label imposition as well as for label swapping. Will be investigating soon but should anyone have any info already and willing to share, it&#39;d be highly appreciated ! </p>

<p>Cheers/Ciao </p>

<p>Andrea</p>
</div>
          </div>
        </li>
      </div>
  </ol>

    </div>
  </div>
</div>
