<div class="comments post" id="comments">
  <h4>14 comments:</h4>
  <div class="comments-content">
    <div class="comment-thread">
        <ol>
      <div>
        <li class="comment" id="6995044997811898981">
          <!--
          <div class="avatar-image-container">
            <img src="https://resources.blogblog.com/img/blank.gif">
          </div>
          -->
          <div class="comment-block">
            <div class="comment-header">
              <cite class="user"><a href="None" rel="nofollow">nosx</a></cite>
              <span class="datetime secondary-text">
                <a rel="nofollow" id="c6995044997811898981" href="#6995044997811898981">13 December 2011 09:34</a>
              </span>
            </div>
            <div class="comment-content">In my mind, we can split the issues into 2 major problems:<br /><br />1) Host address selection.<br />Can this be mitigated by initiating a connection from multiple addresses simulatniously and abandoning those not first-to-succeed? While inefficient, this appears to be a workable solution until smarter people take a crack at the problem.<br /><br />2) CPE next-hop selection.<br />Can this be mitigated by an upstream affinity mechanism? Only send packets sourced from ISPA networks via ISPA, and B via B. Today, that means PBR source based next-hop but a technology to constrain topology based on this kind of setup should not be prohibitively complex. Things get worse with multiple CPE routers to multiple providers but we are talking small site for this specific example.<br /><br />Regarding DHCPv6 extensions to provide CPE additional information:<br />If we are going to provide the CPE additional IPv6 specific information via DHCP, why not provide a list of valid source subnets as well to direct such a source-based forwarding mechanism to make the routing policy clear (ipv6 unicast reverse path forwarding, which most providers cant implement today due to well known cisco hardware deficiencies)<br /><br />While in my previous post I represented these as software deficiencies, and to clarify im including the OS network stack and ipv6 communication protocol extensions to dns and dhcp in that camp as well. The network is doing exactly what it should, providing an end to end layer 3 path between a given set of endpoints.<br /><br />There truly has to be a better way to resolve our issues with an operationally new protocol suite than try to jam it into the old model. My approach to IPv6 deployment at work has been to use it as an opportunity to kick off the shackals of legacy communications systems and force developers to take responsability for their communication. It takes significantly less effort to manipulate how software communicates than to re-architect the network infrastructure around every percieved communications problem.</div>
          </div>
        </li>
      </div>
      <div>
        <li class="comment" id="7068324906810720376">
          <!--
          <div class="avatar-image-container">
            <img src="https://resources.blogblog.com/img/blank.gif">
          </div>
          -->
          <div class="comment-block">
            <div class="comment-header">
              <cite class="user"><a href="None" rel="nofollow">Frank</a></cite>
              <span class="datetime secondary-text">
                <a rel="nofollow" id="c7068324906810720376" href="#7068324906810720376">13 December 2011 14:23</a>
              </span>
            </div>
            <div class="comment-content">Ole and Mark have described an elegant framework here:<br />http://tools.ietf.org/html/draft-townsley-troan-ipv6-ce-transitioning-00<br />If found both sufficient and flexible, this approach could form the basis for CPE multihoming of almost any kind.</div>
          </div>
        </li>
      </div>
      <div>
        <li class="comment" id="25522270522385326">
          <!--
          <div class="avatar-image-container">
            <img src="https://resources.blogblog.com/img/blank.gif">
          </div>
          -->
          <div class="comment-block">
            <div class="comment-header">
              <cite class="user"><a href="None" rel="nofollow">Ivan Pepelnjak</a></cite>
              <span class="datetime secondary-text">
                <a rel="nofollow" id="c25522270522385326" href="#25522270522385326">13 December 2011 16:05</a>
              </span>
            </div>
            <div class="comment-content">Now we&#39;re in perfect agreement ;)<br /><br />As for the CPE job - we could do something along the lines of what needs to be done with PBR today (assuming CPE has just two default routes), a full-blown implementation is described in the draft Frank mentioned - effectively it&#39;s a VRF per WAN link with source address-based VRF selection for egress traffic.</div>
          </div>
        </li>
      </div>
      <div>
        <li class="comment" id="2373591768931604682">
          <!--
          <div class="avatar-image-container">
            <img src="https://resources.blogblog.com/img/blank.gif">
          </div>
          -->
          <div class="comment-block">
            <div class="comment-header">
              <cite class="user"><a href="None" rel="nofollow">hsxx</a></cite>
              <span class="datetime secondary-text">
                <a rel="nofollow" id="c2373591768931604682" href="#2373591768931604682">14 December 2011 02:17</a>
              </span>
            </div>
            <div class="comment-content">It&#39;s great that an appreciated member of the IP world finally brings this topic into open discussion. Even the simple example presented here proves the current state of IPv6 capabilities plainly ridiculous compared to the flexibility that the all-evil IPv4 NAT is able to offer.<br /><br />We started thinking about IPv6 implementation in our enterprise network about a year ago. We have about 5000 IP hosts distributed across 100 sites in 40 countries around the world. The IPv4 implementation is a MPLS core network for corporate business applications like SAP and local Internet connectivity at each site for general youtubing and booking faces, that can also be used for backup VPN connectivity in case of MPLS failure. Private addressing inside the corporate network and IPv4 NAT when going to Internet. Works perfectly. Add to that L2L tunnels to partner organizations, centrally routed IP authenticated services etc., still no problem.<br /><br />So, with great enthusiasm I started familiarizing with IPv6 and googling for examples of enterprise addressing plans and configurations to use as a basis for the design. No match. What? Google more. Nothing. What is this? Can&#39;t be true.<br /><br />After endless googling and discussions with more experienced network experts the sad end result was what is described here and in the previous article. No can do. The greatest and extremely hyped protocol just is not capable of providing a reasonable solution for a simple low-end enterprise network.<br /><br />Fortunately we are big enough to get a /48 PI address space for the multihomed central site connectivity so that we are able to practice IPv6 in a small scale through the one exit point to Internet. Having 16 bits for subnetting allows us to have the same limited logical segmenting capability that we have with the IPv4 private 10/8 addressing currently in use. But at the same time nothing gained from the added address space. 64 bits wasted for in average 50 hosts or in median 20 hosts per site and the network structure still cramped in 16 bits. Great going, IPv6 is so brilliant and saves all our problems plus the whole world. Not.<br /><br />So what would be the options if IPv6 implementation would be an absolute necessity at this point?<br />- Buy lots of expensive MPLS bandwidth to route all the world&#39;s social media through one central pipe?<br />- Implement a strict corporate policy with punishment and threats to ban all generic Internet use?<br />- Split the /48 PI space to /56 or even smaller subnets polluting the routing tables and probably soon discarded when the tables explode? Still excludes the possiblity for policy routing based on whatever reason.<br />- Buy a truckload of high-end routers with all fancy half-standard concoctions and still route traffic through some rare conversion points (LISP etc.)?<br /><br />Fortunately we don&#39;t have immediate need for IPv6 at the moment and can just do the fun-and-play part. Just hoping for NPT66 or similar to emerge before the doomsday dawns.</div>
          </div>
        </li>
      </div>
      <div>
        <li class="comment" id="2719544938727175963">
          <!--
          <div class="avatar-image-container">
            <img src="https://resources.blogblog.com/img/blank.gif">
          </div>
          -->
          <div class="comment-block">
            <div class="comment-header">
              <cite class="user"><a href="None" rel="nofollow">FullMesh</a></cite>
              <span class="datetime secondary-text">
                <a rel="nofollow" id="c2719544938727175963" href="#2719544938727175963">14 December 2011 03:18</a>
              </span>
            </div>
            <div class="comment-content">Sounds like http://www.psg.com/lists/multi6/multi6.2002/msg00860.html and section 4.2 in http://tools.ietf.org/id/draft-huitema-multi6-hosts-01.txt from 2002.</div>
          </div>
        </li>
      </div>
      <div>
        <li class="comment" id="6813856841876006468">
          <!--
          <div class="avatar-image-container">
            <img src="https://resources.blogblog.com/img/blank.gif">
          </div>
          -->
          <div class="comment-block">
            <div class="comment-header">
              <cite class="user"><a href="None" rel="nofollow">Ivan Pepelnjak</a></cite>
              <span class="datetime secondary-text">
                <a rel="nofollow" id="c6813856841876006468" href="#6813856841876006468">14 December 2011 08:23</a>
              </span>
            </div>
            <div class="comment-content">There are other even more stupid options (and no good ones). Here&#39;s a particularly harmful one:<br /><br />* Get an AS number<br />* Ask for a /32 (with enough &quot;positive thinking&quot; you might get one)<br />* Split the /32 into /48s (one per site) and start announcing /48s into the Internet from remote sites.<br /><br />On the other hand, assuming source address selection does work according to RFC 3484, ULA might be a good solution to your problem.</div>
          </div>
        </li>
      </div>
      <div>
        <li class="comment" id="2537742705857483071">
          <!--
          <div class="avatar-image-container">
            <img src="https://resources.blogblog.com/img/blank.gif">
          </div>
          -->
          <div class="comment-block">
            <div class="comment-header">
              <cite class="user"><a href="None" rel="nofollow">Patrick Frejborg</a></cite>
              <span class="datetime secondary-text">
                <a rel="nofollow" id="c2537742705857483071" href="#2537742705857483071">14 December 2011 18:34</a>
              </span>
            </div>
            <div class="comment-content">Have a look on RFC6306, look for exit and approach routing in the long term routing architecture - multi-homing would become multi-pathing and there would be a placeholder for an identifier to create a session layer in the stack.</div>
          </div>
        </li>
      </div>
      <div>
        <li class="comment" id="9142441922254192031">
          <!--
          <div class="avatar-image-container">
            <img src="https://resources.blogblog.com/img/blank.gif">
          </div>
          -->
          <div class="comment-block">
            <div class="comment-header">
              <cite class="user"><a href="None" rel="nofollow">nosx</a></cite>
              <span class="datetime secondary-text">
                <a rel="nofollow" id="c9142441922254192031" href="#9142441922254192031">17 December 2011 06:27</a>
              </span>
            </div>
            <div class="comment-content">This sounds like a misuse of IPv6. Why not use an administratively scoped address for &quot;internal communications&quot; and provider assigned unicast global space for the local internet surfing? Wouldnt that solve all of your problems?</div>
          </div>
        </li>
      </div>
      <div>
        <li class="comment" id="969948887962692040">
          <!--
          <div class="avatar-image-container">
            <img src="https://resources.blogblog.com/img/blank.gif">
          </div>
          -->
          <div class="comment-block">
            <div class="comment-header">
              <cite class="user"><a href="None" rel="nofollow">Ivan Pepelnjak</a></cite>
              <span class="datetime secondary-text">
                <a rel="nofollow" id="c969948887962692040" href="#969948887962692040">17 December 2011 07:56</a>
              </span>
            </div>
            <div class="comment-content">hsxx could probably solve his problems with ULAs, but the moment you want to have two Internet connections for redundancy (from every site) you&#39;re stuck.</div>
          </div>
        </li>
      </div>
      <div>
        <li class="comment" id="4592152795827146897">
          <!--
          <div class="avatar-image-container">
            <img src="https://resources.blogblog.com/img/blank.gif">
          </div>
          -->
          <div class="comment-block">
            <div class="comment-header">
              <cite class="user"><a href="None" rel="nofollow">nosx</a></cite>
              <span class="datetime secondary-text">
                <a rel="nofollow" id="c4592152795827146897" href="#4592152795827146897">17 December 2011 20:15</a>
              </span>
            </div>
            <div class="comment-content">Except for the fact that you can assign multiple PA blocks for every host network for internet access and the previously discussed host or network source-based provider affinity piece solved...<br /><br />Again, if you try to apply IPv4 thinking to IPv6, you will end up with the same problems. If you approach it from a new angle you will find new solutions that could potentially result in a far superior internet to what we have today.</div>
          </div>
        </li>
      </div>
      <div>
        <li class="comment" id="1206524152869190105">
          <!--
          <div class="avatar-image-container">
            <img src="https://resources.blogblog.com/img/blank.gif">
          </div>
          -->
          <div class="comment-block">
            <div class="comment-header">
              <cite class="user"><a href="None" rel="nofollow">Павел Доронин</a></cite>
              <span class="datetime secondary-text">
                <a rel="nofollow" id="c1206524152869190105" href="#1206524152869190105">06 February 2012 08:31</a>
              </span>
            </div>
            <div class="comment-content">CPE configuration<br /><br />interface FastEthernet0/0<br /> description Inside interface<br /> ipv6 address 2001::1/64<br /> ipv6 address 2002::1/64<br /> ipv6 nd router-preference High<br /> ipv6 nd ra interval 300 msec <br /> ipv6 nd ra lifetime 1 - when IPS goes down ra lifetime is only 1 second<br /> ipv6 nd ipv6 nd prefix 2001::1/64 5 2 - valid and preffered lifetime.<br /> ipv6 nd ipv6 nd prefix 2001::1/64 5 2 - not sure about particular values of this timers.<br /><br />Tested client (Cisco router with no ipv6 unicast-routing command) with CPE configuration above:<br />Client port configured<br /><br />Router(config-if)#ipv6 address autoconfig<br /><br />Router#sh ipv6 int f0/0<br />FastEthernet0/0 is up, line protocol is up<br />  IPv6 is enabled, link-local address is FE80::C200:85FF:FE00:0 <br />  No Virtual link-local address(es):<br />  Global unicast address(es):<br />    2001::C200:85FF:FE00:0, subnet is 2001::/64 [EUI/CAL/PRE]<br />      valid lifetime 4 preferred lifetime 1<br />    2002::C200:85FF:FE00:0, subnet is 2002::/64 [EUI/CAL/PRE]<br />      valid lifetime 4 preferred lifetime 1<br />  Joined group address(es):<br />    FF02::1<br />    FF02::1:FF00:0<br />  MTU is 1500 bytes<br />  ICMP error messages limited to one every 100 milliseconds<br />  ICMP redirects are enabled<br />  ICMP unreachables are sent<br />  ND DAD is enabled, number of DAD attempts: 1<br />  ND reachable time is 30000 milliseconds<br />  Default router is FE80::C201:85FF:FE00:0 on FastEthernet0/0<br /><br />We can see that client autoconfigure 2 different addresses from 2 different ISP&#39;s. So this can be any client (Windows, Linux etc.), and there is no need in total static IPv6 configuration, only on CPE router. (As far as I know DNS also can be configured from RA but i do not tested it yet.)<br /><br />Router#sh ipv6 routers<br />Router FE80::C201:85FF:FE00:0 on FastEthernet0/0, last update 0 min<br />  Hops 64, Lifetime 1 sec (not 1800 seconds), AddrFlag=0, OtherFlag=0, MTU=1500<br />  HomeAgentFlag=0, Preference=Medium<br />  Reachable time 0 msec, Retransmit time 0 msec<br />  Prefix 2001::/64 onlink autoconfig<br />    Valid lifetime 5, preferred lifetime 2<br />  Prefix 2002::/64 onlink autoconfig<br />    Valid lifetime 5, preferred lifetime 2<br /><br />For example, when the IPv6 client in our small network connects to the outside world, it might choose a source IPv6 address assigned by the wrong ISP. Use PBR: if address from ISP1 use ISP1 as next-hop, if from  ISP2 use ISP2. In this case we also do not need default routes.<br />And what happens if the link to ISP1 is down and the end-host chooses to use the source IP address belonging to ISP1?<br />When IPS1 is down, we use IP SLA to discover this and EEM to withdrawn ISP&#39;s 1 prefix 2001::1/64 from RA. This with happens with 300ms interval and RA lifetime is only 1 second in our case, so end host can&#39;t use source address from ISP1 anymore. Correct me please if i wrong.</div>
          </div>
        </li>
      </div>
      <div>
        <li class="comment" id="9049811281279552399">
          <!--
          <div class="avatar-image-container">
            <img src="https://resources.blogblog.com/img/blank.gif">
          </div>
          -->
          <div class="comment-block">
            <div class="comment-header">
              <cite class="user"><a href="None" rel="nofollow">Павел Доронин</a></cite>
              <span class="datetime secondary-text">
                <a rel="nofollow" id="c9049811281279552399" href="#9049811281279552399">07 February 2012 03:24</a>
              </span>
            </div>
            <div class="comment-content">You can also use DHCPv6 to assign two or more IP addresses to clients.<br />https://supportforums.cisco.com/message/3551460</div>
          </div>
        </li>
      </div>
      <div>
        <li class="comment" id="7880183966329400380">
          <!--
          <div class="avatar-image-container">
            <img src="https://resources.blogblog.com/img/blank.gif">
          </div>
          -->
          <div class="comment-block">
            <div class="comment-header">
              <cite class="user"><a href="None" rel="nofollow">Anonymous</a></cite>
              <span class="datetime secondary-text">
                <a rel="nofollow" id="c7880183966329400380" href="#7880183966329400380">26 June 2015 18:30</a>
              </span>
            </div>
            <div class="comment-content">The only way is to deprecate prefixes as soon it is known that the uplink is down. This is possible by setting the lifetime as soon it happens to zero preferred lifetime and announcing it.<br /><br />But this is still very problematic because some setups are also using stateful DHCPv6 and the problem persists. <br />The client would have to match also those stateful adresses. (Which is possible as those are also in &quot;dynamic&quot; nature). <br />But it is very likely to happen, that a &quot;lease&quot; get refreshed and so the address is again preferred. <br />And have tested it here, at least &quot;dhcpcd&quot; does not change addresses which got assigned by DHCPv6 to deprecated as soon a RA with zero preferred lifetime arrives.<br /><br />So there would be the need to actively handle it. It would need a routing protocol for source address selection.<br /><br />Sebastian Kricner</div>
          </div>
        </li>
      </div>
      <div>
        <li class="comment" id="1208976985145204244">
          <!--
          <div class="avatar-image-container">
            <img src="https://resources.blogblog.com/img/blank.gif">
          </div>
          -->
          <div class="comment-block">
            <div class="comment-header">
              <cite class="user"><a href="http://tuxwave.net" rel="nofollow">Sebastian Kricner</a></cite>
              <span class="datetime secondary-text">
                <a rel="nofollow" id="c1208976985145204244" href="#1208976985145204244">04 August 2015 03:40</a>
              </span>
            </div>
            <div class="comment-content">Also notice, there is DHCPv6 message type 10 (Reconfigure), which could be used. In current implementations it is just used for manual reconfiguration events by an DHCPv6 administrator. Like dibbler would check it´s lease db and notice changes in the configured prefix by the administrator. Then sending reconfigure messages to the clients. The reconfigure messages are needed to be authenticated. There is a good idea at the dibbler project regarding DHCPv6 authentication.<br /><br />Also, its not too hard to implement such notification daemons for networks, like in script languages. At edge routers its unproblematic to implement. It would notify the clients of vanished routes and so letting deprecating the affected addresses on the clients.<br /><br />Also there are some other ideas at some routing projects, like BIRD (implemented RA daemon, with monitoring on matching routes, sadly just stops or starts RA for the whole instance).<br /><br />Another good thing would be to manage the iproute2 addrlabel table with such notification daemon (setting network wide preferences for source address selection).<br /><br />As already written there are some ideas on routing projects involving both destination route and source address in a routing protocol.</div>
          </div>
        </li>
      </div>
  </ol>

    </div>
  </div>
</div>
